(self.webpackChunkthree_airboat_sim=self.webpackChunkthree_airboat_sim||[]).push([[179],{111:(_l,Po,Pt)=>{"use strict";function Rn(n){return"function"==typeof n}function Ln(n){const t=n(i=>{Error.call(i),i.stack=(new Error).stack});return t.prototype=Object.create(Error.prototype),t.prototype.constructor=t,t}const Q=Ln(n=>function(t){n(this),this.message=t?`${t.length} errors occurred during unsubscription:\n${t.map((i,r)=>`${r+1}) ${i.toString()}`).join("\n  ")}`:"",this.name="UnsubscriptionError",this.errors=t});function ge(n,e){if(n){const t=n.indexOf(e);0<=t&&n.splice(t,1)}}class ve{constructor(e){this.initialTeardown=e,this.closed=!1,this._parentage=null,this._finalizers=null}unsubscribe(){let e;if(!this.closed){this.closed=!0;const{_parentage:t}=this;if(t)if(this._parentage=null,Array.isArray(t))for(const s of t)s.remove(this);else t.remove(this);const{initialTeardown:i}=this;if(Rn(i))try{i()}catch(s){e=s instanceof Q?s.errors:[s]}const{_finalizers:r}=this;if(r){this._finalizers=null;for(const s of r)try{oe(s)}catch(o){e=e??[],o instanceof Q?e=[...e,...o.errors]:e.push(o)}}if(e)throw new Q(e)}}add(e){var t;if(e&&e!==this)if(this.closed)oe(e);else{if(e instanceof ve){if(e.closed||e._hasParent(this))return;e._addParent(this)}(this._finalizers=null!==(t=this._finalizers)&&void 0!==t?t:[]).push(e)}}_hasParent(e){const{_parentage:t}=this;return t===e||Array.isArray(t)&&t.includes(e)}_addParent(e){const{_parentage:t}=this;this._parentage=Array.isArray(t)?(t.push(e),t):t?[t,e]:e}_removeParent(e){const{_parentage:t}=this;t===e?this._parentage=null:Array.isArray(t)&&ge(t,e)}remove(e){const{_finalizers:t}=this;t&&ge(t,e),e instanceof ve&&e._removeParent(this)}}ve.EMPTY=(()=>{const n=new ve;return n.closed=!0,n})();const Dt=ve.EMPTY;function Mt(n){return n instanceof ve||n&&"closed"in n&&Rn(n.remove)&&Rn(n.add)&&Rn(n.unsubscribe)}function oe(n){Rn(n)?n():n.unsubscribe()}const v={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1},Ke={setTimeout(n,e,...t){const{delegate:i}=Ke;return i?.setTimeout?i.setTimeout(n,e,...t):setTimeout(n,e,...t)},clearTimeout(n){const{delegate:e}=Ke;return(e?.clearTimeout||clearTimeout)(n)},delegate:void 0};function He(n){Ke.setTimeout(()=>{const{onUnhandledError:e}=v;if(!e)throw n;e(n)})}function E(){}const P=Ae("C",void 0,void 0);function Ae(n,e,t){return{kind:n,value:e,error:t}}let X=null;function ne(n){if(v.useDeprecatedSynchronousErrorHandling){const e=!X;if(e&&(X={errorThrown:!1,error:null}),n(),e){const{errorThrown:t,error:i}=X;if(X=null,t)throw i}}else n()}class dn extends ve{constructor(e){super(),this.isStopped=!1,e?(this.destination=e,Mt(e)&&e.add(this)):this.destination=zi}static create(e,t,i){return new yr(e,t,i)}next(e){this.isStopped?Zs(function ae(n){return Ae("N",n,void 0)}(e),this):this._next(e)}error(e){this.isStopped?Zs(function Y(n){return Ae("E",void 0,n)}(e),this):(this.isStopped=!0,this._error(e))}complete(){this.isStopped?Zs(P,this):(this.isStopped=!0,this._complete())}unsubscribe(){this.closed||(this.isStopped=!0,super.unsubscribe(),this.destination=null)}_next(e){this.destination.next(e)}_error(e){try{this.destination.error(e)}finally{this.unsubscribe()}}_complete(){try{this.destination.complete()}finally{this.unsubscribe()}}}const Wn=Function.prototype.bind;function ai(n,e){return Wn.call(n,e)}class Ss{constructor(e){this.partialObserver=e}next(e){const{partialObserver:t}=this;if(t.next)try{t.next(e)}catch(i){xr(i)}}error(e){const{partialObserver:t}=this;if(t.error)try{t.error(e)}catch(i){xr(i)}else xr(e)}complete(){const{partialObserver:e}=this;if(e.complete)try{e.complete()}catch(t){xr(t)}}}class yr extends dn{constructor(e,t,i){let r;if(super(),Rn(e)||!e)r={next:e??void 0,error:t??void 0,complete:i??void 0};else{let s;this&&v.useDeprecatedNextContext?(s=Object.create(e),s.unsubscribe=()=>this.unsubscribe(),r={next:e.next&&ai(e.next,s),error:e.error&&ai(e.error,s),complete:e.complete&&ai(e.complete,s)}):r=e}this.destination=new Ss(r)}}function xr(n){v.useDeprecatedSynchronousErrorHandling?function mt(n){v.useDeprecatedSynchronousErrorHandling&&X&&(X.errorThrown=!0,X.error=n)}(n):He(n)}function Zs(n,e){const{onStoppedNotification:t}=v;t&&Ke.setTimeout(()=>t(n,e))}const zi={closed:!0,next:E,error:function Mn(n){throw n},complete:E},ha="function"==typeof Symbol&&Symbol.observable||"@@observable";function Lo(n){return n}let en=(()=>{class n{constructor(t){t&&(this._subscribe=t)}lift(t){const i=new n;return i.source=this,i.operator=t,i}subscribe(t,i,r){const s=function Ji(n){return n&&n instanceof dn||function Ii(n){return n&&Rn(n.next)&&Rn(n.error)&&Rn(n.complete)}(n)&&Mt(n)}(t)?t:new yr(t,i,r);return ne(()=>{const{operator:o,source:a}=this;s.add(o?o.call(s,a):a?this._subscribe(s):this._trySubscribe(s))}),s}_trySubscribe(t){try{return this._subscribe(t)}catch(i){t.error(i)}}forEach(t,i){return new(i=on(i))((r,s)=>{const o=new yr({next:a=>{try{t(a)}catch(l){s(l),o.unsubscribe()}},error:s,complete:r});this.subscribe(o)})}_subscribe(t){var i;return null===(i=this.source)||void 0===i?void 0:i.subscribe(t)}[ha](){return this}pipe(...t){return function bi(n){return 0===n.length?Lo:1===n.length?n[0]:function(t){return n.reduce((i,r)=>r(i),t)}}(t)(this)}toPromise(t){return new(t=on(t))((i,r)=>{let s;this.subscribe(o=>s=o,o=>r(o),()=>i(s))})}}return n.create=e=>new n(e),n})();function on(n){var e;return null!==(e=n??v.Promise)&&void 0!==e?e:Promise}const gl=Ln(n=>function(){n(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"});let da=(()=>{class n extends en{constructor(){super(),this.closed=!1,this.currentObservers=null,this.observers=[],this.isStopped=!1,this.hasError=!1,this.thrownError=null}lift(t){const i=new hu(this,this);return i.operator=t,i}_throwIfClosed(){if(this.closed)throw new gl}next(t){ne(()=>{if(this._throwIfClosed(),!this.isStopped){this.currentObservers||(this.currentObservers=Array.from(this.observers));for(const i of this.currentObservers)i.next(t)}})}error(t){ne(()=>{if(this._throwIfClosed(),!this.isStopped){this.hasError=this.isStopped=!0,this.thrownError=t;const{observers:i}=this;for(;i.length;)i.shift().error(t)}})}complete(){ne(()=>{if(this._throwIfClosed(),!this.isStopped){this.isStopped=!0;const{observers:t}=this;for(;t.length;)t.shift().complete()}})}unsubscribe(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null}get observed(){var t;return(null===(t=this.observers)||void 0===t?void 0:t.length)>0}_trySubscribe(t){return this._throwIfClosed(),super._trySubscribe(t)}_subscribe(t){return this._throwIfClosed(),this._checkFinalizedStatuses(t),this._innerSubscribe(t)}_innerSubscribe(t){const{hasError:i,isStopped:r,observers:s}=this;return i||r?Dt:(this.currentObservers=null,s.push(t),new ve(()=>{this.currentObservers=null,ge(s,t)}))}_checkFinalizedStatuses(t){const{hasError:i,thrownError:r,isStopped:s}=this;i?t.error(r):s&&t.complete()}asObservable(){const t=new en;return t.source=this,t}}return n.create=(e,t)=>new hu(e,t),n})();class hu extends da{constructor(e,t){super(),this.destination=e,this.source=t}next(e){var t,i;null===(i=null===(t=this.destination)||void 0===t?void 0:t.next)||void 0===i||i.call(t,e)}error(e){var t,i;null===(i=null===(t=this.destination)||void 0===t?void 0:t.error)||void 0===i||i.call(t,e)}complete(){var e,t;null===(t=null===(e=this.destination)||void 0===e?void 0:e.complete)||void 0===t||t.call(e)}_subscribe(e){var t,i;return null!==(i=null===(t=this.source)||void 0===t?void 0:t.subscribe(e))&&void 0!==i?i:Dt}}class Em extends da{constructor(e){super(),this._value=e}get value(){return this.getValue()}_subscribe(e){const t=super._subscribe(e);return!t.closed&&e.next(this._value),t}getValue(){const{hasError:e,thrownError:t,_value:i}=this;if(e)throw t;return this._throwIfClosed(),i}next(e){super.next(this._value=e)}}function Js(n){return e=>{if(function Tm(n){return Rn(n?.lift)}(e))return e.lift(function(t){try{return n(t,this)}catch(i){this.error(i)}});throw new TypeError("Unable to lift unknown Observable type")}}function br(n,e,t,i,r){return new Bn(n,e,t,i,r)}class Bn extends dn{constructor(e,t,i,r,s,o){super(e),this.onFinalize=s,this.shouldUnsubscribe=o,this._next=t?function(a){try{t(a)}catch(l){e.error(l)}}:super._next,this._error=r?function(a){try{r(a)}catch(l){e.error(l)}finally{this.unsubscribe()}}:super._error,this._complete=i?function(){try{i()}catch(a){e.error(a)}finally{this.unsubscribe()}}:super._complete}unsubscribe(){var e;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){const{closed:t}=this;super.unsubscribe(),!t&&(null===(e=this.onFinalize)||void 0===e||e.call(this))}}}function Qr(n){return this instanceof Qr?(this.v=n,this):new Qr(n)}function yd(n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t,e=n[Symbol.asyncIterator];return e?e.call(n):(n=function mu(n){var e="function"==typeof Symbol&&Symbol.iterator,t=e&&n[e],i=0;if(t)return t.call(n);if(n&&"number"==typeof n.length)return{next:function(){return n&&i>=n.length&&(n=void 0),{value:n&&n[i++],done:!n}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}(n),t={},i("next"),i("throw"),i("return"),t[Symbol.asyncIterator]=function(){return this},t);function i(s){t[s]=n[s]&&function(o){return new Promise(function(a,l){!function r(s,o,a,l){Promise.resolve(l).then(function(u){s({value:u,done:a})},o)}(a,l,(o=n[s](o)).done,o.value)})}}}"function"==typeof SuppressedError&&SuppressedError;const yl=n=>n&&"number"==typeof n.length&&"function"!=typeof n;function ns(n){return Rn(n?.then)}function bd(n){return Rn(n[ha])}function xl(n){return Symbol.asyncIterator&&Rn(n?.[Symbol.asyncIterator])}function Ad(n){return new TypeError(`You provided ${null!==n&&"object"==typeof n?"an invalid object":`'${n}'`} where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.`)}const Or=function vu(){return"function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator"}();function Fo(n){return Rn(n?.[Or])}function ma(n){return function No(n,e,t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r,i=t.apply(n,e||[]),s=[];return r={},o("next"),o("throw"),o("return"),r[Symbol.asyncIterator]=function(){return this},r;function o(p){i[p]&&(r[p]=function(_){return new Promise(function(y,w){s.push([p,_,y,w])>1||a(p,_)})})}function a(p,_){try{!function l(p){p.value instanceof Qr?Promise.resolve(p.value.v).then(u,d):f(s[0][2],p)}(i[p](_))}catch(y){f(s[0][3],y)}}function u(p){a("next",p)}function d(p){a("throw",p)}function f(p,_){p(_),s.shift(),s.length&&a(s[0][0],s[0][1])}}(this,arguments,function*(){const t=n.getReader();try{for(;;){const{value:i,done:r}=yield Qr(t.read());if(r)return yield Qr(void 0);yield yield Qr(i)}}finally{t.releaseLock()}})}function _a(n){return Rn(n?.getReader)}function ar(n){if(n instanceof en)return n;if(null!=n){if(bd(n))return function Bm(n){return new en(e=>{const t=n[ha]();if(Rn(t.subscribe))return t.subscribe(e);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}(n);if(yl(n))return function is(n){return new en(e=>{for(let t=0;t<n.length&&!e.closed;t++)e.next(n[t]);e.complete()})}(n);if(ns(n))return function bl(n){return new en(e=>{n.then(t=>{e.closed||(e.next(t),e.complete())},t=>e.error(t)).then(null,He)})}(n);if(xl(n))return Al(n);if(Fo(n))return function yu(n){return new en(e=>{for(const t of n)if(e.next(t),e.closed)return;e.complete()})}(n);if(_a(n))return function wd(n){return Al(ma(n))}(n)}throw Ad(n)}function Al(n){return new en(e=>{(function Fm(n,e){var t,i,r,s;return function md(n,e,t,i){return new(t||(t=Promise))(function(s,o){function a(d){try{u(i.next(d))}catch(f){o(f)}}function l(d){try{u(i.throw(d))}catch(f){o(f)}}function u(d){d.done?s(d.value):function r(s){return s instanceof t?s:new t(function(o){o(s)})}(d.value).then(a,l)}u((i=i.apply(n,e||[])).next())})}(this,void 0,void 0,function*(){try{for(t=yd(n);!(i=yield t.next()).done;)if(e.next(i.value),e.closed)return}catch(o){r={error:o}}finally{try{i&&!i.done&&(s=t.return)&&(yield s.call(t))}finally{if(r)throw r.error}}e.complete()})})(n,e).catch(t=>e.error(t))})}function Vr(n,e,t,i=0,r=!1){const s=e.schedule(function(){t(),r?n.add(this.schedule(null,i)):this.unsubscribe()},i);if(n.add(s),!r)return s}function wl(n,e,t=1/0){return Rn(e)?wl((i,r)=>function du(n,e){return Js((t,i)=>{let r=0;t.subscribe(br(i,s=>{i.next(n.call(e,s,r++))}))})}((s,o)=>e(i,s,r,o))(ar(n(i,r))),t):("number"==typeof e&&(t=e),Js((i,r)=>function Om(n,e,t,i,r,s,o,a){const l=[];let u=0,d=0,f=!1;const p=()=>{f&&!l.length&&!u&&e.complete()},_=w=>u<i?y(w):l.push(w),y=w=>{s&&e.next(w),u++;let A=!1;ar(t(w,d++)).subscribe(br(e,b=>{r?.(b),s?_(b):e.next(b)},()=>{A=!0},void 0,()=>{if(A)try{for(u--;l.length&&u<i;){const b=l.shift();o?Vr(e,o,()=>y(b)):y(b)}p()}catch(b){e.error(b)}}))};return n.subscribe(br(e,_,()=>{f=!0,p()})),()=>{a?.()}}(i,r,n,t)))}const Ml=new en(n=>n.complete());function ga(n){return n[n.length-1]}function Md(n){return function km(n){return n&&Rn(n.schedule)}(ga(n))?n.pop():void 0}function Sl(n,e=0){return Js((t,i)=>{t.subscribe(br(i,r=>Vr(i,n,()=>i.next(r),e),()=>Vr(i,n,()=>i.complete(),e),r=>Vr(i,n,()=>i.error(r),e)))})}function Sd(n,e=0){return Js((t,i)=>{i.add(n.schedule(()=>t.subscribe(i),e))})}function va(n,e){if(!n)throw new Error("Iterable cannot be null");return new en(t=>{Vr(t,e,()=>{const i=n[Symbol.asyncIterator]();Vr(t,e,()=>{i.next().then(r=>{r.done?t.complete():t.next(r.value)})},0,!0)})})}function wu(n,e){return e?function Wm(n,e){if(null!=n){if(bd(n))return function bu(n,e){return ar(n).pipe(Sd(e),Sl(e))}(n,e);if(yl(n))return function Au(n,e){return new en(t=>{let i=0;return e.schedule(function(){i===n.length?t.complete():(t.next(n[i++]),t.closed||this.schedule())})})}(n,e);if(ns(n))return function Hm(n,e){return ar(n).pipe(Sd(e),Sl(e))}(n,e);if(xl(n))return va(n,e);if(Fo(n))return function Gm(n,e){return new en(t=>{let i;return Vr(t,e,()=>{i=n[Or](),Vr(t,e,()=>{let r,s;try{({value:r,done:s}=i.next())}catch(o){return void t.error(o)}s?t.complete():t.next(r)},0,!0)}),()=>Rn(i?.return)&&i.return()})}(n,e);if(_a(n))return function Ed(n,e){return va(ma(n),e)}(n,e)}throw Ad(n)}(n,e):ar(n)}function qm(...n){const e=Md(n),t=function zm(n,e){return"number"==typeof ga(n)?n.pop():e}(n,1/0),i=n;return i.length?1===i.length?ar(i[0]):function Vm(n=1/0){return wl(Lo,n)}(t)(wu(i,e)):Ml}function El(n={}){const{connector:e=(()=>new da),resetOnError:t=!0,resetOnComplete:i=!0,resetOnRefCountZero:r=!0}=n;return s=>{let o,a,l,u=0,d=!1,f=!1;const p=()=>{a?.unsubscribe(),a=void 0},_=()=>{p(),o=l=void 0,d=f=!1},y=()=>{const w=o;_(),w?.unsubscribe()};return Js((w,A)=>{u++,!f&&!d&&p();const b=l=l??e();A.add(()=>{u--,0===u&&!f&&!d&&(a=Mu(y,r))}),b.subscribe(A),!o&&u>0&&(o=new yr({next:C=>b.next(C),error:C=>{f=!0,p(),a=Mu(_,t,C),b.error(C)},complete:()=>{d=!0,p(),a=Mu(_,i),b.complete()}}),ar(w).subscribe(o))})(s)}}function Mu(n,e,...t){if(!0===e)return void n();if(!1===e)return;const i=new yr({next:()=>{i.unsubscribe(),n()}});return ar(e(...t)).subscribe(i)}function Oo(n,e){return n===e}function Sn(n){for(let e in n)if(n[e]===Sn)return e;throw Error("Could not find renamed property on target object.")}function Kn(n){if("string"==typeof n)return n;if(Array.isArray(n))return"["+n.map(Kn).join(", ")+"]";if(null==n)return""+n;if(n.overriddenName)return`${n.overriddenName}`;if(n.name)return`${n.name}`;const e=n.toString();if(null==e)return""+e;const t=e.indexOf("\n");return-1===t?e:e.substring(0,t)}function Su(n,e){return null==n||""===n?null===e?"":e:null==e||""===e?n:n+" "+e}const Xm=Sn({__forward_ref__:Sn});function jn(n){return n.__forward_ref__=jn,n.toString=function(){return Kn(this())},n}function St(n){return function Cl(n){return"function"==typeof n&&n.hasOwnProperty(Xm)&&n.__forward_ref__===jn}(n)?n():n}function Eu(n){return n&&!!n.\u0275providers}class Xe extends Error{constructor(e,t){super(function zn(n,e){return`NG0${Math.abs(n)}${e?": "+e:""}`}(e,t)),this.code=e}}function Ge(n){return"string"==typeof n?n:null==n?"":String(n)}function h(n,e){throw new Xe(-201,!1)}function ee(n,e){null==n&&function Z(n,e,t,i){throw new Error(`ASSERTION ERROR: ${n}`+(null==i?"":` [Expected=> ${t} ${i} ${e} <=Actual]`))}(e,n,null,"!=")}function de(n){return{token:n.token,providedIn:n.providedIn||null,factory:n.factory,value:void 0}}function Oe(n){return{providers:n.providers||[],imports:n.imports||[]}}function ze(n){return pt(n,Rt)||pt(n,Gt)}function pt(n,e){return n.hasOwnProperty(e)?n[e]:null}function Ue(n){return n&&(n.hasOwnProperty(Tt)||n.hasOwnProperty(En))?n[Tt]:null}const Rt=Sn({\u0275prov:Sn}),Tt=Sn({\u0275inj:Sn}),Gt=Sn({ngInjectableDef:Sn}),En=Sn({ngInjectorDef:Sn});var rt=(()=>((rt=rt||{})[rt.Default=0]="Default",rt[rt.Host=1]="Host",rt[rt.Self=2]="Self",rt[rt.SkipSelf=4]="SkipSelf",rt[rt.Optional=8]="Optional",rt))();let _n;function dt(n){const e=_n;return _n=n,e}function Ut(n,e,t){const i=ze(n);return i&&"root"==i.providedIn?void 0===i.value?i.value=i.factory():i.value:t&rt.Optional?null:void 0!==e?e:void h(Kn(n))}const zt=(()=>typeof globalThis<"u"&&globalThis||typeof global<"u"&&global||typeof window<"u"&&window||typeof self<"u"&&typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&self)(),cr={},Es="__NG_DI_FLAG__",Li="ngTempTokenPath",Vo=/\n/gm,Ur="__source";let Dl;function Uo(n){const e=Dl;return Dl=n,e}function pI(n,e=rt.Default){if(void 0===Dl)throw new Xe(-203,!1);return null===Dl?Ut(n,void 0,e):Dl.get(n,e&rt.Optional?null:void 0,e)}function bn(n,e=rt.Default){return(function bt(){return _n}()||pI)(St(n),e)}function Hn(n,e=rt.Default){return bn(n,Cd(e))}function Cd(n){return typeof n>"u"||"number"==typeof n?n:0|(n.optional&&8)|(n.host&&1)|(n.self&&2)|(n.skipSelf&&4)}function Ym(n){const e=[];for(let t=0;t<n.length;t++){const i=St(n[t]);if(Array.isArray(i)){if(0===i.length)throw new Xe(900,!1);let r,s=rt.Default;for(let o=0;o<i.length;o++){const a=i[o],l=mI(a);"number"==typeof l?-1===l?r=a.token:s|=l:r=a}e.push(bn(r,s))}else e.push(bn(i))}return e}function mI(n){return n[Es]}function eo(n){return{toString:n}.toString()}var Ts=(()=>((Ts=Ts||{})[Ts.OnPush=0]="OnPush",Ts[Ts.Default=1]="Default",Ts))(),Mr=(()=>{return(n=Mr||(Mr={}))[n.Emulated=0]="Emulated",n[n.None=2]="None",n[n.ShadowDom=3]="ShadowDom",Mr;var n})();const Cs={},Cn=[],Dd=Sn({\u0275cmp:Sn}),Zm=Sn({\u0275dir:Sn}),Jm=Sn({\u0275pipe:Sn}),ux=Sn({\u0275mod:Sn}),to=Sn({\u0275fac:Sn}),Cu=Sn({__NG_ELEMENT_ID__:Sn}),hx=Sn({__NG_ENV_ID__:Sn});function dx(n,e,t){let i=n.length;for(;;){const r=n.indexOf(e,t);if(-1===r)return r;if(0===r||n.charCodeAt(r-1)<=32){const s=e.length;if(r+s===i||n.charCodeAt(r+s)<=32)return r}t=r+1}}function Km(n,e,t){let i=0;for(;i<t.length;){const r=t[i];if("number"==typeof r){if(0!==r)break;i++;const s=t[i++],o=t[i++],a=t[i++];n.setAttribute(e,o,a,s)}else{const s=r,o=t[++i];px(s)?n.setProperty(e,s,o):n.setAttribute(e,s,o),i++}}return i}function fx(n){return 3===n||4===n||6===n}function px(n){return 64===n.charCodeAt(0)}function Du(n,e){if(null!==e&&0!==e.length)if(null===n||0===n.length)n=e.slice();else{let t=-1;for(let i=0;i<e.length;i++){const r=e[i];"number"==typeof r?t=r:0===t||mx(n,t,r,null,-1===t||2===t?e[++i]:null)}}return n}function mx(n,e,t,i,r){let s=0,o=n.length;if(-1===e)o=-1;else for(;s<n.length;){const a=n[s++];if("number"==typeof a){if(a===e){o=-1;break}if(a>e){o=s-1;break}}}for(;s<n.length;){const a=n[s];if("number"==typeof a)break;if(a===t){if(null===i)return void(null!==r&&(n[s+1]=r));if(i===n[s+1])return void(n[s+2]=r)}s++,null!==i&&s++,null!==r&&s++}-1!==o&&(n.splice(o,0,e),s=o+1),n.splice(s++,0,t),null!==i&&n.splice(s++,0,i),null!==r&&n.splice(s++,0,r)}const _x="ng-template";function vI(n,e,t){let i=0,r=!0;for(;i<n.length;){let s=n[i++];if("string"==typeof s&&r){const o=n[i++];if(t&&"class"===s&&-1!==dx(o.toLowerCase(),e,0))return!0}else{if(1===s){for(;i<n.length&&"string"==typeof(s=n[i++]);)if(s.toLowerCase()===e)return!0;return!1}"number"==typeof s&&(r=!1)}}return!1}function gx(n){return 4===n.type&&n.value!==_x}function yI(n,e,t){return e===(4!==n.type||t?n.value:_x)}function xI(n,e,t){let i=4;const r=n.attrs||[],s=function wI(n){for(let e=0;e<n.length;e++)if(fx(n[e]))return e;return n.length}(r);let o=!1;for(let a=0;a<e.length;a++){const l=e[a];if("number"!=typeof l){if(!o)if(4&i){if(i=2|1&i,""!==l&&!yI(n,l,t)||""===l&&1===e.length){if(os(i))return!1;o=!0}}else{const u=8&i?l:e[++a];if(8&i&&null!==n.attrs){if(!vI(n.attrs,u,t)){if(os(i))return!1;o=!0}continue}const f=bI(8&i?"class":l,r,gx(n),t);if(-1===f){if(os(i))return!1;o=!0;continue}if(""!==u){let p;p=f>s?"":r[f+1].toLowerCase();const _=8&i?p:null;if(_&&-1!==dx(_,u,0)||2&i&&u!==p){if(os(i))return!1;o=!0}}}}else{if(!o&&!os(i)&&!os(l))return!1;if(o&&os(l))continue;o=!1,i=l|1&i}}return os(i)||o}function os(n){return 0==(1&n)}function bI(n,e,t,i){if(null===e)return-1;let r=0;if(i||!t){let s=!1;for(;r<e.length;){const o=e[r];if(o===n)return r;if(3===o||6===o)s=!0;else{if(1===o||2===o){let a=e[++r];for(;"string"==typeof a;)a=e[++r];continue}if(4===o)break;if(0===o){r+=4;continue}}r+=s?1:2}return-1}return function MI(n,e){let t=n.indexOf(4);if(t>-1)for(t++;t<n.length;){const i=n[t];if("number"==typeof i)return-1;if(i===e)return t;t++}return-1}(e,n)}function vx(n,e,t=!1){for(let i=0;i<e.length;i++)if(xI(n,e[i],t))return!0;return!1}function yx(n,e){return n?":not("+e.trim()+")":e}function EI(n){let e=n[0],t=1,i=2,r="",s=!1;for(;t<n.length;){let o=n[t];if("string"==typeof o)if(2&i){const a=n[++t];r+="["+o+(a.length>0?'="'+a+'"':"")+"]"}else 8&i?r+="."+o:4&i&&(r+=" "+o);else""!==r&&!os(o)&&(e+=yx(s,r),r=""),i=o,s=s||!os(i);t++}return""!==r&&(e+=yx(s,r)),e}function Qm(n){return eo(()=>{const e=bx(n),t={...e,decls:n.decls,vars:n.vars,template:n.template,consts:n.consts||null,ngContentSelectors:n.ngContentSelectors,onPush:n.changeDetection===Ts.OnPush,directiveDefs:null,pipeDefs:null,dependencies:e.standalone&&n.dependencies||null,getStandaloneInjector:null,signals:n.signals??!1,data:n.data||{},encapsulation:n.encapsulation||Mr.Emulated,styles:n.styles||Cn,_:null,schemas:n.schemas||null,tView:null,id:""};Ax(t);const i=n.dependencies;return t.directiveDefs=Id(i,!1),t.pipeDefs=Id(i,!0),t.id=function NI(n){let e=0;const t=[n.selectors,n.ngContentSelectors,n.hostVars,n.hostAttrs,n.consts,n.vars,n.decls,n.encapsulation,n.standalone,n.signals,n.exportAs,JSON.stringify(n.inputs),JSON.stringify(n.outputs),Object.getOwnPropertyNames(n.type.prototype),!!n.contentQueries,!!n.viewQuery].join("|");for(const r of t)e=Math.imul(31,e)+r.charCodeAt(0)<<0;return e+=2147483648,"c"+e}(t),t})}function II(n){return Pn(n)||Hi(n)}function RI(n){return null!==n}function Iu(n){return eo(()=>({type:n.type,bootstrap:n.bootstrap||Cn,declarations:n.declarations||Cn,imports:n.imports||Cn,exports:n.exports||Cn,transitiveCompileScopes:null,schemas:n.schemas||null,id:n.id||null}))}function xx(n,e){if(null==n)return Cs;const t={};for(const i in n)if(n.hasOwnProperty(i)){let r=n[i],s=r;Array.isArray(r)&&(s=r[1],r=r[0]),t[r]=i,e&&(e[r]=s)}return t}function zr(n){return eo(()=>{const e=bx(n);return Ax(e),e})}function ur(n){return{type:n.type,name:n.name,factory:null,pure:!1!==n.pure,standalone:!0===n.standalone,onDestroy:n.type.prototype.ngOnDestroy||null}}function Pn(n){return n[Dd]||null}function Hi(n){return n[Zm]||null}function hr(n){return n[Jm]||null}function bx(n){const e={};return{type:n.type,providersResolver:null,factory:null,hostBindings:n.hostBindings||null,hostVars:n.hostVars||0,hostAttrs:n.hostAttrs||null,contentQueries:n.contentQueries||null,declaredInputs:e,inputTransforms:null,inputConfig:n.inputs||Cs,exportAs:n.exportAs||null,standalone:!0===n.standalone,signals:!0===n.signals,selectors:n.selectors||Cn,viewQuery:n.viewQuery||null,features:n.features||null,setInput:null,findHostDirectiveDefs:null,hostDirectives:null,inputs:xx(n.inputs,e),outputs:xx(n.outputs)}}function Ax(n){n.features?.forEach(e=>e(n))}function Id(n,e){if(!n)return null;const t=e?hr:II;return()=>("function"==typeof n?n():n).map(i=>t(i)).filter(RI)}const Ai=0,ut=1,Xt=2,$n=3,as=4,Pu=5,Gi=6,Il=7,fi=8,Rl=9,ya=10,Yt=11,Lu=12,wx=13,Pl=14,pi=15,Nu=16,Ll=17,Ds=18,Bu=19,Mx=20,zo=21,no=22,Rd=23,Pd=24,gn=25,e_=1,Sx=2,Is=7,Nl=9,Wi=11;function Er(n){return Array.isArray(n)&&"object"==typeof n[e_]}function dr(n){return Array.isArray(n)&&!0===n[e_]}function t_(n){return 0!=(4&n.flags)}function xa(n){return n.componentOffset>-1}function Nd(n){return 1==(1&n.flags)}function ls(n){return!!n.template}function n_(n){return 0!=(512&n[Xt])}function ba(n,e){return n.hasOwnProperty(to)?n[to]:null}let UI=zt.WeakRef??class kI{constructor(e){this.ref=e}deref(){return this.ref}},HI=0,Rs=null,Bd=!1;function Ni(n){const e=Rs;return Rs=n,e}class Ix{constructor(){this.id=HI++,this.ref=function zI(n){return new UI(n)}(this),this.producers=new Map,this.consumers=new Map,this.trackingVersion=0,this.valueVersion=0}consumerPollProducersForChange(){for(const[e,t]of this.producers){const i=t.producerNode.deref();if(void 0!==i&&t.atTrackingVersion===this.trackingVersion){if(i.producerPollStatus(t.seenValueVersion))return!0}else this.producers.delete(e),i?.consumers.delete(this.id)}return!1}producerMayHaveChanged(){const e=Bd;Bd=!0;try{for(const[t,i]of this.consumers){const r=i.consumerNode.deref();void 0!==r&&r.trackingVersion===i.atTrackingVersion?r.onConsumerDependencyMayHaveChanged():(this.consumers.delete(t),r?.producers.delete(this.id))}}finally{Bd=e}}producerAccessed(){if(Bd)throw new Error("");if(null===Rs)return;let e=Rs.producers.get(this.id);void 0===e?(e={consumerNode:Rs.ref,producerNode:this.ref,seenValueVersion:this.valueVersion,atTrackingVersion:Rs.trackingVersion},Rs.producers.set(this.id,e),this.consumers.set(Rs.id,e)):(e.seenValueVersion=this.valueVersion,e.atTrackingVersion=Rs.trackingVersion)}get hasProducers(){return this.producers.size>0}get producerUpdatesAllowed(){return!1!==Rs?.consumerAllowSignalWrites}producerPollStatus(e){return this.valueVersion!==e||(this.onProducerUpdateValueVersion(),this.valueVersion!==e)}}let Rx=null;const Lx=()=>{};class jI extends Ix{constructor(e,t,i){super(),this.watch=e,this.schedule=t,this.dirty=!1,this.cleanupFn=Lx,this.registerOnCleanup=r=>{this.cleanupFn=r},this.consumerAllowSignalWrites=i}notify(){this.dirty||this.schedule(this),this.dirty=!0}onConsumerDependencyMayHaveChanged(){this.notify()}onProducerUpdateValueVersion(){}run(){if(this.dirty=!1,0!==this.trackingVersion&&!this.consumerPollProducersForChange())return;const e=Ni(this);this.trackingVersion++;try{this.cleanupFn(),this.cleanupFn=Lx,this.watch(this.registerOnCleanup)}finally{Ni(e)}}cleanup(){this.cleanupFn()}}class $I{constructor(e,t,i){this.previousValue=e,this.currentValue=t,this.firstChange=i}isFirstChange(){return this.firstChange}}function Nx(n){return n.type.prototype.ngOnChanges&&(n.setInput=YI),XI}function XI(){const n=Fx(this),e=n?.current;if(e){const t=n.previous;if(t===Cs)n.previous=e;else for(let i in e)t[i]=e[i];n.current=null,this.ngOnChanges(e)}}function YI(n,e,t,i){const r=this.declaredInputs[t],s=Fx(n)||function ZI(n,e){return n[Bx]=e}(n,{previous:Cs,current:null}),o=s.current||(s.current={}),a=s.previous,l=a[r];o[r]=new $I(l&&l.currentValue,e,a===Cs),n[i]=e}const Bx="__ngSimpleChanges__";function Fx(n){return n[Bx]||null}const Ps=function(n,e,t){};function Un(n){for(;Array.isArray(n);)n=n[Ai];return n}function fr(n,e){return Un(e[n.index])}function kx(n,e){return n.data[e]}function Bl(n,e){return n[e]}function Tr(n,e){const t=e[n];return Er(t)?t:t[Ai]}function Ho(n,e){return null==e?null:n[e]}function Ux(n){n[Ll]=0}function iR(n){1024&n[Xt]||(n[Xt]|=1024,Hx(n,1))}function zx(n){1024&n[Xt]&&(n[Xt]&=-1025,Hx(n,-1))}function Hx(n,e){let t=n[$n];if(null===t)return;t[Pu]+=e;let i=t;for(t=t[$n];null!==t&&(1===e&&1===i[Pu]||-1===e&&0===i[Pu]);)t[Pu]+=e,i=t,t=t[$n]}const Ht={lFrame:tb(null),bindingsEnabled:!0,skipHydrationRootTNode:null};function qx(){return Ht.bindingsEnabled}function Ne(){return Ht.lFrame.lView}function An(){return Ht.lFrame.tView}function Ui(){let n=Xx();for(;null!==n&&64===n.type;)n=n.parent;return n}function Xx(){return Ht.lFrame.currentTNode}function Ls(n,e){const t=Ht.lFrame;t.currentTNode=n,t.isParent=e}function l_(){return Ht.lFrame.isParent}function Ki(){const n=Ht.lFrame;let e=n.bindingRootIndex;return-1===e&&(e=n.bindingRootIndex=n.tView.bindingStartIndex),e}function Ol(){return Ht.lFrame.bindingIndex++}function mR(n,e){const t=Ht.lFrame;t.bindingIndex=t.bindingRootIndex=n,u_(e)}function u_(n){Ht.lFrame.currentDirectiveIndex=n}function Kx(){return Ht.lFrame.currentQueryIndex}function d_(n){Ht.lFrame.currentQueryIndex=n}function gR(n){const e=n[ut];return 2===e.type?e.declTNode:1===e.type?n[Gi]:null}function Qx(n,e,t){if(t&rt.SkipSelf){let r=e,s=n;for(;!(r=r.parent,null!==r||t&rt.Host||(r=gR(s),null===r||(s=s[Pl],10&r.type))););if(null===r)return!1;e=r,n=s}const i=Ht.lFrame=eb();return i.currentTNode=e,i.lView=n,!0}function f_(n){const e=eb(),t=n[ut];Ht.lFrame=e,e.currentTNode=t.firstChild,e.lView=n,e.tView=t,e.contextLView=n,e.bindingIndex=t.bindingStartIndex,e.inI18n=!1}function eb(){const n=Ht.lFrame,e=null===n?null:n.child;return null===e?tb(n):e}function tb(n){const e={currentTNode:null,isParent:!0,lView:null,tView:null,selectedIndex:-1,contextLView:null,elementDepthCount:0,currentNamespace:null,currentDirectiveIndex:-1,bindingRootIndex:-1,bindingIndex:-1,currentQueryIndex:0,parent:n,child:null,inI18n:!1};return null!==n&&(n.child=e),e}function nb(){const n=Ht.lFrame;return Ht.lFrame=n.parent,n.currentTNode=null,n.lView=null,n}const ib=nb;function p_(){const n=nb();n.isParent=!0,n.tView=null,n.selectedIndex=-1,n.contextLView=null,n.elementDepthCount=0,n.currentDirectiveIndex=-1,n.currentNamespace=null,n.bindingRootIndex=-1,n.bindingIndex=-1,n.currentQueryIndex=0}function Qi(){return Ht.lFrame.selectedIndex}function Aa(n){Ht.lFrame.selectedIndex=n}function Xn(){const n=Ht.lFrame;return kx(n.tView,n.selectedIndex)}function m_(){Ht.lFrame.currentNamespace="svg"}let ob=!0;function Ud(){return ob}function Go(n){ob=n}function zd(n,e){for(let t=e.directiveStart,i=e.directiveEnd;t<i;t++){const s=n.data[t].type.prototype,{ngAfterContentInit:o,ngAfterContentChecked:a,ngAfterViewInit:l,ngAfterViewChecked:u,ngOnDestroy:d}=s;o&&(n.contentHooks??=[]).push(-t,o),a&&((n.contentHooks??=[]).push(t,a),(n.contentCheckHooks??=[]).push(t,a)),l&&(n.viewHooks??=[]).push(-t,l),u&&((n.viewHooks??=[]).push(t,u),(n.viewCheckHooks??=[]).push(t,u)),null!=d&&(n.destroyHooks??=[]).push(t,d)}}function Hd(n,e,t){ab(n,e,3,t)}function Gd(n,e,t,i){(3&n[Xt])===t&&ab(n,e,t,i)}function __(n,e){let t=n[Xt];(3&t)===e&&(t&=8191,t+=1,n[Xt]=t)}function ab(n,e,t,i){const s=i??-1,o=e.length-1;let a=0;for(let l=void 0!==i?65535&n[Ll]:0;l<o;l++)if("number"==typeof e[l+1]){if(a=e[l],null!=i&&a>=i)break}else e[l]<0&&(n[Ll]+=65536),(a<s||-1==s)&&(wR(n,t,e,l),n[Ll]=(4294901760&n[Ll])+l+2),l++}function lb(n,e){Ps(4,n,e);const t=Ni(null);try{e.call(n)}finally{Ni(t),Ps(5,n,e)}}function wR(n,e,t,i){const r=t[i]<0,s=t[i+1],a=n[r?-t[i]:t[i]];r?n[Xt]>>13<n[Ll]>>16&&(3&n[Xt])===e&&(n[Xt]+=8192,lb(a,s)):lb(a,s)}const Vl=-1;class Vu{constructor(e,t,i){this.factory=e,this.resolving=!1,this.canSeeViewProviders=t,this.injectImpl=i}}function cb(n){return n!==Vl}function Wd(n){return 32767&n}function qd(n,e){let t=function TR(n){return n>>16}(n),i=e;for(;t>0;)i=i[Pl],t--;return i}let v_=!0;function jd(n){const e=v_;return v_=n,e}const ub=255,hb=5;let CR=0;const Ns={};function $d(n,e){const t=db(n,e);if(-1!==t)return t;const i=e[ut];i.firstCreatePass&&(n.injectorIndex=e.length,y_(i.data,n),y_(e,null),y_(i.blueprint,null));const r=x_(n,e),s=n.injectorIndex;if(cb(r)){const o=Wd(r),a=qd(r,e),l=a[ut].data;for(let u=0;u<8;u++)e[s+u]=a[o+u]|l[o+u]}return e[s+8]=r,s}function y_(n,e){n.push(0,0,0,0,0,0,0,0,e)}function db(n,e){return-1===n.injectorIndex||n.parent&&n.parent.injectorIndex===n.injectorIndex||null===e[n.injectorIndex+8]?-1:n.injectorIndex}function x_(n,e){if(n.parent&&-1!==n.parent.injectorIndex)return n.parent.injectorIndex;let t=0,i=null,r=e;for(;null!==r;){if(i=yb(r),null===i)return Vl;if(t++,r=r[Pl],-1!==i.injectorIndex)return i.injectorIndex|t<<16}return Vl}function b_(n,e,t){!function DR(n,e,t){let i;"string"==typeof t?i=t.charCodeAt(0)||0:t.hasOwnProperty(Cu)&&(i=t[Cu]),null==i&&(i=t[Cu]=CR++);const r=i&ub;e.data[n+(r>>hb)]|=1<<r}(n,e,t)}function fb(n,e,t){if(t&rt.Optional||void 0!==n)return n;h()}function pb(n,e,t,i){if(t&rt.Optional&&void 0===i&&(i=null),!(t&(rt.Self|rt.Host))){const r=n[Rl],s=dt(void 0);try{return r?r.get(e,i,t&rt.Optional):Ut(e,i,t&rt.Optional)}finally{dt(s)}}return fb(i,0,t)}function mb(n,e,t,i=rt.Default,r){if(null!==n){if(2048&e[Xt]&&!(i&rt.Self)){const o=function BR(n,e,t,i,r){let s=n,o=e;for(;null!==s&&null!==o&&2048&o[Xt]&&!(512&o[Xt]);){const a=_b(s,o,t,i|rt.Self,Ns);if(a!==Ns)return a;let l=s.parent;if(!l){const u=o[Mx];if(u){const d=u.get(t,Ns,i);if(d!==Ns)return d}l=yb(o),o=o[Pl]}s=l}return r}(n,e,t,i,Ns);if(o!==Ns)return o}const s=_b(n,e,t,i,Ns);if(s!==Ns)return s}return pb(e,t,i,r)}function _b(n,e,t,i,r){const s=function PR(n){if("string"==typeof n)return n.charCodeAt(0)||0;const e=n.hasOwnProperty(Cu)?n[Cu]:void 0;return"number"==typeof e?e>=0?e&ub:LR:e}(t);if("function"==typeof s){if(!Qx(e,n,i))return i&rt.Host?fb(r,0,i):pb(e,t,i,r);try{const o=s(i);if(null!=o||i&rt.Optional)return o;h()}finally{ib()}}else if("number"==typeof s){let o=null,a=db(n,e),l=Vl,u=i&rt.Host?e[pi][Gi]:null;for((-1===a||i&rt.SkipSelf)&&(l=-1===a?x_(n,e):e[a+8],l!==Vl&&vb(i,!1)?(o=e[ut],a=Wd(l),e=qd(l,e)):a=-1);-1!==a;){const d=e[ut];if(gb(s,a,d.data)){const f=RR(a,e,t,o,i,u);if(f!==Ns)return f}l=e[a+8],l!==Vl&&vb(i,e[ut].data[a+8]===u)&&gb(s,a,e)?(o=d,a=Wd(l),e=qd(l,e)):a=-1}}return r}function RR(n,e,t,i,r,s){const o=e[ut],a=o.data[n+8],d=Xd(a,o,t,null==i?xa(a)&&v_:i!=o&&0!=(3&a.type),r&rt.Host&&s===a);return null!==d?wa(e,o,d,a):Ns}function Xd(n,e,t,i,r){const s=n.providerIndexes,o=e.data,a=1048575&s,l=n.directiveStart,d=s>>20,p=r?a+d:n.directiveEnd;for(let _=i?a:a+d;_<p;_++){const y=o[_];if(_<l&&t===y||_>=l&&y.type===t)return _}if(r){const _=o[l];if(_&&ls(_)&&_.type===t)return l}return null}function wa(n,e,t,i){let r=n[t];const s=e.data;if(function MR(n){return n instanceof Vu}(r)){const o=r;o.resolving&&function rs(n,e){const t=e?`. Dependency path: ${e.join(" > ")} > ${n}`:"";throw new Xe(-200,`Circular dependency in DI detected for ${n}${t}`)}(function xn(n){return"function"==typeof n?n.name||n.toString():"object"==typeof n&&null!=n&&"function"==typeof n.type?n.type.name||n.type.toString():Ge(n)}(s[t]));const a=jd(o.canSeeViewProviders);o.resolving=!0;const l=o.injectImpl?dt(o.injectImpl):null;Qx(n,i,rt.Default);try{r=n[t]=o.factory(void 0,s,n,i),e.firstCreatePass&&t>=i.directiveStart&&function AR(n,e,t){const{ngOnChanges:i,ngOnInit:r,ngDoCheck:s}=e.type.prototype;if(i){const o=Nx(e);(t.preOrderHooks??=[]).push(n,o),(t.preOrderCheckHooks??=[]).push(n,o)}r&&(t.preOrderHooks??=[]).push(0-n,r),s&&((t.preOrderHooks??=[]).push(n,s),(t.preOrderCheckHooks??=[]).push(n,s))}(t,s[t],e)}finally{null!==l&&dt(l),jd(a),o.resolving=!1,ib()}}return r}function gb(n,e,t){return!!(t[e+(n>>hb)]&1<<n)}function vb(n,e){return!(n&rt.Self||n&rt.Host&&e)}class kl{constructor(e,t){this._tNode=e,this._lView=t}get(e,t,i){return mb(this._tNode,this._lView,e,Cd(i),t)}}function LR(){return new kl(Ui(),Ne())}function yb(n){const e=n[ut],t=e.type;return 2===t?e.declTNode:1===t?n[Gi]:null}function zu(n,e){n.forEach(t=>Array.isArray(t)?zu(t,e):e(t))}function bb(n,e,t){e>=n.length?n.push(t):n.splice(e,0,t)}function Yd(n,e){return e>=n.length-1?n.pop():n.splice(e,1)[0]}function ef(n){return 128==(128&n.flags)}var pr=(()=>((pr=pr||{})[pr.Important=1]="Important",pr[pr.DashCase=2]="DashCase",pr))();const L_=new Map;let uP=0;const B_="__ngContext__";function qi(n,e){Er(e)?(n[B_]=e[Bu],function dP(n){L_.set(n[Bu],n)}(e)):n[B_]=e}let F_;function O_(n,e){return F_(n,e)}function qu(n){const e=n[$n];return dr(e)?e[$n]:e}function Hb(n){return Wb(n[Lu])}function Gb(n){return Wb(n[as])}function Wb(n){for(;null!==n&&!dr(n);)n=n[as];return n}function $l(n,e,t,i,r){if(null!=i){let s,o=!1;dr(i)?s=i:Er(i)&&(o=!0,i=i[Ai]);const a=Un(i);0===n&&null!==t?null==r?Yb(e,t,a):Ma(e,t,a,r||null,!0):1===n&&null!==t?Ma(e,t,a,r||null,!0):2===n?function af(n,e,t){const i=sf(n,e);i&&function RP(n,e,t,i){n.removeChild(e,t,i)}(n,i,e,t)}(e,a,o):3===n&&e.destroyNode(a),null!=s&&function NP(n,e,t,i,r){const s=t[Is];s!==Un(t)&&$l(e,n,i,s,r);for(let a=Wi;a<t.length;a++){const l=t[a];$u(l[ut],l,n,e,i,s)}}(e,n,s,t,r)}}function rf(n,e,t){return n.createElement(e,t)}function jb(n,e){const t=n[Nl],i=t.indexOf(e);zx(e),t.splice(i,1)}function k_(n,e){if(n.length<=Wi)return;const t=Wi+e,i=n[t];if(i){const r=i[Nu];null!==r&&r!==n&&jb(r,i),e>0&&(n[t-1][as]=i[as]);const s=Yd(n,Wi+e);!function wP(n,e){$u(n,e,e[Yt],2,null,null),e[Ai]=null,e[Gi]=null}(i[ut],i);const o=s[Ds];null!==o&&o.detachView(s[ut]),i[$n]=null,i[as]=null,i[Xt]&=-129}return i}function $b(n,e){if(!(256&e[Xt])){const t=e[Yt];e[Rd]?.destroy(),e[Pd]?.destroy(),t.destroyNode&&$u(n,e,t,3,null,null),function EP(n){let e=n[Lu];if(!e)return U_(n[ut],n);for(;e;){let t=null;if(Er(e))t=e[Lu];else{const i=e[Wi];i&&(t=i)}if(!t){for(;e&&!e[as]&&e!==n;)Er(e)&&U_(e[ut],e),e=e[$n];null===e&&(e=n),Er(e)&&U_(e[ut],e),t=e&&e[as]}e=t}}(e)}}function U_(n,e){if(!(256&e[Xt])){e[Xt]&=-129,e[Xt]|=256,function IP(n,e){let t;if(null!=n&&null!=(t=n.destroyHooks))for(let i=0;i<t.length;i+=2){const r=e[t[i]];if(!(r instanceof Vu)){const s=t[i+1];if(Array.isArray(s))for(let o=0;o<s.length;o+=2){const a=r[s[o]],l=s[o+1];Ps(4,a,l);try{l.call(a)}finally{Ps(5,a,l)}}else{Ps(4,r,s);try{s.call(r)}finally{Ps(5,r,s)}}}}}(n,e),function DP(n,e){const t=n.cleanup,i=e[Il];if(null!==t)for(let s=0;s<t.length-1;s+=2)if("string"==typeof t[s]){const o=t[s+3];o>=0?i[o]():i[-o].unsubscribe(),s+=2}else t[s].call(i[t[s+1]]);null!==i&&(e[Il]=null);const r=e[zo];if(null!==r){e[zo]=null;for(let s=0;s<r.length;s++)(0,r[s])()}}(n,e),1===e[ut].type&&e[Yt].destroy();const t=e[Nu];if(null!==t&&dr(e[$n])){t!==e[$n]&&jb(t,e);const i=e[Ds];null!==i&&i.detachView(n)}!function fP(n){L_.delete(n[Bu])}(e)}}function z_(n,e,t){return function Xb(n,e,t){let i=e;for(;null!==i&&40&i.type;)i=(e=i).parent;if(null===i)return t[Ai];{const{componentOffset:r}=i;if(r>-1){const{encapsulation:s}=n.data[i.directiveStart+r];if(s===Mr.None||s===Mr.Emulated)return null}return fr(i,t)}}(n,e.parent,t)}function Ma(n,e,t,i,r){n.insertBefore(e,t,i,r)}function Yb(n,e,t){n.appendChild(e,t)}function Zb(n,e,t,i,r){null!==i?Ma(n,e,t,i,r):Yb(n,e,t)}function sf(n,e){return n.parentNode(e)}let H_,j_,Qb=function Kb(n,e,t){return 40&n.type?fr(n,t):null};function of(n,e,t,i){const r=z_(n,i,e),s=e[Yt],a=function Jb(n,e,t){return Qb(n,e,t)}(i.parent||e[Gi],i,e);if(null!=r)if(Array.isArray(t))for(let l=0;l<t.length;l++)Zb(s,r,t[l],a,!1);else Zb(s,r,t,a,!1);void 0!==H_&&H_(s,i,e,t,r)}function ju(n,e){if(null!==e){const t=e.type;if(3&t)return fr(e,n);if(4&t)return G_(-1,n[e.index]);if(8&t){const i=e.child;if(null!==i)return ju(n,i);{const r=n[e.index];return dr(r)?G_(-1,r):Un(r)}}if(32&t)return O_(e,n)()||Un(n[e.index]);{const i=tA(n,e);return null!==i?Array.isArray(i)?i[0]:ju(qu(n[pi]),i):ju(n,e.next)}}return null}function tA(n,e){return null!==e?n[pi][Gi].projection[e.projection]:null}function G_(n,e){const t=Wi+n+1;if(t<e.length){const i=e[t],r=i[ut].firstChild;if(null!==r)return ju(i,r)}return e[Is]}function W_(n,e,t,i,r,s,o){for(;null!=t;){const a=i[t.index],l=t.type;if(o&&0===e&&(a&&qi(Un(a),i),t.flags|=2),32!=(32&t.flags))if(8&l)W_(n,e,t.child,i,r,s,!1),$l(e,n,r,a,s);else if(32&l){const u=O_(t,i);let d;for(;d=u();)$l(e,n,r,d,s);$l(e,n,r,a,s)}else 16&l?iA(n,e,i,t,r,s):$l(e,n,r,a,s);t=o?t.projectionNext:t.next}}function $u(n,e,t,i,r,s){W_(t,i,n.firstChild,e,r,s,!1)}function iA(n,e,t,i,r,s){const o=t[pi],l=o[Gi].projection[i.projection];if(Array.isArray(l))for(let u=0;u<l.length;u++)$l(e,n,r,l[u],s);else{let u=l;const d=o[$n];ef(i)&&(u.flags|=128),W_(n,e,u,d,r,s,!0)}}function rA(n,e,t){""===t?n.removeAttribute(e,"class"):n.setAttribute(e,"class",t)}function sA(n,e,t){const{mergedAttrs:i,classes:r,styles:s}=t;null!==i&&Km(n,e,i),null!==r&&rA(n,e,r),null!==s&&function FP(n,e,t){n.setAttribute(e,"style",t)}(n,e,s)}class Zt{constructor(e,t){this._desc=e,this.ngMetadataName="InjectionToken",this.\u0275prov=void 0,"number"==typeof t?this.__NG_ELEMENT_ID__=t:void 0!==t&&(this.\u0275prov=de({token:this,providedIn:t.providedIn||"root",factory:t.factory}))}get multi(){return this}toString(){return`InjectionToken ${this._desc}`}}const hf=new Zt("ENVIRONMENT_INITIALIZER"),vA=new Zt("INJECTOR",-1),yA=new Zt("INJECTOR_DEF_TYPES");class xA{get(e,t=cr){if(t===cr){const i=new Error(`NullInjectorError: No provider for ${Kn(e)}!`);throw i.name="NullInjectorError",i}return t}}function uL(...n){return{\u0275providers:AA(0,n),\u0275fromNgModule:!0}}function AA(n,...e){const t=[],i=new Set;let r;return zu(e,s=>{const o=s;K_(o,t,[],i)&&(r||=[],r.push(o))}),void 0!==r&&wA(r,t),t}function wA(n,e){for(let t=0;t<n.length;t++){const{providers:r}=n[t];Q_(r,s=>{e.push(s)})}}function K_(n,e,t,i){if(!(n=St(n)))return!1;let r=null,s=Ue(n);const o=!s&&Pn(n);if(s||o){if(o&&!o.standalone)return!1;r=n}else{const l=n.ngModule;if(s=Ue(l),!s)return!1;r=l}const a=i.has(r);if(o){if(a)return!1;if(i.add(r),o.dependencies){const l="function"==typeof o.dependencies?o.dependencies():o.dependencies;for(const u of l)K_(u,e,t,i)}}else{if(!s)return!1;{if(null!=s.imports&&!a){let u;i.add(r);try{zu(s.imports,d=>{K_(d,e,t,i)&&(u||=[],u.push(d))})}finally{}void 0!==u&&wA(u,e)}if(!a){const u=ba(r)||(()=>new r);e.push({provide:r,useFactory:u,deps:Cn},{provide:yA,useValue:r,multi:!0},{provide:hf,useValue:()=>bn(r),multi:!0})}const l=s.providers;null==l||a||Q_(l,d=>{e.push(d)})}}return r!==n&&void 0!==n.providers}function Q_(n,e){for(let t of n)Eu(t)&&(t=t.\u0275providers),Array.isArray(t)?Q_(t,e):e(t)}const hL=Sn({provide:String,useValue:Sn});function eg(n){return null!==n&&"object"==typeof n&&hL in n}function Sa(n){return"function"==typeof n}const tg=new Zt("Set Injector scope."),df={},fL={};let ng;function ff(){return void 0===ng&&(ng=new xA),ng}class Yl{}class ig extends Yl{get destroyed(){return this._destroyed}constructor(e,t,i,r){super(),this.parent=t,this.source=i,this.scopes=r,this.records=new Map,this._ngOnDestroyHooks=new Set,this._onDestroyHooks=[],this._destroyed=!1,sg(e,o=>this.processProvider(o)),this.records.set(vA,Zl(void 0,this)),r.has("environment")&&this.records.set(Yl,Zl(void 0,this));const s=this.records.get(tg);null!=s&&"string"==typeof s.value&&this.scopes.add(s.value),this.injectorDefTypes=new Set(this.get(yA.multi,Cn,rt.Self))}destroy(){this.assertNotDestroyed(),this._destroyed=!0;try{for(const t of this._ngOnDestroyHooks)t.ngOnDestroy();const e=this._onDestroyHooks;this._onDestroyHooks=[];for(const t of e)t()}finally{this.records.clear(),this._ngOnDestroyHooks.clear(),this.injectorDefTypes.clear()}}onDestroy(e){return this.assertNotDestroyed(),this._onDestroyHooks.push(e),()=>this.removeOnDestroy(e)}runInContext(e){this.assertNotDestroyed();const t=Uo(this),i=dt(void 0);try{return e()}finally{Uo(t),dt(i)}}get(e,t=cr,i=rt.Default){if(this.assertNotDestroyed(),e.hasOwnProperty(hx))return e[hx](this);i=Cd(i);const r=Uo(this),s=dt(void 0);try{if(!(i&rt.SkipSelf)){let a=this.records.get(e);if(void 0===a){const l=function vL(n){return"function"==typeof n||"object"==typeof n&&n instanceof Zt}(e)&&ze(e);a=l&&this.injectableDefInScope(l)?Zl(rg(e),df):null,this.records.set(e,a)}if(null!=a)return this.hydrate(e,a)}return(i&rt.Self?ff():this.parent).get(e,t=i&rt.Optional&&t===cr?null:t)}catch(o){if("NullInjectorError"===o.name){if((o[Li]=o[Li]||[]).unshift(Kn(e)),r)throw o;return function _I(n,e,t,i){const r=n[Li];throw e[Ur]&&r.unshift(e[Ur]),n.message=function gI(n,e,t,i=null){n=n&&"\n"===n.charAt(0)&&"\u0275"==n.charAt(1)?n.slice(2):n;let r=Kn(e);if(Array.isArray(e))r=e.map(Kn).join(" -> ");else if("object"==typeof e){let s=[];for(let o in e)if(e.hasOwnProperty(o)){let a=e[o];s.push(o+":"+("string"==typeof a?JSON.stringify(a):Kn(a)))}r=`{${s.join(", ")}}`}return`${t}${i?"("+i+")":""}[${r}]: ${n.replace(Vo,"\n  ")}`}("\n"+n.message,r,t,i),n.ngTokenPath=r,n[Li]=null,n}(o,e,"R3InjectorError",this.source)}throw o}finally{dt(s),Uo(r)}}resolveInjectorInitializers(){const e=Uo(this),t=dt(void 0);try{const i=this.get(hf.multi,Cn,rt.Self);for(const r of i)r()}finally{Uo(e),dt(t)}}toString(){const e=[],t=this.records;for(const i of t.keys())e.push(Kn(i));return`R3Injector[${e.join(", ")}]`}assertNotDestroyed(){if(this._destroyed)throw new Xe(205,!1)}processProvider(e){let t=Sa(e=St(e))?e:St(e&&e.provide);const i=function mL(n){return eg(n)?Zl(void 0,n.useValue):Zl(function EA(n,e,t){let i;if(Sa(n)){const r=St(n);return ba(r)||rg(r)}if(eg(n))i=()=>St(n.useValue);else if(function SA(n){return!(!n||!n.useFactory)}(n))i=()=>n.useFactory(...Ym(n.deps||[]));else if(function MA(n){return!(!n||!n.useExisting)}(n))i=()=>bn(St(n.useExisting));else{const r=St(n&&(n.useClass||n.provide));if(!function _L(n){return!!n.deps}(n))return ba(r)||rg(r);i=()=>new r(...Ym(n.deps))}return i}(n),df)}(e);if(Sa(e)||!0!==e.multi)this.records.get(t);else{let r=this.records.get(t);r||(r=Zl(void 0,df,!0),r.factory=()=>Ym(r.multi),this.records.set(t,r)),t=e,r.multi.push(e)}this.records.set(t,i)}hydrate(e,t){return t.value===df&&(t.value=fL,t.value=t.factory()),"object"==typeof t.value&&t.value&&function gL(n){return null!==n&&"object"==typeof n&&"function"==typeof n.ngOnDestroy}(t.value)&&this._ngOnDestroyHooks.add(t.value),t.value}injectableDefInScope(e){if(!e.providedIn)return!1;const t=St(e.providedIn);return"string"==typeof t?"any"===t||this.scopes.has(t):this.injectorDefTypes.has(t)}removeOnDestroy(e){const t=this._onDestroyHooks.indexOf(e);-1!==t&&this._onDestroyHooks.splice(t,1)}}function rg(n){const e=ze(n),t=null!==e?e.factory:ba(n);if(null!==t)return t;if(n instanceof Zt)throw new Xe(204,!1);if(n instanceof Function)return function pL(n){const e=n.length;if(e>0)throw function Hu(n,e){const t=[];for(let i=0;i<n;i++)t.push(e);return t}(e,"?"),new Xe(204,!1);const t=function $e(n){return n&&(n[Rt]||n[Gt])||null}(n);return null!==t?()=>t.factory(n):()=>new n}(n);throw new Xe(204,!1)}function Zl(n,e,t=!1){return{factory:n,value:e,multi:t?[]:void 0}}function sg(n,e){for(const t of n)Array.isArray(t)?sg(t,e):t&&Eu(t)?sg(t.\u0275providers,e):e(t)}const pf=new Zt("AppId",{providedIn:"root",factory:()=>yL}),yL="ng",TA=new Zt("Platform Initializer"),Jl=new Zt("Platform ID",{providedIn:"platform",factory:()=>"unknown"}),CA=new Zt("CSP nonce",{providedIn:"root",factory:()=>function Xu(){if(void 0!==j_)return j_;if(typeof document<"u")return document;throw new Xe(210,!1)}().body?.querySelector("[ngCspNonce]")?.getAttribute("ngCspNonce")||null});let IA=(n,e)=>null;function RA(n,e){return IA(n,e)}class CL{}class NA{}class IL{resolveComponentFactory(e){throw function DL(n){const e=Error(`No component factory found for ${Kn(n)}.`);return e.ngComponent=n,e}(e)}}let yf=(()=>{class n{}return n.NULL=new IL,n})();function RL(){return Kl(Ui(),Ne())}function Kl(n,e){return new Ql(fr(n,e))}let Ql=(()=>{class n{constructor(t){this.nativeElement=t}}return n.__NG_ELEMENT_ID__=RL,n})();function PL(n){return n instanceof Ql?n.nativeElement:n}class FA{}let NL=(()=>{class n{}return n.\u0275prov=de({token:n,providedIn:"root",factory:()=>null}),n})();class _g{constructor(e){this.full=e,this.major=e.split(".")[0],this.minor=e.split(".")[1],this.patch=e.split(".").slice(2).join(".")}}const BL=new _g("16.1.4"),gg={};function th(n){for(;n;){n[Xt]|=64;const e=qu(n);if(n_(n)&&!e)return n;n=e}return null}function vg(n){return n.ngOriginalError}class Ea{constructor(){this._console=console}handleError(e){const t=this._findOriginalError(e);this._console.error("ERROR",e),t&&this._console.error("ORIGINAL ERROR",t)}_findOriginalError(e){let t=e&&vg(e);for(;t&&vg(t);)t=vg(t);return t||null}}const UA=new Zt("",{providedIn:"root",factory:()=>!1});function bf(n){return n.ownerDocument.defaultView}class qA extends Ix{constructor(){super(...arguments),this.consumerAllowSignalWrites=!1,this._lView=null}set lView(e){this._lView=e}onConsumerDependencyMayHaveChanged(){th(this._lView)}onProducerUpdateValueVersion(){}get hasReadASignal(){return this.hasProducers}runInContext(e,t,i){const r=Ni(this);this.trackingVersion++;try{e(t,i)}finally{Ni(r)}}destroy(){this.trackingVersion++}}let Af=null;function jA(){return Af??=new qA,Af}function $A(n,e){return n[e]??jA()}function XA(n,e){const t=jA();t.hasReadASignal&&(n[e]=Af,t.lView=n,Af=new qA)}const Jt={};function cs(n){YA(An(),Ne(),Qi()+n,!1)}function YA(n,e,t,i){if(!i)if(3==(3&e[Xt])){const s=n.preOrderCheckHooks;null!==s&&Hd(e,s,t)}else{const s=n.preOrderHooks;null!==s&&Gd(e,s,0,t)}Aa(t)}function QA(n,e=null,t=null,i){const r=ew(n,e,t,i);return r.resolveInjectorInitializers(),r}function ew(n,e=null,t=null,i,r=new Set){const s=[t||Cn,uL(n)];return i=i||("object"==typeof n?void 0:Kn(n)),new ig(s,e||ff(),i||null,r)}let Ta=(()=>{class n{static create(t,i){if(Array.isArray(t))return QA({name:""},i,t,"");{const r=t.name??"";return QA({name:r},t.parent,t.providers,r)}}}return n.THROW_IF_NOT_FOUND=cr,n.NULL=new xA,n.\u0275prov=de({token:n,providedIn:"any",factory:()=>bn(vA)}),n.__NG_ELEMENT_ID__=-1,n})();function an(n,e=rt.Default){const t=Ne();return null===t?bn(n,e):mb(Ui(),t,St(n),e)}function wf(n,e,t,i,r,s,o,a,l,u,d){const f=e.blueprint.slice();return f[Ai]=r,f[Xt]=140|i,(null!==u||n&&2048&n[Xt])&&(f[Xt]|=2048),Ux(f),f[$n]=f[Pl]=n,f[fi]=t,f[ya]=o||n&&n[ya],f[Yt]=a||n&&n[Yt],f[Rl]=l||n&&n[Rl]||null,f[Gi]=s,f[Bu]=function hP(){return uP++}(),f[no]=d,f[Mx]=u,f[pi]=2==e.type?n[pi]:f,f}function tc(n,e,t,i,r){let s=n.data[e];if(null===s)s=function yg(n,e,t,i,r){const s=Xx(),o=l_(),l=n.data[e]=function n2(n,e,t,i,r,s){let o=e?e.injectorIndex:-1,a=0;return function Fl(){return null!==Ht.skipHydrationRootTNode}()&&(a|=128),{type:t,index:i,insertBeforeIndex:null,injectorIndex:o,directiveStart:-1,directiveEnd:-1,directiveStylingLast:-1,componentOffset:-1,propertyBindings:null,flags:a,providerIndexes:0,value:r,attrs:s,mergedAttrs:null,localNames:null,initialInputs:void 0,inputs:null,outputs:null,tView:null,next:null,prev:null,projectionNext:null,child:null,parent:e,projection:null,styles:null,stylesWithoutHost:null,residualStyles:void 0,classes:null,classesWithoutHost:null,residualClasses:void 0,classBindings:0,styleBindings:0}}(0,o?s:s&&s.parent,t,e,i,r);return null===n.firstChild&&(n.firstChild=l),null!==s&&(o?null==s.child&&null!==l.parent&&(s.child=l):null===s.next&&(s.next=l,l.prev=s)),l}(n,e,t,i,r),function pR(){return Ht.lFrame.inI18n}()&&(s.flags|=32);else if(64&s.type){s.type=t,s.value=i,s.attrs=r;const o=function Ou(){const n=Ht.lFrame,e=n.currentTNode;return n.isParent?e:e.parent}();s.injectorIndex=null===o?-1:o.injectorIndex}return Ls(s,!0),s}function nh(n,e,t,i){if(0===t)return-1;const r=e.length;for(let s=0;s<t;s++)e.push(i),n.blueprint.push(i),n.data.push(null);return r}function tw(n,e,t,i,r){const s=$A(e,Rd),o=Qi(),a=2&i;try{if(Aa(-1),a&&e.length>gn&&YA(n,e,gn,!1),Ps(a?2:0,r),a)s.runInContext(t,i,r);else{const u=Ni(null);try{t(i,r)}finally{Ni(u)}}}finally{a&&null===e[Rd]&&XA(e,Rd),Aa(o),Ps(a?3:1,r)}}function xg(n,e,t){if(t_(e)){const i=Ni(null);try{const s=e.directiveEnd;for(let o=e.directiveStart;o<s;o++){const a=n.data[o];a.contentQueries&&a.contentQueries(1,t[o],o)}}finally{Ni(i)}}}function bg(n,e,t){qx()&&(function c2(n,e,t,i){const r=t.directiveStart,s=t.directiveEnd;xa(t)&&function _2(n,e,t){const i=fr(e,n),r=nw(t);let o=16;t.signals?o=4096:t.onPush&&(o=64);const a=Mf(n,wf(n,r,null,o,i,e,null,n[ya].rendererFactory.createRenderer(i,t),null,null,null));n[e.index]=a}(e,t,n.data[r+t.componentOffset]),n.firstCreatePass||$d(t,e),qi(i,e);const o=t.initialInputs;for(let a=r;a<s;a++){const l=n.data[a],u=wa(e,n,a,t);qi(u,e),null!==o&&g2(0,a-r,u,l,0,o),ls(l)&&(Tr(t.index,e)[fi]=wa(e,n,a,t))}}(n,e,t,fr(t,e)),64==(64&t.flags)&&aw(n,e,t))}function Ag(n,e,t=fr){const i=e.localNames;if(null!==i){let r=e.index+1;for(let s=0;s<i.length;s+=2){const o=i[s+1],a=-1===o?t(e,n):n[o];n[r++]=a}}}function nw(n){const e=n.tView;return null===e||e.incompleteFirstPass?n.tView=wg(1,null,n.template,n.decls,n.vars,n.directiveDefs,n.pipeDefs,n.viewQuery,n.schemas,n.consts,n.id):e}function wg(n,e,t,i,r,s,o,a,l,u,d){const f=gn+i,p=f+r,_=function ZL(n,e){const t=[];for(let i=0;i<e;i++)t.push(i<n?null:Jt);return t}(f,p),y="function"==typeof u?u():u;return _[ut]={type:n,blueprint:_,template:t,queries:null,viewQuery:a,declTNode:e,data:_.slice().fill(null,f),bindingStartIndex:f,expandoStartIndex:p,hostBindingOpCodes:null,firstCreatePass:!0,firstUpdatePass:!0,staticViewQueries:!1,staticContentQueries:!1,preOrderHooks:null,preOrderCheckHooks:null,contentHooks:null,contentCheckHooks:null,viewHooks:null,viewCheckHooks:null,destroyHooks:null,cleanup:null,contentQueries:null,components:null,directiveRegistry:"function"==typeof s?s():s,pipeRegistry:"function"==typeof o?o():o,firstChild:null,schemas:l,consts:y,incompleteFirstPass:!1,ssrId:d}}let iw=n=>null;function rw(n,e,t,i){for(let r in n)if(n.hasOwnProperty(r)){t=null===t?{}:t;const s=n[r];null===i?sw(t,e,r,s):i.hasOwnProperty(r)&&sw(t,e,i[r],s)}return t}function sw(n,e,t,i){n.hasOwnProperty(t)?n[t].push(e,i):n[t]=[e,i]}function Mg(n,e,t,i){if(qx()){const r=null===i?null:{"":-1},s=function h2(n,e){const t=n.directiveRegistry;let i=null,r=null;if(t)for(let s=0;s<t.length;s++){const o=t[s];if(vx(e,o.selectors,!1))if(i||(i=[]),ls(o))if(null!==o.findHostDirectiveDefs){const a=[];r=r||new Map,o.findHostDirectiveDefs(o,a,r),i.unshift(...a,o),Sg(n,e,a.length)}else i.unshift(o),Sg(n,e,0);else r=r||new Map,o.findHostDirectiveDefs?.(o,i,r),i.push(o)}return null===i?null:[i,r]}(n,t);let o,a;null===s?o=a=null:[o,a]=s,null!==o&&ow(n,e,t,o,r,a),r&&function d2(n,e,t){if(e){const i=n.localNames=[];for(let r=0;r<e.length;r+=2){const s=t[e[r+1]];if(null==s)throw new Xe(-301,!1);i.push(e[r],s)}}}(t,i,r)}t.mergedAttrs=Du(t.mergedAttrs,t.attrs)}function ow(n,e,t,i,r,s){for(let u=0;u<i.length;u++)b_($d(t,e),n,i[u].type);!function p2(n,e,t){n.flags|=1,n.directiveStart=e,n.directiveEnd=e+t,n.providerIndexes=e}(t,n.data.length,i.length);for(let u=0;u<i.length;u++){const d=i[u];d.providersResolver&&d.providersResolver(d)}let o=!1,a=!1,l=nh(n,e,i.length,null);for(let u=0;u<i.length;u++){const d=i[u];t.mergedAttrs=Du(t.mergedAttrs,d.hostAttrs),m2(n,t,e,l,d),f2(l,d,r),null!==d.contentQueries&&(t.flags|=4),(null!==d.hostBindings||null!==d.hostAttrs||0!==d.hostVars)&&(t.flags|=64);const f=d.type.prototype;!o&&(f.ngOnChanges||f.ngOnInit||f.ngDoCheck)&&((n.preOrderHooks??=[]).push(t.index),o=!0),!a&&(f.ngOnChanges||f.ngDoCheck)&&((n.preOrderCheckHooks??=[]).push(t.index),a=!0),l++}!function i2(n,e,t){const r=e.directiveEnd,s=n.data,o=e.attrs,a=[];let l=null,u=null;for(let d=e.directiveStart;d<r;d++){const f=s[d],p=t?t.get(f):null,y=p?p.outputs:null;l=rw(f.inputs,d,l,p?p.inputs:null),u=rw(f.outputs,d,u,y);const w=null===l||null===o||gx(e)?null:v2(l,d,o);a.push(w)}null!==l&&(l.hasOwnProperty("class")&&(e.flags|=8),l.hasOwnProperty("style")&&(e.flags|=16)),e.initialInputs=a,e.inputs=l,e.outputs=u}(n,t,s)}function aw(n,e,t){const i=t.directiveStart,r=t.directiveEnd,s=t.index,o=function _R(){return Ht.lFrame.currentDirectiveIndex}();try{Aa(s);for(let a=i;a<r;a++){const l=n.data[a],u=e[a];u_(a),(null!==l.hostBindings||0!==l.hostVars||null!==l.hostAttrs)&&u2(l,u)}}finally{Aa(-1),u_(o)}}function u2(n,e){null!==n.hostBindings&&n.hostBindings(1,e)}function Sg(n,e,t){e.componentOffset=t,(n.components??=[]).push(e.index)}function f2(n,e,t){if(t){if(e.exportAs)for(let i=0;i<e.exportAs.length;i++)t[e.exportAs[i]]=n;ls(e)&&(t[""]=n)}}function m2(n,e,t,i,r){n.data[i]=r;const s=r.factory||(r.factory=ba(r.type)),o=new Vu(s,ls(r),an);n.blueprint[i]=o,t[i]=o,function a2(n,e,t,i,r){const s=r.hostBindings;if(s){let o=n.hostBindingOpCodes;null===o&&(o=n.hostBindingOpCodes=[]);const a=~e.index;(function l2(n){let e=n.length;for(;e>0;){const t=n[--e];if("number"==typeof t&&t<0)return t}return 0})(o)!=a&&o.push(a),o.push(t,i,s)}}(n,e,i,nh(n,t,r.hostVars,Jt),r)}function Bs(n,e,t,i,r,s){const o=fr(n,e);!function Eg(n,e,t,i,r,s,o){if(null==s)n.removeAttribute(e,r,t);else{const a=null==o?Ge(s):o(s,i||"",r);n.setAttribute(e,r,a,t)}}(e[Yt],o,s,n.value,t,i,r)}function g2(n,e,t,i,r,s){const o=s[e];if(null!==o)for(let a=0;a<o.length;)lw(i,t,o[a++],o[a++],o[a++])}function lw(n,e,t,i,r){const s=Ni(null);try{const o=n.inputTransforms;null!==o&&o.hasOwnProperty(i)&&(r=o[i].call(e,r)),null!==n.setInput?n.setInput(e,r,t,i):e[i]=r}finally{Ni(s)}}function v2(n,e,t){let i=null,r=0;for(;r<t.length;){const s=t[r];if(0!==s)if(5!==s){if("number"==typeof s)break;if(n.hasOwnProperty(s)){null===i&&(i=[]);const o=n[s];for(let a=0;a<o.length;a+=2)if(o[a]===e){i.push(s,o[a+1],t[r+1]);break}}r+=2}else r+=2;else r+=4}return i}function cw(n,e,t,i){return[n,!0,!1,e,null,0,i,t,null,null,null]}function uw(n,e){const t=n.contentQueries;if(null!==t)for(let i=0;i<t.length;i+=2){const s=t[i+1];if(-1!==s){const o=n.data[s];d_(t[i]),o.contentQueries(2,e[s],s)}}}function Mf(n,e){return n[Lu]?n[wx][as]=e:n[Lu]=e,n[wx]=e,e}function Tg(n,e,t){d_(0);const i=Ni(null);try{e(n,t)}finally{Ni(i)}}function hw(n){return n[Il]||(n[Il]=[])}function dw(n){return n.cleanup||(n.cleanup=[])}function pw(n,e){const t=n[Rl],i=t?t.get(Ea,null):null;i&&i.handleError(e)}function Cg(n,e,t,i,r){for(let s=0;s<t.length;){const o=t[s++],a=t[s++];lw(n.data[o],e[o],i,a,r)}}function ao(n,e,t){const i=function kd(n,e){return Un(e[n])}(e,n);!function qb(n,e,t){n.setValue(e,t)}(n[Yt],i,t)}function y2(n,e){const t=Tr(e,n),i=t[ut];!function x2(n,e){for(let t=e.length;t<n.blueprint.length;t++)e.push(n.blueprint[t])}(i,t);const r=t[Ai];null!==r&&null===t[no]&&(t[no]=RA(r,t[Rl])),Dg(i,t,t[fi])}function Dg(n,e,t){f_(e);try{const i=n.viewQuery;null!==i&&Tg(1,i,t);const r=n.template;null!==r&&tw(n,e,r,1,t),n.firstCreatePass&&(n.firstCreatePass=!1),n.staticContentQueries&&uw(n,e),n.staticViewQueries&&Tg(2,n.viewQuery,t);const s=n.components;null!==s&&function b2(n,e){for(let t=0;t<e.length;t++)y2(n,e[t])}(e,s)}catch(i){throw n.firstCreatePass&&(n.incompleteFirstPass=!0,n.firstCreatePass=!1),i}finally{e[Xt]&=-5,p_()}}let mw=(()=>{class n{constructor(){this.all=new Set,this.queue=new Map}create(t,i,r){const s=typeof Zone>"u"?null:Zone.current,o=new jI(t,u=>{this.all.has(u)&&this.queue.set(u,s)},r);let a;this.all.add(o),o.notify();const l=()=>{o.cleanup(),a?.(),this.all.delete(o),this.queue.delete(o)};return a=i?.onDestroy(l),{destroy:l}}flush(){if(0!==this.queue.size)for(const[t,i]of this.queue)this.queue.delete(t),i?i.run(()=>t.run()):t.run()}get isQueueEmpty(){return 0===this.queue.size}}return n.\u0275prov=de({token:n,providedIn:"root",factory:()=>new n}),n})();function Sf(n,e,t){let i=t?n.styles:null,r=t?n.classes:null,s=0;if(null!==e)for(let o=0;o<e.length;o++){const a=e[o];"number"==typeof a?s=a:1==s?r=Su(r,a):2==s&&(i=Su(i,a+": "+e[++o]+";"))}t?n.styles=i:n.stylesWithoutHost=i,t?n.classes=r:n.classesWithoutHost=r}function ih(n,e,t,i,r=!1){for(;null!==t;){const s=e[t.index];if(null!==s&&i.push(Un(s)),dr(s)){for(let a=Wi;a<s.length;a++){const l=s[a],u=l[ut].firstChild;null!==u&&ih(l[ut],l,u,i)}s[Is]!==s[Ai]&&i.push(s[Is])}const o=t.type;if(8&o)ih(n,e,t.child,i);else if(32&o){const a=O_(t,e);let l;for(;l=a();)i.push(l)}else if(16&o){const a=tA(e,t);if(Array.isArray(a))i.push(...a);else{const l=qu(e[pi]);ih(l[ut],l,a,i,!0)}}t=r?t.projectionNext:t.next}return i}function Ef(n,e,t,i=!0){const r=e[ya].rendererFactory;r.begin&&r.begin();try{_w(n,e,n.template,t)}catch(o){throw i&&pw(e,o),o}finally{r.end&&r.end(),e[ya].effectManager?.flush()}}function _w(n,e,t,i){const r=e[Xt];if(256!=(256&r)){e[ya].effectManager?.flush(),f_(e);try{Ux(e),function Zx(n){return Ht.lFrame.bindingIndex=n}(n.bindingStartIndex),null!==t&&tw(n,e,t,2,i);const o=3==(3&r);if(o){const u=n.preOrderCheckHooks;null!==u&&Hd(e,u,null)}else{const u=n.preOrderHooks;null!==u&&Gd(e,u,0,null),__(e,0)}if(function E2(n){for(let e=Hb(n);null!==e;e=Gb(e)){if(!e[Sx])continue;const t=e[Nl];for(let i=0;i<t.length;i++){iR(t[i])}}}(e),gw(e,2),null!==n.contentQueries&&uw(n,e),o){const u=n.contentCheckHooks;null!==u&&Hd(e,u)}else{const u=n.contentHooks;null!==u&&Gd(e,u,1),__(e,1)}!function YL(n,e){const t=n.hostBindingOpCodes;if(null===t)return;const i=$A(e,Pd);try{for(let r=0;r<t.length;r++){const s=t[r];if(s<0)Aa(~s);else{const o=s,a=t[++r],l=t[++r];mR(a,o),i.runInContext(l,2,e[o])}}}finally{null===e[Pd]&&XA(e,Pd),Aa(-1)}}(n,e);const a=n.components;null!==a&&yw(e,a,0);const l=n.viewQuery;if(null!==l&&Tg(2,l,i),o){const u=n.viewCheckHooks;null!==u&&Hd(e,u)}else{const u=n.viewHooks;null!==u&&Gd(e,u,2),__(e,2)}!0===n.firstUpdatePass&&(n.firstUpdatePass=!1),e[Xt]&=-73,zx(e)}finally{p_()}}}function gw(n,e){for(let t=Hb(n);null!==t;t=Gb(t))for(let i=Wi;i<t.length;i++)vw(t[i],e)}function T2(n,e,t){vw(Tr(e,n),t)}function vw(n,e){if(!function tR(n){return 128==(128&n[Xt])}(n))return;const t=n[ut];if(80&n[Xt]&&0===e||1024&n[Xt]||2===e)_w(t,n,t.template,n[fi]);else if(n[Pu]>0){gw(n,1);const r=n[ut].components;null!==r&&yw(n,r,1)}}function yw(n,e,t){for(let i=0;i<e.length;i++)T2(n,e[i],t)}class rh{get rootNodes(){const e=this._lView,t=e[ut];return ih(t,e,t.firstChild,[])}constructor(e,t){this._lView=e,this._cdRefInjectingView=t,this._appRef=null,this._attachedToViewContainer=!1}get context(){return this._lView[fi]}set context(e){this._lView[fi]=e}get destroyed(){return 256==(256&this._lView[Xt])}destroy(){if(this._appRef)this._appRef.detachView(this);else if(this._attachedToViewContainer){const e=this._lView[$n];if(dr(e)){const t=e[8],i=t?t.indexOf(this):-1;i>-1&&(k_(e,i),Yd(t,i))}this._attachedToViewContainer=!1}$b(this._lView[ut],this._lView)}onDestroy(e){!function Gx(n,e){if(256==(256&n[Xt]))throw new Xe(911,!1);null===n[zo]&&(n[zo]=[]),n[zo].push(e)}(this._lView,e)}markForCheck(){th(this._cdRefInjectingView||this._lView)}detach(){this._lView[Xt]&=-129}reattach(){this._lView[Xt]|=128}detectChanges(){Ef(this._lView[ut],this._lView,this.context)}checkNoChanges(){}attachToViewContainerRef(){if(this._appRef)throw new Xe(902,!1);this._attachedToViewContainer=!0}detachFromAppRef(){this._appRef=null,function SP(n,e){$u(n,e,e[Yt],2,null,null)}(this._lView[ut],this._lView)}attachToAppRef(e){if(this._attachedToViewContainer)throw new Xe(902,!1);this._appRef=e}}class C2 extends rh{constructor(e){super(e),this._view=e}detectChanges(){const e=this._view;Ef(e[ut],e,e[fi],!1)}checkNoChanges(){}get context(){return null}}class xw extends yf{constructor(e){super(),this.ngModule=e}resolveComponentFactory(e){const t=Pn(e);return new sh(t,this.ngModule)}}function bw(n){const e=[];for(let t in n)n.hasOwnProperty(t)&&e.push({propName:n[t],templateName:t});return e}class I2{constructor(e,t){this.injector=e,this.parentInjector=t}get(e,t,i){i=Cd(i);const r=this.injector.get(e,gg,i);return r!==gg||t===gg?r:this.parentInjector.get(e,t,i)}}class sh extends NA{get inputs(){const e=this.componentDef,t=e.inputTransforms,i=bw(e.inputs);if(null!==t)for(const r of i)t.hasOwnProperty(r.propName)&&(r.transform=t[r.propName]);return i}get outputs(){return bw(this.componentDef.outputs)}constructor(e,t){super(),this.componentDef=e,this.ngModule=t,this.componentType=e.type,this.selector=function TI(n){return n.map(EI).join(",")}(e.selectors),this.ngContentSelectors=e.ngContentSelectors?e.ngContentSelectors:[],this.isBoundToModule=!!t}create(e,t,i,r){let s=(r=r||this.ngModule)instanceof Yl?r:r?.injector;s&&null!==this.componentDef.getStandaloneInjector&&(s=this.componentDef.getStandaloneInjector(s)||s);const o=s?new I2(e,s):e,a=o.get(FA,null);if(null===a)throw new Xe(407,!1);const d={rendererFactory:a,sanitizer:o.get(NL,null),effectManager:o.get(mw,null)},f=a.createRenderer(null,this.componentDef),p=this.componentDef.selectors[0][0]||"div",_=i?function JL(n,e,t,i){const s=i.get(UA,!1)||t===Mr.ShadowDom,o=n.selectRootElement(e,s);return function KL(n){iw(n)}(o),o}(f,i,this.componentDef.encapsulation,o):rf(f,p,function D2(n){const e=n.toLowerCase();return"svg"===e?"svg":"math"===e?"math":null}(p)),A=this.componentDef.signals?4608:this.componentDef.onPush?576:528,b=wg(0,null,null,1,0,null,null,null,null,null,null),C=wf(null,b,null,A,null,null,d,f,o,null,null);let T,I;f_(C);try{const N=this.componentDef;let k,G=null;N.findHostDirectiveDefs?(k=[],G=new Map,N.findHostDirectiveDefs(N,k,G),k.push(N)):k=[N];const K=function P2(n,e){const t=n[ut],i=gn;return n[i]=e,tc(t,i,2,"#host",null)}(C,_),L=function L2(n,e,t,i,r,s,o){const a=r[ut];!function N2(n,e,t,i){for(const r of n)e.mergedAttrs=Du(e.mergedAttrs,r.hostAttrs);null!==e.mergedAttrs&&(Sf(e,e.mergedAttrs,!0),null!==t&&sA(i,t,e))}(i,n,e,o);let l=null;null!==e&&(l=RA(e,r[Rl]));const u=s.rendererFactory.createRenderer(e,t);let d=16;t.signals?d=4096:t.onPush&&(d=64);const f=wf(r,nw(t),null,d,r[n.index],n,s,u,null,null,l);return a.firstCreatePass&&Sg(a,n,i.length-1),Mf(r,f),r[n.index]=f}(K,_,N,k,C,d,f);I=kx(b,gn),_&&function F2(n,e,t,i){if(i)Km(n,t,["ng-version",BL.full]);else{const{attrs:r,classes:s}=function CI(n){const e=[],t=[];let i=1,r=2;for(;i<n.length;){let s=n[i];if("string"==typeof s)2===r?""!==s&&e.push(s,n[++i]):8===r&&t.push(s);else{if(!os(r))break;r=s}i++}return{attrs:e,classes:t}}(e.selectors[0]);r&&Km(n,t,r),s&&s.length>0&&rA(n,t,s.join(" "))}}(f,N,_,i),void 0!==t&&function O2(n,e,t){const i=n.projection=[];for(let r=0;r<e.length;r++){const s=t[r];i.push(null!=s?Array.from(s):null)}}(I,this.ngContentSelectors,t),T=function B2(n,e,t,i,r,s){const o=Ui(),a=r[ut],l=fr(o,r);ow(a,r,o,t,null,i);for(let d=0;d<t.length;d++)qi(wa(r,a,o.directiveStart+d,o),r);aw(a,r,o),l&&qi(l,r);const u=wa(r,a,o.directiveStart+o.componentOffset,o);if(n[fi]=r[fi]=u,null!==s)for(const d of s)d(u,e);return xg(a,o,n),u}(L,N,k,G,C,[V2]),Dg(b,C,null)}finally{p_()}return new R2(this.componentType,T,Kl(I,C),C,I)}}class R2 extends CL{constructor(e,t,i,r,s){super(),this.location=i,this._rootLView=r,this._tNode=s,this.previousInputValues=null,this.instance=t,this.hostView=this.changeDetectorRef=new C2(r),this.componentType=e}setInput(e,t){const i=this._tNode.inputs;let r;if(null!==i&&(r=i[e])){if(this.previousInputValues??=new Map,this.previousInputValues.has(e)&&Object.is(this.previousInputValues.get(e),t))return;const s=this._rootLView;Cg(s[ut],s,r,e,t),this.previousInputValues.set(e,t),th(Tr(this._tNode.index,s))}}get injector(){return new kl(this._tNode,this._rootLView)}destroy(){this.hostView.destroy()}onDestroy(e){this.hostView.onDestroy(e)}}function V2(){const n=Ui();zd(Ne()[ut],n)}function Fs(n,e,t){return n[e]=t}function ji(n,e,t){return!Object.is(n[e],t)&&(n[e]=t,!0)}function nc(n,e,t,i){const r=Ne();return ji(r,Ol(),e)&&(An(),Bs(Xn(),r,n,e,t,i)),nc}function uh(n,e,t,i,r,s,o,a){const l=Ne(),u=An(),d=n+gn,f=u.firstCreatePass?function pN(n,e,t,i,r,s,o,a,l){const u=e.consts,d=tc(e,n,4,o||null,Ho(u,a));Mg(e,t,d,Ho(u,l)),zd(e,d);const f=d.tView=wg(2,d,i,r,s,e.directiveRegistry,e.pipeRegistry,null,e.schemas,u,null);return null!==e.queries&&(e.queries.template(e,d),f.queries=e.queries.embeddedTView(d)),d}(d,u,l,e,t,i,r,s,o):u.data[d];Ls(f,!1);const p=kw(u,l,f,n);Ud()&&of(u,l,p,f),qi(p,l),Mf(l,l[d]=cw(p,l,p,f)),Nd(f)&&bg(u,l,f),null!=o&&Ag(l,f,a)}let kw=function Uw(n,e,t,i){return Go(!0),e[Yt].createComment("")};function Da(n,e,t){const i=Ne();return ji(i,Ol(),e)&&function Dr(n,e,t,i,r,s,o,a){const l=fr(e,t);let d,u=e.inputs;!a&&null!=u&&(d=u[i])?(Cg(n,t,d,i,r),xa(e)&&function s2(n,e){const t=Tr(e,n);16&t[Xt]||(t[Xt]|=64)}(t,e.index)):3&e.type&&(i=function r2(n){return"class"===n?"className":"for"===n?"htmlFor":"formaction"===n?"formAction":"innerHtml"===n?"innerHTML":"readonly"===n?"readOnly":"tabindex"===n?"tabIndex":n}(i),r=null!=o?o(r,e.value||"",i):r,s.setProperty(l,i,r))}(An(),Xn(),i,n,e,i[Yt],t,!1),Da}function Fg(n,e,t,i,r){const o=r?"class":"style";Cg(n,t,e.inputs[o],o,i)}function qo(n,e,t,i){const r=Ne(),s=An(),o=gn+n,a=r[Yt],l=s.firstCreatePass?function yN(n,e,t,i,r,s){const o=e.consts,l=tc(e,n,2,i,Ho(o,r));return Mg(e,t,l,Ho(o,s)),null!==l.attrs&&Sf(l,l.attrs,!1),null!==l.mergedAttrs&&Sf(l,l.mergedAttrs,!0),null!==e.queries&&e.queries.elementStart(e,l),l}(o,s,r,e,t,i):s.data[o],u=zw(s,r,l,a,e,n);r[o]=u;const d=Nd(l);return Ls(l,!0),sA(a,u,l),32!=(32&l.flags)&&Ud()&&of(s,r,u,l),0===function sR(){return Ht.lFrame.elementDepthCount}()&&qi(u,r),function oR(){Ht.lFrame.elementDepthCount++}(),d&&(bg(s,r,l),xg(s,l,r)),null!==i&&Ag(r,l),qo}function jo(){let n=Ui();l_()?function c_(){Ht.lFrame.isParent=!1}():(n=n.parent,Ls(n,!1));const e=n;(function lR(n){return Ht.skipHydrationRootTNode===n})(e)&&function dR(){Ht.skipHydrationRootTNode=null}(),function aR(){Ht.lFrame.elementDepthCount--}();const t=An();return t.firstCreatePass&&(zd(t,n),t_(n)&&t.queries.elementEnd(n)),null!=e.classesWithoutHost&&function SR(n){return 0!=(8&n.flags)}(e)&&Fg(t,e,Ne(),e.classesWithoutHost,!0),null!=e.stylesWithoutHost&&function ER(n){return 0!=(16&n.flags)}(e)&&Fg(t,e,Ne(),e.stylesWithoutHost,!1),jo}function Ia(n,e,t,i){return qo(n,e,t,i),jo(),Ia}let zw=(n,e,t,i,r,s)=>(Go(!0),rf(i,r,function sb(){return Ht.lFrame.currentNamespace}()));function kg(n){return!!n&&"function"==typeof n.then}function qw(n){return!!n&&"function"==typeof n.subscribe}function Lf(n,e,t,i){const r=Ne(),s=An(),o=Ui();return function $w(n,e,t,i,r,s,o){const a=Nd(i),u=n.firstCreatePass&&dw(n),d=e[fi],f=hw(e);let p=!0;if(3&i.type||o){const w=fr(i,e),A=o?o(w):w,b=f.length,C=o?I=>o(Un(I[i.index])):i.index;let T=null;if(!o&&a&&(T=function SN(n,e,t,i){const r=n.cleanup;if(null!=r)for(let s=0;s<r.length-1;s+=2){const o=r[s];if(o===t&&r[s+1]===i){const a=e[Il],l=r[s+2];return a.length>l?a[l]:null}"string"==typeof o&&(s+=2)}return null}(n,e,r,i.index)),null!==T)(T.__ngLastListenerFn__||T).__ngNextListenerFn__=s,T.__ngLastListenerFn__=s,p=!1;else{s=Yw(i,e,d,s,!1);const I=t.listen(A,r,s);f.push(s,I),u&&u.push(r,C,b,b+1)}}else s=Yw(i,e,d,s,!1);const _=i.outputs;let y;if(p&&null!==_&&(y=_[r])){const w=y.length;if(w)for(let A=0;A<w;A+=2){const N=e[y[A]][y[A+1]].subscribe(s),k=f.length;f.push(s,N),u&&u.push(r,i.index,k,-(k+1))}}}(s,r,r[Yt],o,n,e,i),Lf}function Xw(n,e,t,i){try{return Ps(6,e,t),!1!==t(i)}catch(r){return pw(n,r),!1}finally{Ps(7,e,t)}}function Yw(n,e,t,i,r){return function s(o){if(o===Function)return i;th(n.componentOffset>-1?Tr(n.index,e):e);let l=Xw(e,t,i,o),u=s.__ngNextListenerFn__;for(;u;)l=Xw(e,t,u,o)&&l,u=u.__ngNextListenerFn__;return r&&!1===l&&o.preventDefault(),l}}function Nf(n=1){return function vR(n){return(Ht.lFrame.contextLView=function yR(n,e){for(;n>0;)e=e[Pl],n--;return e}(n,Ht.lFrame.contextLView))[fi]}(n)}function Of(n,e=""){const t=Ne(),i=An(),r=n+gn,s=i.firstCreatePass?tc(i,r,1,e,null):i.data[r],o=xM(i,t,s,e,n);t[r]=o,Ud()&&of(i,t,o,s),Ls(s,!1)}let xM=(n,e,t,i,r)=>(Go(!0),function nf(n,e){return n.createText(e)}(e[Yt],i));function Vf(n){return qg("",n,""),Vf}function qg(n,e,t){const i=Ne(),r=function rc(n,e,t,i){return ji(n,Ol(),t)?e+Ge(t)+i:Jt}(i,n,e,t);return r!==Jt&&ao(i,Qi(),r),qg}const Pa=void 0;var vB=["en",[["a","p"],["AM","PM"],Pa],[["AM","PM"],Pa,Pa],[["S","M","T","W","T","F","S"],["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],["Su","Mo","Tu","We","Th","Fr","Sa"]],Pa,[["J","F","M","A","M","J","J","A","S","O","N","D"],["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],["January","February","March","April","May","June","July","August","September","October","November","December"]],Pa,[["B","A"],["BC","AD"],["Before Christ","Anno Domini"]],0,[6,0],["M/d/yy","MMM d, y","MMMM d, y","EEEE, MMMM d, y"],["h:mm a","h:mm:ss a","h:mm:ss a z","h:mm:ss a zzzz"],["{1}, {0}",Pa,"{1} 'at' {0}",Pa],[".",",",";","%","+","-","E","\xd7","\u2030","\u221e","NaN",":"],["#,##0.###","#,##0%","\xa4#,##0.00","#E0"],"USD","$","US Dollar",{},"ltr",function gB(n){const t=Math.floor(Math.abs(n)),i=n.toString().replace(/^[^.]*\.?/,"").length;return 1===t&&0===i?1:5}];let fc={};function er(n){const e=function yB(n){return n.toLowerCase().replace(/_/g,"-")}(n);let t=zM(e);if(t)return t;const i=e.split("-")[0];if(t=zM(i),t)return t;if("en"===i)return vB;throw new Xe(701,!1)}function zM(n){return n in fc||(fc[n]=zt.ng&&zt.ng.common&&zt.ng.common.locales&&zt.ng.common.locales[n]),fc[n]}var lt=(()=>((lt=lt||{})[lt.LocaleId=0]="LocaleId",lt[lt.DayPeriodsFormat=1]="DayPeriodsFormat",lt[lt.DayPeriodsStandalone=2]="DayPeriodsStandalone",lt[lt.DaysFormat=3]="DaysFormat",lt[lt.DaysStandalone=4]="DaysStandalone",lt[lt.MonthsFormat=5]="MonthsFormat",lt[lt.MonthsStandalone=6]="MonthsStandalone",lt[lt.Eras=7]="Eras",lt[lt.FirstDayOfWeek=8]="FirstDayOfWeek",lt[lt.WeekendRange=9]="WeekendRange",lt[lt.DateFormat=10]="DateFormat",lt[lt.TimeFormat=11]="TimeFormat",lt[lt.DateTimeFormat=12]="DateTimeFormat",lt[lt.NumberSymbols=13]="NumberSymbols",lt[lt.NumberFormats=14]="NumberFormats",lt[lt.CurrencyCode=15]="CurrencyCode",lt[lt.CurrencySymbol=16]="CurrencySymbol",lt[lt.CurrencyName=17]="CurrencyName",lt[lt.Currencies=18]="Currencies",lt[lt.Directionality=19]="Directionality",lt[lt.PluralCase=20]="PluralCase",lt[lt.ExtraData=21]="ExtraData",lt))();const pc="en-US";let HM=pc;class mc{}class vF{}class Kg extends mc{constructor(e,t,i){super(),this._parent=t,this._bootstrapComponents=[],this.destroyCbs=[],this.componentFactoryResolver=new xw(this);const r=function Sr(n,e){const t=n[ux]||null;if(!t&&!0===e)throw new Error(`Type ${Kn(n)} does not have '\u0275mod' property.`);return t}(e);this._bootstrapComponents=function oo(n){return n instanceof Function?n():n}(r.bootstrap),this._r3Injector=ew(e,t,[{provide:mc,useValue:this},{provide:yf,useValue:this.componentFactoryResolver},...i],Kn(e),new Set(["environment"])),this._r3Injector.resolveInjectorInitializers(),this.instance=this._r3Injector.get(e)}get injector(){return this._r3Injector}destroy(){const e=this._r3Injector;!e.destroyed&&e.destroy(),this.destroyCbs.forEach(t=>t()),this.destroyCbs=null}onDestroy(e){this.destroyCbs.push(e)}}class Qg extends vF{constructor(e){super(),this.moduleType=e}create(e){return new Kg(this.moduleType,e,[])}}function gh(n,e){const t=n[e];return t===Jt?void 0:t}function AS(n,e,t,i,r,s,o){const a=e+t;return function Ca(n,e,t,i){const r=ji(n,e,t);return ji(n,e+1,i)||r}(n,a,r,s)?Fs(n,a+2,o?i.call(o,r,s):i(r,s)):gh(n,a+2)}function tv(n,e){const t=An();let i;const r=n+gn;t.firstCreatePass?(i=function HF(n,e){if(e)for(let t=e.length-1;t>=0;t--){const i=e[t];if(n===i.name)return i}}(e,t.pipeRegistry),t.data[r]=i,i.onDestroy&&(t.destroyHooks??=[]).push(r,i.onDestroy)):i=t.data[r];const s=i.factory||(i.factory=ba(i.type)),o=dt(an);try{const a=jd(!1),l=s();return jd(a),function gN(n,e,t,i){t>=n.data.length&&(n.data[t]=null,n.blueprint[t]=null),e[t]=i}(t,Ne(),r,l),l}finally{dt(o)}}function ES(n,e,t){const i=n+gn,r=Ne(),s=Bl(r,i);return vh(r,i)?function bS(n,e,t,i,r,s){const o=e+t;return ji(n,o,r)?Fs(n,o+1,s?i.call(s,r):i(r)):gh(n,o+1)}(r,Ki(),e,s.transform,t,s):s.transform(t)}function vh(n,e){return n[ut].data[e].pure}function nv(n){return e=>{setTimeout(n,void 0,e)}}const lo=class jF extends da{constructor(e=!1){super(),this.__isAsync=e}emit(e){super.next(e)}subscribe(e,t,i){let r=e,s=t||(()=>null),o=i;if(e&&"object"==typeof e){const l=e;r=l.next?.bind(l),s=l.error?.bind(l),o=l.complete?.bind(l)}this.__isAsync&&(s=nv(s),r&&(r=nv(r)),o&&(o=nv(o)));const a=super.subscribe({next:r,error:s,complete:o});return e instanceof ve&&e.add(a),a}};function $F(){return this._results[Symbol.iterator]()}class iv{get changes(){return this._changes||(this._changes=new lo)}constructor(e=!1){this._emitDistinctChangesOnly=e,this.dirty=!0,this._results=[],this._changesDetected=!1,this._changes=null,this.length=0,this.first=void 0,this.last=void 0;const t=iv.prototype;t[Symbol.iterator]||(t[Symbol.iterator]=$F)}get(e){return this._results[e]}map(e){return this._results.map(e)}filter(e){return this._results.filter(e)}find(e){return this._results.find(e)}reduce(e,t){return this._results.reduce(e,t)}forEach(e){this._results.forEach(e)}some(e){return this._results.some(e)}toArray(){return this._results.slice()}toString(){return this._results.toString()}reset(e,t){const i=this;i.dirty=!1;const r=function Hr(n){return n.flat(Number.POSITIVE_INFINITY)}(e);(this._changesDetected=!function VR(n,e,t){if(n.length!==e.length)return!1;for(let i=0;i<n.length;i++){let r=n[i],s=e[i];if(t&&(r=t(r),s=t(s)),s!==r)return!1}return!0}(i._results,r,t))&&(i._results=r,i.length=r.length,i.last=r[this.length-1],i.first=r[0])}notifyOnChanges(){this._changes&&(this._changesDetected||!this._emitDistinctChangesOnly)&&this._changes.emit(this)}setDirty(){this.dirty=!0}destroy(){this.changes.complete(),this.changes.unsubscribe()}}let co=(()=>{class n{}return n.__NG_ELEMENT_ID__=ZF,n})();const XF=co,YF=class extends XF{constructor(e,t,i){super(),this._declarationLView=e,this._declarationTContainer=t,this.elementRef=i}get ssrId(){return this._declarationTContainer.tView?.ssrId||null}createEmbeddedView(e,t){return this.createEmbeddedViewImpl(e,t,null)}createEmbeddedViewImpl(e,t,i){const o=this._declarationTContainer.tView,a=wf(this._declarationLView,o,e,4096&this._declarationLView[Xt]?4096:16,null,o.declTNode,null,null,null,t||null,i||null);a[Nu]=this._declarationLView[this._declarationTContainer.index];const u=this._declarationLView[Ds];return null!==u&&(a[Ds]=u.createEmbeddedView(o)),Dg(o,a,e),new rh(a)}};function ZF(){return Gf(Ui(),Ne())}function Gf(n,e){return 4&n.type?new YF(e,n,Kl(n,e)):null}let ks=(()=>{class n{}return n.__NG_ELEMENT_ID__=iO,n})();function iO(){return LS(Ui(),Ne())}const rO=ks,RS=class extends rO{constructor(e,t,i){super(),this._lContainer=e,this._hostTNode=t,this._hostLView=i}get element(){return Kl(this._hostTNode,this._hostLView)}get injector(){return new kl(this._hostTNode,this._hostLView)}get parentInjector(){const e=x_(this._hostTNode,this._hostLView);if(cb(e)){const t=qd(e,this._hostLView),i=Wd(e);return new kl(t[ut].data[i+8],t)}return new kl(null,this._hostLView)}clear(){for(;this.length>0;)this.remove(this.length-1)}get(e){const t=PS(this._lContainer);return null!==t&&t[e]||null}get length(){return this._lContainer.length-Wi}createEmbeddedView(e,t,i){let r,s;"number"==typeof i?r=i:null!=i&&(r=i.index,s=i.injector);const a=e.createEmbeddedViewImpl(t||{},s,null);return this.insertImpl(a,r,false),a}createComponent(e,t,i,r,s){const o=e&&!function Uu(n){return"function"==typeof n}(e);let a;if(o)a=t;else{const w=t||{};a=w.index,i=w.injector,r=w.projectableNodes,s=w.environmentInjector||w.ngModuleRef}const l=o?e:new sh(Pn(e)),u=i||this.parentInjector;if(!s&&null==l.ngModule){const A=(o?u:this.parentInjector).get(Yl,null);A&&(s=A)}Pn(l.componentType??{});const _=l.create(u,r,null,s);return this.insertImpl(_.hostView,a,false),_}insert(e,t){return this.insertImpl(e,t,!1)}insertImpl(e,t,i){const r=e._lView,s=r[ut];if(function nR(n){return dr(n[$n])}(r)){const l=this.indexOf(e);if(-1!==l)this.detach(l);else{const u=r[$n],d=new RS(u,u[Gi],u[$n]);d.detach(d.indexOf(e))}}const o=this._adjustIndex(t),a=this._lContainer;if(function TP(n,e,t,i){const r=Wi+i,s=t.length;i>0&&(t[r-1][as]=e),i<s-Wi?(e[as]=t[r],bb(t,Wi+i,e)):(t.push(e),e[as]=null),e[$n]=t;const o=e[Nu];null!==o&&t!==o&&function CP(n,e){const t=n[Nl];e[pi]!==e[$n][$n][pi]&&(n[Sx]=!0),null===t?n[Nl]=[e]:t.push(e)}(o,e);const a=e[Ds];null!==a&&a.insertView(n),e[Xt]|=128}(s,r,a,o),!i){const l=G_(o,a),u=r[Yt],d=sf(u,a[Is]);null!==d&&function MP(n,e,t,i,r,s){i[Ai]=r,i[Gi]=e,$u(n,i,t,1,r,s)}(s,a[Gi],u,r,d,l)}return e.attachToViewContainerRef(),bb(sv(a),o,e),e}move(e,t){return this.insert(e,t)}indexOf(e){const t=PS(this._lContainer);return null!==t?t.indexOf(e):-1}remove(e){const t=this._adjustIndex(e,-1),i=k_(this._lContainer,t);i&&(Yd(sv(this._lContainer),t),$b(i[ut],i))}detach(e){const t=this._adjustIndex(e,-1),i=k_(this._lContainer,t);return i&&null!=Yd(sv(this._lContainer),t)?new rh(i):null}_adjustIndex(e,t=0){return e??this.length+t}};function PS(n){return n[8]}function sv(n){return n[8]||(n[8]=[])}function LS(n,e){let t;const i=e[n.index];return dr(i)?t=i:(t=cw(i,e,null,n),e[n.index]=t,Mf(e,t)),NS(t,e,n,i),new RS(t,n,e)}let NS=function BS(n,e,t,i){if(n[Is])return;let r;r=8&t.type?Un(i):function sO(n,e){const t=n[Yt],i=t.createComment(""),r=fr(e,n);return Ma(t,sf(t,r),i,function PP(n,e){return n.nextSibling(e)}(t,r),!1),i}(e,t),n[Is]=r};class ov{constructor(e){this.queryList=e,this.matches=null}clone(){return new ov(this.queryList)}setDirty(){this.queryList.setDirty()}}class av{constructor(e=[]){this.queries=e}createEmbeddedView(e){const t=e.queries;if(null!==t){const i=null!==e.contentQueries?e.contentQueries[0]:t.length,r=[];for(let s=0;s<i;s++){const o=t.getByIndex(s);r.push(this.queries[o.indexInDeclarationView].clone())}return new av(r)}return null}insertView(e){this.dirtyQueriesWithMatches(e)}detachView(e){this.dirtyQueriesWithMatches(e)}dirtyQueriesWithMatches(e){for(let t=0;t<this.queries.length;t++)null!==GS(e,t).matches&&this.queries[t].setDirty()}}class FS{constructor(e,t,i=null){this.predicate=e,this.flags=t,this.read=i}}class lv{constructor(e=[]){this.queries=e}elementStart(e,t){for(let i=0;i<this.queries.length;i++)this.queries[i].elementStart(e,t)}elementEnd(e){for(let t=0;t<this.queries.length;t++)this.queries[t].elementEnd(e)}embeddedTView(e){let t=null;for(let i=0;i<this.length;i++){const r=null!==t?t.length:0,s=this.getByIndex(i).embeddedTView(e,r);s&&(s.indexInDeclarationView=i,null!==t?t.push(s):t=[s])}return null!==t?new lv(t):null}template(e,t){for(let i=0;i<this.queries.length;i++)this.queries[i].template(e,t)}getByIndex(e){return this.queries[e]}get length(){return this.queries.length}track(e){this.queries.push(e)}}class cv{constructor(e,t=-1){this.metadata=e,this.matches=null,this.indexInDeclarationView=-1,this.crossesNgTemplate=!1,this._appliesToNextNode=!0,this._declarationNodeIndex=t}elementStart(e,t){this.isApplyingToNode(t)&&this.matchTNode(e,t)}elementEnd(e){this._declarationNodeIndex===e.index&&(this._appliesToNextNode=!1)}template(e,t){this.elementStart(e,t)}embeddedTView(e,t){return this.isApplyingToNode(e)?(this.crossesNgTemplate=!0,this.addMatch(-e.index,t),new cv(this.metadata)):null}isApplyingToNode(e){if(this._appliesToNextNode&&1!=(1&this.metadata.flags)){const t=this._declarationNodeIndex;let i=e.parent;for(;null!==i&&8&i.type&&i.index!==t;)i=i.parent;return t===(null!==i?i.index:-1)}return this._appliesToNextNode}matchTNode(e,t){const i=this.metadata.predicate;if(Array.isArray(i))for(let r=0;r<i.length;r++){const s=i[r];this.matchTNodeWithReadOption(e,t,lO(t,s)),this.matchTNodeWithReadOption(e,t,Xd(t,e,s,!1,!1))}else i===co?4&t.type&&this.matchTNodeWithReadOption(e,t,-1):this.matchTNodeWithReadOption(e,t,Xd(t,e,i,!1,!1))}matchTNodeWithReadOption(e,t,i){if(null!==i){const r=this.metadata.read;if(null!==r)if(r===Ql||r===ks||r===co&&4&t.type)this.addMatch(t.index,-2);else{const s=Xd(t,e,r,!1,!1);null!==s&&this.addMatch(t.index,s)}else this.addMatch(t.index,i)}}addMatch(e,t){null===this.matches?this.matches=[e,t]:this.matches.push(e,t)}}function lO(n,e){const t=n.localNames;if(null!==t)for(let i=0;i<t.length;i+=2)if(t[i]===e)return t[i+1];return null}function uO(n,e,t,i){return-1===t?function cO(n,e){return 11&n.type?Kl(n,e):4&n.type?Gf(n,e):null}(e,n):-2===t?function hO(n,e,t){return t===Ql?Kl(e,n):t===co?Gf(e,n):t===ks?LS(e,n):void 0}(n,e,i):wa(n,n[ut],t,e)}function OS(n,e,t,i){const r=e[Ds].queries[i];if(null===r.matches){const s=n.data,o=t.matches,a=[];for(let l=0;l<o.length;l+=2){const u=o[l];a.push(u<0?null:uO(e,s[u],o[l+1],t.metadata.read))}r.matches=a}return r.matches}function uv(n,e,t,i){const r=n.queries.getByIndex(t),s=r.matches;if(null!==s){const o=OS(n,e,r,t);for(let a=0;a<s.length;a+=2){const l=s[a];if(l>0)i.push(o[a/2]);else{const u=s[a+1],d=e[-l];for(let f=Wi;f<d.length;f++){const p=d[f];p[Nu]===p[$n]&&uv(p[ut],p,u,i)}if(null!==d[Nl]){const f=d[Nl];for(let p=0;p<f.length;p++){const _=f[p];uv(_[ut],_,u,i)}}}}}return i}function VS(n){const e=Ne(),t=An(),i=Kx();d_(i+1);const r=GS(t,i);if(n.dirty&&function eR(n){return 4==(4&n[Xt])}(e)===(2==(2&r.metadata.flags))){if(null===r.matches)n.reset([]);else{const s=r.crossesNgTemplate?uv(t,e,i,[]):OS(t,e,r,i);n.reset(s,PL),n.notifyOnChanges()}return!0}return!1}function kS(n,e,t){const i=An();i.firstCreatePass&&(function HS(n,e,t){null===n.queries&&(n.queries=new lv),n.queries.track(new cv(e,t))}(i,new FS(n,e,t),-1),2==(2&e)&&(i.staticViewQueries=!0)),function zS(n,e,t){const i=new iv(4==(4&t));(function t2(n,e,t,i){const r=hw(e);r.push(t),n.firstCreatePass&&dw(n).push(i,r.length-1)})(n,e,i,i.destroy),null===e[Ds]&&(e[Ds]=new av),e[Ds].queries.push(new ov(i))}(i,Ne(),e)}function GS(n,e){return n.queries.getByIndex(e)}const FO=new Zt("Application Initializer");let mv=(()=>{class n{constructor(){this.initialized=!1,this.done=!1,this.donePromise=new Promise((t,i)=>{this.resolve=t,this.reject=i}),this.appInits=Hn(FO,{optional:!0})??[]}runInitializers(){if(this.initialized)return;const t=[];for(const r of this.appInits){const s=r();if(kg(s))t.push(s);else if(qw(s)){const o=new Promise((a,l)=>{s.subscribe({complete:a,error:l})});t.push(o)}}const i=()=>{this.done=!0,this.resolve()};Promise.all(t).then(()=>{i()}).catch(r=>{this.reject(r)}),0===t.length&&i(),this.initialized=!0}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275prov=de({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();const uo=new Zt("LocaleId",{providedIn:"root",factory:()=>Hn(uo,rt.Optional|rt.SkipSelf)||function VO(){return typeof $localize<"u"&&$localize.locale||pc}()});let UO=(()=>{class n{constructor(){this.taskId=0,this.pendingTasks=new Set,this.hasPendingTasks=new Em(!1)}add(){this.hasPendingTasks.next(!0);const t=this.taskId++;return this.pendingTasks.add(t),t}remove(t){this.pendingTasks.delete(t),0===this.pendingTasks.size&&this.hasPendingTasks.next(!1)}ngOnDestroy(){this.pendingTasks.clear(),this.hasPendingTasks.next(!1)}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275prov=de({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();function cE(...n){}class Si{constructor({enableLongStackTrace:e=!1,shouldCoalesceEventChangeDetection:t=!1,shouldCoalesceRunChangeDetection:i=!1}){if(this.hasPendingMacrotasks=!1,this.hasPendingMicrotasks=!1,this.isStable=!0,this.onUnstable=new lo(!1),this.onMicrotaskEmpty=new lo(!1),this.onStable=new lo(!1),this.onError=new lo(!1),typeof Zone>"u")throw new Xe(908,!1);Zone.assertZonePatched();const r=this;r._nesting=0,r._outer=r._inner=Zone.current,Zone.TaskTrackingZoneSpec&&(r._inner=r._inner.fork(new Zone.TaskTrackingZoneSpec)),e&&Zone.longStackTraceZoneSpec&&(r._inner=r._inner.fork(Zone.longStackTraceZoneSpec)),r.shouldCoalesceEventChangeDetection=!i&&t,r.shouldCoalesceRunChangeDetection=i,r.lastRequestAnimationFrameId=-1,r.nativeRequestAnimationFrame=function WO(){const n="function"==typeof zt.requestAnimationFrame;let e=zt[n?"requestAnimationFrame":"setTimeout"],t=zt[n?"cancelAnimationFrame":"clearTimeout"];if(typeof Zone<"u"&&e&&t){const i=e[Zone.__symbol__("OriginalDelegate")];i&&(e=i);const r=t[Zone.__symbol__("OriginalDelegate")];r&&(t=r)}return{nativeRequestAnimationFrame:e,nativeCancelAnimationFrame:t}}().nativeRequestAnimationFrame,function $O(n){const e=()=>{!function jO(n){n.isCheckStableRunning||-1!==n.lastRequestAnimationFrameId||(n.lastRequestAnimationFrameId=n.nativeRequestAnimationFrame.call(zt,()=>{n.fakeTopEventTask||(n.fakeTopEventTask=Zone.root.scheduleEventTask("fakeTopEventTask",()=>{n.lastRequestAnimationFrameId=-1,gv(n),n.isCheckStableRunning=!0,_v(n),n.isCheckStableRunning=!1},void 0,()=>{},()=>{})),n.fakeTopEventTask.invoke()}),gv(n))}(n)};n._inner=n._inner.fork({name:"angular",properties:{isAngularZone:!0},onInvokeTask:(t,i,r,s,o,a)=>{try{return uE(n),t.invokeTask(r,s,o,a)}finally{(n.shouldCoalesceEventChangeDetection&&"eventTask"===s.type||n.shouldCoalesceRunChangeDetection)&&e(),hE(n)}},onInvoke:(t,i,r,s,o,a,l)=>{try{return uE(n),t.invoke(r,s,o,a,l)}finally{n.shouldCoalesceRunChangeDetection&&e(),hE(n)}},onHasTask:(t,i,r,s)=>{t.hasTask(r,s),i===r&&("microTask"==s.change?(n._hasPendingMicrotasks=s.microTask,gv(n),_v(n)):"macroTask"==s.change&&(n.hasPendingMacrotasks=s.macroTask))},onHandleError:(t,i,r,s)=>(t.handleError(r,s),n.runOutsideAngular(()=>n.onError.emit(s)),!1)})}(r)}static isInAngularZone(){return typeof Zone<"u"&&!0===Zone.current.get("isAngularZone")}static assertInAngularZone(){if(!Si.isInAngularZone())throw new Xe(909,!1)}static assertNotInAngularZone(){if(Si.isInAngularZone())throw new Xe(909,!1)}run(e,t,i){return this._inner.run(e,t,i)}runTask(e,t,i,r){const s=this._inner,o=s.scheduleEventTask("NgZoneEvent: "+r,e,qO,cE,cE);try{return s.runTask(o,t,i)}finally{s.cancelTask(o)}}runGuarded(e,t,i){return this._inner.runGuarded(e,t,i)}runOutsideAngular(e){return this._outer.run(e)}}const qO={};function _v(n){if(0==n._nesting&&!n.hasPendingMicrotasks&&!n.isStable)try{n._nesting++,n.onMicrotaskEmpty.emit(null)}finally{if(n._nesting--,!n.hasPendingMicrotasks)try{n.runOutsideAngular(()=>n.onStable.emit(null))}finally{n.isStable=!0}}}function gv(n){n.hasPendingMicrotasks=!!(n._hasPendingMicrotasks||(n.shouldCoalesceEventChangeDetection||n.shouldCoalesceRunChangeDetection)&&-1!==n.lastRequestAnimationFrameId)}function uE(n){n._nesting++,n.isStable&&(n.isStable=!1,n.onUnstable.emit(null))}function hE(n){n._nesting--,_v(n)}class XO{constructor(){this.hasPendingMicrotasks=!1,this.hasPendingMacrotasks=!1,this.isStable=!0,this.onUnstable=new lo,this.onMicrotaskEmpty=new lo,this.onStable=new lo,this.onError=new lo}run(e,t,i){return e.apply(t,i)}runGuarded(e,t,i){return e.apply(t,i)}runOutsideAngular(e){return e()}runTask(e,t,i,r){return e.apply(t,i)}}const dE=new Zt("",{providedIn:"root",factory:fE});function fE(){const n=Hn(Si);let e=!0;return qm(new en(r=>{e=n.isStable&&!n.hasPendingMacrotasks&&!n.hasPendingMicrotasks,n.runOutsideAngular(()=>{r.next(e),r.complete()})}),new en(r=>{let s;n.runOutsideAngular(()=>{s=n.onStable.subscribe(()=>{Si.assertNotInAngularZone(),queueMicrotask(()=>{!e&&!n.hasPendingMacrotasks&&!n.hasPendingMicrotasks&&(e=!0,r.next(!0))})})});const o=n.onUnstable.subscribe(()=>{Si.assertInAngularZone(),e&&(e=!1,n.runOutsideAngular(()=>{r.next(!1)}))});return()=>{s.unsubscribe(),o.unsubscribe()}}).pipe(El()))}const pE=new Zt(""),qf=new Zt("");let xv,vv=(()=>{class n{constructor(t,i,r){this._ngZone=t,this.registry=i,this._pendingCount=0,this._isZoneStable=!0,this._didWork=!1,this._callbacks=[],this.taskTrackingZone=null,xv||(function YO(n){xv=n}(r),r.addToWindow(i)),this._watchAngularEvents(),t.run(()=>{this.taskTrackingZone=typeof Zone>"u"?null:Zone.current.get("TaskTrackingZone")})}_watchAngularEvents(){this._ngZone.onUnstable.subscribe({next:()=>{this._didWork=!0,this._isZoneStable=!1}}),this._ngZone.runOutsideAngular(()=>{this._ngZone.onStable.subscribe({next:()=>{Si.assertNotInAngularZone(),queueMicrotask(()=>{this._isZoneStable=!0,this._runCallbacksIfReady()})}})})}increasePendingRequestCount(){return this._pendingCount+=1,this._didWork=!0,this._pendingCount}decreasePendingRequestCount(){if(this._pendingCount-=1,this._pendingCount<0)throw new Error("pending async requests below zero");return this._runCallbacksIfReady(),this._pendingCount}isStable(){return this._isZoneStable&&0===this._pendingCount&&!this._ngZone.hasPendingMacrotasks}_runCallbacksIfReady(){if(this.isStable())queueMicrotask(()=>{for(;0!==this._callbacks.length;){let t=this._callbacks.pop();clearTimeout(t.timeoutId),t.doneCb(this._didWork)}this._didWork=!1});else{let t=this.getPendingTasks();this._callbacks=this._callbacks.filter(i=>!i.updateCb||!i.updateCb(t)||(clearTimeout(i.timeoutId),!1)),this._didWork=!0}}getPendingTasks(){return this.taskTrackingZone?this.taskTrackingZone.macroTasks.map(t=>({source:t.source,creationLocation:t.creationLocation,data:t.data})):[]}addCallback(t,i,r){let s=-1;i&&i>0&&(s=setTimeout(()=>{this._callbacks=this._callbacks.filter(o=>o.timeoutId!==s),t(this._didWork,this.getPendingTasks())},i)),this._callbacks.push({doneCb:t,timeoutId:s,updateCb:r})}whenStable(t,i,r){if(r&&!this.taskTrackingZone)throw new Error('Task tracking zone is required when passing an update callback to whenStable(). Is "zone.js/plugins/task-tracking" loaded?');this.addCallback(t,i,r),this._runCallbacksIfReady()}getPendingRequestCount(){return this._pendingCount}registerApplication(t){this.registry.registerApplication(t,this)}unregisterApplication(t){this.registry.unregisterApplication(t)}findProviders(t,i,r){return[]}}return n.\u0275fac=function(t){return new(t||n)(bn(Si),bn(yv),bn(qf))},n.\u0275prov=de({token:n,factory:n.\u0275fac}),n})(),yv=(()=>{class n{constructor(){this._applications=new Map}registerApplication(t,i){this._applications.set(t,i)}unregisterApplication(t){this._applications.delete(t)}unregisterAllApplications(){this._applications.clear()}getTestability(t){return this._applications.get(t)||null}getAllTestabilities(){return Array.from(this._applications.values())}getAllRootElements(){return Array.from(this._applications.keys())}findTestabilityInTree(t,i=!0){return xv?.findTestabilityInTree(this,t,i)??null}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275prov=de({token:n,factory:n.\u0275fac,providedIn:"platform"}),n})(),Xo=null;const mE=new Zt("AllowMultipleToken"),bv=new Zt("PlatformDestroyListeners"),_E=new Zt("appBootstrapListener");function yE(n,e,t=[]){const i=`Platform: ${e}`,r=new Zt(i);return(s=[])=>{let o=Av();if(!o||o.injector.get(mE,!1)){const a=[...t,...s,{provide:r,useValue:!0}];n?n(a):function KO(n){if(Xo&&!Xo.get(mE,!1))throw new Xe(400,!1);(function gE(){!function WI(n){Rx=n}(()=>{throw new Xe(600,!1)})})(),Xo=n;const e=n.get(bE);(function vE(n){n.get(TA,null)?.forEach(t=>t())})(n)}(function xE(n=[],e){return Ta.create({name:e,providers:[{provide:tg,useValue:"platform"},{provide:bv,useValue:new Set([()=>Xo=null])},...n]})}(a,i))}return function eV(n){const e=Av();if(!e)throw new Xe(401,!1);return e}()}}function Av(){return Xo?.get(bE)??null}let bE=(()=>{class n{constructor(t){this._injector=t,this._modules=[],this._destroyListeners=[],this._destroyed=!1}bootstrapModuleFactory(t,i){const r=function tV(n="zone.js",e){return"noop"===n?new XO:"zone.js"===n?new Si(e):n}(i?.ngZone,function AE(n){return{enableLongStackTrace:!1,shouldCoalesceEventChangeDetection:n?.eventCoalescing??!1,shouldCoalesceRunChangeDetection:n?.runCoalescing??!1}}({eventCoalescing:i?.ngZoneEventCoalescing,runCoalescing:i?.ngZoneRunCoalescing}));return r.run(()=>{const s=function xF(n,e,t){return new Kg(n,e,t)}(t.moduleType,this.injector,function TE(n){return[{provide:Si,useFactory:n},{provide:hf,multi:!0,useFactory:()=>{const e=Hn(iV,{optional:!0});return()=>e.initialize()}},{provide:EE,useFactory:nV},{provide:dE,useFactory:fE}]}(()=>r)),o=s.injector.get(Ea,null);return r.runOutsideAngular(()=>{const a=r.onError.subscribe({next:l=>{o.handleError(l)}});s.onDestroy(()=>{jf(this._modules,s),a.unsubscribe()})}),function wE(n,e,t){try{const i=t();return kg(i)?i.catch(r=>{throw e.runOutsideAngular(()=>n.handleError(r)),r}):i}catch(i){throw e.runOutsideAngular(()=>n.handleError(i)),i}}(o,r,()=>{const a=s.injector.get(mv);return a.runInitializers(),a.donePromise.then(()=>(function GM(n){ee(n,"Expected localeId to be defined"),"string"==typeof n&&(HM=n.toLowerCase().replace(/_/g,"-"))}(s.injector.get(uo,pc)||pc),this._moduleDoBootstrap(s),s))})})}bootstrapModule(t,i=[]){const r=ME({},i);return function ZO(n,e,t){const i=new Qg(t);return Promise.resolve(i)}(0,0,t).then(s=>this.bootstrapModuleFactory(s,r))}_moduleDoBootstrap(t){const i=t.injector.get(xh);if(t._bootstrapComponents.length>0)t._bootstrapComponents.forEach(r=>i.bootstrap(r));else{if(!t.instance.ngDoBootstrap)throw new Xe(-403,!1);t.instance.ngDoBootstrap(i)}this._modules.push(t)}onDestroy(t){this._destroyListeners.push(t)}get injector(){return this._injector}destroy(){if(this._destroyed)throw new Xe(404,!1);this._modules.slice().forEach(i=>i.destroy()),this._destroyListeners.forEach(i=>i());const t=this._injector.get(bv,null);t&&(t.forEach(i=>i()),t.clear()),this._destroyed=!0}get destroyed(){return this._destroyed}}return n.\u0275fac=function(t){return new(t||n)(bn(Ta))},n.\u0275prov=de({token:n,factory:n.\u0275fac,providedIn:"platform"}),n})();function ME(n,e){return Array.isArray(e)?e.reduce(ME,n):{...n,...e}}let xh=(()=>{class n{constructor(){this._bootstrapListeners=[],this._runningTick=!1,this._destroyed=!1,this._destroyListeners=[],this._views=[],this.internalErrorHandler=Hn(EE),this.zoneIsStable=Hn(dE),this.componentTypes=[],this.components=[],this.isStable=Hn(UO).hasPendingTasks.pipe(function Td(n,e){return Js((t,i)=>{let r=null,s=0,o=!1;const a=()=>o&&!r&&i.complete();t.subscribe(br(i,l=>{r?.unsubscribe();let u=0;const d=s++;ar(n(l,d)).subscribe(r=br(i,f=>i.next(e?e(l,f,d,u++):f),()=>{r=null,a()}))},()=>{o=!0,a()}))})}(t=>t?function jm(...n){return wu(n,Md(n))}(!1):this.zoneIsStable),function $m(n,e=Lo){return n=n??Oo,Js((t,i)=>{let r,s=!0;t.subscribe(br(i,o=>{const a=e(o);(s||!n(r,a))&&(s=!1,r=a,i.next(o))}))})}(),El()),this._injector=Hn(Yl)}get destroyed(){return this._destroyed}get injector(){return this._injector}bootstrap(t,i){const r=t instanceof NA;if(!this._injector.get(mv).done)throw!r&&function Ru(n){const e=Pn(n)||Hi(n)||hr(n);return null!==e&&e.standalone}(t),new Xe(405,!1);let o;o=r?t:this._injector.get(yf).resolveComponentFactory(t),this.componentTypes.push(o.componentType);const a=function JO(n){return n.isBoundToModule}(o)?void 0:this._injector.get(mc),u=o.create(Ta.NULL,[],i||o.selector,a),d=u.location.nativeElement,f=u.injector.get(pE,null);return f?.registerApplication(d),u.onDestroy(()=>{this.detachView(u.hostView),jf(this.components,u),f?.unregisterApplication(d)}),this._loadComponent(u),u}tick(){if(this._runningTick)throw new Xe(101,!1);try{this._runningTick=!0;for(let t of this._views)t.detectChanges()}catch(t){this.internalErrorHandler(t)}finally{this._runningTick=!1}}attachView(t){const i=t;this._views.push(i),i.attachToAppRef(this)}detachView(t){const i=t;jf(this._views,i),i.detachFromAppRef()}_loadComponent(t){this.attachView(t.hostView),this.tick(),this.components.push(t);const i=this._injector.get(_E,[]);i.push(...this._bootstrapListeners),i.forEach(r=>r(t))}ngOnDestroy(){if(!this._destroyed)try{this._destroyListeners.forEach(t=>t()),this._views.slice().forEach(t=>t.destroy())}finally{this._destroyed=!0,this._views=[],this._bootstrapListeners=[],this._destroyListeners=[]}}onDestroy(t){return this._destroyListeners.push(t),()=>jf(this._destroyListeners,t)}destroy(){if(this._destroyed)throw new Xe(406,!1);const t=this._injector;t.destroy&&!t.destroyed&&t.destroy()}get viewCount(){return this._views.length}warnIfDestroyed(){}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275prov=de({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();function jf(n,e){const t=n.indexOf(e);t>-1&&n.splice(t,1)}const EE=new Zt("",{providedIn:"root",factory:()=>Hn(Ea).handleError.bind(void 0)});function nV(){const n=Hn(Si),e=Hn(Ea);return t=>n.runOutsideAngular(()=>e.handleError(t))}let iV=(()=>{class n{constructor(){this.zone=Hn(Si),this.applicationRef=Hn(xh)}initialize(){this._onMicrotaskEmptySubscription||(this._onMicrotaskEmptySubscription=this.zone.onMicrotaskEmpty.subscribe({next:()=>{this.zone.run(()=>{this.applicationRef.tick()})}}))}ngOnDestroy(){this._onMicrotaskEmptySubscription?.unsubscribe()}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275prov=de({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();const xV=yE(null,"core",[]);let bV=(()=>{class n{constructor(t){}}return n.\u0275fac=function(t){return new(t||n)(bn(xh))},n.\u0275mod=Iu({type:n}),n.\u0275inj=Oe({}),n})(),Dv=null;function Iv(){return Dv}class PV{}const Na=new Zt("DocumentToken");var _r=(()=>((_r=_r||{})[_r.Decimal=0]="Decimal",_r[_r.Percent=1]="Percent",_r[_r.Currency=2]="Currency",_r[_r.Scientific=3]="Scientific",_r))(),Lt=(()=>((Lt=Lt||{})[Lt.Decimal=0]="Decimal",Lt[Lt.Group=1]="Group",Lt[Lt.List=2]="List",Lt[Lt.PercentSign=3]="PercentSign",Lt[Lt.PlusSign=4]="PlusSign",Lt[Lt.MinusSign=5]="MinusSign",Lt[Lt.Exponential=6]="Exponential",Lt[Lt.SuperscriptingExponent=7]="SuperscriptingExponent",Lt[Lt.PerMille=8]="PerMille",Lt[Lt.Infinity=9]="Infinity",Lt[Lt.NaN=10]="NaN",Lt[Lt.TimeSeparator=11]="TimeSeparator",Lt[Lt.CurrencyDecimal=12]="CurrencyDecimal",Lt[Lt.CurrencyGroup=13]="CurrencyGroup",Lt))();function Wr(n,e){const t=er(n),i=t[lt.NumberSymbols][e];if(typeof i>"u"){if(e===Lt.CurrencyDecimal)return t[lt.NumberSymbols][Lt.Decimal];if(e===Lt.CurrencyGroup)return t[lt.NumberSymbols][Lt.Group]}return i}function Rv(n,e){return er(n)[lt.NumberFormats][e]}const ok=/^(\d+)?\.((\d+)(-(\d+))?)?$/;function Fv(n,e,t,i,r,s,o=!1){let a="",l=!1;if(isFinite(n)){let u=function pk(n){let i,r,s,o,a,e=Math.abs(n)+"",t=0;for((r=e.indexOf("."))>-1&&(e=e.replace(".","")),(s=e.search(/e/i))>0?(r<0&&(r=s),r+=+e.slice(s+1),e=e.substring(0,s)):r<0&&(r=e.length),s=0;"0"===e.charAt(s);s++);if(s===(a=e.length))i=[0],r=1;else{for(a--;"0"===e.charAt(a);)a--;for(r-=s,i=[],o=0;s<=a;s++,o++)i[o]=Number(e.charAt(s))}return r>22&&(i=i.splice(0,21),t=r-1,r=1),{digits:i,exponent:t,integerLen:r}}(n);o&&(u=function fk(n){if(0===n.digits[0])return n;const e=n.digits.length-n.integerLen;return n.exponent?n.exponent+=2:(0===e?n.digits.push(0,0):1===e&&n.digits.push(0),n.integerLen+=2),n}(u));let d=e.minInt,f=e.minFrac,p=e.maxFrac;if(s){const C=s.match(ok);if(null===C)throw new Error(`${s} is not a valid digit info`);const T=C[1],I=C[3],N=C[5];null!=T&&(d=Vv(T)),null!=I&&(f=Vv(I)),null!=N?p=Vv(N):null!=I&&f>p&&(p=f)}!function mk(n,e,t){if(e>t)throw new Error(`The minimum number of digits after fraction (${e}) is higher than the maximum (${t}).`);let i=n.digits,r=i.length-n.integerLen;const s=Math.min(Math.max(e,r),t);let o=s+n.integerLen,a=i[o];if(o>0){i.splice(Math.max(n.integerLen,o));for(let f=o;f<i.length;f++)i[f]=0}else{r=Math.max(0,r),n.integerLen=1,i.length=Math.max(1,o=s+1),i[0]=0;for(let f=1;f<o;f++)i[f]=0}if(a>=5)if(o-1<0){for(let f=0;f>o;f--)i.unshift(0),n.integerLen++;i.unshift(1),n.integerLen++}else i[o-1]++;for(;r<Math.max(0,s);r++)i.push(0);let l=0!==s;const u=e+n.integerLen,d=i.reduceRight(function(f,p,_,y){return y[_]=(p+=f)<10?p:p-10,l&&(0===y[_]&&_>=u?y.pop():l=!1),p>=10?1:0},0);d&&(i.unshift(d),n.integerLen++)}(u,f,p);let _=u.digits,y=u.integerLen;const w=u.exponent;let A=[];for(l=_.every(C=>!C);y<d;y++)_.unshift(0);for(;y<0;y++)_.unshift(0);y>0?A=_.splice(y,_.length):(A=_,_=[0]);const b=[];for(_.length>=e.lgSize&&b.unshift(_.splice(-e.lgSize,_.length).join(""));_.length>e.gSize;)b.unshift(_.splice(-e.gSize,_.length).join(""));_.length&&b.unshift(_.join("")),a=b.join(Wr(t,i)),A.length&&(a+=Wr(t,r)+A.join("")),w&&(a+=Wr(t,Lt.Exponential)+"+"+w)}else a=Wr(t,Lt.Infinity);return a=n<0&&!l?e.negPre+a+e.negSuf:e.posPre+a+e.posSuf,a}function Ov(n,e="-"){const t={minInt:1,minFrac:0,maxFrac:0,posPre:"",posSuf:"",negPre:"",negSuf:"",gSize:0,lgSize:0},i=n.split(";"),r=i[0],s=i[1],o=-1!==r.indexOf(".")?r.split("."):[r.substring(0,r.lastIndexOf("0")+1),r.substring(r.lastIndexOf("0")+1)],a=o[0],l=o[1]||"";t.posPre=a.substring(0,a.indexOf("#"));for(let d=0;d<l.length;d++){const f=l.charAt(d);"0"===f?t.minFrac=t.maxFrac=d+1:"#"===f?t.maxFrac=d+1:t.posSuf+=f}const u=a.split(",");if(t.gSize=u[1]?u[1].length:0,t.lgSize=u[2]||u[1]?(u[2]||u[1]).length:0,s){const d=r.length-t.posPre.length-t.posSuf.length,f=s.indexOf("#");t.negPre=s.substring(0,f).replace(/'/g,""),t.negSuf=s.slice(f+d).replace(/'/g,"")}else t.negPre=e+t.posPre,t.negSuf=t.posSuf;return t}function Vv(n){const e=parseInt(n);if(isNaN(e))throw new Error("Invalid integer literal when parsing "+n);return e}let eT=(()=>{class n{constructor(t,i){this._viewContainer=t,this._context=new Ak,this._thenTemplateRef=null,this._elseTemplateRef=null,this._thenViewRef=null,this._elseViewRef=null,this._thenTemplateRef=i}set ngIf(t){this._context.$implicit=this._context.ngIf=t,this._updateView()}set ngIfThen(t){tT("ngIfThen",t),this._thenTemplateRef=t,this._thenViewRef=null,this._updateView()}set ngIfElse(t){tT("ngIfElse",t),this._elseTemplateRef=t,this._elseViewRef=null,this._updateView()}_updateView(){this._context.$implicit?this._thenViewRef||(this._viewContainer.clear(),this._elseViewRef=null,this._thenTemplateRef&&(this._thenViewRef=this._viewContainer.createEmbeddedView(this._thenTemplateRef,this._context))):this._elseViewRef||(this._viewContainer.clear(),this._thenViewRef=null,this._elseTemplateRef&&(this._elseViewRef=this._viewContainer.createEmbeddedView(this._elseTemplateRef,this._context)))}static ngTemplateContextGuard(t,i){return!0}}return n.\u0275fac=function(t){return new(t||n)(an(ks),an(co))},n.\u0275dir=zr({type:n,selectors:[["","ngIf",""]],inputs:{ngIf:"ngIf",ngIfThen:"ngIfThen",ngIfElse:"ngIfElse"},standalone:!0}),n})();class Ak{constructor(){this.$implicit=null,this.ngIf=null}}function tT(n,e){if(e&&!e.createEmbeddedView)throw new Error(`${n} must be a TemplateRef, but received '${Kn(e)}'.`)}function ps(n,e){return new Xe(2100,!1)}let rT=(()=>{class n{constructor(t){this._locale=t}transform(t,i,r){if(!Gv(t))return null;r=r||this._locale;try{return function dk(n,e,t){return Fv(n,Ov(Rv(e,_r.Decimal),Wr(e,Lt.MinusSign)),e,Lt.Group,Lt.Decimal,t)}(Wv(t),r,i)}catch(s){throw ps()}}}return n.\u0275fac=function(t){return new(t||n)(an(uo,16))},n.\u0275pipe=ur({name:"number",type:n,pure:!0,standalone:!0}),n})(),sT=(()=>{class n{constructor(t){this._locale=t}transform(t,i,r){if(!Gv(t))return null;r=r||this._locale;try{return function hk(n,e,t){return Fv(n,Ov(Rv(e,_r.Percent),Wr(e,Lt.MinusSign)),e,Lt.Group,Lt.Decimal,t,!0).replace(new RegExp("%","g"),Wr(e,Lt.PercentSign))}(Wv(t),r,i)}catch(s){throw ps()}}}return n.\u0275fac=function(t){return new(t||n)(an(uo,16))},n.\u0275pipe=ur({name:"percent",type:n,pure:!0,standalone:!0}),n})();function Gv(n){return!(null==n||""===n||n!=n)}function Wv(n){if("string"==typeof n&&!isNaN(Number(n)-parseFloat(n)))return Number(n);if("number"!=typeof n)throw new Error(`${n} is not a number`);return n}let qk=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=Iu({type:n}),n.\u0275inj=Oe({}),n})();function aT(n){return"server"===n}class yU extends PV{constructor(){super(...arguments),this.supportsDOMEvents=!0}}class $v extends yU{static makeCurrent(){!function RV(n){Dv||(Dv=n)}(new $v)}onAndCancel(e,t,i){return e.addEventListener(t,i),()=>{e.removeEventListener(t,i)}}dispatchEvent(e,t){e.dispatchEvent(t)}remove(e){e.parentNode&&e.parentNode.removeChild(e)}createElement(e,t){return(t=t||this.getDefaultDocument()).createElement(e)}createHtmlDocument(){return document.implementation.createHTMLDocument("fakeTitle")}getDefaultDocument(){return document}isElementNode(e){return e.nodeType===Node.ELEMENT_NODE}isShadowRoot(e){return e instanceof DocumentFragment}getGlobalEventTarget(e,t){return"window"===t?window:"document"===t?e:"body"===t?e.body:null}getBaseHref(e){const t=function xU(){return Sh=Sh||document.querySelector("base"),Sh?Sh.getAttribute("href"):null}();return null==t?null:function bU(n){lp=lp||document.createElement("a"),lp.setAttribute("href",n);const e=lp.pathname;return"/"===e.charAt(0)?e:`/${e}`}(t)}resetBaseElement(){Sh=null}getUserAgent(){return window.navigator.userAgent}getCookie(e){return function gk(n,e){e=encodeURIComponent(e);for(const t of n.split(";")){const i=t.indexOf("="),[r,s]=-1==i?[t,""]:[t.slice(0,i),t.slice(i+1)];if(r.trim()===e)return decodeURIComponent(s)}return null}(document.cookie,e)}}let lp,Sh=null,wU=(()=>{class n{build(){return new XMLHttpRequest}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275prov=de({token:n,factory:n.\u0275fac}),n})();const Xv=new Zt("EventManagerPlugins");let fT=(()=>{class n{constructor(t,i){this._zone=i,this._eventNameToPlugin=new Map,t.forEach(r=>{r.manager=this}),this._plugins=t.slice().reverse()}addEventListener(t,i,r){return this._findPluginFor(i).addEventListener(t,i,r)}getZone(){return this._zone}_findPluginFor(t){let i=this._eventNameToPlugin.get(t);if(i)return i;if(i=this._plugins.find(s=>s.supports(t)),!i)throw new Xe(5101,!1);return this._eventNameToPlugin.set(t,i),i}}return n.\u0275fac=function(t){return new(t||n)(bn(Xv),bn(Si))},n.\u0275prov=de({token:n,factory:n.\u0275fac}),n})();class pT{constructor(e){this._doc=e}}const Yv="ng-app-id";let mT=(()=>{class n{constructor(t,i,r,s={}){this.doc=t,this.appId=i,this.nonce=r,this.platformId=s,this.styleRef=new Map,this.hostNodes=new Set,this.styleNodesInDOM=this.collectServerRenderedStyles(),this.platformIsServer=aT(s),this.resetHostNodes()}addStyles(t){for(const i of t)1===this.changeUsageCount(i,1)&&this.onStyleAdded(i)}removeStyles(t){for(const i of t)this.changeUsageCount(i,-1)<=0&&this.onStyleRemoved(i)}ngOnDestroy(){const t=this.styleNodesInDOM;t&&(t.forEach(i=>i.remove()),t.clear());for(const i of this.getAllStyles())this.onStyleRemoved(i);this.resetHostNodes()}addHost(t){this.hostNodes.add(t);for(const i of this.getAllStyles())this.addStyleToHost(t,i)}removeHost(t){this.hostNodes.delete(t)}getAllStyles(){return this.styleRef.keys()}onStyleAdded(t){for(const i of this.hostNodes)this.addStyleToHost(i,t)}onStyleRemoved(t){const i=this.styleRef;i.get(t)?.elements?.forEach(r=>r.remove()),i.delete(t)}collectServerRenderedStyles(){const t=this.doc.head?.querySelectorAll(`style[${Yv}="${this.appId}"]`);if(t?.length){const i=new Map;return t.forEach(r=>{null!=r.textContent&&i.set(r.textContent,r)}),i}return null}changeUsageCount(t,i){const r=this.styleRef;if(r.has(t)){const s=r.get(t);return s.usage+=i,s.usage}return r.set(t,{usage:i,elements:[]}),i}getStyleElement(t,i){const r=this.styleNodesInDOM,s=r?.get(i);if(s?.parentNode===t)return r.delete(i),s.removeAttribute(Yv),s;{const o=this.doc.createElement("style");return this.nonce&&o.setAttribute("nonce",this.nonce),o.textContent=i,this.platformIsServer&&o.setAttribute(Yv,this.appId),o}}addStyleToHost(t,i){const r=this.getStyleElement(t,i);t.appendChild(r);const s=this.styleRef,o=s.get(i)?.elements;o?o.push(r):s.set(i,{elements:[r],usage:1})}resetHostNodes(){const t=this.hostNodes;t.clear(),t.add(this.doc.head)}}return n.\u0275fac=function(t){return new(t||n)(bn(Na),bn(pf),bn(CA,8),bn(Jl))},n.\u0275prov=de({token:n,factory:n.\u0275fac}),n})();const Zv={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/",math:"http://www.w3.org/1998/MathML/"},Jv=/%COMP%/g,TU=new Zt("RemoveStylesOnCompDestroy",{providedIn:"root",factory:()=>!1});function gT(n,e){return e.map(t=>t.replace(Jv,n))}let vT=(()=>{class n{constructor(t,i,r,s,o,a,l,u=null){this.eventManager=t,this.sharedStylesHost=i,this.appId=r,this.removeStylesOnCompDestroy=s,this.doc=o,this.platformId=a,this.ngZone=l,this.nonce=u,this.rendererByCompId=new Map,this.platformIsServer=aT(a),this.defaultRenderer=new Kv(t,o,l,this.platformIsServer)}createRenderer(t,i){if(!t||!i)return this.defaultRenderer;this.platformIsServer&&i.encapsulation===Mr.ShadowDom&&(i={...i,encapsulation:Mr.Emulated});const r=this.getOrCreateRenderer(t,i);return r instanceof xT?r.applyToHost(t):r instanceof Qv&&r.applyStyles(),r}getOrCreateRenderer(t,i){const r=this.rendererByCompId;let s=r.get(i.id);if(!s){const o=this.doc,a=this.ngZone,l=this.eventManager,u=this.sharedStylesHost,d=this.removeStylesOnCompDestroy,f=this.platformIsServer;switch(i.encapsulation){case Mr.Emulated:s=new xT(l,u,i,this.appId,d,o,a,f);break;case Mr.ShadowDom:return new RU(l,u,t,i,o,a,this.nonce,f);default:s=new Qv(l,u,i,d,o,a,f)}s.onDestroy=()=>r.delete(i.id),r.set(i.id,s)}return s}ngOnDestroy(){this.rendererByCompId.clear()}}return n.\u0275fac=function(t){return new(t||n)(bn(fT),bn(mT),bn(pf),bn(TU),bn(Na),bn(Jl),bn(Si),bn(CA))},n.\u0275prov=de({token:n,factory:n.\u0275fac}),n})();class Kv{constructor(e,t,i,r){this.eventManager=e,this.doc=t,this.ngZone=i,this.platformIsServer=r,this.data=Object.create(null),this.destroyNode=null}destroy(){}createElement(e,t){return t?this.doc.createElementNS(Zv[t]||t,e):this.doc.createElement(e)}createComment(e){return this.doc.createComment(e)}createText(e){return this.doc.createTextNode(e)}appendChild(e,t){(yT(e)?e.content:e).appendChild(t)}insertBefore(e,t,i){e&&(yT(e)?e.content:e).insertBefore(t,i)}removeChild(e,t){e&&e.removeChild(t)}selectRootElement(e,t){let i="string"==typeof e?this.doc.querySelector(e):e;if(!i)throw new Xe(-5104,!1);return t||(i.textContent=""),i}parentNode(e){return e.parentNode}nextSibling(e){return e.nextSibling}setAttribute(e,t,i,r){if(r){t=r+":"+t;const s=Zv[r];s?e.setAttributeNS(s,t,i):e.setAttribute(t,i)}else e.setAttribute(t,i)}removeAttribute(e,t,i){if(i){const r=Zv[i];r?e.removeAttributeNS(r,t):e.removeAttribute(`${i}:${t}`)}else e.removeAttribute(t)}addClass(e,t){e.classList.add(t)}removeClass(e,t){e.classList.remove(t)}setStyle(e,t,i,r){r&(pr.DashCase|pr.Important)?e.style.setProperty(t,i,r&pr.Important?"important":""):e.style[t]=i}removeStyle(e,t,i){i&pr.DashCase?e.style.removeProperty(t):e.style[t]=""}setProperty(e,t,i){e[t]=i}setValue(e,t){e.nodeValue=t}listen(e,t,i){if("string"==typeof e&&!(e=Iv().getGlobalEventTarget(this.doc,e)))throw new Error(`Unsupported event target ${e} for event ${t}`);return this.eventManager.addEventListener(e,t,this.decoratePreventDefault(i))}decoratePreventDefault(e){return t=>{if("__ngUnwrap__"===t)return e;!1===(this.platformIsServer?this.ngZone.runGuarded(()=>e(t)):e(t))&&t.preventDefault()}}}function yT(n){return"TEMPLATE"===n.tagName&&void 0!==n.content}class RU extends Kv{constructor(e,t,i,r,s,o,a,l){super(e,s,o,l),this.sharedStylesHost=t,this.hostEl=i,this.shadowRoot=i.attachShadow({mode:"open"}),this.sharedStylesHost.addHost(this.shadowRoot);const u=gT(r.id,r.styles);for(const d of u){const f=document.createElement("style");a&&f.setAttribute("nonce",a),f.textContent=d,this.shadowRoot.appendChild(f)}}nodeOrShadowRoot(e){return e===this.hostEl?this.shadowRoot:e}appendChild(e,t){return super.appendChild(this.nodeOrShadowRoot(e),t)}insertBefore(e,t,i){return super.insertBefore(this.nodeOrShadowRoot(e),t,i)}removeChild(e,t){return super.removeChild(this.nodeOrShadowRoot(e),t)}parentNode(e){return this.nodeOrShadowRoot(super.parentNode(this.nodeOrShadowRoot(e)))}destroy(){this.sharedStylesHost.removeHost(this.shadowRoot)}}class Qv extends Kv{constructor(e,t,i,r,s,o,a,l){super(e,s,o,a),this.sharedStylesHost=t,this.removeStylesOnCompDestroy=r,this.rendererUsageCount=0,this.styles=l?gT(l,i.styles):i.styles}applyStyles(){this.sharedStylesHost.addStyles(this.styles),this.rendererUsageCount++}destroy(){this.removeStylesOnCompDestroy&&(this.sharedStylesHost.removeStyles(this.styles),this.rendererUsageCount--,0===this.rendererUsageCount&&this.onDestroy?.())}}class xT extends Qv{constructor(e,t,i,r,s,o,a,l){const u=r+"-"+i.id;super(e,t,i,s,o,a,l,u),this.contentAttr=function CU(n){return"_ngcontent-%COMP%".replace(Jv,n)}(u),this.hostAttr=function DU(n){return"_nghost-%COMP%".replace(Jv,n)}(u)}applyToHost(e){this.applyStyles(),this.setAttribute(e,this.hostAttr,"")}createElement(e,t){const i=super.createElement(e,t);return super.setAttribute(i,this.contentAttr,""),i}}let PU=(()=>{class n extends pT{constructor(t){super(t)}supports(t){return!0}addEventListener(t,i,r){return t.addEventListener(i,r,!1),()=>this.removeEventListener(t,i,r)}removeEventListener(t,i,r){return t.removeEventListener(i,r)}}return n.\u0275fac=function(t){return new(t||n)(bn(Na))},n.\u0275prov=de({token:n,factory:n.\u0275fac}),n})();const bT=["alt","control","meta","shift"],LU={"\b":"Backspace","\t":"Tab","\x7f":"Delete","\x1b":"Escape",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Menu:"ContextMenu",Scroll:"ScrollLock",Win:"OS"},NU={alt:n=>n.altKey,control:n=>n.ctrlKey,meta:n=>n.metaKey,shift:n=>n.shiftKey};let BU=(()=>{class n extends pT{constructor(t){super(t)}supports(t){return null!=n.parseEventName(t)}addEventListener(t,i,r){const s=n.parseEventName(i),o=n.eventCallback(s.fullKey,r,this.manager.getZone());return this.manager.getZone().runOutsideAngular(()=>Iv().onAndCancel(t,s.domEventName,o))}static parseEventName(t){const i=t.toLowerCase().split("."),r=i.shift();if(0===i.length||"keydown"!==r&&"keyup"!==r)return null;const s=n._normalizeKey(i.pop());let o="",a=i.indexOf("code");if(a>-1&&(i.splice(a,1),o="code."),bT.forEach(u=>{const d=i.indexOf(u);d>-1&&(i.splice(d,1),o+=u+".")}),o+=s,0!=i.length||0===s.length)return null;const l={};return l.domEventName=r,l.fullKey=o,l}static matchEventFullKeyCode(t,i){let r=LU[t.key]||t.key,s="";return i.indexOf("code.")>-1&&(r=t.code,s="code."),!(null==r||!r)&&(r=r.toLowerCase()," "===r?r="space":"."===r&&(r="dot"),bT.forEach(o=>{o!==r&&(0,NU[o])(t)&&(s+=o+".")}),s+=r,s===i)}static eventCallback(t,i,r){return s=>{n.matchEventFullKeyCode(s,t)&&r.runGuarded(()=>i(s))}}static _normalizeKey(t){return"esc"===t?"escape":t}}return n.\u0275fac=function(t){return new(t||n)(bn(Na))},n.\u0275prov=de({token:n,factory:n.\u0275fac}),n})();const kU=yE(xV,"browser",[{provide:Jl,useValue:"browser"},{provide:TA,useValue:function FU(){$v.makeCurrent()},multi:!0},{provide:Na,useFactory:function VU(){return function UP(n){j_=n}(document),document},deps:[]}]),UU=new Zt(""),MT=[{provide:qf,useClass:class AU{addToWindow(e){zt.getAngularTestability=(i,r=!0)=>{const s=e.findTestabilityInTree(i,r);if(null==s)throw new Xe(5103,!1);return s},zt.getAllAngularTestabilities=()=>e.getAllTestabilities(),zt.getAllAngularRootElements=()=>e.getAllRootElements(),zt.frameworkStabilizers||(zt.frameworkStabilizers=[]),zt.frameworkStabilizers.push(i=>{const r=zt.getAllAngularTestabilities();let s=r.length,o=!1;const a=function(l){o=o||l,s--,0==s&&i(o)};r.forEach(l=>{l.whenStable(a)})})}findTestabilityInTree(e,t,i){return null==t?null:e.getTestability(t)??(i?Iv().isShadowRoot(t)?this.findTestabilityInTree(e,t.host,!0):this.findTestabilityInTree(e,t.parentElement,!0):null)}},deps:[]},{provide:pE,useClass:vv,deps:[Si,yv,qf]},{provide:vv,useClass:vv,deps:[Si,yv,qf]}],ST=[{provide:tg,useValue:"root"},{provide:Ea,useFactory:function OU(){return new Ea},deps:[]},{provide:Xv,useClass:PU,multi:!0,deps:[Na,Si,Jl]},{provide:Xv,useClass:BU,multi:!0,deps:[Na]},vT,mT,fT,{provide:FA,useExisting:vT},{provide:class Zk{},useClass:wU,deps:[]},[]];let zU=(()=>{class n{constructor(t){}static withServerTransition(t){return{ngModule:n,providers:[{provide:pf,useValue:t.appId}]}}}return n.\u0275fac=function(t){return new(t||n)(bn(UU,12))},n.\u0275mod=Iu({type:n}),n.\u0275inj=Oe({providers:[...ST,...MT],imports:[qk,bV]}),n})();function DT(n,e,t,i,r,s,o){try{var a=n[s](o),l=a.value}catch(u){return void t(u)}a.done?e(l):Promise.resolve(l).then(i,r)}function IT(n){return function(){var e=this,t=arguments;return new Promise(function(i,r){var s=n.apply(e,t);function o(l){DT(s,i,r,o,a,"next",l)}function a(l){DT(s,i,r,o,a,"throw",l)}o(void 0)})}}typeof window<"u"&&window;const PT=1,LT=2,fo=3,cp=0,m3=1,_3=2,mo=0,g3=1,v3=2,y3=3,x3=4,b3=5,Ba=301,Fa=302,Eh=306,Oa=1e3,$i=1001,ui=1003,ei=1006,_o=1008,Jo=1009,Ko=1014,go=1015,Dh=1016,Va=1020,jr=1023,ka=1026,xc=1027,Ih=2300,bc=2301,Ua=3001,jt="srgb",zs="srgb-linear",yC="display-p3",xC="300 es",vo=2e3;class Mc{addEventListener(e,t){void 0===this._listeners&&(this._listeners={});const i=this._listeners;void 0===i[e]&&(i[e]=[]),-1===i[e].indexOf(t)&&i[e].push(t)}hasEventListener(e,t){if(void 0===this._listeners)return!1;const i=this._listeners;return void 0!==i[e]&&-1!==i[e].indexOf(t)}removeEventListener(e,t){if(void 0===this._listeners)return;const r=this._listeners[e];if(void 0!==r){const s=r.indexOf(t);-1!==s&&r.splice(s,1)}}dispatchEvent(e){if(void 0===this._listeners)return;const i=this._listeners[e.type];if(void 0!==i){e.target=this;const r=i.slice(0);for(let s=0,o=r.length;s<o;s++)r[s].call(this,e);e.target=null}}}const Xi=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];let bC=1234567;const Ga=Math.PI/180,Sc=180/Math.PI;function Ir(){const n=4294967295*Math.random()|0,e=4294967295*Math.random()|0,t=4294967295*Math.random()|0,i=4294967295*Math.random()|0;return(Xi[255&n]+Xi[n>>8&255]+Xi[n>>16&255]+Xi[n>>24&255]+"-"+Xi[255&e]+Xi[e>>8&255]+"-"+Xi[e>>16&15|64]+Xi[e>>24&255]+"-"+Xi[63&t|128]+Xi[t>>8&255]+"-"+Xi[t>>16&255]+Xi[t>>24&255]+Xi[255&i]+Xi[i>>8&255]+Xi[i>>16&255]+Xi[i>>24&255]).toLowerCase()}function ti(n,e,t){return Math.max(e,Math.min(t,n))}function _y(n,e){return(n%e+e)%e}function Rh(n,e,t){return(1-t)*n+t*e}function gy(n){return 0==(n&n-1)&&0!==n}function AC(n){return Math.pow(2,Math.ceil(Math.log(n)/Math.LN2))}function _p(n){return Math.pow(2,Math.floor(Math.log(n)/Math.LN2))}function Rr(n,e){switch(e.constructor){case Float32Array:return n;case Uint32Array:return n/4294967295;case Uint16Array:return n/65535;case Uint8Array:return n/255;case Int32Array:return Math.max(n/2147483647,-1);case Int16Array:return Math.max(n/32767,-1);case Int8Array:return Math.max(n/127,-1);default:throw new Error("Invalid component type.")}}function ln(n,e){switch(e.constructor){case Float32Array:return n;case Uint32Array:return Math.round(4294967295*n);case Uint16Array:return Math.round(65535*n);case Uint8Array:return Math.round(255*n);case Int32Array:return Math.round(2147483647*n);case Int16Array:return Math.round(32767*n);case Int8Array:return Math.round(127*n);default:throw new Error("Invalid component type.")}}const yo={DEG2RAD:Ga,RAD2DEG:Sc,generateUUID:Ir,clamp:ti,euclideanModulo:_y,mapLinear:function $3(n,e,t,i,r){return i+(n-e)*(r-i)/(t-e)},inverseLerp:function X3(n,e,t){return n!==e?(t-n)/(e-n):0},lerp:Rh,damp:function Y3(n,e,t,i){return Rh(n,e,1-Math.exp(-t*i))},pingpong:function Z3(n,e=1){return e-Math.abs(_y(n,2*e)-e)},smoothstep:function J3(n,e,t){return n<=e?0:n>=t?1:(n=(n-e)/(t-e))*n*(3-2*n)},smootherstep:function K3(n,e,t){return n<=e?0:n>=t?1:(n=(n-e)/(t-e))*n*n*(n*(6*n-15)+10)},randInt:function Q3(n,e){return n+Math.floor(Math.random()*(e-n+1))},randFloat:function ez(n,e){return n+Math.random()*(e-n)},randFloatSpread:function tz(n){return n*(.5-Math.random())},seededRandom:function nz(n){void 0!==n&&(bC=n);let e=bC+=1831565813;return e=Math.imul(e^e>>>15,1|e),e^=e+Math.imul(e^e>>>7,61|e),((e^e>>>14)>>>0)/4294967296},degToRad:function iz(n){return n*Ga},radToDeg:function rz(n){return n*Sc},isPowerOfTwo:gy,ceilPowerOfTwo:AC,floorPowerOfTwo:_p,setQuaternionFromProperEuler:function sz(n,e,t,i,r){const s=Math.cos,o=Math.sin,a=s(t/2),l=o(t/2),u=s((e+i)/2),d=o((e+i)/2),f=s((e-i)/2),p=o((e-i)/2),_=s((i-e)/2),y=o((i-e)/2);switch(r){case"XYX":n.set(a*d,l*f,l*p,a*u);break;case"YZY":n.set(l*p,a*d,l*f,a*u);break;case"ZXZ":n.set(l*f,l*p,a*d,a*u);break;case"XZX":n.set(a*d,l*y,l*_,a*u);break;case"YXY":n.set(l*_,a*d,l*y,a*u);break;case"ZYZ":n.set(l*y,l*_,a*d,a*u);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+r)}},normalize:ln,denormalize:Rr};class Be{constructor(e=0,t=0){Be.prototype.isVector2=!0,this.x=e,this.y=t}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,t){return this.x=e,this.y=t,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){const t=this.x,i=this.y,r=e.elements;return this.x=r[0]*t+r[3]*i+r[6],this.y=r[1]*t+r[4]*i+r[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this}clampLength(e,t){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(t,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(0===t)return Math.PI/2;const i=this.dot(e)/t;return Math.acos(ti(i,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,i=this.y-e.y;return t*t+i*i}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}lerpVectors(e,t,i){return this.x=e.x+(t.x-e.x)*i,this.y=e.y+(t.y-e.y)*i,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this}rotateAround(e,t){const i=Math.cos(t),r=Math.sin(t),s=this.x-e.x,o=this.y-e.y;return this.x=s*i-o*r+e.x,this.y=s*r+o*i+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class un{constructor(e,t,i,r,s,o,a,l,u){un.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],void 0!==e&&this.set(e,t,i,r,s,o,a,l,u)}set(e,t,i,r,s,o,a,l,u){const d=this.elements;return d[0]=e,d[1]=r,d[2]=a,d[3]=t,d[4]=s,d[5]=l,d[6]=i,d[7]=o,d[8]=u,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){const t=this.elements,i=e.elements;return t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t[4]=i[4],t[5]=i[5],t[6]=i[6],t[7]=i[7],t[8]=i[8],this}extractBasis(e,t,i){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),i.setFromMatrix3Column(this,2),this}setFromMatrix4(e){const t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const i=e.elements,r=t.elements,s=this.elements,o=i[0],a=i[3],l=i[6],u=i[1],d=i[4],f=i[7],p=i[2],_=i[5],y=i[8],w=r[0],A=r[3],b=r[6],C=r[1],T=r[4],I=r[7],N=r[2],k=r[5],G=r[8];return s[0]=o*w+a*C+l*N,s[3]=o*A+a*T+l*k,s[6]=o*b+a*I+l*G,s[1]=u*w+d*C+f*N,s[4]=u*A+d*T+f*k,s[7]=u*b+d*I+f*G,s[2]=p*w+_*C+y*N,s[5]=p*A+_*T+y*k,s[8]=p*b+_*I+y*G,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}determinant(){const e=this.elements,t=e[0],i=e[1],r=e[2],s=e[3],o=e[4],a=e[5],l=e[6],u=e[7],d=e[8];return t*o*d-t*a*u-i*s*d+i*a*l+r*s*u-r*o*l}invert(){const e=this.elements,t=e[0],i=e[1],r=e[2],s=e[3],o=e[4],a=e[5],l=e[6],u=e[7],d=e[8],f=d*o-a*u,p=a*l-d*s,_=u*s-o*l,y=t*f+i*p+r*_;if(0===y)return this.set(0,0,0,0,0,0,0,0,0);const w=1/y;return e[0]=f*w,e[1]=(r*u-d*i)*w,e[2]=(a*i-r*o)*w,e[3]=p*w,e[4]=(d*t-r*l)*w,e[5]=(r*s-a*t)*w,e[6]=_*w,e[7]=(i*l-u*t)*w,e[8]=(o*t-i*s)*w,this}transpose(){let e;const t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){const t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}setUvTransform(e,t,i,r,s,o,a){const l=Math.cos(s),u=Math.sin(s);return this.set(i*l,i*u,-i*(l*o+u*a)+o+e,-r*u,r*l,-r*(-u*o+l*a)+a+t,0,0,1),this}scale(e,t){return this.premultiply(vy.makeScale(e,t)),this}rotate(e){return this.premultiply(vy.makeRotation(-e)),this}translate(e,t){return this.premultiply(vy.makeTranslation(e,t)),this}makeTranslation(e,t){return e.isVector2?this.set(1,0,e.x,0,1,e.y,0,0,1):this.set(1,0,e,0,1,t,0,0,1),this}makeRotation(e){const t=Math.cos(e),i=Math.sin(e);return this.set(t,-i,0,i,t,0,0,0,1),this}makeScale(e,t){return this.set(e,0,0,0,t,0,0,0,1),this}equals(e){const t=this.elements,i=e.elements;for(let r=0;r<9;r++)if(t[r]!==i[r])return!1;return!0}fromArray(e,t=0){for(let i=0;i<9;i++)this.elements[i]=e[i+t];return this}toArray(e=[],t=0){const i=this.elements;return e[t]=i[0],e[t+1]=i[1],e[t+2]=i[2],e[t+3]=i[3],e[t+4]=i[4],e[t+5]=i[5],e[t+6]=i[6],e[t+7]=i[7],e[t+8]=i[8],e}clone(){return(new this.constructor).fromArray(this.elements)}}const vy=new un;function wC(n){for(let e=n.length-1;e>=0;--e)if(n[e]>=65535)return!0;return!1}function Ph(n){return document.createElementNS("http://www.w3.org/1999/xhtml",n)}Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array;const MC={};function Lh(n){n in MC||(MC[n]=!0,console.warn(n))}function Tc(n){return n<.04045?.0773993808*n:Math.pow(.9478672986*n+.0521327014,2.4)}function yy(n){return n<.0031308?12.92*n:1.055*Math.pow(n,.41666)-.055}const az=(new un).fromArray([.8224621,.0331941,.0170827,.177538,.9668058,.0723974,-1e-7,1e-7,.9105199]),lz=(new un).fromArray([1.2249401,-.0420569,-.0196376,-.2249404,1.0420571,-.0786361,1e-7,0,1.0982735]),hz={[zs]:n=>n,[jt]:n=>n.convertSRGBToLinear(),[yC]:function cz(n){return n.convertSRGBToLinear().applyMatrix3(lz)}},dz={[zs]:n=>n,[jt]:n=>n.convertLinearToSRGB(),[yC]:function uz(n){return n.applyMatrix3(az).convertLinearToSRGB()}},ms={enabled:!0,get legacyMode(){return console.warn("THREE.ColorManagement: .legacyMode=false renamed to .enabled=true in r150."),!this.enabled},set legacyMode(n){console.warn("THREE.ColorManagement: .legacyMode=false renamed to .enabled=true in r150."),this.enabled=!n},get workingColorSpace(){return zs},set workingColorSpace(n){console.warn("THREE.ColorManagement: .workingColorSpace is readonly.")},convert:function(n,e,t){if(!1===this.enabled||e===t||!e||!t)return n;const i=hz[e],r=dz[t];if(void 0===i||void 0===r)throw new Error(`Unsupported color space conversion, "${e}" to "${t}".`);return r(i(n))},fromWorkingColorSpace:function(n,e){return this.convert(n,this.workingColorSpace,e)},toWorkingColorSpace:function(n,e){return this.convert(n,e,this.workingColorSpace)}};let Cc;class SC{static getDataURL(e){if(/^data:/i.test(e.src)||typeof HTMLCanvasElement>"u")return e.src;let t;if(e instanceof HTMLCanvasElement)t=e;else{void 0===Cc&&(Cc=Ph("canvas")),Cc.width=e.width,Cc.height=e.height;const i=Cc.getContext("2d");e instanceof ImageData?i.putImageData(e,0,0):i.drawImage(e,0,0,e.width,e.height),t=Cc}return t.width>2048||t.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",e),t.toDataURL("image/jpeg",.6)):t.toDataURL("image/png")}static sRGBToLinear(e){if(typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&e instanceof ImageBitmap){const t=Ph("canvas");t.width=e.width,t.height=e.height;const i=t.getContext("2d");i.drawImage(e,0,0,e.width,e.height);const r=i.getImageData(0,0,e.width,e.height),s=r.data;for(let o=0;o<s.length;o++)s[o]=255*Tc(s[o]/255);return i.putImageData(r,0,0),t}if(e.data){const t=e.data.slice(0);for(let i=0;i<t.length;i++)t[i]=t instanceof Uint8Array||t instanceof Uint8ClampedArray?Math.floor(255*Tc(t[i]/255)):Tc(t[i]);return{data:t,width:e.width,height:e.height}}return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),e}}let fz=0;class Dc{constructor(e=null){this.isSource=!0,Object.defineProperty(this,"id",{value:fz++}),this.uuid=Ir(),this.data=e,this.version=0}set needsUpdate(e){!0===e&&this.version++}toJSON(e){const t=void 0===e||"string"==typeof e;if(!t&&void 0!==e.images[this.uuid])return e.images[this.uuid];const i={uuid:this.uuid,url:""},r=this.data;if(null!==r){let s;if(Array.isArray(r)){s=[];for(let o=0,a=r.length;o<a;o++)s.push(xy(r[o].isDataTexture?r[o].image:r[o]))}else s=xy(r);i.url=s}return t||(e.images[this.uuid]=i),i}}function xy(n){return typeof HTMLImageElement<"u"&&n instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&n instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&n instanceof ImageBitmap?SC.getDataURL(n):n.data?{data:Array.from(n.data),width:n.width,height:n.height,type:n.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}let pz=0,_s=(()=>{class n extends Mc{constructor(t=n.DEFAULT_IMAGE,i=n.DEFAULT_MAPPING,r=$i,s=$i,o=ei,a=_o,l=jr,u=Jo,d=n.DEFAULT_ANISOTROPY,f=""){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:pz++}),this.uuid=Ir(),this.name="",this.source=new Dc(t),this.mipmaps=[],this.mapping=i,this.channel=0,this.wrapS=r,this.wrapT=s,this.magFilter=o,this.minFilter=a,this.anisotropy=d,this.format=l,this.internalFormat=null,this.type=u,this.offset=new Be(0,0),this.repeat=new Be(1,1),this.center=new Be(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new un,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,"string"==typeof f?this.colorSpace=f:(Lh("THREE.Texture: Property .encoding has been replaced by .colorSpace."),this.colorSpace=f===Ua?jt:""),this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.needsPMREMUpdate=!1}get image(){return this.source.data}set image(t=null){this.source.data=t}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return(new this.constructor).copy(this)}copy(t){return this.name=t.name,this.source=t.source,this.mipmaps=t.mipmaps.slice(0),this.mapping=t.mapping,this.channel=t.channel,this.wrapS=t.wrapS,this.wrapT=t.wrapT,this.magFilter=t.magFilter,this.minFilter=t.minFilter,this.anisotropy=t.anisotropy,this.format=t.format,this.internalFormat=t.internalFormat,this.type=t.type,this.offset.copy(t.offset),this.repeat.copy(t.repeat),this.center.copy(t.center),this.rotation=t.rotation,this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrix.copy(t.matrix),this.generateMipmaps=t.generateMipmaps,this.premultiplyAlpha=t.premultiplyAlpha,this.flipY=t.flipY,this.unpackAlignment=t.unpackAlignment,this.colorSpace=t.colorSpace,this.userData=JSON.parse(JSON.stringify(t.userData)),this.needsUpdate=!0,this}toJSON(t){const i=void 0===t||"string"==typeof t;if(!i&&void 0!==t.textures[this.uuid])return t.textures[this.uuid];const r={metadata:{version:4.6,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(t).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(r.userData=this.userData),i||(t.textures[this.uuid]=r),r}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(t){if(300!==this.mapping)return t;if(t.applyMatrix3(this.matrix),t.x<0||t.x>1)switch(this.wrapS){case Oa:t.x=t.x-Math.floor(t.x);break;case $i:t.x=t.x<0?0:1;break;case 1002:t.x=1===Math.abs(Math.floor(t.x)%2)?Math.ceil(t.x)-t.x:t.x-Math.floor(t.x)}if(t.y<0||t.y>1)switch(this.wrapT){case Oa:t.y=t.y-Math.floor(t.y);break;case $i:t.y=t.y<0?0:1;break;case 1002:t.y=1===Math.abs(Math.floor(t.y)%2)?Math.ceil(t.y)-t.y:t.y-Math.floor(t.y)}return this.flipY&&(t.y=1-t.y),t}set needsUpdate(t){!0===t&&(this.version++,this.source.needsUpdate=!0)}get encoding(){return Lh("THREE.Texture: Property .encoding has been replaced by .colorSpace."),this.colorSpace===jt?Ua:3e3}set encoding(t){Lh("THREE.Texture: Property .encoding has been replaced by .colorSpace."),this.colorSpace=t===Ua?jt:""}}return n.DEFAULT_IMAGE=null,n.DEFAULT_MAPPING=300,n.DEFAULT_ANISOTROPY=1,n})();class Nn{constructor(e=0,t=0,i=0,r=1){Nn.prototype.isVector4=!0,this.x=e,this.y=t,this.z=i,this.w=r}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,t,i,r){return this.x=e,this.y=t,this.z=i,this.w=r,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=void 0!==e.w?e.w:1,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){const t=this.x,i=this.y,r=this.z,s=this.w,o=e.elements;return this.x=o[0]*t+o[4]*i+o[8]*r+o[12]*s,this.y=o[1]*t+o[5]*i+o[9]*r+o[13]*s,this.z=o[2]*t+o[6]*i+o[10]*r+o[14]*s,this.w=o[3]*t+o[7]*i+o[11]*r+o[15]*s,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);const t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this}setAxisAngleFromRotationMatrix(e){let t,i,r,s;const l=e.elements,u=l[0],d=l[4],f=l[8],p=l[1],_=l[5],y=l[9],w=l[2],A=l[6],b=l[10];if(Math.abs(d-p)<.01&&Math.abs(f-w)<.01&&Math.abs(y-A)<.01){if(Math.abs(d+p)<.1&&Math.abs(f+w)<.1&&Math.abs(y+A)<.1&&Math.abs(u+_+b-3)<.1)return this.set(1,0,0,0),this;t=Math.PI;const T=(u+1)/2,I=(_+1)/2,N=(b+1)/2,k=(d+p)/4,G=(f+w)/4,K=(y+A)/4;return T>I&&T>N?T<.01?(i=0,r=.707106781,s=.707106781):(i=Math.sqrt(T),r=k/i,s=G/i):I>N?I<.01?(i=.707106781,r=0,s=.707106781):(r=Math.sqrt(I),i=k/r,s=K/r):N<.01?(i=.707106781,r=.707106781,s=0):(s=Math.sqrt(N),i=G/s,r=K/s),this.set(i,r,s,t),this}let C=Math.sqrt((A-y)*(A-y)+(f-w)*(f-w)+(p-d)*(p-d));return Math.abs(C)<.001&&(C=1),this.x=(A-y)/C,this.y=(f-w)/C,this.z=(p-d)/C,this.w=Math.acos((u+_+b-1)/2),this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this.w=Math.max(e.w,Math.min(t.w,this.w)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this.w=Math.max(e,Math.min(t,this.w)),this}clampLength(e,t){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(t,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this}lerpVectors(e,t,i){return this.x=e.x+(t.x-e.x)*i,this.y=e.y+(t.y-e.y)*i,this.z=e.z+(t.z-e.z)*i,this.w=e.w+(t.w-e.w)*i,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}class Wa extends Mc{constructor(e=1,t=1,i={}){super(),this.isWebGLRenderTarget=!0,this.width=e,this.height=t,this.depth=1,this.scissor=new Nn(0,0,e,t),this.scissorTest=!1,this.viewport=new Nn(0,0,e,t);const r={width:e,height:t,depth:1};void 0!==i.encoding&&(Lh("THREE.WebGLRenderTarget: option.encoding has been replaced by option.colorSpace."),i.colorSpace=i.encoding===Ua?jt:""),this.texture=new _s(r,i.mapping,i.wrapS,i.wrapT,i.magFilter,i.minFilter,i.format,i.type,i.anisotropy,i.colorSpace),this.texture.isRenderTargetTexture=!0,this.texture.flipY=!1,this.texture.generateMipmaps=void 0!==i.generateMipmaps&&i.generateMipmaps,this.texture.internalFormat=void 0!==i.internalFormat?i.internalFormat:null,this.texture.minFilter=void 0!==i.minFilter?i.minFilter:ei,this.depthBuffer=void 0===i.depthBuffer||i.depthBuffer,this.stencilBuffer=void 0!==i.stencilBuffer&&i.stencilBuffer,this.depthTexture=void 0!==i.depthTexture?i.depthTexture:null,this.samples=void 0!==i.samples?i.samples:0}setSize(e,t,i=1){(this.width!==e||this.height!==t||this.depth!==i)&&(this.width=e,this.height=t,this.depth=i,this.texture.image.width=e,this.texture.image.height=t,this.texture.image.depth=i,this.dispose()),this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)}clone(){return(new this.constructor).copy(this)}copy(e){this.width=e.width,this.height=e.height,this.depth=e.depth,this.scissor.copy(e.scissor),this.scissorTest=e.scissorTest,this.viewport.copy(e.viewport),this.texture=e.texture.clone(),this.texture.isRenderTargetTexture=!0;const t=Object.assign({},e.texture.image);return this.texture.source=new Dc(t),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,null!==e.depthTexture&&(this.depthTexture=e.depthTexture.clone()),this.samples=e.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}class by extends _s{constructor(e=null,t=1,i=1,r=1){super(null),this.isDataArrayTexture=!0,this.image={data:e,width:t,height:i,depth:r},this.magFilter=ui,this.minFilter=ui,this.wrapR=$i,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class EC extends _s{constructor(e=null,t=1,i=1,r=1){super(null),this.isData3DTexture=!0,this.image={data:e,width:t,height:i,depth:r},this.magFilter=ui,this.minFilter=ui,this.wrapR=$i,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class Yi{constructor(e=0,t=0,i=0,r=1){this.isQuaternion=!0,this._x=e,this._y=t,this._z=i,this._w=r}static slerpFlat(e,t,i,r,s,o,a){let l=i[r+0],u=i[r+1],d=i[r+2],f=i[r+3];const p=s[o+0],_=s[o+1],y=s[o+2],w=s[o+3];if(0===a)return e[t+0]=l,e[t+1]=u,e[t+2]=d,void(e[t+3]=f);if(1===a)return e[t+0]=p,e[t+1]=_,e[t+2]=y,void(e[t+3]=w);if(f!==w||l!==p||u!==_||d!==y){let A=1-a;const b=l*p+u*_+d*y+f*w,C=b>=0?1:-1,T=1-b*b;if(T>Number.EPSILON){const N=Math.sqrt(T),k=Math.atan2(N,b*C);A=Math.sin(A*k)/N,a=Math.sin(a*k)/N}const I=a*C;if(l=l*A+p*I,u=u*A+_*I,d=d*A+y*I,f=f*A+w*I,A===1-a){const N=1/Math.sqrt(l*l+u*u+d*d+f*f);l*=N,u*=N,d*=N,f*=N}}e[t]=l,e[t+1]=u,e[t+2]=d,e[t+3]=f}static multiplyQuaternionsFlat(e,t,i,r,s,o){const a=i[r],l=i[r+1],u=i[r+2],d=i[r+3],f=s[o],p=s[o+1],_=s[o+2],y=s[o+3];return e[t]=a*y+d*f+l*_-u*p,e[t+1]=l*y+d*p+u*f-a*_,e[t+2]=u*y+d*_+a*p-l*f,e[t+3]=d*y-a*f-l*p-u*_,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,t,i,r){return this._x=e,this._y=t,this._z=i,this._w=r,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,t){const i=e._x,r=e._y,s=e._z,o=e._order,a=Math.cos,l=Math.sin,u=a(i/2),d=a(r/2),f=a(s/2),p=l(i/2),_=l(r/2),y=l(s/2);switch(o){case"XYZ":this._x=p*d*f+u*_*y,this._y=u*_*f-p*d*y,this._z=u*d*y+p*_*f,this._w=u*d*f-p*_*y;break;case"YXZ":this._x=p*d*f+u*_*y,this._y=u*_*f-p*d*y,this._z=u*d*y-p*_*f,this._w=u*d*f+p*_*y;break;case"ZXY":this._x=p*d*f-u*_*y,this._y=u*_*f+p*d*y,this._z=u*d*y+p*_*f,this._w=u*d*f-p*_*y;break;case"ZYX":this._x=p*d*f-u*_*y,this._y=u*_*f+p*d*y,this._z=u*d*y-p*_*f,this._w=u*d*f+p*_*y;break;case"YZX":this._x=p*d*f+u*_*y,this._y=u*_*f+p*d*y,this._z=u*d*y-p*_*f,this._w=u*d*f-p*_*y;break;case"XZY":this._x=p*d*f-u*_*y,this._y=u*_*f-p*d*y,this._z=u*d*y+p*_*f,this._w=u*d*f+p*_*y;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+o)}return!1!==t&&this._onChangeCallback(),this}setFromAxisAngle(e,t){const i=t/2,r=Math.sin(i);return this._x=e.x*r,this._y=e.y*r,this._z=e.z*r,this._w=Math.cos(i),this._onChangeCallback(),this}setFromRotationMatrix(e){const t=e.elements,i=t[0],r=t[4],s=t[8],o=t[1],a=t[5],l=t[9],u=t[2],d=t[6],f=t[10],p=i+a+f;if(p>0){const _=.5/Math.sqrt(p+1);this._w=.25/_,this._x=(d-l)*_,this._y=(s-u)*_,this._z=(o-r)*_}else if(i>a&&i>f){const _=2*Math.sqrt(1+i-a-f);this._w=(d-l)/_,this._x=.25*_,this._y=(r+o)/_,this._z=(s+u)/_}else if(a>f){const _=2*Math.sqrt(1+a-i-f);this._w=(s-u)/_,this._x=(r+o)/_,this._y=.25*_,this._z=(l+d)/_}else{const _=2*Math.sqrt(1+f-i-a);this._w=(o-r)/_,this._x=(s+u)/_,this._y=(l+d)/_,this._z=.25*_}return this._onChangeCallback(),this}setFromUnitVectors(e,t){let i=e.dot(t)+1;return i<Number.EPSILON?(i=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=i):(this._x=0,this._y=-e.z,this._z=e.y,this._w=i)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=i),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(ti(this.dot(e),-1,1)))}rotateTowards(e,t){const i=this.angleTo(e);if(0===i)return this;const r=Math.min(1,t/i);return this.slerp(e,r),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return 0===e?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e){return this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,t){const i=e._x,r=e._y,s=e._z,o=e._w,a=t._x,l=t._y,u=t._z,d=t._w;return this._x=i*d+o*a+r*u-s*l,this._y=r*d+o*l+s*a-i*u,this._z=s*d+o*u+i*l-r*a,this._w=o*d-i*a-r*l-s*u,this._onChangeCallback(),this}slerp(e,t){if(0===t)return this;if(1===t)return this.copy(e);const i=this._x,r=this._y,s=this._z,o=this._w;let a=o*e._w+i*e._x+r*e._y+s*e._z;if(a<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,a=-a):this.copy(e),a>=1)return this._w=o,this._x=i,this._y=r,this._z=s,this;const l=1-a*a;if(l<=Number.EPSILON){const _=1-t;return this._w=_*o+t*this._w,this._x=_*i+t*this._x,this._y=_*r+t*this._y,this._z=_*s+t*this._z,this.normalize(),this._onChangeCallback(),this}const u=Math.sqrt(l),d=Math.atan2(u,a),f=Math.sin((1-t)*d)/u,p=Math.sin(t*d)/u;return this._w=o*f+this._w*p,this._x=i*f+this._x*p,this._y=r*f+this._y*p,this._z=s*f+this._z*p,this._onChangeCallback(),this}slerpQuaternions(e,t,i){return this.copy(e).slerp(t,i)}random(){const e=Math.random(),t=Math.sqrt(1-e),i=Math.sqrt(e),r=2*Math.PI*Math.random(),s=2*Math.PI*Math.random();return this.set(t*Math.cos(r),i*Math.sin(s),i*Math.cos(s),t*Math.sin(r))}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,t=0){return this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}fromBufferAttribute(e,t){return this._x=e.getX(t),this._y=e.getY(t),this._z=e.getZ(t),this._w=e.getW(t),this}toJSON(){return this.toArray()}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class q{constructor(e=0,t=0,i=0){q.prototype.isVector3=!0,this.x=e,this.y=t,this.z=i}set(e,t,i){return void 0===i&&(i=this.z),this.x=e,this.y=t,this.z=i,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}applyEuler(e){return this.applyQuaternion(TC.setFromEuler(e))}applyAxisAngle(e,t){return this.applyQuaternion(TC.setFromAxisAngle(e,t))}applyMatrix3(e){const t=this.x,i=this.y,r=this.z,s=e.elements;return this.x=s[0]*t+s[3]*i+s[6]*r,this.y=s[1]*t+s[4]*i+s[7]*r,this.z=s[2]*t+s[5]*i+s[8]*r,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){const t=this.x,i=this.y,r=this.z,s=e.elements,o=1/(s[3]*t+s[7]*i+s[11]*r+s[15]);return this.x=(s[0]*t+s[4]*i+s[8]*r+s[12])*o,this.y=(s[1]*t+s[5]*i+s[9]*r+s[13])*o,this.z=(s[2]*t+s[6]*i+s[10]*r+s[14])*o,this}applyQuaternion(e){const t=this.x,i=this.y,r=this.z,s=e.x,o=e.y,a=e.z,l=e.w,u=l*t+o*r-a*i,d=l*i+a*t-s*r,f=l*r+s*i-o*t,p=-s*t-o*i-a*r;return this.x=u*l+p*-s+d*-a-f*-o,this.y=d*l+p*-o+f*-s-u*-a,this.z=f*l+p*-a+u*-o-d*-s,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){const t=this.x,i=this.y,r=this.z,s=e.elements;return this.x=s[0]*t+s[4]*i+s[8]*r,this.y=s[1]*t+s[5]*i+s[9]*r,this.z=s[2]*t+s[6]*i+s[10]*r,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this}clampLength(e,t){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(t,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}lerpVectors(e,t,i){return this.x=e.x+(t.x-e.x)*i,this.y=e.y+(t.y-e.y)*i,this.z=e.z+(t.z-e.z)*i,this}cross(e){return this.crossVectors(this,e)}crossVectors(e,t){const i=e.x,r=e.y,s=e.z,o=t.x,a=t.y,l=t.z;return this.x=r*l-s*a,this.y=s*o-i*l,this.z=i*a-r*o,this}projectOnVector(e){const t=e.lengthSq();if(0===t)return this.set(0,0,0);const i=e.dot(this)/t;return this.copy(e).multiplyScalar(i)}projectOnPlane(e){return Ay.copy(this).projectOnVector(e),this.sub(Ay)}reflect(e){return this.sub(Ay.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(0===t)return Math.PI/2;const i=this.dot(e)/t;return Math.acos(ti(i,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,i=this.y-e.y,r=this.z-e.z;return t*t+i*i+r*r}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,t,i){const r=Math.sin(t)*e;return this.x=r*Math.sin(i),this.y=Math.cos(t)*e,this.z=r*Math.cos(i),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,t,i){return this.x=e*Math.sin(t),this.y=i,this.z=e*Math.cos(t),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}setFromMatrixScale(e){const t=this.setFromMatrixColumn(e,0).length(),i=this.setFromMatrixColumn(e,1).length(),r=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=i,this.z=r,this}setFromMatrixColumn(e,t){return this.fromArray(e.elements,4*t)}setFromMatrix3Column(e,t){return this.fromArray(e.elements,3*t)}setFromEuler(e){return this.x=e._x,this.y=e._y,this.z=e._z,this}setFromColor(e){return this.x=e.r,this.y=e.g,this.z=e.b,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const e=2*(Math.random()-.5),t=Math.random()*Math.PI*2,i=Math.sqrt(1-e**2);return this.x=i*Math.cos(t),this.y=i*Math.sin(t),this.z=e,this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const Ay=new q,TC=new Yi;class Hs{constructor(e=new q(1/0,1/0,1/0),t=new q(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromArray(e){this.makeEmpty();for(let t=0,i=e.length;t<i;t+=3)this.expandByPoint(bo.fromArray(e,t));return this}setFromBufferAttribute(e){this.makeEmpty();for(let t=0,i=e.count;t<i;t++)this.expandByPoint(bo.fromBufferAttribute(e,t));return this}setFromPoints(e){this.makeEmpty();for(let t=0,i=e.length;t<i;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const i=bo.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(i),this.max.copy(e).add(i),this}setFromObject(e,t=!1){return this.makeEmpty(),this.expandByObject(e,t)}clone(){return(new this.constructor).copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(e){return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}expandByObject(e,t=!1){if(e.updateWorldMatrix(!1,!1),void 0!==e.boundingBox)null===e.boundingBox&&e.computeBoundingBox(),Ic.copy(e.boundingBox),Ic.applyMatrix4(e.matrixWorld),this.union(Ic);else{const r=e.geometry;if(void 0!==r)if(t&&void 0!==r.attributes&&void 0!==r.attributes.position){const s=r.attributes.position;for(let o=0,a=s.count;o<a;o++)bo.fromBufferAttribute(s,o).applyMatrix4(e.matrixWorld),this.expandByPoint(bo)}else null===r.boundingBox&&r.computeBoundingBox(),Ic.copy(r.boundingBox),Ic.applyMatrix4(e.matrixWorld),this.union(Ic)}const i=e.children;for(let r=0,s=i.length;r<s;r++)this.expandByObject(i[r],t);return this}containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z)}intersectsSphere(e){return this.clampPoint(e.center,bo),bo.distanceToSquared(e.center)<=e.radius*e.radius}intersectsPlane(e){let t,i;return e.normal.x>0?(t=e.normal.x*this.min.x,i=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,i=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,i+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,i+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,i+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,i+=e.normal.z*this.min.z),t<=-e.constant&&i>=-e.constant}intersectsTriangle(e){if(this.isEmpty())return!1;this.getCenter(Nh),gp.subVectors(this.max,Nh),Rc.subVectors(e.a,Nh),Pc.subVectors(e.b,Nh),Lc.subVectors(e.c,Nh),Qo.subVectors(Pc,Rc),ea.subVectors(Lc,Pc),qa.subVectors(Rc,Lc);let t=[0,-Qo.z,Qo.y,0,-ea.z,ea.y,0,-qa.z,qa.y,Qo.z,0,-Qo.x,ea.z,0,-ea.x,qa.z,0,-qa.x,-Qo.y,Qo.x,0,-ea.y,ea.x,0,-qa.y,qa.x,0];return!(!wy(t,Rc,Pc,Lc,gp)||(t=[1,0,0,0,1,0,0,0,1],!wy(t,Rc,Pc,Lc,gp)))&&(vp.crossVectors(Qo,ea),t=[vp.x,vp.y,vp.z],wy(t,Rc,Pc,Lc,gp))}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return this.clampPoint(e,bo).distanceTo(e)}getBoundingSphere(e){return this.isEmpty()?e.makeEmpty():(this.getCenter(e.center),e.radius=.5*this.getSize(bo).length()),e}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}applyMatrix4(e){return this.isEmpty()||(xo[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),xo[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),xo[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),xo[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),xo[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),xo[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),xo[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),xo[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(xo)),this}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}const xo=[new q,new q,new q,new q,new q,new q,new q,new q],bo=new q,Ic=new Hs,Rc=new q,Pc=new q,Lc=new q,Qo=new q,ea=new q,qa=new q,Nh=new q,gp=new q,vp=new q,ja=new q;function wy(n,e,t,i,r){for(let s=0,o=n.length-3;s<=o;s+=3){ja.fromArray(n,s);const a=r.x*Math.abs(ja.x)+r.y*Math.abs(ja.y)+r.z*Math.abs(ja.z),l=e.dot(ja),u=t.dot(ja),d=i.dot(ja);if(Math.max(-Math.max(l,u,d),Math.min(l,u,d))>a)return!1}return!0}const mz=new Hs,Bh=new q,My=new q;class gs{constructor(e=new q,t=-1){this.center=e,this.radius=t}set(e,t){return this.center.copy(e),this.radius=t,this}setFromPoints(e,t){const i=this.center;void 0!==t?i.copy(t):mz.setFromPoints(e).getCenter(i);let r=0;for(let s=0,o=e.length;s<o;s++)r=Math.max(r,i.distanceToSquared(e[s]));return this.radius=Math.sqrt(r),this}copy(e){return this.center.copy(e.center),this.radius=e.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(e){return e.distanceTo(this.center)-this.radius}intersectsSphere(e){const t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t}intersectsBox(e){return e.intersectsSphere(this)}intersectsPlane(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}clampPoint(e,t){const i=this.center.distanceToSquared(e);return t.copy(e),i>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t}getBoundingBox(e){return this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)}applyMatrix4(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}translate(e){return this.center.add(e),this}expandByPoint(e){if(this.isEmpty())return this.center.copy(e),this.radius=0,this;Bh.subVectors(e,this.center);const t=Bh.lengthSq();if(t>this.radius*this.radius){const i=Math.sqrt(t),r=.5*(i-this.radius);this.center.addScaledVector(Bh,r/i),this.radius+=r}return this}union(e){return e.isEmpty()?this:this.isEmpty()?(this.copy(e),this):(!0===this.center.equals(e.center)?this.radius=Math.max(this.radius,e.radius):(My.subVectors(e.center,this.center).setLength(e.radius),this.expandByPoint(Bh.copy(e.center).add(My)),this.expandByPoint(Bh.copy(e.center).sub(My))),this)}equals(e){return e.center.equals(this.center)&&e.radius===this.radius}clone(){return(new this.constructor).copy(this)}}const Ao=new q,Sy=new q,yp=new q,ta=new q,Ey=new q,xp=new q,Ty=new q;class Fh{constructor(e=new q,t=new q(0,0,-1)){this.origin=e,this.direction=t}set(e,t){return this.origin.copy(e),this.direction.copy(t),this}copy(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}at(e,t){return t.copy(this.origin).addScaledVector(this.direction,e)}lookAt(e){return this.direction.copy(e).sub(this.origin).normalize(),this}recast(e){return this.origin.copy(this.at(e,Ao)),this}closestPointToPoint(e,t){t.subVectors(e,this.origin);const i=t.dot(this.direction);return i<0?t.copy(this.origin):t.copy(this.origin).addScaledVector(this.direction,i)}distanceToPoint(e){return Math.sqrt(this.distanceSqToPoint(e))}distanceSqToPoint(e){const t=Ao.subVectors(e,this.origin).dot(this.direction);return t<0?this.origin.distanceToSquared(e):(Ao.copy(this.origin).addScaledVector(this.direction,t),Ao.distanceToSquared(e))}distanceSqToSegment(e,t,i,r){Sy.copy(e).add(t).multiplyScalar(.5),yp.copy(t).sub(e).normalize(),ta.copy(this.origin).sub(Sy);const s=.5*e.distanceTo(t),o=-this.direction.dot(yp),a=ta.dot(this.direction),l=-ta.dot(yp),u=ta.lengthSq(),d=Math.abs(1-o*o);let f,p,_,y;if(d>0)if(f=o*l-a,p=o*a-l,y=s*d,f>=0)if(p>=-y)if(p<=y){const w=1/d;f*=w,p*=w,_=f*(f+o*p+2*a)+p*(o*f+p+2*l)+u}else p=s,f=Math.max(0,-(o*p+a)),_=-f*f+p*(p+2*l)+u;else p=-s,f=Math.max(0,-(o*p+a)),_=-f*f+p*(p+2*l)+u;else p<=-y?(f=Math.max(0,-(-o*s+a)),p=f>0?-s:Math.min(Math.max(-s,-l),s),_=-f*f+p*(p+2*l)+u):p<=y?(f=0,p=Math.min(Math.max(-s,-l),s),_=p*(p+2*l)+u):(f=Math.max(0,-(o*s+a)),p=f>0?s:Math.min(Math.max(-s,-l),s),_=-f*f+p*(p+2*l)+u);else p=o>0?-s:s,f=Math.max(0,-(o*p+a)),_=-f*f+p*(p+2*l)+u;return i&&i.copy(this.origin).addScaledVector(this.direction,f),r&&r.copy(Sy).addScaledVector(yp,p),_}intersectSphere(e,t){Ao.subVectors(e.center,this.origin);const i=Ao.dot(this.direction),r=Ao.dot(Ao)-i*i,s=e.radius*e.radius;if(r>s)return null;const o=Math.sqrt(s-r),a=i-o,l=i+o;return l<0?null:this.at(a<0?l:a,t)}intersectsSphere(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius}distanceToPlane(e){const t=e.normal.dot(this.direction);if(0===t)return 0===e.distanceToPoint(this.origin)?0:null;const i=-(this.origin.dot(e.normal)+e.constant)/t;return i>=0?i:null}intersectPlane(e,t){const i=this.distanceToPlane(e);return null===i?null:this.at(i,t)}intersectsPlane(e){const t=e.distanceToPoint(this.origin);return 0===t||e.normal.dot(this.direction)*t<0}intersectBox(e,t){let i,r,s,o,a,l;const u=1/this.direction.x,d=1/this.direction.y,f=1/this.direction.z,p=this.origin;return u>=0?(i=(e.min.x-p.x)*u,r=(e.max.x-p.x)*u):(i=(e.max.x-p.x)*u,r=(e.min.x-p.x)*u),d>=0?(s=(e.min.y-p.y)*d,o=(e.max.y-p.y)*d):(s=(e.max.y-p.y)*d,o=(e.min.y-p.y)*d),i>o||s>r||((s>i||isNaN(i))&&(i=s),(o<r||isNaN(r))&&(r=o),f>=0?(a=(e.min.z-p.z)*f,l=(e.max.z-p.z)*f):(a=(e.max.z-p.z)*f,l=(e.min.z-p.z)*f),i>l||a>r)||((a>i||i!=i)&&(i=a),(l<r||r!=r)&&(r=l),r<0)?null:this.at(i>=0?i:r,t)}intersectsBox(e){return null!==this.intersectBox(e,Ao)}intersectTriangle(e,t,i,r,s){Ey.subVectors(t,e),xp.subVectors(i,e),Ty.crossVectors(Ey,xp);let a,o=this.direction.dot(Ty);if(o>0){if(r)return null;a=1}else{if(!(o<0))return null;a=-1,o=-o}ta.subVectors(this.origin,e);const l=a*this.direction.dot(xp.crossVectors(ta,xp));if(l<0)return null;const u=a*this.direction.dot(Ey.cross(ta));if(u<0||l+u>o)return null;const d=-a*ta.dot(Ty);return d<0?null:this.at(d/o,s)}applyMatrix4(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}equals(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}clone(){return(new this.constructor).copy(this)}}class Wt{constructor(e,t,i,r,s,o,a,l,u,d,f,p,_,y,w,A){Wt.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],void 0!==e&&this.set(e,t,i,r,s,o,a,l,u,d,f,p,_,y,w,A)}set(e,t,i,r,s,o,a,l,u,d,f,p,_,y,w,A){const b=this.elements;return b[0]=e,b[4]=t,b[8]=i,b[12]=r,b[1]=s,b[5]=o,b[9]=a,b[13]=l,b[2]=u,b[6]=d,b[10]=f,b[14]=p,b[3]=_,b[7]=y,b[11]=w,b[15]=A,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return(new Wt).fromArray(this.elements)}copy(e){const t=this.elements,i=e.elements;return t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t[4]=i[4],t[5]=i[5],t[6]=i[6],t[7]=i[7],t[8]=i[8],t[9]=i[9],t[10]=i[10],t[11]=i[11],t[12]=i[12],t[13]=i[13],t[14]=i[14],t[15]=i[15],this}copyPosition(e){const t=this.elements,i=e.elements;return t[12]=i[12],t[13]=i[13],t[14]=i[14],this}setFromMatrix3(e){const t=e.elements;return this.set(t[0],t[3],t[6],0,t[1],t[4],t[7],0,t[2],t[5],t[8],0,0,0,0,1),this}extractBasis(e,t,i){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),i.setFromMatrixColumn(this,2),this}makeBasis(e,t,i){return this.set(e.x,t.x,i.x,0,e.y,t.y,i.y,0,e.z,t.z,i.z,0,0,0,0,1),this}extractRotation(e){const t=this.elements,i=e.elements,r=1/Nc.setFromMatrixColumn(e,0).length(),s=1/Nc.setFromMatrixColumn(e,1).length(),o=1/Nc.setFromMatrixColumn(e,2).length();return t[0]=i[0]*r,t[1]=i[1]*r,t[2]=i[2]*r,t[3]=0,t[4]=i[4]*s,t[5]=i[5]*s,t[6]=i[6]*s,t[7]=0,t[8]=i[8]*o,t[9]=i[9]*o,t[10]=i[10]*o,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromEuler(e){const t=this.elements,i=e.x,r=e.y,s=e.z,o=Math.cos(i),a=Math.sin(i),l=Math.cos(r),u=Math.sin(r),d=Math.cos(s),f=Math.sin(s);if("XYZ"===e.order){const p=o*d,_=o*f,y=a*d,w=a*f;t[0]=l*d,t[4]=-l*f,t[8]=u,t[1]=_+y*u,t[5]=p-w*u,t[9]=-a*l,t[2]=w-p*u,t[6]=y+_*u,t[10]=o*l}else if("YXZ"===e.order){const p=l*d,_=l*f,y=u*d,w=u*f;t[0]=p+w*a,t[4]=y*a-_,t[8]=o*u,t[1]=o*f,t[5]=o*d,t[9]=-a,t[2]=_*a-y,t[6]=w+p*a,t[10]=o*l}else if("ZXY"===e.order){const p=l*d,_=l*f,y=u*d,w=u*f;t[0]=p-w*a,t[4]=-o*f,t[8]=y+_*a,t[1]=_+y*a,t[5]=o*d,t[9]=w-p*a,t[2]=-o*u,t[6]=a,t[10]=o*l}else if("ZYX"===e.order){const p=o*d,_=o*f,y=a*d,w=a*f;t[0]=l*d,t[4]=y*u-_,t[8]=p*u+w,t[1]=l*f,t[5]=w*u+p,t[9]=_*u-y,t[2]=-u,t[6]=a*l,t[10]=o*l}else if("YZX"===e.order){const p=o*l,_=o*u,y=a*l,w=a*u;t[0]=l*d,t[4]=w-p*f,t[8]=y*f+_,t[1]=f,t[5]=o*d,t[9]=-a*d,t[2]=-u*d,t[6]=_*f+y,t[10]=p-w*f}else if("XZY"===e.order){const p=o*l,_=o*u,y=a*l,w=a*u;t[0]=l*d,t[4]=-f,t[8]=u*d,t[1]=p*f+w,t[5]=o*d,t[9]=_*f-y,t[2]=y*f-_,t[6]=a*d,t[10]=w*f+p}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromQuaternion(e){return this.compose(_z,e,gz)}lookAt(e,t,i){const r=this.elements;return Pr.subVectors(e,t),0===Pr.lengthSq()&&(Pr.z=1),Pr.normalize(),na.crossVectors(i,Pr),0===na.lengthSq()&&(1===Math.abs(i.z)?Pr.x+=1e-4:Pr.z+=1e-4,Pr.normalize(),na.crossVectors(i,Pr)),na.normalize(),bp.crossVectors(Pr,na),r[0]=na.x,r[4]=bp.x,r[8]=Pr.x,r[1]=na.y,r[5]=bp.y,r[9]=Pr.y,r[2]=na.z,r[6]=bp.z,r[10]=Pr.z,this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const i=e.elements,r=t.elements,s=this.elements,o=i[0],a=i[4],l=i[8],u=i[12],d=i[1],f=i[5],p=i[9],_=i[13],y=i[2],w=i[6],A=i[10],b=i[14],C=i[3],T=i[7],I=i[11],N=i[15],k=r[0],G=r[4],K=r[8],L=r[12],H=r[1],me=r[5],Te=r[9],le=r[13],ue=r[2],_e=r[6],Le=r[10],Se=r[14],De=r[3],Fe=r[7],Ve=r[11],he=r[15];return s[0]=o*k+a*H+l*ue+u*De,s[4]=o*G+a*me+l*_e+u*Fe,s[8]=o*K+a*Te+l*Le+u*Ve,s[12]=o*L+a*le+l*Se+u*he,s[1]=d*k+f*H+p*ue+_*De,s[5]=d*G+f*me+p*_e+_*Fe,s[9]=d*K+f*Te+p*Le+_*Ve,s[13]=d*L+f*le+p*Se+_*he,s[2]=y*k+w*H+A*ue+b*De,s[6]=y*G+w*me+A*_e+b*Fe,s[10]=y*K+w*Te+A*Le+b*Ve,s[14]=y*L+w*le+A*Se+b*he,s[3]=C*k+T*H+I*ue+N*De,s[7]=C*G+T*me+I*_e+N*Fe,s[11]=C*K+T*Te+I*Le+N*Ve,s[15]=C*L+T*le+I*Se+N*he,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}determinant(){const e=this.elements,t=e[0],i=e[4],r=e[8],s=e[12],o=e[1],a=e[5],l=e[9],u=e[13],d=e[2],f=e[6],p=e[10],_=e[14];return e[3]*(+s*l*f-r*u*f-s*a*p+i*u*p+r*a*_-i*l*_)+e[7]*(+t*l*_-t*u*p+s*o*p-r*o*_+r*u*d-s*l*d)+e[11]*(+t*u*f-t*a*_-s*o*f+i*o*_+s*a*d-i*u*d)+e[15]*(-r*a*d-t*l*f+t*a*p+r*o*f-i*o*p+i*l*d)}transpose(){const e=this.elements;let t;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this}setPosition(e,t,i){const r=this.elements;return e.isVector3?(r[12]=e.x,r[13]=e.y,r[14]=e.z):(r[12]=e,r[13]=t,r[14]=i),this}invert(){const e=this.elements,t=e[0],i=e[1],r=e[2],s=e[3],o=e[4],a=e[5],l=e[6],u=e[7],d=e[8],f=e[9],p=e[10],_=e[11],y=e[12],w=e[13],A=e[14],b=e[15],C=f*A*u-w*p*u+w*l*_-a*A*_-f*l*b+a*p*b,T=y*p*u-d*A*u-y*l*_+o*A*_+d*l*b-o*p*b,I=d*w*u-y*f*u+y*a*_-o*w*_-d*a*b+o*f*b,N=y*f*l-d*w*l-y*a*p+o*w*p+d*a*A-o*f*A,k=t*C+i*T+r*I+s*N;if(0===k)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const G=1/k;return e[0]=C*G,e[1]=(w*p*s-f*A*s-w*r*_+i*A*_+f*r*b-i*p*b)*G,e[2]=(a*A*s-w*l*s+w*r*u-i*A*u-a*r*b+i*l*b)*G,e[3]=(f*l*s-a*p*s-f*r*u+i*p*u+a*r*_-i*l*_)*G,e[4]=T*G,e[5]=(d*A*s-y*p*s+y*r*_-t*A*_-d*r*b+t*p*b)*G,e[6]=(y*l*s-o*A*s-y*r*u+t*A*u+o*r*b-t*l*b)*G,e[7]=(o*p*s-d*l*s+d*r*u-t*p*u-o*r*_+t*l*_)*G,e[8]=I*G,e[9]=(y*f*s-d*w*s-y*i*_+t*w*_+d*i*b-t*f*b)*G,e[10]=(o*w*s-y*a*s+y*i*u-t*w*u-o*i*b+t*a*b)*G,e[11]=(d*a*s-o*f*s-d*i*u+t*f*u+o*i*_-t*a*_)*G,e[12]=N*G,e[13]=(d*w*r-y*f*r+y*i*p-t*w*p-d*i*A+t*f*A)*G,e[14]=(y*a*r-o*w*r-y*i*l+t*w*l+o*i*A-t*a*A)*G,e[15]=(o*f*r-d*a*r+d*i*l-t*f*l-o*i*p+t*a*p)*G,this}scale(e){const t=this.elements,i=e.x,r=e.y,s=e.z;return t[0]*=i,t[4]*=r,t[8]*=s,t[1]*=i,t[5]*=r,t[9]*=s,t[2]*=i,t[6]*=r,t[10]*=s,t[3]*=i,t[7]*=r,t[11]*=s,this}getMaxScaleOnAxis(){const e=this.elements;return Math.sqrt(Math.max(e[0]*e[0]+e[1]*e[1]+e[2]*e[2],e[4]*e[4]+e[5]*e[5]+e[6]*e[6],e[8]*e[8]+e[9]*e[9]+e[10]*e[10]))}makeTranslation(e,t,i){return e.isVector3?this.set(1,0,0,e.x,0,1,0,e.y,0,0,1,e.z,0,0,0,1):this.set(1,0,0,e,0,1,0,t,0,0,1,i,0,0,0,1),this}makeRotationX(e){const t=Math.cos(e),i=Math.sin(e);return this.set(1,0,0,0,0,t,-i,0,0,i,t,0,0,0,0,1),this}makeRotationY(e){const t=Math.cos(e),i=Math.sin(e);return this.set(t,0,i,0,0,1,0,0,-i,0,t,0,0,0,0,1),this}makeRotationZ(e){const t=Math.cos(e),i=Math.sin(e);return this.set(t,-i,0,0,i,t,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,t){const i=Math.cos(t),r=Math.sin(t),s=1-i,o=e.x,a=e.y,l=e.z,u=s*o,d=s*a;return this.set(u*o+i,u*a-r*l,u*l+r*a,0,u*a+r*l,d*a+i,d*l-r*o,0,u*l-r*a,d*l+r*o,s*l*l+i,0,0,0,0,1),this}makeScale(e,t,i){return this.set(e,0,0,0,0,t,0,0,0,0,i,0,0,0,0,1),this}makeShear(e,t,i,r,s,o){return this.set(1,i,s,0,e,1,o,0,t,r,1,0,0,0,0,1),this}compose(e,t,i){const r=this.elements,s=t._x,o=t._y,a=t._z,l=t._w,u=s+s,d=o+o,f=a+a,p=s*u,_=s*d,y=s*f,w=o*d,A=o*f,b=a*f,C=l*u,T=l*d,I=l*f,N=i.x,k=i.y,G=i.z;return r[0]=(1-(w+b))*N,r[1]=(_+I)*N,r[2]=(y-T)*N,r[3]=0,r[4]=(_-I)*k,r[5]=(1-(p+b))*k,r[6]=(A+C)*k,r[7]=0,r[8]=(y+T)*G,r[9]=(A-C)*G,r[10]=(1-(p+w))*G,r[11]=0,r[12]=e.x,r[13]=e.y,r[14]=e.z,r[15]=1,this}decompose(e,t,i){const r=this.elements;let s=Nc.set(r[0],r[1],r[2]).length();const o=Nc.set(r[4],r[5],r[6]).length(),a=Nc.set(r[8],r[9],r[10]).length();this.determinant()<0&&(s=-s),e.x=r[12],e.y=r[13],e.z=r[14],vs.copy(this);const u=1/s,d=1/o,f=1/a;return vs.elements[0]*=u,vs.elements[1]*=u,vs.elements[2]*=u,vs.elements[4]*=d,vs.elements[5]*=d,vs.elements[6]*=d,vs.elements[8]*=f,vs.elements[9]*=f,vs.elements[10]*=f,t.setFromRotationMatrix(vs),i.x=s,i.y=o,i.z=a,this}makePerspective(e,t,i,r,s,o,a=vo){const l=this.elements,u=2*s/(t-e),d=2*s/(i-r),f=(t+e)/(t-e),p=(i+r)/(i-r);let _,y;if(a===vo)_=-(o+s)/(o-s),y=-2*o*s/(o-s);else{if(2001!==a)throw new Error("THREE.Matrix4.makePerspective(): Invalid coordinate system: "+a);_=-o/(o-s),y=-o*s/(o-s)}return l[0]=u,l[4]=0,l[8]=f,l[12]=0,l[1]=0,l[5]=d,l[9]=p,l[13]=0,l[2]=0,l[6]=0,l[10]=_,l[14]=y,l[3]=0,l[7]=0,l[11]=-1,l[15]=0,this}makeOrthographic(e,t,i,r,s,o,a=vo){const l=this.elements,u=1/(t-e),d=1/(i-r),f=1/(o-s),p=(t+e)*u,_=(i+r)*d;let y,w;if(a===vo)y=(o+s)*f,w=-2*f;else{if(2001!==a)throw new Error("THREE.Matrix4.makeOrthographic(): Invalid coordinate system: "+a);y=s*f,w=-1*f}return l[0]=2*u,l[4]=0,l[8]=0,l[12]=-p,l[1]=0,l[5]=2*d,l[9]=0,l[13]=-_,l[2]=0,l[6]=0,l[10]=w,l[14]=-y,l[3]=0,l[7]=0,l[11]=0,l[15]=1,this}equals(e){const t=this.elements,i=e.elements;for(let r=0;r<16;r++)if(t[r]!==i[r])return!1;return!0}fromArray(e,t=0){for(let i=0;i<16;i++)this.elements[i]=e[i+t];return this}toArray(e=[],t=0){const i=this.elements;return e[t]=i[0],e[t+1]=i[1],e[t+2]=i[2],e[t+3]=i[3],e[t+4]=i[4],e[t+5]=i[5],e[t+6]=i[6],e[t+7]=i[7],e[t+8]=i[8],e[t+9]=i[9],e[t+10]=i[10],e[t+11]=i[11],e[t+12]=i[12],e[t+13]=i[13],e[t+14]=i[14],e[t+15]=i[15],e}}const Nc=new q,vs=new Wt,_z=new q(0,0,0),gz=new q(1,1,1),na=new q,bp=new q,Pr=new q,CC=new Wt,DC=new Yi;let vz=(()=>{class n{constructor(t=0,i=0,r=0,s=n.DEFAULT_ORDER){this.isEuler=!0,this._x=t,this._y=i,this._z=r,this._order=s}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get order(){return this._order}set order(t){this._order=t,this._onChangeCallback()}set(t,i,r,s=this._order){return this._x=t,this._y=i,this._z=r,this._order=s,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(t){return this._x=t._x,this._y=t._y,this._z=t._z,this._order=t._order,this._onChangeCallback(),this}setFromRotationMatrix(t,i=this._order,r=!0){const s=t.elements,o=s[0],a=s[4],l=s[8],u=s[1],d=s[5],f=s[9],p=s[2],_=s[6],y=s[10];switch(i){case"XYZ":this._y=Math.asin(ti(l,-1,1)),Math.abs(l)<.9999999?(this._x=Math.atan2(-f,y),this._z=Math.atan2(-a,o)):(this._x=Math.atan2(_,d),this._z=0);break;case"YXZ":this._x=Math.asin(-ti(f,-1,1)),Math.abs(f)<.9999999?(this._y=Math.atan2(l,y),this._z=Math.atan2(u,d)):(this._y=Math.atan2(-p,o),this._z=0);break;case"ZXY":this._x=Math.asin(ti(_,-1,1)),Math.abs(_)<.9999999?(this._y=Math.atan2(-p,y),this._z=Math.atan2(-a,d)):(this._y=0,this._z=Math.atan2(u,o));break;case"ZYX":this._y=Math.asin(-ti(p,-1,1)),Math.abs(p)<.9999999?(this._x=Math.atan2(_,y),this._z=Math.atan2(u,o)):(this._x=0,this._z=Math.atan2(-a,d));break;case"YZX":this._z=Math.asin(ti(u,-1,1)),Math.abs(u)<.9999999?(this._x=Math.atan2(-f,d),this._y=Math.atan2(-p,o)):(this._x=0,this._y=Math.atan2(l,y));break;case"XZY":this._z=Math.asin(-ti(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(_,d),this._y=Math.atan2(l,o)):(this._x=Math.atan2(-f,y),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+i)}return this._order=i,!0===r&&this._onChangeCallback(),this}setFromQuaternion(t,i,r){return CC.makeRotationFromQuaternion(t),this.setFromRotationMatrix(CC,i,r)}setFromVector3(t,i=this._order){return this.set(t.x,t.y,t.z,i)}reorder(t){return DC.setFromEuler(this),this.setFromQuaternion(DC,t)}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._order===this._order}fromArray(t){return this._x=t[0],this._y=t[1],this._z=t[2],void 0!==t[3]&&(this._order=t[3]),this._onChangeCallback(),this}toArray(t=[],i=0){return t[i]=this._x,t[i+1]=this._y,t[i+2]=this._z,t[i+3]=this._order,t}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}}return n.DEFAULT_ORDER="XYZ",n})();class Cy{constructor(){this.mask=1}set(e){this.mask=(1<<e|0)>>>0}enable(e){this.mask|=1<<e|0}enableAll(){this.mask=-1}toggle(e){this.mask^=1<<e|0}disable(e){this.mask&=~(1<<e|0)}disableAll(){this.mask=0}test(e){return 0!=(this.mask&e.mask)}isEnabled(e){return 0!=(this.mask&(1<<e|0))}}let yz=0;const IC=new q,Bc=new Yi,wo=new Wt,Ap=new q,Oh=new q,xz=new q,bz=new Yi,RC=new q(1,0,0),PC=new q(0,1,0),LC=new q(0,0,1),Az={type:"added"},NC={type:"removed"};let vi=(()=>{class n extends Mc{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:yz++}),this.uuid=Ir(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=n.DEFAULT_UP.clone();const t=new q,i=new vz,r=new Yi,s=new q(1,1,1);i._onChange(function o(){r.setFromEuler(i,!1)}),r._onChange(function a(){i.setFromQuaternion(r,void 0,!1)}),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:t},rotation:{configurable:!0,enumerable:!0,value:i},quaternion:{configurable:!0,enumerable:!0,value:r},scale:{configurable:!0,enumerable:!0,value:s},modelViewMatrix:{value:new Wt},normalMatrix:{value:new un}}),this.matrix=new Wt,this.matrixWorld=new Wt,this.matrixAutoUpdate=n.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.matrixWorldAutoUpdate=n.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.layers=new Cy,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeRender(){}onAfterRender(){}applyMatrix4(t){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(t),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(t){return this.quaternion.premultiply(t),this}setRotationFromAxisAngle(t,i){this.quaternion.setFromAxisAngle(t,i)}setRotationFromEuler(t){this.quaternion.setFromEuler(t,!0)}setRotationFromMatrix(t){this.quaternion.setFromRotationMatrix(t)}setRotationFromQuaternion(t){this.quaternion.copy(t)}rotateOnAxis(t,i){return Bc.setFromAxisAngle(t,i),this.quaternion.multiply(Bc),this}rotateOnWorldAxis(t,i){return Bc.setFromAxisAngle(t,i),this.quaternion.premultiply(Bc),this}rotateX(t){return this.rotateOnAxis(RC,t)}rotateY(t){return this.rotateOnAxis(PC,t)}rotateZ(t){return this.rotateOnAxis(LC,t)}translateOnAxis(t,i){return IC.copy(t).applyQuaternion(this.quaternion),this.position.add(IC.multiplyScalar(i)),this}translateX(t){return this.translateOnAxis(RC,t)}translateY(t){return this.translateOnAxis(PC,t)}translateZ(t){return this.translateOnAxis(LC,t)}localToWorld(t){return this.updateWorldMatrix(!0,!1),t.applyMatrix4(this.matrixWorld)}worldToLocal(t){return this.updateWorldMatrix(!0,!1),t.applyMatrix4(wo.copy(this.matrixWorld).invert())}lookAt(t,i,r){t.isVector3?Ap.copy(t):Ap.set(t,i,r);const s=this.parent;this.updateWorldMatrix(!0,!1),Oh.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?wo.lookAt(Oh,Ap,this.up):wo.lookAt(Ap,Oh,this.up),this.quaternion.setFromRotationMatrix(wo),s&&(wo.extractRotation(s.matrixWorld),Bc.setFromRotationMatrix(wo),this.quaternion.premultiply(Bc.invert()))}add(t){if(arguments.length>1){for(let i=0;i<arguments.length;i++)this.add(arguments[i]);return this}return t===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",t),this):(t&&t.isObject3D?(null!==t.parent&&t.parent.remove(t),t.parent=this,this.children.push(t),t.dispatchEvent(Az)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",t),this)}remove(t){if(arguments.length>1){for(let r=0;r<arguments.length;r++)this.remove(arguments[r]);return this}const i=this.children.indexOf(t);return-1!==i&&(t.parent=null,this.children.splice(i,1),t.dispatchEvent(NC)),this}removeFromParent(){const t=this.parent;return null!==t&&t.remove(this),this}clear(){for(let t=0;t<this.children.length;t++){const i=this.children[t];i.parent=null,i.dispatchEvent(NC)}return this.children.length=0,this}attach(t){return this.updateWorldMatrix(!0,!1),wo.copy(this.matrixWorld).invert(),null!==t.parent&&(t.parent.updateWorldMatrix(!0,!1),wo.multiply(t.parent.matrixWorld)),t.applyMatrix4(wo),this.add(t),t.updateWorldMatrix(!1,!0),this}getObjectById(t){return this.getObjectByProperty("id",t)}getObjectByName(t){return this.getObjectByProperty("name",t)}getObjectByProperty(t,i){if(this[t]===i)return this;for(let r=0,s=this.children.length;r<s;r++){const a=this.children[r].getObjectByProperty(t,i);if(void 0!==a)return a}}getObjectsByProperty(t,i){let r=[];this[t]===i&&r.push(this);for(let s=0,o=this.children.length;s<o;s++){const a=this.children[s].getObjectsByProperty(t,i);a.length>0&&(r=r.concat(a))}return r}getWorldPosition(t){return this.updateWorldMatrix(!0,!1),t.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(t){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Oh,t,xz),t}getWorldScale(t){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Oh,bz,t),t}getWorldDirection(t){this.updateWorldMatrix(!0,!1);const i=this.matrixWorld.elements;return t.set(i[8],i[9],i[10]).normalize()}raycast(){}traverse(t){t(this);const i=this.children;for(let r=0,s=i.length;r<s;r++)i[r].traverse(t)}traverseVisible(t){if(!1===this.visible)return;t(this);const i=this.children;for(let r=0,s=i.length;r<s;r++)i[r].traverseVisible(t)}traverseAncestors(t){const i=this.parent;null!==i&&(t(i),i.traverseAncestors(t))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(t){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||t)&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,t=!0);const i=this.children;for(let r=0,s=i.length;r<s;r++){const o=i[r];(!0===o.matrixWorldAutoUpdate||!0===t)&&o.updateMatrixWorld(t)}}updateWorldMatrix(t,i){const r=this.parent;if(!0===t&&null!==r&&!0===r.matrixWorldAutoUpdate&&r.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),!0===i){const s=this.children;for(let o=0,a=s.length;o<a;o++){const l=s[o];!0===l.matrixWorldAutoUpdate&&l.updateWorldMatrix(!1,!0)}}}toJSON(t){const i=void 0===t||"string"==typeof t,r={};i&&(t={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},r.metadata={version:4.6,type:"Object",generator:"Object3D.toJSON"});const s={};function o(l,u){return void 0===l[u.uuid]&&(l[u.uuid]=u.toJSON(t)),u.uuid}if(s.uuid=this.uuid,s.type=this.type,""!==this.name&&(s.name=this.name),!0===this.castShadow&&(s.castShadow=!0),!0===this.receiveShadow&&(s.receiveShadow=!0),!1===this.visible&&(s.visible=!1),!1===this.frustumCulled&&(s.frustumCulled=!1),0!==this.renderOrder&&(s.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(s.userData=this.userData),s.layers=this.layers.mask,s.matrix=this.matrix.toArray(),s.up=this.up.toArray(),!1===this.matrixAutoUpdate&&(s.matrixAutoUpdate=!1),this.isInstancedMesh&&(s.type="InstancedMesh",s.count=this.count,s.instanceMatrix=this.instanceMatrix.toJSON(),null!==this.instanceColor&&(s.instanceColor=this.instanceColor.toJSON())),this.isScene)this.background&&(this.background.isColor?s.background=this.background.toJSON():this.background.isTexture&&(s.background=this.background.toJSON(t).uuid)),this.environment&&this.environment.isTexture&&!0!==this.environment.isRenderTargetTexture&&(s.environment=this.environment.toJSON(t).uuid);else if(this.isMesh||this.isLine||this.isPoints){s.geometry=o(t.geometries,this.geometry);const l=this.geometry.parameters;if(void 0!==l&&void 0!==l.shapes){const u=l.shapes;if(Array.isArray(u))for(let d=0,f=u.length;d<f;d++)o(t.shapes,u[d]);else o(t.shapes,u)}}if(this.isSkinnedMesh&&(s.bindMode=this.bindMode,s.bindMatrix=this.bindMatrix.toArray(),void 0!==this.skeleton&&(o(t.skeletons,this.skeleton),s.skeleton=this.skeleton.uuid)),void 0!==this.material)if(Array.isArray(this.material)){const l=[];for(let u=0,d=this.material.length;u<d;u++)l.push(o(t.materials,this.material[u]));s.material=l}else s.material=o(t.materials,this.material);if(this.children.length>0){s.children=[];for(let l=0;l<this.children.length;l++)s.children.push(this.children[l].toJSON(t).object)}if(this.animations.length>0){s.animations=[];for(let l=0;l<this.animations.length;l++)s.animations.push(o(t.animations,this.animations[l]))}if(i){const l=a(t.geometries),u=a(t.materials),d=a(t.textures),f=a(t.images),p=a(t.shapes),_=a(t.skeletons),y=a(t.animations),w=a(t.nodes);l.length>0&&(r.geometries=l),u.length>0&&(r.materials=u),d.length>0&&(r.textures=d),f.length>0&&(r.images=f),p.length>0&&(r.shapes=p),_.length>0&&(r.skeletons=_),y.length>0&&(r.animations=y),w.length>0&&(r.nodes=w)}return r.object=s,r;function a(l){const u=[];for(const d in l){const f=l[d];delete f.metadata,u.push(f)}return u}}clone(t){return(new this.constructor).copy(this,t)}copy(t,i=!0){if(this.name=t.name,this.up.copy(t.up),this.position.copy(t.position),this.rotation.order=t.rotation.order,this.quaternion.copy(t.quaternion),this.scale.copy(t.scale),this.matrix.copy(t.matrix),this.matrixWorld.copy(t.matrixWorld),this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrixWorldNeedsUpdate=t.matrixWorldNeedsUpdate,this.matrixWorldAutoUpdate=t.matrixWorldAutoUpdate,this.layers.mask=t.layers.mask,this.visible=t.visible,this.castShadow=t.castShadow,this.receiveShadow=t.receiveShadow,this.frustumCulled=t.frustumCulled,this.renderOrder=t.renderOrder,this.animations=t.animations,this.userData=JSON.parse(JSON.stringify(t.userData)),!0===i)for(let r=0;r<t.children.length;r++)this.add(t.children[r].clone());return this}}return n.DEFAULT_UP=new q(0,1,0),n.DEFAULT_MATRIX_AUTO_UPDATE=!0,n.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0,n})();const ys=new q,Mo=new q,Dy=new q,So=new q,Fc=new q,Oc=new q,BC=new q,Iy=new q,Ry=new q,Py=new q;let wp=!1;class Lr{constructor(e=new q,t=new q,i=new q){this.a=e,this.b=t,this.c=i}static getNormal(e,t,i,r){r.subVectors(i,t),ys.subVectors(e,t),r.cross(ys);const s=r.lengthSq();return s>0?r.multiplyScalar(1/Math.sqrt(s)):r.set(0,0,0)}static getBarycoord(e,t,i,r,s){ys.subVectors(r,t),Mo.subVectors(i,t),Dy.subVectors(e,t);const o=ys.dot(ys),a=ys.dot(Mo),l=ys.dot(Dy),u=Mo.dot(Mo),d=Mo.dot(Dy),f=o*u-a*a;if(0===f)return s.set(-2,-1,-1);const p=1/f,_=(u*l-a*d)*p,y=(o*d-a*l)*p;return s.set(1-_-y,y,_)}static containsPoint(e,t,i,r){return this.getBarycoord(e,t,i,r,So),So.x>=0&&So.y>=0&&So.x+So.y<=1}static getUV(e,t,i,r,s,o,a,l){return!1===wp&&(console.warn("THREE.Triangle.getUV() has been renamed to THREE.Triangle.getInterpolation()."),wp=!0),this.getInterpolation(e,t,i,r,s,o,a,l)}static getInterpolation(e,t,i,r,s,o,a,l){return this.getBarycoord(e,t,i,r,So),l.setScalar(0),l.addScaledVector(s,So.x),l.addScaledVector(o,So.y),l.addScaledVector(a,So.z),l}static isFrontFacing(e,t,i,r){return ys.subVectors(i,t),Mo.subVectors(e,t),ys.cross(Mo).dot(r)<0}set(e,t,i){return this.a.copy(e),this.b.copy(t),this.c.copy(i),this}setFromPointsAndIndices(e,t,i,r){return this.a.copy(e[t]),this.b.copy(e[i]),this.c.copy(e[r]),this}setFromAttributeAndIndices(e,t,i,r){return this.a.fromBufferAttribute(e,t),this.b.fromBufferAttribute(e,i),this.c.fromBufferAttribute(e,r),this}clone(){return(new this.constructor).copy(this)}copy(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}getArea(){return ys.subVectors(this.c,this.b),Mo.subVectors(this.a,this.b),.5*ys.cross(Mo).length()}getMidpoint(e){return e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return Lr.getNormal(this.a,this.b,this.c,e)}getPlane(e){return e.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,t){return Lr.getBarycoord(e,this.a,this.b,this.c,t)}getUV(e,t,i,r,s){return!1===wp&&(console.warn("THREE.Triangle.getUV() has been renamed to THREE.Triangle.getInterpolation()."),wp=!0),Lr.getInterpolation(e,this.a,this.b,this.c,t,i,r,s)}getInterpolation(e,t,i,r,s){return Lr.getInterpolation(e,this.a,this.b,this.c,t,i,r,s)}containsPoint(e){return Lr.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return Lr.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(e){return e.intersectsTriangle(this)}closestPointToPoint(e,t){const i=this.a,r=this.b,s=this.c;let o,a;Fc.subVectors(r,i),Oc.subVectors(s,i),Iy.subVectors(e,i);const l=Fc.dot(Iy),u=Oc.dot(Iy);if(l<=0&&u<=0)return t.copy(i);Ry.subVectors(e,r);const d=Fc.dot(Ry),f=Oc.dot(Ry);if(d>=0&&f<=d)return t.copy(r);const p=l*f-d*u;if(p<=0&&l>=0&&d<=0)return o=l/(l-d),t.copy(i).addScaledVector(Fc,o);Py.subVectors(e,s);const _=Fc.dot(Py),y=Oc.dot(Py);if(y>=0&&_<=y)return t.copy(s);const w=_*u-l*y;if(w<=0&&u>=0&&y<=0)return a=u/(u-y),t.copy(i).addScaledVector(Oc,a);const A=d*y-_*f;if(A<=0&&f-d>=0&&_-y>=0)return BC.subVectors(s,r),a=(f-d)/(f-d+(_-y)),t.copy(r).addScaledVector(BC,a);const b=1/(A+w+p);return o=w*b,a=p*b,t.copy(i).addScaledVector(Fc,o).addScaledVector(Oc,a)}equals(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}}let wz=0;class $r extends Mc{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:wz++}),this.uuid=Ir(),this.name="",this.type="Material",this.blending=1,this.side=0,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.alphaHash=!1,this.blendSrc=204,this.blendDst=205,this.blendEquation=100,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=3,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=519,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=7680,this.stencilZFail=7680,this.stencilZPass=7680,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(e){this._alphaTest>0!=e>0&&this.version++,this._alphaTest=e}onBuild(){}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(e){if(void 0!==e)for(const t in e){const i=e[t];if(void 0===i){console.warn(`THREE.Material: parameter '${t}' has value of undefined.`);continue}const r=this[t];void 0!==r?r&&r.isColor?r.set(i):r&&r.isVector3&&i&&i.isVector3?r.copy(i):this[t]=i:console.warn(`THREE.Material: '${t}' is not a property of THREE.${this.type}.`)}}toJSON(e){const t=void 0===e||"string"==typeof e;t&&(e={textures:{},images:{}});const i={metadata:{version:4.6,type:"Material",generator:"Material.toJSON"}};function r(s){const o=[];for(const a in s){const l=s[a];delete l.metadata,o.push(l)}return o}if(i.uuid=this.uuid,i.type=this.type,""!==this.name&&(i.name=this.name),this.color&&this.color.isColor&&(i.color=this.color.getHex()),void 0!==this.roughness&&(i.roughness=this.roughness),void 0!==this.metalness&&(i.metalness=this.metalness),void 0!==this.sheen&&(i.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(i.sheenColor=this.sheenColor.getHex()),void 0!==this.sheenRoughness&&(i.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(i.emissive=this.emissive.getHex()),this.emissiveIntensity&&1!==this.emissiveIntensity&&(i.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(i.specular=this.specular.getHex()),void 0!==this.specularIntensity&&(i.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(i.specularColor=this.specularColor.getHex()),void 0!==this.shininess&&(i.shininess=this.shininess),void 0!==this.clearcoat&&(i.clearcoat=this.clearcoat),void 0!==this.clearcoatRoughness&&(i.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(i.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(i.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(i.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,i.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),void 0!==this.iridescence&&(i.iridescence=this.iridescence),void 0!==this.iridescenceIOR&&(i.iridescenceIOR=this.iridescenceIOR),void 0!==this.iridescenceThicknessRange&&(i.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(i.iridescenceMap=this.iridescenceMap.toJSON(e).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(i.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(e).uuid),void 0!==this.anisotropy&&(i.anisotropy=this.anisotropy),void 0!==this.anisotropyRotation&&(i.anisotropyRotation=this.anisotropyRotation),this.anisotropyMap&&this.anisotropyMap.isTexture&&(i.anisotropyMap=this.anisotropyMap.toJSON(e).uuid),this.map&&this.map.isTexture&&(i.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(i.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(i.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(i.lightMap=this.lightMap.toJSON(e).uuid,i.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(i.aoMap=this.aoMap.toJSON(e).uuid,i.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(i.bumpMap=this.bumpMap.toJSON(e).uuid,i.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(i.normalMap=this.normalMap.toJSON(e).uuid,i.normalMapType=this.normalMapType,i.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(i.displacementMap=this.displacementMap.toJSON(e).uuid,i.displacementScale=this.displacementScale,i.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(i.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(i.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(i.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(i.specularMap=this.specularMap.toJSON(e).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(i.specularIntensityMap=this.specularIntensityMap.toJSON(e).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(i.specularColorMap=this.specularColorMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(i.envMap=this.envMap.toJSON(e).uuid,void 0!==this.combine&&(i.combine=this.combine)),void 0!==this.envMapIntensity&&(i.envMapIntensity=this.envMapIntensity),void 0!==this.reflectivity&&(i.reflectivity=this.reflectivity),void 0!==this.refractionRatio&&(i.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(i.gradientMap=this.gradientMap.toJSON(e).uuid),void 0!==this.transmission&&(i.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(i.transmissionMap=this.transmissionMap.toJSON(e).uuid),void 0!==this.thickness&&(i.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(i.thicknessMap=this.thicknessMap.toJSON(e).uuid),void 0!==this.attenuationDistance&&this.attenuationDistance!==1/0&&(i.attenuationDistance=this.attenuationDistance),void 0!==this.attenuationColor&&(i.attenuationColor=this.attenuationColor.getHex()),void 0!==this.size&&(i.size=this.size),null!==this.shadowSide&&(i.shadowSide=this.shadowSide),void 0!==this.sizeAttenuation&&(i.sizeAttenuation=this.sizeAttenuation),1!==this.blending&&(i.blending=this.blending),0!==this.side&&(i.side=this.side),this.vertexColors&&(i.vertexColors=!0),this.opacity<1&&(i.opacity=this.opacity),!0===this.transparent&&(i.transparent=this.transparent),i.depthFunc=this.depthFunc,i.depthTest=this.depthTest,i.depthWrite=this.depthWrite,i.colorWrite=this.colorWrite,i.stencilWrite=this.stencilWrite,i.stencilWriteMask=this.stencilWriteMask,i.stencilFunc=this.stencilFunc,i.stencilRef=this.stencilRef,i.stencilFuncMask=this.stencilFuncMask,i.stencilFail=this.stencilFail,i.stencilZFail=this.stencilZFail,i.stencilZPass=this.stencilZPass,void 0!==this.rotation&&0!==this.rotation&&(i.rotation=this.rotation),!0===this.polygonOffset&&(i.polygonOffset=!0),0!==this.polygonOffsetFactor&&(i.polygonOffsetFactor=this.polygonOffsetFactor),0!==this.polygonOffsetUnits&&(i.polygonOffsetUnits=this.polygonOffsetUnits),void 0!==this.linewidth&&1!==this.linewidth&&(i.linewidth=this.linewidth),void 0!==this.dashSize&&(i.dashSize=this.dashSize),void 0!==this.gapSize&&(i.gapSize=this.gapSize),void 0!==this.scale&&(i.scale=this.scale),!0===this.dithering&&(i.dithering=!0),this.alphaTest>0&&(i.alphaTest=this.alphaTest),!0===this.alphaHash&&(i.alphaHash=this.alphaHash),!0===this.alphaToCoverage&&(i.alphaToCoverage=this.alphaToCoverage),!0===this.premultipliedAlpha&&(i.premultipliedAlpha=this.premultipliedAlpha),!0===this.forceSinglePass&&(i.forceSinglePass=this.forceSinglePass),!0===this.wireframe&&(i.wireframe=this.wireframe),this.wireframeLinewidth>1&&(i.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(i.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(i.wireframeLinejoin=this.wireframeLinejoin),!0===this.flatShading&&(i.flatShading=this.flatShading),!1===this.visible&&(i.visible=!1),!1===this.toneMapped&&(i.toneMapped=!1),!1===this.fog&&(i.fog=!1),Object.keys(this.userData).length>0&&(i.userData=this.userData),t){const s=r(e.textures),o=r(e.images);s.length>0&&(i.textures=s),o.length>0&&(i.images=o)}return i}clone(){return(new this.constructor).copy(this)}copy(e){this.name=e.name,this.blending=e.blending,this.side=e.side,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;const t=e.clippingPlanes;let i=null;if(null!==t){const r=t.length;i=new Array(r);for(let s=0;s!==r;++s)i[s]=t[s].clone()}return this.clippingPlanes=i,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.alphaHash=e.alphaHash,this.alphaToCoverage=e.alphaToCoverage,this.premultipliedAlpha=e.premultipliedAlpha,this.forceSinglePass=e.forceSinglePass,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(e){!0===e&&this.version++}}const FC={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},xs={h:0,s:0,l:0},Mp={h:0,s:0,l:0};function Ly(n,e,t){return t<0&&(t+=1),t>1&&(t-=1),t<1/6?n+6*(e-n)*t:t<.5?e:t<2/3?n+6*(e-n)*(2/3-t):n}class Qe{constructor(e,t,i){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(e,t,i)}set(e,t,i){if(void 0===t&&void 0===i){const r=e;r&&r.isColor?this.copy(r):"number"==typeof r?this.setHex(r):"string"==typeof r&&this.setStyle(r)}else this.setRGB(e,t,i);return this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e,t=jt){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(255&e)/255,ms.toWorkingColorSpace(this,t),this}setRGB(e,t,i,r=ms.workingColorSpace){return this.r=e,this.g=t,this.b=i,ms.toWorkingColorSpace(this,r),this}setHSL(e,t,i,r=ms.workingColorSpace){if(e=_y(e,1),t=ti(t,0,1),i=ti(i,0,1),0===t)this.r=this.g=this.b=i;else{const s=i<=.5?i*(1+t):i+t-i*t,o=2*i-s;this.r=Ly(o,s,e+1/3),this.g=Ly(o,s,e),this.b=Ly(o,s,e-1/3)}return ms.toWorkingColorSpace(this,r),this}setStyle(e,t=jt){function i(s){void 0!==s&&parseFloat(s)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}let r;if(r=/^(\w+)\(([^\)]*)\)/.exec(e)){let s;const a=r[2];switch(r[1]){case"rgb":case"rgba":if(s=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return i(s[4]),this.setRGB(Math.min(255,parseInt(s[1],10))/255,Math.min(255,parseInt(s[2],10))/255,Math.min(255,parseInt(s[3],10))/255,t);if(s=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return i(s[4]),this.setRGB(Math.min(100,parseInt(s[1],10))/100,Math.min(100,parseInt(s[2],10))/100,Math.min(100,parseInt(s[3],10))/100,t);break;case"hsl":case"hsla":if(s=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return i(s[4]),this.setHSL(parseFloat(s[1])/360,parseFloat(s[2])/100,parseFloat(s[3])/100,t);break;default:console.warn("THREE.Color: Unknown color model "+e)}}else if(r=/^\#([A-Fa-f\d]+)$/.exec(e)){const s=r[1],o=s.length;if(3===o)return this.setRGB(parseInt(s.charAt(0),16)/15,parseInt(s.charAt(1),16)/15,parseInt(s.charAt(2),16)/15,t);if(6===o)return this.setHex(parseInt(s,16),t);console.warn("THREE.Color: Invalid hex color "+e)}else if(e&&e.length>0)return this.setColorName(e,t);return this}setColorName(e,t=jt){const i=FC[e.toLowerCase()];return void 0!==i?this.setHex(i,t):console.warn("THREE.Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copySRGBToLinear(e){return this.r=Tc(e.r),this.g=Tc(e.g),this.b=Tc(e.b),this}copyLinearToSRGB(e){return this.r=yy(e.r),this.g=yy(e.g),this.b=yy(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(e=jt){return ms.fromWorkingColorSpace(Zi.copy(this),e),65536*Math.round(ti(255*Zi.r,0,255))+256*Math.round(ti(255*Zi.g,0,255))+Math.round(ti(255*Zi.b,0,255))}getHexString(e=jt){return("000000"+this.getHex(e).toString(16)).slice(-6)}getHSL(e,t=ms.workingColorSpace){ms.fromWorkingColorSpace(Zi.copy(this),t);const i=Zi.r,r=Zi.g,s=Zi.b,o=Math.max(i,r,s),a=Math.min(i,r,s);let l,u;const d=(a+o)/2;if(a===o)l=0,u=0;else{const f=o-a;switch(u=d<=.5?f/(o+a):f/(2-o-a),o){case i:l=(r-s)/f+(r<s?6:0);break;case r:l=(s-i)/f+2;break;case s:l=(i-r)/f+4}l/=6}return e.h=l,e.s=u,e.l=d,e}getRGB(e,t=ms.workingColorSpace){return ms.fromWorkingColorSpace(Zi.copy(this),t),e.r=Zi.r,e.g=Zi.g,e.b=Zi.b,e}getStyle(e=jt){ms.fromWorkingColorSpace(Zi.copy(this),e);const t=Zi.r,i=Zi.g,r=Zi.b;return e!==jt?`color(${e} ${t.toFixed(3)} ${i.toFixed(3)} ${r.toFixed(3)})`:`rgb(${Math.round(255*t)},${Math.round(255*i)},${Math.round(255*r)})`}offsetHSL(e,t,i){return this.getHSL(xs),xs.h+=e,xs.s+=t,xs.l+=i,this.setHSL(xs.h,xs.s,xs.l),this}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this}lerpColors(e,t,i){return this.r=e.r+(t.r-e.r)*i,this.g=e.g+(t.g-e.g)*i,this.b=e.b+(t.b-e.b)*i,this}lerpHSL(e,t){this.getHSL(xs),e.getHSL(Mp);const i=Rh(xs.h,Mp.h,t),r=Rh(xs.s,Mp.s,t),s=Rh(xs.l,Mp.l,t);return this.setHSL(i,r,s),this}setFromVector3(e){return this.r=e.x,this.g=e.y,this.b=e.z,this}applyMatrix3(e){const t=this.r,i=this.g,r=this.b,s=e.elements;return this.r=s[0]*t+s[3]*i+s[6]*r,this.g=s[1]*t+s[4]*i+s[7]*r,this.b=s[2]*t+s[5]*i+s[8]*r,this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,t=0){return this.r=e[t],this.g=e[t+1],this.b=e[t+2],this}toArray(e=[],t=0){return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e}fromBufferAttribute(e,t){return this.r=e.getX(t),this.g=e.getY(t),this.b=e.getZ(t),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}const Zi=new Qe;Qe.NAMES=FC;class Xr extends $r{constructor(e){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new Qe(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=cp,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}const yi=new q,Sp=new Be;class ni{constructor(e,t,i=!1){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,this.name="",this.array=e,this.itemSize=t,this.count=void 0!==e?e.length/t:0,this.normalized=i,this.usage=35044,this.updateRange={offset:0,count:-1},this.gpuType=go,this.version=0}onUploadCallback(){}set needsUpdate(e){!0===e&&this.version++}setUsage(e){return this.usage=e,this}copy(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this.gpuType=e.gpuType,this}copyAt(e,t,i){e*=this.itemSize,i*=t.itemSize;for(let r=0,s=this.itemSize;r<s;r++)this.array[e+r]=t.array[i+r];return this}copyArray(e){return this.array.set(e),this}applyMatrix3(e){if(2===this.itemSize)for(let t=0,i=this.count;t<i;t++)Sp.fromBufferAttribute(this,t),Sp.applyMatrix3(e),this.setXY(t,Sp.x,Sp.y);else if(3===this.itemSize)for(let t=0,i=this.count;t<i;t++)yi.fromBufferAttribute(this,t),yi.applyMatrix3(e),this.setXYZ(t,yi.x,yi.y,yi.z);return this}applyMatrix4(e){for(let t=0,i=this.count;t<i;t++)yi.fromBufferAttribute(this,t),yi.applyMatrix4(e),this.setXYZ(t,yi.x,yi.y,yi.z);return this}applyNormalMatrix(e){for(let t=0,i=this.count;t<i;t++)yi.fromBufferAttribute(this,t),yi.applyNormalMatrix(e),this.setXYZ(t,yi.x,yi.y,yi.z);return this}transformDirection(e){for(let t=0,i=this.count;t<i;t++)yi.fromBufferAttribute(this,t),yi.transformDirection(e),this.setXYZ(t,yi.x,yi.y,yi.z);return this}set(e,t=0){return this.array.set(e,t),this}getX(e){let t=this.array[e*this.itemSize];return this.normalized&&(t=Rr(t,this.array)),t}setX(e,t){return this.normalized&&(t=ln(t,this.array)),this.array[e*this.itemSize]=t,this}getY(e){let t=this.array[e*this.itemSize+1];return this.normalized&&(t=Rr(t,this.array)),t}setY(e,t){return this.normalized&&(t=ln(t,this.array)),this.array[e*this.itemSize+1]=t,this}getZ(e){let t=this.array[e*this.itemSize+2];return this.normalized&&(t=Rr(t,this.array)),t}setZ(e,t){return this.normalized&&(t=ln(t,this.array)),this.array[e*this.itemSize+2]=t,this}getW(e){let t=this.array[e*this.itemSize+3];return this.normalized&&(t=Rr(t,this.array)),t}setW(e,t){return this.normalized&&(t=ln(t,this.array)),this.array[e*this.itemSize+3]=t,this}setXY(e,t,i){return e*=this.itemSize,this.normalized&&(t=ln(t,this.array),i=ln(i,this.array)),this.array[e+0]=t,this.array[e+1]=i,this}setXYZ(e,t,i,r){return e*=this.itemSize,this.normalized&&(t=ln(t,this.array),i=ln(i,this.array),r=ln(r,this.array)),this.array[e+0]=t,this.array[e+1]=i,this.array[e+2]=r,this}setXYZW(e,t,i,r,s){return e*=this.itemSize,this.normalized&&(t=ln(t,this.array),i=ln(i,this.array),r=ln(r,this.array),s=ln(s,this.array)),this.array[e+0]=t,this.array[e+1]=i,this.array[e+2]=r,this.array[e+3]=s,this}onUpload(e){return this.onUploadCallback=e,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return""!==this.name&&(e.name=this.name),35044!==this.usage&&(e.usage=this.usage),(0!==this.updateRange.offset||-1!==this.updateRange.count)&&(e.updateRange=this.updateRange),e}}class OC extends ni{constructor(e,t,i){super(new Uint16Array(e),t,i)}}class VC extends ni{constructor(e,t,i){super(new Uint32Array(e),t,i)}}class ht extends ni{constructor(e,t,i){super(new Float32Array(e),t,i)}}let Sz=0;const Yr=new Wt,Ny=new vi,Vc=new q,Nr=new Hs,kh=new Hs,Bi=new q;class hn extends Mc{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:Sz++}),this.uuid=Ir(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(e){return this.index=Array.isArray(e)?new(wC(e)?VC:OC)(e,1):e,this}getAttribute(e){return this.attributes[e]}setAttribute(e,t){return this.attributes[e]=t,this}deleteAttribute(e){return delete this.attributes[e],this}hasAttribute(e){return void 0!==this.attributes[e]}addGroup(e,t,i=0){this.groups.push({start:e,count:t,materialIndex:i})}clearGroups(){this.groups=[]}setDrawRange(e,t){this.drawRange.start=e,this.drawRange.count=t}applyMatrix4(e){const t=this.attributes.position;void 0!==t&&(t.applyMatrix4(e),t.needsUpdate=!0);const i=this.attributes.normal;if(void 0!==i){const s=(new un).getNormalMatrix(e);i.applyNormalMatrix(s),i.needsUpdate=!0}const r=this.attributes.tangent;return void 0!==r&&(r.transformDirection(e),r.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this}applyQuaternion(e){return Yr.makeRotationFromQuaternion(e),this.applyMatrix4(Yr),this}rotateX(e){return Yr.makeRotationX(e),this.applyMatrix4(Yr),this}rotateY(e){return Yr.makeRotationY(e),this.applyMatrix4(Yr),this}rotateZ(e){return Yr.makeRotationZ(e),this.applyMatrix4(Yr),this}translate(e,t,i){return Yr.makeTranslation(e,t,i),this.applyMatrix4(Yr),this}scale(e,t,i){return Yr.makeScale(e,t,i),this.applyMatrix4(Yr),this}lookAt(e){return Ny.lookAt(e),Ny.updateMatrix(),this.applyMatrix4(Ny.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(Vc).negate(),this.translate(Vc.x,Vc.y,Vc.z),this}setFromPoints(e){const t=[];for(let i=0,r=e.length;i<r;i++){const s=e[i];t.push(s.x,s.y,s.z||0)}return this.setAttribute("position",new ht(t,3)),this}computeBoundingBox(){null===this.boundingBox&&(this.boundingBox=new Hs);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingBox.set(new q(-1/0,-1/0,-1/0),new q(1/0,1/0,1/0));if(void 0!==e){if(this.boundingBox.setFromBufferAttribute(e),t)for(let i=0,r=t.length;i<r;i++)Nr.setFromBufferAttribute(t[i]),this.morphTargetsRelative?(Bi.addVectors(this.boundingBox.min,Nr.min),this.boundingBox.expandByPoint(Bi),Bi.addVectors(this.boundingBox.max,Nr.max),this.boundingBox.expandByPoint(Bi)):(this.boundingBox.expandByPoint(Nr.min),this.boundingBox.expandByPoint(Nr.max))}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){null===this.boundingSphere&&(this.boundingSphere=new gs);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingSphere.set(new q,1/0);if(e){const i=this.boundingSphere.center;if(Nr.setFromBufferAttribute(e),t)for(let s=0,o=t.length;s<o;s++)kh.setFromBufferAttribute(t[s]),this.morphTargetsRelative?(Bi.addVectors(Nr.min,kh.min),Nr.expandByPoint(Bi),Bi.addVectors(Nr.max,kh.max),Nr.expandByPoint(Bi)):(Nr.expandByPoint(kh.min),Nr.expandByPoint(kh.max));Nr.getCenter(i);let r=0;for(let s=0,o=e.count;s<o;s++)Bi.fromBufferAttribute(e,s),r=Math.max(r,i.distanceToSquared(Bi));if(t)for(let s=0,o=t.length;s<o;s++){const a=t[s],l=this.morphTargetsRelative;for(let u=0,d=a.count;u<d;u++)Bi.fromBufferAttribute(a,u),l&&(Vc.fromBufferAttribute(e,u),Bi.add(Vc)),r=Math.max(r,i.distanceToSquared(Bi))}this.boundingSphere.radius=Math.sqrt(r),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const e=this.index,t=this.attributes;if(null===e||void 0===t.position||void 0===t.normal||void 0===t.uv)return void console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");const i=e.array,r=t.position.array,s=t.normal.array,o=t.uv.array,a=r.length/3;!1===this.hasAttribute("tangent")&&this.setAttribute("tangent",new ni(new Float32Array(4*a),4));const l=this.getAttribute("tangent").array,u=[],d=[];for(let H=0;H<a;H++)u[H]=new q,d[H]=new q;const f=new q,p=new q,_=new q,y=new Be,w=new Be,A=new Be,b=new q,C=new q;function T(H,me,Te){f.fromArray(r,3*H),p.fromArray(r,3*me),_.fromArray(r,3*Te),y.fromArray(o,2*H),w.fromArray(o,2*me),A.fromArray(o,2*Te),p.sub(f),_.sub(f),w.sub(y),A.sub(y);const le=1/(w.x*A.y-A.x*w.y);isFinite(le)&&(b.copy(p).multiplyScalar(A.y).addScaledVector(_,-w.y).multiplyScalar(le),C.copy(_).multiplyScalar(w.x).addScaledVector(p,-A.x).multiplyScalar(le),u[H].add(b),u[me].add(b),u[Te].add(b),d[H].add(C),d[me].add(C),d[Te].add(C))}let I=this.groups;0===I.length&&(I=[{start:0,count:i.length}]);for(let H=0,me=I.length;H<me;++H){const Te=I[H],le=Te.start;for(let _e=le,Le=le+Te.count;_e<Le;_e+=3)T(i[_e+0],i[_e+1],i[_e+2])}const N=new q,k=new q,G=new q,K=new q;function L(H){G.fromArray(s,3*H),K.copy(G);const me=u[H];N.copy(me),N.sub(G.multiplyScalar(G.dot(me))).normalize(),k.crossVectors(K,me);const le=k.dot(d[H])<0?-1:1;l[4*H]=N.x,l[4*H+1]=N.y,l[4*H+2]=N.z,l[4*H+3]=le}for(let H=0,me=I.length;H<me;++H){const Te=I[H],le=Te.start;for(let _e=le,Le=le+Te.count;_e<Le;_e+=3)L(i[_e+0]),L(i[_e+1]),L(i[_e+2])}}computeVertexNormals(){const e=this.index,t=this.getAttribute("position");if(void 0!==t){let i=this.getAttribute("normal");if(void 0===i)i=new ni(new Float32Array(3*t.count),3),this.setAttribute("normal",i);else for(let p=0,_=i.count;p<_;p++)i.setXYZ(p,0,0,0);const r=new q,s=new q,o=new q,a=new q,l=new q,u=new q,d=new q,f=new q;if(e)for(let p=0,_=e.count;p<_;p+=3){const y=e.getX(p+0),w=e.getX(p+1),A=e.getX(p+2);r.fromBufferAttribute(t,y),s.fromBufferAttribute(t,w),o.fromBufferAttribute(t,A),d.subVectors(o,s),f.subVectors(r,s),d.cross(f),a.fromBufferAttribute(i,y),l.fromBufferAttribute(i,w),u.fromBufferAttribute(i,A),a.add(d),l.add(d),u.add(d),i.setXYZ(y,a.x,a.y,a.z),i.setXYZ(w,l.x,l.y,l.z),i.setXYZ(A,u.x,u.y,u.z)}else for(let p=0,_=t.count;p<_;p+=3)r.fromBufferAttribute(t,p+0),s.fromBufferAttribute(t,p+1),o.fromBufferAttribute(t,p+2),d.subVectors(o,s),f.subVectors(r,s),d.cross(f),i.setXYZ(p+0,d.x,d.y,d.z),i.setXYZ(p+1,d.x,d.y,d.z),i.setXYZ(p+2,d.x,d.y,d.z);this.normalizeNormals(),i.needsUpdate=!0}}normalizeNormals(){const e=this.attributes.normal;for(let t=0,i=e.count;t<i;t++)Bi.fromBufferAttribute(e,t),Bi.normalize(),e.setXYZ(t,Bi.x,Bi.y,Bi.z)}toNonIndexed(){function e(a,l){const u=a.array,d=a.itemSize,f=a.normalized,p=new u.constructor(l.length*d);let _=0,y=0;for(let w=0,A=l.length;w<A;w++){_=a.isInterleavedBufferAttribute?l[w]*a.data.stride+a.offset:l[w]*d;for(let b=0;b<d;b++)p[y++]=u[_++]}return new ni(p,d,f)}if(null===this.index)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const t=new hn,i=this.index.array,r=this.attributes;for(const a in r){const u=e(r[a],i);t.setAttribute(a,u)}const s=this.morphAttributes;for(const a in s){const l=[],u=s[a];for(let d=0,f=u.length;d<f;d++){const _=e(u[d],i);l.push(_)}t.morphAttributes[a]=l}t.morphTargetsRelative=this.morphTargetsRelative;const o=this.groups;for(let a=0,l=o.length;a<l;a++){const u=o[a];t.addGroup(u.start,u.count,u.materialIndex)}return t}toJSON(){const e={metadata:{version:4.6,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,""!==this.name&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),void 0!==this.parameters){const l=this.parameters;for(const u in l)void 0!==l[u]&&(e[u]=l[u]);return e}e.data={attributes:{}};const t=this.index;null!==t&&(e.data.index={type:t.array.constructor.name,array:Array.prototype.slice.call(t.array)});const i=this.attributes;for(const l in i)e.data.attributes[l]=i[l].toJSON(e.data);const r={};let s=!1;for(const l in this.morphAttributes){const u=this.morphAttributes[l],d=[];for(let f=0,p=u.length;f<p;f++)d.push(u[f].toJSON(e.data));d.length>0&&(r[l]=d,s=!0)}s&&(e.data.morphAttributes=r,e.data.morphTargetsRelative=this.morphTargetsRelative);const o=this.groups;o.length>0&&(e.data.groups=JSON.parse(JSON.stringify(o)));const a=this.boundingSphere;return null!==a&&(e.data.boundingSphere={center:a.center.toArray(),radius:a.radius}),e}clone(){return(new this.constructor).copy(this)}copy(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const t={};this.name=e.name;const i=e.index;null!==i&&this.setIndex(i.clone(t));const r=e.attributes;for(const u in r)this.setAttribute(u,r[u].clone(t));const s=e.morphAttributes;for(const u in s){const d=[],f=s[u];for(let p=0,_=f.length;p<_;p++)d.push(f[p].clone(t));this.morphAttributes[u]=d}this.morphTargetsRelative=e.morphTargetsRelative;const o=e.groups;for(let u=0,d=o.length;u<d;u++){const f=o[u];this.addGroup(f.start,f.count,f.materialIndex)}const a=e.boundingBox;null!==a&&(this.boundingBox=a.clone());const l=e.boundingSphere;return null!==l&&(this.boundingSphere=l.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}}const kC=new Wt,$a=new Fh,Ep=new gs,UC=new q,kc=new q,Uc=new q,zc=new q,By=new q,Tp=new q,Cp=new Be,Dp=new Be,Ip=new Be,zC=new q,HC=new q,GC=new q,Rp=new q,Pp=new q;class Gn extends vi{constructor(e=new hn,t=new Xr){super(),this.isMesh=!0,this.type="Mesh",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),void 0!==e.morphTargetInfluences&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),void 0!==e.morphTargetDictionary&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=e.material,this.geometry=e.geometry,this}updateMorphTargets(){const t=this.geometry.morphAttributes,i=Object.keys(t);if(i.length>0){const r=t[i[0]];if(void 0!==r){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let s=0,o=r.length;s<o;s++){const a=r[s].name||String(s);this.morphTargetInfluences.push(0),this.morphTargetDictionary[a]=s}}}}getVertexPosition(e,t){const i=this.geometry,s=i.morphAttributes.position,o=i.morphTargetsRelative;t.fromBufferAttribute(i.attributes.position,e);const a=this.morphTargetInfluences;if(s&&a){Tp.set(0,0,0);for(let l=0,u=s.length;l<u;l++){const d=a[l];0!==d&&(By.fromBufferAttribute(s[l],e),Tp.addScaledVector(o?By:By.sub(t),d))}t.add(Tp)}return t}raycast(e,t){const i=this.geometry,s=this.matrixWorld;void 0!==this.material&&(null===i.boundingSphere&&i.computeBoundingSphere(),Ep.copy(i.boundingSphere),Ep.applyMatrix4(s),$a.copy(e.ray).recast(e.near),(!1!==Ep.containsPoint($a.origin)||!(null===$a.intersectSphere(Ep,UC)||$a.origin.distanceToSquared(UC)>(e.far-e.near)**2))&&(kC.copy(s).invert(),$a.copy(e.ray).applyMatrix4(kC),(null===i.boundingBox||!1!==$a.intersectsBox(i.boundingBox))&&this._computeIntersections(e,t,$a)))}_computeIntersections(e,t,i){let r;const s=this.geometry,o=this.material,a=s.index,l=s.attributes.position,u=s.attributes.uv,d=s.attributes.uv1,f=s.attributes.normal,p=s.groups,_=s.drawRange;if(null!==a)if(Array.isArray(o))for(let y=0,w=p.length;y<w;y++){const A=p[y],b=o[A.materialIndex];for(let I=Math.max(A.start,_.start),N=Math.min(a.count,Math.min(A.start+A.count,_.start+_.count));I<N;I+=3)r=Lp(this,b,e,i,u,d,f,a.getX(I),a.getX(I+1),a.getX(I+2)),r&&(r.faceIndex=Math.floor(I/3),r.face.materialIndex=A.materialIndex,t.push(r))}else for(let A=Math.max(0,_.start),b=Math.min(a.count,_.start+_.count);A<b;A+=3)r=Lp(this,o,e,i,u,d,f,a.getX(A),a.getX(A+1),a.getX(A+2)),r&&(r.faceIndex=Math.floor(A/3),t.push(r));else if(void 0!==l)if(Array.isArray(o))for(let y=0,w=p.length;y<w;y++){const A=p[y],b=o[A.materialIndex];for(let I=Math.max(A.start,_.start),N=Math.min(l.count,Math.min(A.start+A.count,_.start+_.count));I<N;I+=3)r=Lp(this,b,e,i,u,d,f,I,I+1,I+2),r&&(r.faceIndex=Math.floor(I/3),r.face.materialIndex=A.materialIndex,t.push(r))}else for(let A=Math.max(0,_.start),b=Math.min(l.count,_.start+_.count);A<b;A+=3)r=Lp(this,o,e,i,u,d,f,A,A+1,A+2),r&&(r.faceIndex=Math.floor(A/3),t.push(r))}}function Lp(n,e,t,i,r,s,o,a,l,u){n.getVertexPosition(a,kc),n.getVertexPosition(l,Uc),n.getVertexPosition(u,zc);const d=function Ez(n,e,t,i,r,s,o,a){let l;if(l=1===e.side?i.intersectTriangle(o,s,r,!0,a):i.intersectTriangle(r,s,o,0===e.side,a),null===l)return null;Pp.copy(a),Pp.applyMatrix4(n.matrixWorld);const u=t.ray.origin.distanceTo(Pp);return u<t.near||u>t.far?null:{distance:u,point:Pp.clone(),object:n}}(n,e,t,i,kc,Uc,zc,Rp);if(d){r&&(Cp.fromBufferAttribute(r,a),Dp.fromBufferAttribute(r,l),Ip.fromBufferAttribute(r,u),d.uv=Lr.getInterpolation(Rp,kc,Uc,zc,Cp,Dp,Ip,new Be)),s&&(Cp.fromBufferAttribute(s,a),Dp.fromBufferAttribute(s,l),Ip.fromBufferAttribute(s,u),d.uv1=Lr.getInterpolation(Rp,kc,Uc,zc,Cp,Dp,Ip,new Be),d.uv2=d.uv1),o&&(zC.fromBufferAttribute(o,a),HC.fromBufferAttribute(o,l),GC.fromBufferAttribute(o,u),d.normal=Lr.getInterpolation(Rp,kc,Uc,zc,zC,HC,GC,new q),d.normal.dot(i.direction)>0&&d.normal.multiplyScalar(-1));const f={a,b:l,c:u,normal:new q,materialIndex:0};Lr.getNormal(kc,Uc,zc,f.normal),d.face=f}return d}class Xa extends hn{constructor(e=1,t=1,i=1,r=1,s=1,o=1){super(),this.type="BoxGeometry",this.parameters={width:e,height:t,depth:i,widthSegments:r,heightSegments:s,depthSegments:o};const a=this;r=Math.floor(r),s=Math.floor(s),o=Math.floor(o);const l=[],u=[],d=[],f=[];let p=0,_=0;function y(w,A,b,C,T,I,N,k,G,K,L){const H=I/G,me=N/K,Te=I/2,le=N/2,ue=k/2,_e=G+1,Le=K+1;let Se=0,De=0;const Fe=new q;for(let Ve=0;Ve<Le;Ve++){const he=Ve*me-le;for(let Ce=0;Ce<_e;Ce++)Fe[w]=(Ce*H-Te)*C,Fe[A]=he*T,Fe[b]=ue,u.push(Fe.x,Fe.y,Fe.z),Fe[w]=0,Fe[A]=0,Fe[b]=k>0?1:-1,d.push(Fe.x,Fe.y,Fe.z),f.push(Ce/G),f.push(1-Ve/K),Se+=1}for(let Ve=0;Ve<K;Ve++)for(let he=0;he<G;he++){const Ye=p+he+_e*(Ve+1),tt=p+(he+1)+_e*(Ve+1),it=p+(he+1)+_e*Ve;l.push(p+he+_e*Ve,Ye,it),l.push(Ye,tt,it),De+=6}a.addGroup(_,De,L),_+=De,p+=Se}y("z","y","x",-1,-1,i,t,e,o,s,0),y("z","y","x",1,-1,i,t,-e,o,s,1),y("x","z","y",1,1,e,i,t,r,o,2),y("x","z","y",1,-1,e,i,-t,r,o,3),y("x","y","z",1,-1,e,t,i,r,s,4),y("x","y","z",-1,-1,e,t,-i,r,s,5),this.setIndex(l),this.setAttribute("position",new ht(u,3)),this.setAttribute("normal",new ht(d,3)),this.setAttribute("uv",new ht(f,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Xa(e.width,e.height,e.depth,e.widthSegments,e.heightSegments,e.depthSegments)}}function Hc(n){const e={};for(const t in n){e[t]={};for(const i in n[t]){const r=n[t][i];r&&(r.isColor||r.isMatrix3||r.isMatrix4||r.isVector2||r.isVector3||r.isVector4||r.isTexture||r.isQuaternion)?r.isRenderTargetTexture?(console.warn("UniformsUtils: Textures of render targets cannot be cloned via cloneUniforms() or mergeUniforms()."),e[t][i]=null):e[t][i]=r.clone():e[t][i]=Array.isArray(r)?r.slice():r}}return e}function nr(n){const e={};for(let t=0;t<n.length;t++){const i=Hc(n[t]);for(const r in i)e[r]=i[r]}return e}function WC(n){return null===n.getRenderTarget()?n.outputColorSpace:zs}const Fy={clone:Hc,merge:nr};class Zr extends $r{constructor(e){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader="void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",this.fragmentShader="void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}",this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.forceSinglePass=!0,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv1:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,void 0!==e&&this.setValues(e)}copy(e){return super.copy(e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=Hc(e.uniforms),this.uniformsGroups=function Tz(n){const e=[];for(let t=0;t<n.length;t++)e.push(n[t].clone());return e}(e.uniformsGroups),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.fog=e.fog,this.lights=e.lights,this.clipping=e.clipping,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this}toJSON(e){const t=super.toJSON(e);t.glslVersion=this.glslVersion,t.uniforms={};for(const r in this.uniforms){const o=this.uniforms[r].value;t.uniforms[r]=o&&o.isTexture?{type:"t",value:o.toJSON(e).uuid}:o&&o.isColor?{type:"c",value:o.getHex()}:o&&o.isVector2?{type:"v2",value:o.toArray()}:o&&o.isVector3?{type:"v3",value:o.toArray()}:o&&o.isVector4?{type:"v4",value:o.toArray()}:o&&o.isMatrix3?{type:"m3",value:o.toArray()}:o&&o.isMatrix4?{type:"m4",value:o.toArray()}:{value:o}}Object.keys(this.defines).length>0&&(t.defines=this.defines),t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader,t.lights=this.lights,t.clipping=this.clipping;const i={};for(const r in this.extensions)!0===this.extensions[r]&&(i[r]=!0);return Object.keys(i).length>0&&(t.extensions=i),t}}class Oy extends vi{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new Wt,this.projectionMatrix=new Wt,this.projectionMatrixInverse=new Wt,this.coordinateSystem=vo}copy(e,t){return super.copy(e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this.coordinateSystem=e.coordinateSystem,this}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return e.set(-t[8],-t[9],-t[10]).normalize()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,t){super.updateWorldMatrix(e,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return(new this.constructor).copy(this)}}class Fi extends Oy{constructor(e=50,t=1,i=.1,r=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=e,this.zoom=1,this.near=i,this.far=r,this.focus=10,this.aspect=t,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=null===e.view?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this}setFocalLength(e){const t=.5*this.getFilmHeight()/e;this.fov=2*Sc*Math.atan(t),this.updateProjectionMatrix()}getFocalLength(){const e=Math.tan(.5*Ga*this.fov);return.5*this.getFilmHeight()/e}getEffectiveFOV(){return 2*Sc*Math.atan(Math.tan(.5*Ga*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}setViewOffset(e,t,i,r,s,o){this.aspect=e/t,null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=i,this.view.offsetY=r,this.view.width=s,this.view.height=o,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=this.near;let t=e*Math.tan(.5*Ga*this.fov)/this.zoom,i=2*t,r=this.aspect*i,s=-.5*r;const o=this.view;if(null!==this.view&&this.view.enabled){const l=o.fullWidth,u=o.fullHeight;s+=o.offsetX*r/l,t-=o.offsetY*i/u,r*=o.width/l,i*=o.height/u}const a=this.filmOffset;0!==a&&(s+=e*a/this.getFilmWidth()),this.projectionMatrix.makePerspective(s,s+r,t,t-i,e,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,null!==this.view&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}}class Iz extends vi{constructor(e,t,i){super(),this.type="CubeCamera",this.renderTarget=i,this.coordinateSystem=null;const r=new Fi(-90,1,e,t);r.layers=this.layers,this.add(r);const s=new Fi(-90,1,e,t);s.layers=this.layers,this.add(s);const o=new Fi(-90,1,e,t);o.layers=this.layers,this.add(o);const a=new Fi(-90,1,e,t);a.layers=this.layers,this.add(a);const l=new Fi(-90,1,e,t);l.layers=this.layers,this.add(l);const u=new Fi(-90,1,e,t);u.layers=this.layers,this.add(u)}updateCoordinateSystem(){const e=this.coordinateSystem,t=this.children.concat(),[i,r,s,o,a,l]=t;for(const u of t)this.remove(u);if(e===vo)i.up.set(0,1,0),i.lookAt(1,0,0),r.up.set(0,1,0),r.lookAt(-1,0,0),s.up.set(0,0,-1),s.lookAt(0,1,0),o.up.set(0,0,1),o.lookAt(0,-1,0),a.up.set(0,1,0),a.lookAt(0,0,1),l.up.set(0,1,0),l.lookAt(0,0,-1);else{if(2001!==e)throw new Error("THREE.CubeCamera.updateCoordinateSystem(): Invalid coordinate system: "+e);i.up.set(0,-1,0),i.lookAt(-1,0,0),r.up.set(0,-1,0),r.lookAt(1,0,0),s.up.set(0,0,1),s.lookAt(0,1,0),o.up.set(0,0,-1),o.lookAt(0,-1,0),a.up.set(0,-1,0),a.lookAt(0,0,1),l.up.set(0,-1,0),l.lookAt(0,0,-1)}for(const u of t)this.add(u),u.updateMatrixWorld()}update(e,t){null===this.parent&&this.updateMatrixWorld();const i=this.renderTarget;this.coordinateSystem!==e.coordinateSystem&&(this.coordinateSystem=e.coordinateSystem,this.updateCoordinateSystem());const[r,s,o,a,l,u]=this.children,d=e.getRenderTarget(),f=e.toneMapping,p=e.xr.enabled;e.toneMapping=mo,e.xr.enabled=!1;const _=i.texture.generateMipmaps;i.texture.generateMipmaps=!1,e.setRenderTarget(i,0),e.render(t,r),e.setRenderTarget(i,1),e.render(t,s),e.setRenderTarget(i,2),e.render(t,o),e.setRenderTarget(i,3),e.render(t,a),e.setRenderTarget(i,4),e.render(t,l),i.texture.generateMipmaps=_,e.setRenderTarget(i,5),e.render(t,u),e.setRenderTarget(d),e.toneMapping=f,e.xr.enabled=p,i.texture.needsPMREMUpdate=!0}}class Np extends _s{constructor(e,t,i,r,s,o,a,l,u,d){super(e=void 0!==e?e:[],t=void 0!==t?t:Ba,i,r,s,o,a,l,u,d),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(e){this.image=e}}class Rz extends Wa{constructor(e=1,t={}){super(e,e,t),this.isWebGLCubeRenderTarget=!0;const i={width:e,height:e,depth:1},r=[i,i,i,i,i,i];void 0!==t.encoding&&(Lh("THREE.WebGLCubeRenderTarget: option.encoding has been replaced by option.colorSpace."),t.colorSpace=t.encoding===Ua?jt:""),this.texture=new Np(r,t.mapping,t.wrapS,t.wrapT,t.magFilter,t.minFilter,t.format,t.type,t.anisotropy,t.colorSpace),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=void 0!==t.generateMipmaps&&t.generateMipmaps,this.texture.minFilter=void 0!==t.minFilter?t.minFilter:ei}fromEquirectangularTexture(e,t){this.texture.type=t.type,this.texture.colorSpace=t.colorSpace,this.texture.generateMipmaps=t.generateMipmaps,this.texture.minFilter=t.minFilter,this.texture.magFilter=t.magFilter;const i_uniforms={tEquirect:{value:null}},i_vertexShader="\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\tvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\n\t\t\t\t\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n\n\t\t\t\t}\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvWorldDirection = transformDirection( position, modelMatrix );\n\n\t\t\t\t\t#include <begin_vertex>\n\t\t\t\t\t#include <project_vertex>\n\n\t\t\t\t}\n\t\t\t",i_fragmentShader="\n\n\t\t\t\tuniform sampler2D tEquirect;\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\t#include <common>\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvec3 direction = normalize( vWorldDirection );\n\n\t\t\t\t\tvec2 sampleUV = equirectUv( direction );\n\n\t\t\t\t\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\n\t\t\t\t}\n\t\t\t",r=new Xa(5,5,5),s=new Zr({name:"CubemapFromEquirect",uniforms:Hc(i_uniforms),vertexShader:i_vertexShader,fragmentShader:i_fragmentShader,side:1,blending:0});s.uniforms.tEquirect.value=t;const o=new Gn(r,s),a=t.minFilter;return t.minFilter===_o&&(t.minFilter=ei),new Iz(1,10,this).update(e,o),t.minFilter=a,o.geometry.dispose(),o.material.dispose(),this}clear(e,t,i,r){const s=e.getRenderTarget();for(let o=0;o<6;o++)e.setRenderTarget(this,o),e.clear(t,i,r);e.setRenderTarget(s)}}const Vy=new q,Pz=new q,Lz=new un;class Ya{constructor(e=new q(1,0,0),t=0){this.isPlane=!0,this.normal=e,this.constant=t}set(e,t){return this.normal.copy(e),this.constant=t,this}setComponents(e,t,i,r){return this.normal.set(e,t,i),this.constant=r,this}setFromNormalAndCoplanarPoint(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this}setFromCoplanarPoints(e,t,i){const r=Vy.subVectors(i,t).cross(Pz.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(r,e),this}copy(e){return this.normal.copy(e.normal),this.constant=e.constant,this}normalize(){const e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(e){return this.normal.dot(e)+this.constant}distanceToSphere(e){return this.distanceToPoint(e.center)-e.radius}projectPoint(e,t){return t.copy(e).addScaledVector(this.normal,-this.distanceToPoint(e))}intersectLine(e,t){const i=e.delta(Vy),r=this.normal.dot(i);if(0===r)return 0===this.distanceToPoint(e.start)?t.copy(e.start):null;const s=-(e.start.dot(this.normal)+this.constant)/r;return s<0||s>1?null:t.copy(e.start).addScaledVector(i,s)}intersectsLine(e){const t=this.distanceToPoint(e.start),i=this.distanceToPoint(e.end);return t<0&&i>0||i<0&&t>0}intersectsBox(e){return e.intersectsPlane(this)}intersectsSphere(e){return e.intersectsPlane(this)}coplanarPoint(e){return e.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(e,t){const i=t||Lz.getNormalMatrix(e),r=this.coplanarPoint(Vy).applyMatrix4(e),s=this.normal.applyMatrix3(i).normalize();return this.constant=-r.dot(s),this}translate(e){return this.constant-=e.dot(this.normal),this}equals(e){return e.normal.equals(this.normal)&&e.constant===this.constant}clone(){return(new this.constructor).copy(this)}}const Za=new gs,Bp=new q;class ky{constructor(e=new Ya,t=new Ya,i=new Ya,r=new Ya,s=new Ya,o=new Ya){this.planes=[e,t,i,r,s,o]}set(e,t,i,r,s,o){const a=this.planes;return a[0].copy(e),a[1].copy(t),a[2].copy(i),a[3].copy(r),a[4].copy(s),a[5].copy(o),this}copy(e){const t=this.planes;for(let i=0;i<6;i++)t[i].copy(e.planes[i]);return this}setFromProjectionMatrix(e,t=vo){const i=this.planes,r=e.elements,s=r[0],o=r[1],a=r[2],l=r[3],u=r[4],d=r[5],f=r[6],p=r[7],_=r[8],y=r[9],w=r[10],A=r[11],b=r[12],C=r[13],T=r[14],I=r[15];if(i[0].setComponents(l-s,p-u,A-_,I-b).normalize(),i[1].setComponents(l+s,p+u,A+_,I+b).normalize(),i[2].setComponents(l+o,p+d,A+y,I+C).normalize(),i[3].setComponents(l-o,p-d,A-y,I-C).normalize(),i[4].setComponents(l-a,p-f,A-w,I-T).normalize(),t===vo)i[5].setComponents(l+a,p+f,A+w,I+T).normalize();else{if(2001!==t)throw new Error("THREE.Frustum.setFromProjectionMatrix(): Invalid coordinate system: "+t);i[5].setComponents(a,f,w,T).normalize()}return this}intersectsObject(e){if(void 0!==e.boundingSphere)null===e.boundingSphere&&e.computeBoundingSphere(),Za.copy(e.boundingSphere).applyMatrix4(e.matrixWorld);else{const t=e.geometry;null===t.boundingSphere&&t.computeBoundingSphere(),Za.copy(t.boundingSphere).applyMatrix4(e.matrixWorld)}return this.intersectsSphere(Za)}intersectsSprite(e){return Za.center.set(0,0,0),Za.radius=.7071067811865476,Za.applyMatrix4(e.matrixWorld),this.intersectsSphere(Za)}intersectsSphere(e){const t=this.planes,i=e.center,r=-e.radius;for(let s=0;s<6;s++)if(t[s].distanceToPoint(i)<r)return!1;return!0}intersectsBox(e){const t=this.planes;for(let i=0;i<6;i++){const r=t[i];if(Bp.x=r.normal.x>0?e.max.x:e.min.x,Bp.y=r.normal.y>0?e.max.y:e.min.y,Bp.z=r.normal.z>0?e.max.z:e.min.z,r.distanceToPoint(Bp)<0)return!1}return!0}containsPoint(e){const t=this.planes;for(let i=0;i<6;i++)if(t[i].distanceToPoint(e)<0)return!1;return!0}clone(){return(new this.constructor).copy(this)}}function qC(){let n=null,e=!1,t=null,i=null;function r(s,o){t(s,o),i=n.requestAnimationFrame(r)}return{start:function(){!0!==e&&null!==t&&(i=n.requestAnimationFrame(r),e=!0)},stop:function(){n.cancelAnimationFrame(i),e=!1},setAnimationLoop:function(s){t=s},setContext:function(s){n=s}}}function Nz(n,e){const t=e.isWebGL2,i=new WeakMap;return{get:function o(u){return u.isInterleavedBufferAttribute&&(u=u.data),i.get(u)},remove:function a(u){u.isInterleavedBufferAttribute&&(u=u.data);const d=i.get(u);d&&(n.deleteBuffer(d.buffer),i.delete(u))},update:function l(u,d){if(u.isGLBufferAttribute){const p=i.get(u);return void((!p||p.version<u.version)&&i.set(u,{buffer:u.buffer,type:u.type,bytesPerElement:u.elementSize,version:u.version}))}u.isInterleavedBufferAttribute&&(u=u.data);const f=i.get(u);void 0===f?i.set(u,function r(u,d){const f=u.array,p=u.usage,_=n.createBuffer();let y;if(n.bindBuffer(d,_),n.bufferData(d,f,p),u.onUploadCallback(),f instanceof Float32Array)y=n.FLOAT;else if(f instanceof Uint16Array)if(u.isFloat16BufferAttribute){if(!t)throw new Error("THREE.WebGLAttributes: Usage of Float16BufferAttribute requires WebGL2.");y=n.HALF_FLOAT}else y=n.UNSIGNED_SHORT;else if(f instanceof Int16Array)y=n.SHORT;else if(f instanceof Uint32Array)y=n.UNSIGNED_INT;else if(f instanceof Int32Array)y=n.INT;else if(f instanceof Int8Array)y=n.BYTE;else if(f instanceof Uint8Array)y=n.UNSIGNED_BYTE;else{if(!(f instanceof Uint8ClampedArray))throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+f);y=n.UNSIGNED_BYTE}return{buffer:_,type:y,bytesPerElement:f.BYTES_PER_ELEMENT,version:u.version}}(u,d)):f.version<u.version&&(function s(u,d,f){const p=d.array,_=d.updateRange;n.bindBuffer(f,u),-1===_.count?n.bufferSubData(f,0,p):(t?n.bufferSubData(f,_.offset*p.BYTES_PER_ELEMENT,p,_.offset,_.count):n.bufferSubData(f,_.offset*p.BYTES_PER_ELEMENT,p.subarray(_.offset,_.offset+_.count)),_.count=-1),d.onUploadCallback()}(f.buffer,u,d),f.version=u.version)}}}class Ja extends hn{constructor(e=1,t=1,i=1,r=1){super(),this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:i,heightSegments:r};const s=e/2,o=t/2,a=Math.floor(i),l=Math.floor(r),u=a+1,d=l+1,f=e/a,p=t/l,_=[],y=[],w=[],A=[];for(let b=0;b<d;b++){const C=b*p-o;for(let T=0;T<u;T++)y.push(T*f-s,-C,0),w.push(0,0,1),A.push(T/a),A.push(1-b/l)}for(let b=0;b<l;b++)for(let C=0;C<a;C++){const I=C+u*(b+1),N=C+1+u*(b+1),k=C+1+u*b;_.push(C+u*b,I,k),_.push(I,N,k)}this.setIndex(_),this.setAttribute("position",new ht(y,3)),this.setAttribute("normal",new ht(w,3)),this.setAttribute("uv",new ht(A,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Ja(e.width,e.height,e.widthSegments,e.heightSegments)}}const rn={alphahash_fragment:"#ifdef USE_ALPHAHASH\n\tif ( diffuseColor.a < getAlphaHashThreshold( vPosition ) ) discard;\n#endif",alphahash_pars_fragment:"#ifdef USE_ALPHAHASH\n\tconst float ALPHA_HASH_SCALE = 0.05;\n\tfloat hash2D( vec2 value ) {\n\t\treturn fract( 1.0e4 * sin( 17.0 * value.x + 0.1 * value.y ) * ( 0.1 + abs( sin( 13.0 * value.y + value.x ) ) ) );\n\t}\n\tfloat hash3D( vec3 value ) {\n\t\treturn hash2D( vec2( hash2D( value.xy ), value.z ) );\n\t}\n\tfloat getAlphaHashThreshold( vec3 position ) {\n\t\tfloat maxDeriv = max(\n\t\t\tlength( dFdx( position.xyz ) ),\n\t\t\tlength( dFdy( position.xyz ) )\n\t\t);\n\t\tfloat pixScale = 1.0 / ( ALPHA_HASH_SCALE * maxDeriv );\n\t\tvec2 pixScales = vec2(\n\t\t\texp2( floor( log2( pixScale ) ) ),\n\t\t\texp2( ceil( log2( pixScale ) ) )\n\t\t);\n\t\tvec2 alpha = vec2(\n\t\t\thash3D( floor( pixScales.x * position.xyz ) ),\n\t\t\thash3D( floor( pixScales.y * position.xyz ) )\n\t\t);\n\t\tfloat lerpFactor = fract( log2( pixScale ) );\n\t\tfloat x = ( 1.0 - lerpFactor ) * alpha.x + lerpFactor * alpha.y;\n\t\tfloat a = min( lerpFactor, 1.0 - lerpFactor );\n\t\tvec3 cases = vec3(\n\t\t\tx * x / ( 2.0 * a * ( 1.0 - a ) ),\n\t\t\t( x - 0.5 * a ) / ( 1.0 - a ),\n\t\t\t1.0 - ( ( 1.0 - x ) * ( 1.0 - x ) / ( 2.0 * a * ( 1.0 - a ) ) )\n\t\t);\n\t\tfloat threshold = ( x < ( 1.0 - a ) )\n\t\t\t? ( ( x < a ) ? cases.x : cases.y )\n\t\t\t: cases.z;\n\t\treturn clamp( threshold , 1.0e-6, 1.0 );\n\t}\n#endif",alphamap_fragment:"#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, vAlphaMapUv ).g;\n#endif",alphamap_pars_fragment:"#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",alphatest_fragment:"#ifdef USE_ALPHATEST\n\tif ( diffuseColor.a < alphaTest ) discard;\n#endif",alphatest_pars_fragment:"#ifdef USE_ALPHATEST\n\tuniform float alphaTest;\n#endif",aomap_fragment:"#ifdef USE_AOMAP\n\tfloat ambientOcclusion = ( texture2D( aoMap, vAoMapUv ).r - 1.0 ) * aoMapIntensity + 1.0;\n\treflectedLight.indirectDiffuse *= ambientOcclusion;\n\t#if defined( USE_ENVMAP ) && defined( STANDARD )\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );\n\t#endif\n#endif",aomap_pars_fragment:"#ifdef USE_AOMAP\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n#endif",begin_vertex:"vec3 transformed = vec3( position );\n#ifdef USE_ALPHAHASH\n\tvPosition = vec3( position );\n#endif",beginnormal_vertex:"vec3 objectNormal = vec3( normal );\n#ifdef USE_TANGENT\n\tvec3 objectTangent = vec3( tangent.xyz );\n#endif",bsdfs:"float G_BlinnPhong_Implicit( ) {\n\treturn 0.25;\n}\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n}\nvec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, 1.0, dotVH );\n\tfloat G = G_BlinnPhong_Implicit( );\n\tfloat D = D_BlinnPhong( shininess, dotNH );\n\treturn F * ( G * D );\n} // validated",iridescence_fragment:"#ifdef USE_IRIDESCENCE\n\tconst mat3 XYZ_TO_REC709 = mat3(\n\t\t 3.2404542, -0.9692660,  0.0556434,\n\t\t-1.5371385,  1.8760108, -0.2040259,\n\t\t-0.4985314,  0.0415560,  1.0572252\n\t);\n\tvec3 Fresnel0ToIor( vec3 fresnel0 ) {\n\t\tvec3 sqrtF0 = sqrt( fresnel0 );\n\t\treturn ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );\n\t}\n\tvec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {\n\t\treturn pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );\n\t}\n\tfloat IorToFresnel0( float transmittedIor, float incidentIor ) {\n\t\treturn pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));\n\t}\n\tvec3 evalSensitivity( float OPD, vec3 shift ) {\n\t\tfloat phase = 2.0 * PI * OPD * 1.0e-9;\n\t\tvec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );\n\t\tvec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );\n\t\tvec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );\n\t\tvec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );\n\t\txyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );\n\t\txyz /= 1.0685e-7;\n\t\tvec3 rgb = XYZ_TO_REC709 * xyz;\n\t\treturn rgb;\n\t}\n\tvec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {\n\t\tvec3 I;\n\t\tfloat iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );\n\t\tfloat sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );\n\t\tfloat cosTheta2Sq = 1.0 - sinTheta2Sq;\n\t\tif ( cosTheta2Sq < 0.0 ) {\n\t\t\t return vec3( 1.0 );\n\t\t}\n\t\tfloat cosTheta2 = sqrt( cosTheta2Sq );\n\t\tfloat R0 = IorToFresnel0( iridescenceIOR, outsideIOR );\n\t\tfloat R12 = F_Schlick( R0, 1.0, cosTheta1 );\n\t\tfloat R21 = R12;\n\t\tfloat T121 = 1.0 - R12;\n\t\tfloat phi12 = 0.0;\n\t\tif ( iridescenceIOR < outsideIOR ) phi12 = PI;\n\t\tfloat phi21 = PI - phi12;\n\t\tvec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );\t\tvec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );\n\t\tvec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );\n\t\tvec3 phi23 = vec3( 0.0 );\n\t\tif ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;\n\t\tif ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;\n\t\tif ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;\n\t\tfloat OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;\n\t\tvec3 phi = vec3( phi21 ) + phi23;\n\t\tvec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );\n\t\tvec3 r123 = sqrt( R123 );\n\t\tvec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );\n\t\tvec3 C0 = R12 + Rs;\n\t\tI = C0;\n\t\tvec3 Cm = Rs - T121;\n\t\tfor ( int m = 1; m <= 2; ++ m ) {\n\t\t\tCm *= r123;\n\t\t\tvec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );\n\t\t\tI += Cm * Sm;\n\t\t}\n\t\treturn max( I, vec3( 0.0 ) );\n\t}\n#endif",bumpmap_pars_fragment:"#ifdef USE_BUMPMAP\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\tvec2 dHdxy_fwd() {\n\t\tvec2 dSTdx = dFdx( vBumpMapUv );\n\t\tvec2 dSTdy = dFdy( vBumpMapUv );\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vBumpMapUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdy ).x - Hll;\n\t\treturn vec2( dBx, dBy );\n\t}\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {\n\t\tvec3 vSigmaX = dFdx( surf_pos.xyz );\n\t\tvec3 vSigmaY = dFdy( surf_pos.xyz );\n\t\tvec3 vN = surf_norm;\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\t\tfloat fDet = dot( vSigmaX, R1 ) * faceDirection;\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\t}\n#endif",clipping_planes_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvec4 plane;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n\t\tplane = clippingPlanes[ i ];\n\t\tif ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;\n\t}\n\t#pragma unroll_loop_end\n\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\tbool clipped = true;\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n\t\t\tplane = clippingPlanes[ i ];\n\t\t\tclipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t\tif ( clipped ) discard;\n\t#endif\n#endif",clipping_planes_pars_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n#endif",clipping_planes_pars_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n#endif",clipping_planes_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvClipPosition = - mvPosition.xyz;\n#endif",color_fragment:"#if defined( USE_COLOR_ALPHA )\n\tdiffuseColor *= vColor;\n#elif defined( USE_COLOR )\n\tdiffuseColor.rgb *= vColor;\n#endif",color_pars_fragment:"#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR )\n\tvarying vec3 vColor;\n#endif",color_pars_vertex:"#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvarying vec3 vColor;\n#endif",color_vertex:"#if defined( USE_COLOR_ALPHA )\n\tvColor = vec4( 1.0 );\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvColor = vec3( 1.0 );\n#endif\n#ifdef USE_COLOR\n\tvColor *= color;\n#endif\n#ifdef USE_INSTANCING_COLOR\n\tvColor.xyz *= instanceColor.xyz;\n#endif",common:"#define PI 3.141592653589793\n#define PI2 6.283185307179586\n#define PI_HALF 1.5707963267948966\n#define RECIPROCAL_PI 0.3183098861837907\n#define RECIPROCAL_PI2 0.15915494309189535\n#define EPSILON 1e-6\n#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\n#define whiteComplement( a ) ( 1.0 - saturate( a ) )\nfloat pow2( const in float x ) { return x*x; }\nvec3 pow2( const in vec3 x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }\nfloat average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }\nhighp float rand( const in vec2 uv ) {\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\treturn fract( sin( sn ) * c );\n}\n#ifdef HIGH_PRECISION\n\tfloat precisionSafeLength( vec3 v ) { return length( v ); }\n#else\n\tfloat precisionSafeLength( vec3 v ) {\n\t\tfloat maxComponent = max3( abs( v ) );\n\t\treturn length( v / maxComponent ) * maxComponent;\n\t}\n#endif\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\nstruct GeometricContext {\n\tvec3 position;\n\tvec3 normal;\n\tvec3 viewDir;\n#ifdef USE_CLEARCOAT\n\tvec3 clearcoatNormal;\n#endif\n};\n#ifdef USE_ALPHAHASH\n\tvarying vec3 vPosition;\n#endif\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n}\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n}\nmat3 transposeMat3( const in mat3 m ) {\n\tmat3 tmp;\n\ttmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );\n\ttmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );\n\ttmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );\n\treturn tmp;\n}\nfloat luminance( const in vec3 rgb ) {\n\tconst vec3 weights = vec3( 0.2126729, 0.7151522, 0.0721750 );\n\treturn dot( weights, rgb );\n}\nbool isPerspectiveMatrix( mat4 m ) {\n\treturn m[ 2 ][ 3 ] == - 1.0;\n}\nvec2 equirectUv( in vec3 dir ) {\n\tfloat u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;\n\tfloat v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\treturn vec2( u, v );\n}\nvec3 BRDF_Lambert( const in vec3 diffuseColor ) {\n\treturn RECIPROCAL_PI * diffuseColor;\n}\nvec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {\n\tfloat fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );\n\treturn f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );\n}\nfloat F_Schlick( const in float f0, const in float f90, const in float dotVH ) {\n\tfloat fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );\n\treturn f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );\n} // validated",cube_uv_reflection_fragment:"#ifdef ENVMAP_TYPE_CUBE_UV\n\t#define cubeUV_minMipLevel 4.0\n\t#define cubeUV_minTileSize 16.0\n\tfloat getFace( vec3 direction ) {\n\t\tvec3 absDirection = abs( direction );\n\t\tfloat face = - 1.0;\n\t\tif ( absDirection.x > absDirection.z ) {\n\t\t\tif ( absDirection.x > absDirection.y )\n\t\t\t\tface = direction.x > 0.0 ? 0.0 : 3.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t} else {\n\t\t\tif ( absDirection.z > absDirection.y )\n\t\t\t\tface = direction.z > 0.0 ? 2.0 : 5.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t}\n\t\treturn face;\n\t}\n\tvec2 getUV( vec3 direction, float face ) {\n\t\tvec2 uv;\n\t\tif ( face == 0.0 ) {\n\t\t\tuv = vec2( direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 1.0 ) {\n\t\t\tuv = vec2( - direction.x, - direction.z ) / abs( direction.y );\n\t\t} else if ( face == 2.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.y ) / abs( direction.z );\n\t\t} else if ( face == 3.0 ) {\n\t\t\tuv = vec2( - direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 4.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.z ) / abs( direction.y );\n\t\t} else {\n\t\t\tuv = vec2( direction.x, direction.y ) / abs( direction.z );\n\t\t}\n\t\treturn 0.5 * ( uv + 1.0 );\n\t}\n\tvec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {\n\t\tfloat face = getFace( direction );\n\t\tfloat filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );\n\t\tmipInt = max( mipInt, cubeUV_minMipLevel );\n\t\tfloat faceSize = exp2( mipInt );\n\t\thighp vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;\n\t\tif ( face > 2.0 ) {\n\t\t\tuv.y += faceSize;\n\t\t\tface -= 3.0;\n\t\t}\n\t\tuv.x += face * faceSize;\n\t\tuv.x += filterInt * 3.0 * cubeUV_minTileSize;\n\t\tuv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );\n\t\tuv.x *= CUBEUV_TEXEL_WIDTH;\n\t\tuv.y *= CUBEUV_TEXEL_HEIGHT;\n\t\t#ifdef texture2DGradEXT\n\t\t\treturn texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;\n\t\t#else\n\t\t\treturn texture2D( envMap, uv ).rgb;\n\t\t#endif\n\t}\n\t#define cubeUV_r0 1.0\n\t#define cubeUV_v0 0.339\n\t#define cubeUV_m0 - 2.0\n\t#define cubeUV_r1 0.8\n\t#define cubeUV_v1 0.276\n\t#define cubeUV_m1 - 1.0\n\t#define cubeUV_r4 0.4\n\t#define cubeUV_v4 0.046\n\t#define cubeUV_m4 2.0\n\t#define cubeUV_r5 0.305\n\t#define cubeUV_v5 0.016\n\t#define cubeUV_m5 3.0\n\t#define cubeUV_r6 0.21\n\t#define cubeUV_v6 0.0038\n\t#define cubeUV_m6 4.0\n\tfloat roughnessToMip( float roughness ) {\n\t\tfloat mip = 0.0;\n\t\tif ( roughness >= cubeUV_r1 ) {\n\t\t\tmip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;\n\t\t} else if ( roughness >= cubeUV_r4 ) {\n\t\t\tmip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;\n\t\t} else if ( roughness >= cubeUV_r5 ) {\n\t\t\tmip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;\n\t\t} else if ( roughness >= cubeUV_r6 ) {\n\t\t\tmip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;\n\t\t} else {\n\t\t\tmip = - 2.0 * log2( 1.16 * roughness );\t\t}\n\t\treturn mip;\n\t}\n\tvec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {\n\t\tfloat mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );\n\t\tfloat mipF = fract( mip );\n\t\tfloat mipInt = floor( mip );\n\t\tvec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );\n\t\tif ( mipF == 0.0 ) {\n\t\t\treturn vec4( color0, 1.0 );\n\t\t} else {\n\t\t\tvec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );\n\t\t\treturn vec4( mix( color0, color1, mipF ), 1.0 );\n\t\t}\n\t}\n#endif",defaultnormal_vertex:"vec3 transformedNormal = objectNormal;\n#ifdef USE_INSTANCING\n\tmat3 m = mat3( instanceMatrix );\n\ttransformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );\n\ttransformedNormal = m * transformedNormal;\n#endif\ntransformedNormal = normalMatrix * transformedNormal;\n#ifdef FLIP_SIDED\n\ttransformedNormal = - transformedNormal;\n#endif\n#ifdef USE_TANGENT\n\tvec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#ifdef FLIP_SIDED\n\t\ttransformedTangent = - transformedTangent;\n\t#endif\n#endif",displacementmap_pars_vertex:"#ifdef USE_DISPLACEMENTMAP\n\tuniform sampler2D displacementMap;\n\tuniform float displacementScale;\n\tuniform float displacementBias;\n#endif",displacementmap_vertex:"#ifdef USE_DISPLACEMENTMAP\n\ttransformed += normalize( objectNormal ) * ( texture2D( displacementMap, vDisplacementMapUv ).x * displacementScale + displacementBias );\n#endif",emissivemap_fragment:"#ifdef USE_EMISSIVEMAP\n\tvec4 emissiveColor = texture2D( emissiveMap, vEmissiveMapUv );\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\n#endif",emissivemap_pars_fragment:"#ifdef USE_EMISSIVEMAP\n\tuniform sampler2D emissiveMap;\n#endif",colorspace_fragment:"gl_FragColor = linearToOutputTexel( gl_FragColor );",colorspace_pars_fragment:"vec4 LinearToLinear( in vec4 value ) {\n\treturn value;\n}\nvec4 LinearTosRGB( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );\n}",envmap_fragment:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvec3 cameraToFrag;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToFrag = normalize( vWorldPosition - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( cameraToFrag, worldNormal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );\n\t\t#endif\n\t#else\n\t\tvec3 reflectVec = vReflect;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\t#else\n\t\tvec4 envColor = vec4( 0.0 );\n\t#endif\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\t#endif\n#endif",envmap_common_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float envMapIntensity;\n\tuniform float flipEnvMap;\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\t\n#endif",envmap_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float reflectivity;\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\tvarying vec3 vWorldPosition;\n\t\tuniform float refractionRatio;\n\t#else\n\t\tvarying vec3 vReflect;\n\t#endif\n#endif",envmap_pars_vertex:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\t\n\t\tvarying vec3 vWorldPosition;\n\t#else\n\t\tvarying vec3 vReflect;\n\t\tuniform float refractionRatio;\n\t#endif\n#endif",envmap_physical_pars_fragment:"#ifdef USE_ENVMAP\n\tvec3 getIBLIrradiance( const in vec3 normal ) {\n\t\t#ifdef ENVMAP_TYPE_CUBE_UV\n\t\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );\n\t\t\treturn PI * envMapColor.rgb * envMapIntensity;\n\t\t#else\n\t\t\treturn vec3( 0.0 );\n\t\t#endif\n\t}\n\tvec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {\n\t\t#ifdef ENVMAP_TYPE_CUBE_UV\n\t\t\tvec3 reflectVec = reflect( - viewDir, normal );\n\t\t\treflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );\n\t\t\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );\n\t\t\treturn envMapColor.rgb * envMapIntensity;\n\t\t#else\n\t\t\treturn vec3( 0.0 );\n\t\t#endif\n\t}\n\t#ifdef USE_ANISOTROPY\n\t\tvec3 getIBLAnisotropyRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in vec3 bitangent, const in float anisotropy ) {\n\t\t\t#ifdef ENVMAP_TYPE_CUBE_UV\n\t\t\t\tvec3 bentNormal = cross( bitangent, viewDir );\n\t\t\t\tbentNormal = normalize( cross( bentNormal, bitangent ) );\n\t\t\t\tbentNormal = normalize( mix( bentNormal, normal, pow2( pow2( 1.0 - anisotropy * ( 1.0 - roughness ) ) ) ) );\n\t\t\t\treturn getIBLRadiance( viewDir, bentNormal, roughness );\n\t\t\t#else\n\t\t\t\treturn vec3( 0.0 );\n\t\t\t#endif\n\t\t}\n\t#endif\n#endif",envmap_vertex:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvWorldPosition = worldPosition.xyz;\n\t#else\n\t\tvec3 cameraToVertex;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#endif\n#endif",fog_vertex:"#ifdef USE_FOG\n\tvFogDepth = - mvPosition.z;\n#endif",fog_pars_vertex:"#ifdef USE_FOG\n\tvarying float vFogDepth;\n#endif",fog_fragment:"#ifdef USE_FOG\n\t#ifdef FOG_EXP2\n\t\tfloat fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );\n\t#else\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, vFogDepth );\n\t#endif\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n#endif",fog_pars_fragment:"#ifdef USE_FOG\n\tuniform vec3 fogColor;\n\tvarying float vFogDepth;\n\t#ifdef FOG_EXP2\n\t\tuniform float fogDensity;\n\t#else\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n#endif",gradientmap_pars_fragment:"#ifdef USE_GRADIENTMAP\n\tuniform sampler2D gradientMap;\n#endif\nvec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {\n\tfloat dotNL = dot( normal, lightDirection );\n\tvec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );\n\t#ifdef USE_GRADIENTMAP\n\t\treturn vec3( texture2D( gradientMap, coord ).r );\n\t#else\n\t\tvec2 fw = fwidth( coord ) * 0.5;\n\t\treturn mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );\n\t#endif\n}",lightmap_fragment:"#ifdef USE_LIGHTMAP\n\tvec4 lightMapTexel = texture2D( lightMap, vLightMapUv );\n\tvec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;\n\treflectedLight.indirectDiffuse += lightMapIrradiance;\n#endif",lightmap_pars_fragment:"#ifdef USE_LIGHTMAP\n\tuniform sampler2D lightMap;\n\tuniform float lightMapIntensity;\n#endif",lights_lambert_fragment:"LambertMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularStrength = specularStrength;",lights_lambert_pars_fragment:"varying vec3 vViewPosition;\nstruct LambertMaterial {\n\tvec3 diffuseColor;\n\tfloat specularStrength;\n};\nvoid RE_Direct_Lambert( const in IncidentLight directLight, const in GeometricContext geometry, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in GeometricContext geometry, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Lambert\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Lambert",lights_pars_begin:"uniform bool receiveShadow;\nuniform vec3 ambientLightColor;\nuniform vec3 lightProbe[ 9 ];\nvec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {\n\tfloat x = normal.x, y = normal.y, z = normal.z;\n\tvec3 result = shCoefficients[ 0 ] * 0.886227;\n\tresult += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;\n\tresult += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;\n\tresult += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;\n\tresult += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;\n\tresult += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;\n\tresult += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );\n\tresult += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;\n\tresult += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );\n\treturn result;\n}\nvec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {\n\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\tvec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );\n\treturn irradiance;\n}\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n\tvec3 irradiance = ambientLightColor;\n\treturn irradiance;\n}\nfloat getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n\t#if defined ( LEGACY_LIGHTS )\n\t\tif ( cutoffDistance > 0.0 && decayExponent > 0.0 ) {\n\t\t\treturn pow( saturate( - lightDistance / cutoffDistance + 1.0 ), decayExponent );\n\t\t}\n\t\treturn 1.0;\n\t#else\n\t\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n\t\tif ( cutoffDistance > 0.0 ) {\n\t\t\tdistanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n\t\t}\n\t\treturn distanceFalloff;\n\t#endif\n}\nfloat getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {\n\treturn smoothstep( coneCosine, penumbraCosine, angleCosine );\n}\n#if NUM_DIR_LIGHTS > 0\n\tstruct DirectionalLight {\n\t\tvec3 direction;\n\t\tvec3 color;\n\t};\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n\tvoid getDirectionalLightInfo( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight light ) {\n\t\tlight.color = directionalLight.color;\n\t\tlight.direction = directionalLight.direction;\n\t\tlight.visible = true;\n\t}\n#endif\n#if NUM_POINT_LIGHTS > 0\n\tstruct PointLight {\n\t\tvec3 position;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t};\n\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n\tvoid getPointLightInfo( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight light ) {\n\t\tvec3 lVector = pointLight.position - geometry.position;\n\t\tlight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tlight.color = pointLight.color;\n\t\tlight.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );\n\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tstruct SpotLight {\n\t\tvec3 position;\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tfloat coneCos;\n\t\tfloat penumbraCos;\n\t};\n\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n\tvoid getSpotLightInfo( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight light ) {\n\t\tvec3 lVector = spotLight.position - geometry.position;\n\t\tlight.direction = normalize( lVector );\n\t\tfloat angleCos = dot( light.direction, spotLight.direction );\n\t\tfloat spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n\t\tif ( spotAttenuation > 0.0 ) {\n\t\t\tfloat lightDistance = length( lVector );\n\t\t\tlight.color = spotLight.color * spotAttenuation;\n\t\t\tlight.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );\n\t\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\t\t} else {\n\t\t\tlight.color = vec3( 0.0 );\n\t\t\tlight.visible = false;\n\t\t}\n\t}\n#endif\n#if NUM_RECT_AREA_LIGHTS > 0\n\tstruct RectAreaLight {\n\t\tvec3 color;\n\t\tvec3 position;\n\t\tvec3 halfWidth;\n\t\tvec3 halfHeight;\n\t};\n\tuniform sampler2D ltc_1;\tuniform sampler2D ltc_2;\n\tuniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tstruct HemisphereLight {\n\t\tvec3 direction;\n\t\tvec3 skyColor;\n\t\tvec3 groundColor;\n\t};\n\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {\n\t\tfloat dotNL = dot( normal, hemiLight.direction );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n\t\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n\t\treturn irradiance;\n\t}\n#endif",lights_toon_fragment:"ToonMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;",lights_toon_pars_fragment:"varying vec3 vViewPosition;\nstruct ToonMaterial {\n\tvec3 diffuseColor;\n};\nvoid RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\tvec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Toon\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Toon",lights_phong_fragment:"BlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;",lights_phong_pars_fragment:"varying vec3 vViewPosition;\nstruct BlinnPhongMaterial {\n\tvec3 diffuseColor;\n\tvec3 specularColor;\n\tfloat specularShininess;\n\tfloat specularStrength;\n};\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n\treflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_BlinnPhong\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_BlinnPhong",lights_physical_fragment:"PhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\nvec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );\nfloat geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );\nmaterial.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;\nmaterial.roughness = min( material.roughness, 1.0 );\n#ifdef IOR\n\tmaterial.ior = ior;\n\t#ifdef USE_SPECULAR\n\t\tfloat specularIntensityFactor = specularIntensity;\n\t\tvec3 specularColorFactor = specularColor;\n\t\t#ifdef USE_SPECULAR_COLORMAP\n\t\t\tspecularColorFactor *= texture2D( specularColorMap, vSpecularColorMapUv ).rgb;\n\t\t#endif\n\t\t#ifdef USE_SPECULAR_INTENSITYMAP\n\t\t\tspecularIntensityFactor *= texture2D( specularIntensityMap, vSpecularIntensityMapUv ).a;\n\t\t#endif\n\t\tmaterial.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );\n\t#else\n\t\tfloat specularIntensityFactor = 1.0;\n\t\tvec3 specularColorFactor = vec3( 1.0 );\n\t\tmaterial.specularF90 = 1.0;\n\t#endif\n\tmaterial.specularColor = mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );\n#else\n\tmaterial.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );\n\tmaterial.specularF90 = 1.0;\n#endif\n#ifdef USE_CLEARCOAT\n\tmaterial.clearcoat = clearcoat;\n\tmaterial.clearcoatRoughness = clearcoatRoughness;\n\tmaterial.clearcoatF0 = vec3( 0.04 );\n\tmaterial.clearcoatF90 = 1.0;\n\t#ifdef USE_CLEARCOATMAP\n\t\tmaterial.clearcoat *= texture2D( clearcoatMap, vClearcoatMapUv ).x;\n\t#endif\n\t#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\t\tmaterial.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vClearcoatRoughnessMapUv ).y;\n\t#endif\n\tmaterial.clearcoat = saturate( material.clearcoat );\tmaterial.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );\n\tmaterial.clearcoatRoughness += geometryRoughness;\n\tmaterial.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );\n#endif\n#ifdef USE_IRIDESCENCE\n\tmaterial.iridescence = iridescence;\n\tmaterial.iridescenceIOR = iridescenceIOR;\n\t#ifdef USE_IRIDESCENCEMAP\n\t\tmaterial.iridescence *= texture2D( iridescenceMap, vIridescenceMapUv ).r;\n\t#endif\n\t#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\t\tmaterial.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vIridescenceThicknessMapUv ).g + iridescenceThicknessMinimum;\n\t#else\n\t\tmaterial.iridescenceThickness = iridescenceThicknessMaximum;\n\t#endif\n#endif\n#ifdef USE_SHEEN\n\tmaterial.sheenColor = sheenColor;\n\t#ifdef USE_SHEEN_COLORMAP\n\t\tmaterial.sheenColor *= texture2D( sheenColorMap, vSheenColorMapUv ).rgb;\n\t#endif\n\tmaterial.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );\n\t#ifdef USE_SHEEN_ROUGHNESSMAP\n\t\tmaterial.sheenRoughness *= texture2D( sheenRoughnessMap, vSheenRoughnessMapUv ).a;\n\t#endif\n#endif\n#ifdef USE_ANISOTROPY\n\t#ifdef USE_ANISOTROPYMAP\n\t\tmat2 anisotropyMat = mat2( anisotropyVector.x, anisotropyVector.y, - anisotropyVector.y, anisotropyVector.x );\n\t\tvec3 anisotropyPolar = texture2D( anisotropyMap, vAnisotropyMapUv ).rgb;\n\t\tvec2 anisotropyV = anisotropyMat * normalize( 2.0 * anisotropyPolar.rg - vec2( 1.0 ) ) * anisotropyPolar.b;\n\t#else\n\t\tvec2 anisotropyV = anisotropyVector;\n\t#endif\n\tmaterial.anisotropy = length( anisotropyV );\n\tanisotropyV /= material.anisotropy;\n\tmaterial.anisotropy = saturate( material.anisotropy );\n\tmaterial.alphaT = mix( pow2( material.roughness ), 1.0, pow2( material.anisotropy ) );\n\tmaterial.anisotropyT = tbn[ 0 ] * anisotropyV.x - tbn[ 1 ] * anisotropyV.y;\n\tmaterial.anisotropyB = tbn[ 1 ] * anisotropyV.x + tbn[ 0 ] * anisotropyV.y;\n#endif",lights_physical_pars_fragment:"struct PhysicalMaterial {\n\tvec3 diffuseColor;\n\tfloat roughness;\n\tvec3 specularColor;\n\tfloat specularF90;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat clearcoat;\n\t\tfloat clearcoatRoughness;\n\t\tvec3 clearcoatF0;\n\t\tfloat clearcoatF90;\n\t#endif\n\t#ifdef USE_IRIDESCENCE\n\t\tfloat iridescence;\n\t\tfloat iridescenceIOR;\n\t\tfloat iridescenceThickness;\n\t\tvec3 iridescenceFresnel;\n\t\tvec3 iridescenceF0;\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tvec3 sheenColor;\n\t\tfloat sheenRoughness;\n\t#endif\n\t#ifdef IOR\n\t\tfloat ior;\n\t#endif\n\t#ifdef USE_TRANSMISSION\n\t\tfloat transmission;\n\t\tfloat transmissionAlpha;\n\t\tfloat thickness;\n\t\tfloat attenuationDistance;\n\t\tvec3 attenuationColor;\n\t#endif\n\t#ifdef USE_ANISOTROPY\n\t\tfloat anisotropy;\n\t\tfloat alphaT;\n\t\tvec3 anisotropyT;\n\t\tvec3 anisotropyB;\n\t#endif\n};\nvec3 clearcoatSpecular = vec3( 0.0 );\nvec3 sheenSpecular = vec3( 0.0 );\nvec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {\n    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );\n    float x2 = x * x;\n    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );\n    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );\n}\nfloat V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\treturn 0.5 / max( gv + gl, EPSILON );\n}\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n\tfloat a2 = pow2( alpha );\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\n}\n#ifdef USE_ANISOTROPY\n\tfloat V_GGX_SmithCorrelated_Anisotropic( const in float alphaT, const in float alphaB, const in float dotTV, const in float dotBV, const in float dotTL, const in float dotBL, const in float dotNV, const in float dotNL ) {\n\t\tfloat gv = dotNL * length( vec3( alphaT * dotTV, alphaB * dotBV, dotNV ) );\n\t\tfloat gl = dotNV * length( vec3( alphaT * dotTL, alphaB * dotBL, dotNL ) );\n\t\tfloat v = 0.5 / ( gv + gl );\n\t\treturn saturate(v);\n\t}\n\tfloat D_GGX_Anisotropic( const in float alphaT, const in float alphaB, const in float dotNH, const in float dotTH, const in float dotBH ) {\n\t\tfloat a2 = alphaT * alphaB;\n\t\thighp vec3 v = vec3( alphaB * dotTH, alphaT * dotBH, a2 * dotNH );\n\t\thighp float v2 = dot( v, v );\n\t\tfloat w2 = a2 / v2;\n\t\treturn RECIPROCAL_PI * a2 * pow2 ( w2 );\n\t}\n#endif\n#ifdef USE_CLEARCOAT\n\tvec3 BRDF_GGX_Clearcoat( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material) {\n\t\tvec3 f0 = material.clearcoatF0;\n\t\tfloat f90 = material.clearcoatF90;\n\t\tfloat roughness = material.clearcoatRoughness;\n\t\tfloat alpha = pow2( roughness );\n\t\tvec3 halfDir = normalize( lightDir + viewDir );\n\t\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\t\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\t\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\t\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\t\tvec3 F = F_Schlick( f0, f90, dotVH );\n\t\tfloat V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\t\tfloat D = D_GGX( alpha, dotNH );\n\t\treturn F * ( V * D );\n\t}\n#endif\nvec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material ) {\n\tvec3 f0 = material.specularColor;\n\tfloat f90 = material.specularF90;\n\tfloat roughness = material.roughness;\n\tfloat alpha = pow2( roughness );\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\tvec3 F = F_Schlick( f0, f90, dotVH );\n\t#ifdef USE_IRIDESCENCE\n\t\tF = mix( F, material.iridescenceFresnel, material.iridescence );\n\t#endif\n\t#ifdef USE_ANISOTROPY\n\t\tfloat dotTL = dot( material.anisotropyT, lightDir );\n\t\tfloat dotTV = dot( material.anisotropyT, viewDir );\n\t\tfloat dotTH = dot( material.anisotropyT, halfDir );\n\t\tfloat dotBL = dot( material.anisotropyB, lightDir );\n\t\tfloat dotBV = dot( material.anisotropyB, viewDir );\n\t\tfloat dotBH = dot( material.anisotropyB, halfDir );\n\t\tfloat V = V_GGX_SmithCorrelated_Anisotropic( material.alphaT, alpha, dotTV, dotBV, dotTL, dotBL, dotNV, dotNL );\n\t\tfloat D = D_GGX_Anisotropic( material.alphaT, alpha, dotNH, dotTH, dotBH );\n\t#else\n\t\tfloat V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\t\tfloat D = D_GGX( alpha, dotNH );\n\t#endif\n\treturn F * ( V * D );\n}\nvec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {\n\tconst float LUT_SIZE = 64.0;\n\tconst float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n\tconst float LUT_BIAS = 0.5 / LUT_SIZE;\n\tfloat dotNV = saturate( dot( N, V ) );\n\tvec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );\n\tuv = uv * LUT_SCALE + LUT_BIAS;\n\treturn uv;\n}\nfloat LTC_ClippedSphereFormFactor( const in vec3 f ) {\n\tfloat l = length( f );\n\treturn max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );\n}\nvec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {\n\tfloat x = dot( v1, v2 );\n\tfloat y = abs( x );\n\tfloat a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;\n\tfloat b = 3.4175940 + ( 4.1616724 + y ) * y;\n\tfloat v = a / b;\n\tfloat theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;\n\treturn cross( v1, v2 ) * theta_sintheta;\n}\nvec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {\n\tvec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];\n\tvec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];\n\tvec3 lightNormal = cross( v1, v2 );\n\tif( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );\n\tvec3 T1, T2;\n\tT1 = normalize( V - N * dot( V, N ) );\n\tT2 = - cross( N, T1 );\n\tmat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );\n\tvec3 coords[ 4 ];\n\tcoords[ 0 ] = mat * ( rectCoords[ 0 ] - P );\n\tcoords[ 1 ] = mat * ( rectCoords[ 1 ] - P );\n\tcoords[ 2 ] = mat * ( rectCoords[ 2 ] - P );\n\tcoords[ 3 ] = mat * ( rectCoords[ 3 ] - P );\n\tcoords[ 0 ] = normalize( coords[ 0 ] );\n\tcoords[ 1 ] = normalize( coords[ 1 ] );\n\tcoords[ 2 ] = normalize( coords[ 2 ] );\n\tcoords[ 3 ] = normalize( coords[ 3 ] );\n\tvec3 vectorFormFactor = vec3( 0.0 );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );\n\tfloat result = LTC_ClippedSphereFormFactor( vectorFormFactor );\n\treturn vec3( result );\n}\n#if defined( USE_SHEEN )\nfloat D_Charlie( float roughness, float dotNH ) {\n\tfloat alpha = pow2( roughness );\n\tfloat invAlpha = 1.0 / alpha;\n\tfloat cos2h = dotNH * dotNH;\n\tfloat sin2h = max( 1.0 - cos2h, 0.0078125 );\n\treturn ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );\n}\nfloat V_Neubelt( float dotNV, float dotNL ) {\n\treturn saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );\n}\nvec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat D = D_Charlie( sheenRoughness, dotNH );\n\tfloat V = V_Neubelt( dotNV, dotNL );\n\treturn sheenColor * ( D * V );\n}\n#endif\nfloat IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat r2 = roughness * roughness;\n\tfloat a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;\n\tfloat b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;\n\tfloat DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );\n\treturn saturate( DG * RECIPROCAL_PI );\n}\nvec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n\tvec4 r = roughness * c0 + c1;\n\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n\tvec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;\n\treturn fab;\n}\nvec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {\n\tvec2 fab = DFGApprox( normal, viewDir, roughness );\n\treturn specularColor * fab.x + specularF90 * fab.y;\n}\n#ifdef USE_IRIDESCENCE\nvoid computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n#else\nvoid computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n#endif\n\tvec2 fab = DFGApprox( normal, viewDir, roughness );\n\t#ifdef USE_IRIDESCENCE\n\t\tvec3 Fr = mix( specularColor, iridescenceF0, iridescence );\n\t#else\n\t\tvec3 Fr = specularColor;\n\t#endif\n\tvec3 FssEss = Fr * fab.x + specularF90 * fab.y;\n\tfloat Ess = fab.x + fab.y;\n\tfloat Ems = 1.0 - Ess;\n\tvec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;\tvec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );\n\tsingleScatter += FssEss;\n\tmultiScatter += Fms * Ems;\n}\n#if NUM_RECT_AREA_LIGHTS > 0\n\tvoid RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t\tvec3 normal = geometry.normal;\n\t\tvec3 viewDir = geometry.viewDir;\n\t\tvec3 position = geometry.position;\n\t\tvec3 lightPos = rectAreaLight.position;\n\t\tvec3 halfWidth = rectAreaLight.halfWidth;\n\t\tvec3 halfHeight = rectAreaLight.halfHeight;\n\t\tvec3 lightColor = rectAreaLight.color;\n\t\tfloat roughness = material.roughness;\n\t\tvec3 rectCoords[ 4 ];\n\t\trectCoords[ 0 ] = lightPos + halfWidth - halfHeight;\t\trectCoords[ 1 ] = lightPos - halfWidth - halfHeight;\n\t\trectCoords[ 2 ] = lightPos - halfWidth + halfHeight;\n\t\trectCoords[ 3 ] = lightPos + halfWidth + halfHeight;\n\t\tvec2 uv = LTC_Uv( normal, viewDir, roughness );\n\t\tvec4 t1 = texture2D( ltc_1, uv );\n\t\tvec4 t2 = texture2D( ltc_2, uv );\n\t\tmat3 mInv = mat3(\n\t\t\tvec3( t1.x, 0, t1.y ),\n\t\t\tvec3(    0, 1,    0 ),\n\t\t\tvec3( t1.z, 0, t1.w )\n\t\t);\n\t\tvec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );\n\t\treflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );\n\t\treflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );\n\t}\n#endif\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat dotNLcc = saturate( dot( geometry.clearcoatNormal, directLight.direction ) );\n\t\tvec3 ccIrradiance = dotNLcc * directLight.color;\n\t\tclearcoatSpecular += ccIrradiance * BRDF_GGX_Clearcoat( directLight.direction, geometry.viewDir, geometry.clearcoatNormal, material );\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tsheenSpecular += irradiance * BRDF_Sheen( directLight.direction, geometry.viewDir, geometry.normal, material.sheenColor, material.sheenRoughness );\n\t#endif\n\treflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.normal, material );\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {\n\t#ifdef USE_CLEARCOAT\n\t\tclearcoatSpecular += clearcoatRadiance * EnvironmentBRDF( geometry.clearcoatNormal, geometry.viewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tsheenSpecular += irradiance * material.sheenColor * IBLSheenBRDF( geometry.normal, geometry.viewDir, material.sheenRoughness );\n\t#endif\n\tvec3 singleScattering = vec3( 0.0 );\n\tvec3 multiScattering = vec3( 0.0 );\n\tvec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;\n\t#ifdef USE_IRIDESCENCE\n\t\tcomputeMultiscatteringIridescence( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );\n\t#else\n\t\tcomputeMultiscattering( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );\n\t#endif\n\tvec3 totalScattering = singleScattering + multiScattering;\n\tvec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );\n\treflectedLight.indirectSpecular += radiance * singleScattering;\n\treflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;\n\treflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;\n}\n#define RE_Direct\t\t\t\tRE_Direct_Physical\n#define RE_Direct_RectArea\t\tRE_Direct_RectArea_Physical\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular\t\tRE_IndirectSpecular_Physical\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n}",lights_fragment_begin:"\nGeometricContext geometry;\ngeometry.position = - vViewPosition;\ngeometry.normal = normal;\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );\n#ifdef USE_CLEARCOAT\n\tgeometry.clearcoatNormal = clearcoatNormal;\n#endif\n#ifdef USE_IRIDESCENCE\n\tfloat dotNVi = saturate( dot( normal, geometry.viewDir ) );\n\tif ( material.iridescenceThickness == 0.0 ) {\n\t\tmaterial.iridescence = 0.0;\n\t} else {\n\t\tmaterial.iridescence = saturate( material.iridescence );\n\t}\n\tif ( material.iridescence > 0.0 ) {\n\t\tmaterial.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );\n\t\tmaterial.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );\n\t}\n#endif\nIncidentLight directLight;\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\tPointLight pointLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tgetPointLightInfo( pointLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )\n\t\tpointLightShadow = pointLightShadows[ i ];\n\t\tdirectLight.color *= ( directLight.visible && receiveShadow ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\tSpotLight spotLight;\n\tvec4 spotColor;\n\tvec3 spotLightCoord;\n\tbool inSpotLightMap;\n\t#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tgetSpotLightInfo( spotLight, geometry, directLight );\n\t\t#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )\n\t\t#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX\n\t\t#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\t#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS\n\t\t#else\n\t\t#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )\n\t\t#endif\n\t\t#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )\n\t\t\tspotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;\n\t\t\tinSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );\n\t\t\tspotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );\n\t\t\tdirectLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;\n\t\t#endif\n\t\t#undef SPOT_LIGHT_MAP_INDEX\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\tspotLightShadow = spotLightShadows[ i ];\n\t\tdirectLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\tDirectionalLight directionalLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tgetDirectionalLightInfo( directionalLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )\n\t\tdirectionalLightShadow = directionalLightShadows[ i ];\n\t\tdirectLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n\tRectAreaLight rectAreaLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\t\trectAreaLight = rectAreaLights[ i ];\n\t\tRE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if defined( RE_IndirectDiffuse )\n\tvec3 iblIrradiance = vec3( 0.0 );\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\tirradiance += getLightProbeIrradiance( lightProbe, geometry.normal );\n\t#if ( NUM_HEMI_LIGHTS > 0 )\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n#endif\n#if defined( RE_IndirectSpecular )\n\tvec3 radiance = vec3( 0.0 );\n\tvec3 clearcoatRadiance = vec3( 0.0 );\n#endif",lights_fragment_maps:"#if defined( RE_IndirectDiffuse )\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel = texture2D( lightMap, vLightMapUv );\n\t\tvec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;\n\t\tirradiance += lightMapIrradiance;\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )\n\t\tiblIrradiance += getIBLIrradiance( geometry.normal );\n\t#endif\n#endif\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n\t#ifdef USE_ANISOTROPY\n\t\tradiance += getIBLAnisotropyRadiance( geometry.viewDir, geometry.normal, material.roughness, material.anisotropyB, material.anisotropy );\n\t#else\n\t\tradiance += getIBLRadiance( geometry.viewDir, geometry.normal, material.roughness );\n\t#endif\n\t#ifdef USE_CLEARCOAT\n\t\tclearcoatRadiance += getIBLRadiance( geometry.viewDir, geometry.clearcoatNormal, material.clearcoatRoughness );\n\t#endif\n#endif",lights_fragment_end:"#if defined( RE_IndirectDiffuse )\n\tRE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );\n#endif\n#if defined( RE_IndirectSpecular )\n\tRE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );\n#endif",logdepthbuf_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tgl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;\n#endif",logdepthbuf_pars_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tuniform float logDepthBufFC;\n\tvarying float vFragDepth;\n\tvarying float vIsPerspective;\n#endif",logdepthbuf_pars_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvarying float vFragDepth;\n\t\tvarying float vIsPerspective;\n\t#else\n\t\tuniform float logDepthBufFC;\n\t#endif\n#endif",logdepthbuf_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvFragDepth = 1.0 + gl_Position.w;\n\t\tvIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );\n\t#else\n\t\tif ( isPerspectiveMatrix( projectionMatrix ) ) {\n\t\t\tgl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;\n\t\t\tgl_Position.z *= gl_Position.w;\n\t\t}\n\t#endif\n#endif",map_fragment:"#ifdef USE_MAP\n\tdiffuseColor *= texture2D( map, vMapUv );\n#endif",map_pars_fragment:"#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif",map_particle_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\t#if defined( USE_POINTS_UV )\n\t\tvec2 uv = vUv;\n\t#else\n\t\tvec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;\n\t#endif\n#endif\n#ifdef USE_MAP\n\tdiffuseColor *= texture2D( map, uv );\n#endif\n#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, uv ).g;\n#endif",map_particle_pars_fragment:"#if defined( USE_POINTS_UV )\n\tvarying vec2 vUv;\n#else\n\t#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\t\tuniform mat3 uvTransform;\n\t#endif\n#endif\n#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif\n#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",metalnessmap_fragment:"float metalnessFactor = metalness;\n#ifdef USE_METALNESSMAP\n\tvec4 texelMetalness = texture2D( metalnessMap, vMetalnessMapUv );\n\tmetalnessFactor *= texelMetalness.b;\n#endif",metalnessmap_pars_fragment:"#ifdef USE_METALNESSMAP\n\tuniform sampler2D metalnessMap;\n#endif",morphcolor_vertex:"#if defined( USE_MORPHCOLORS ) && defined( MORPHTARGETS_TEXTURE )\n\tvColor *= morphTargetBaseInfluence;\n\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t#if defined( USE_COLOR_ALPHA )\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];\n\t\t#elif defined( USE_COLOR )\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];\n\t\t#endif\n\t}\n#endif",morphnormal_vertex:"#ifdef USE_MORPHNORMALS\n\tobjectNormal *= morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];\n\t\t}\n\t#else\n\t\tobjectNormal += morphNormal0 * morphTargetInfluences[ 0 ];\n\t\tobjectNormal += morphNormal1 * morphTargetInfluences[ 1 ];\n\t\tobjectNormal += morphNormal2 * morphTargetInfluences[ 2 ];\n\t\tobjectNormal += morphNormal3 * morphTargetInfluences[ 3 ];\n\t#endif\n#endif",morphtarget_pars_vertex:"#ifdef USE_MORPHTARGETS\n\tuniform float morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tuniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];\n\t\tuniform sampler2DArray morphTargetsTexture;\n\t\tuniform ivec2 morphTargetsTextureSize;\n\t\tvec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {\n\t\t\tint texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;\n\t\t\tint y = texelIndex / morphTargetsTextureSize.x;\n\t\t\tint x = texelIndex - y * morphTargetsTextureSize.x;\n\t\t\tivec3 morphUV = ivec3( x, y, morphTargetIndex );\n\t\t\treturn texelFetch( morphTargetsTexture, morphUV, 0 );\n\t\t}\n\t#else\n\t\t#ifndef USE_MORPHNORMALS\n\t\t\tuniform float morphTargetInfluences[ 8 ];\n\t\t#else\n\t\t\tuniform float morphTargetInfluences[ 4 ];\n\t\t#endif\n\t#endif\n#endif",morphtarget_vertex:"#ifdef USE_MORPHTARGETS\n\ttransformed *= morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];\n\t\t}\n\t#else\n\t\ttransformed += morphTarget0 * morphTargetInfluences[ 0 ];\n\t\ttransformed += morphTarget1 * morphTargetInfluences[ 1 ];\n\t\ttransformed += morphTarget2 * morphTargetInfluences[ 2 ];\n\t\ttransformed += morphTarget3 * morphTargetInfluences[ 3 ];\n\t\t#ifndef USE_MORPHNORMALS\n\t\t\ttransformed += morphTarget4 * morphTargetInfluences[ 4 ];\n\t\t\ttransformed += morphTarget5 * morphTargetInfluences[ 5 ];\n\t\t\ttransformed += morphTarget6 * morphTargetInfluences[ 6 ];\n\t\t\ttransformed += morphTarget7 * morphTargetInfluences[ 7 ];\n\t\t#endif\n\t#endif\n#endif",normal_fragment_begin:"float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;\n#ifdef FLAT_SHADED\n\tvec3 fdx = dFdx( vViewPosition );\n\tvec3 fdy = dFdy( vViewPosition );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n#else\n\tvec3 normal = normalize( vNormal );\n\t#ifdef DOUBLE_SIDED\n\t\tnormal *= faceDirection;\n\t#endif\n#endif\n#if defined( USE_NORMALMAP_TANGENTSPACE ) || defined( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY )\n\t#ifdef USE_TANGENT\n\t\tmat3 tbn = mat3( normalize( vTangent ), normalize( vBitangent ), normal );\n\t#else\n\t\tmat3 tbn = getTangentFrame( - vViewPosition, normal,\n\t\t#if defined( USE_NORMALMAP )\n\t\t\tvNormalMapUv\n\t\t#elif defined( USE_CLEARCOAT_NORMALMAP )\n\t\t\tvClearcoatNormalMapUv\n\t\t#else\n\t\t\tvUv\n\t\t#endif\n\t\t);\n\t#endif\n\t#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )\n\t\ttbn[0] *= faceDirection;\n\t\ttbn[1] *= faceDirection;\n\t#endif\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\t#ifdef USE_TANGENT\n\t\tmat3 tbn2 = mat3( normalize( vTangent ), normalize( vBitangent ), normal );\n\t#else\n\t\tmat3 tbn2 = getTangentFrame( - vViewPosition, normal, vClearcoatNormalMapUv );\n\t#endif\n\t#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )\n\t\ttbn2[0] *= faceDirection;\n\t\ttbn2[1] *= faceDirection;\n\t#endif\n#endif\nvec3 geometryNormal = normal;",normal_fragment_maps:"#ifdef USE_NORMALMAP_OBJECTSPACE\n\tnormal = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;\n\t#ifdef FLIP_SIDED\n\t\tnormal = - normal;\n\t#endif\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * faceDirection;\n\t#endif\n\tnormal = normalize( normalMatrix * normal );\n#elif defined( USE_NORMALMAP_TANGENTSPACE )\n\tvec3 mapN = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;\n\tmapN.xy *= normalScale;\n\tnormal = normalize( tbn * mapN );\n#elif defined( USE_BUMPMAP )\n\tnormal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );\n#endif",normal_pars_fragment:"#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif",normal_pars_vertex:"#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif",normal_vertex:"#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n\t#ifdef USE_TANGENT\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\t#endif\n#endif",normalmap_pars_fragment:"#ifdef USE_NORMALMAP\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n#endif\n#ifdef USE_NORMALMAP_OBJECTSPACE\n\tuniform mat3 normalMatrix;\n#endif\n#if ! defined ( USE_TANGENT ) && ( defined ( USE_NORMALMAP_TANGENTSPACE ) || defined ( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY ) )\n\tmat3 getTangentFrame( vec3 eye_pos, vec3 surf_norm, vec2 uv ) {\n\t\tvec3 q0 = dFdx( eye_pos.xyz );\n\t\tvec3 q1 = dFdy( eye_pos.xyz );\n\t\tvec2 st0 = dFdx( uv.st );\n\t\tvec2 st1 = dFdy( uv.st );\n\t\tvec3 N = surf_norm;\n\t\tvec3 q1perp = cross( q1, N );\n\t\tvec3 q0perp = cross( N, q0 );\n\t\tvec3 T = q1perp * st0.x + q0perp * st1.x;\n\t\tvec3 B = q1perp * st0.y + q0perp * st1.y;\n\t\tfloat det = max( dot( T, T ), dot( B, B ) );\n\t\tfloat scale = ( det == 0.0 ) ? 0.0 : inversesqrt( det );\n\t\treturn mat3( T * scale, B * scale, N );\n\t}\n#endif",clearcoat_normal_fragment_begin:"#ifdef USE_CLEARCOAT\n\tvec3 clearcoatNormal = geometryNormal;\n#endif",clearcoat_normal_fragment_maps:"#ifdef USE_CLEARCOAT_NORMALMAP\n\tvec3 clearcoatMapN = texture2D( clearcoatNormalMap, vClearcoatNormalMapUv ).xyz * 2.0 - 1.0;\n\tclearcoatMapN.xy *= clearcoatNormalScale;\n\tclearcoatNormal = normalize( tbn2 * clearcoatMapN );\n#endif",clearcoat_pars_fragment:"#ifdef USE_CLEARCOATMAP\n\tuniform sampler2D clearcoatMap;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tuniform sampler2D clearcoatNormalMap;\n\tuniform vec2 clearcoatNormalScale;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tuniform sampler2D clearcoatRoughnessMap;\n#endif",iridescence_pars_fragment:"#ifdef USE_IRIDESCENCEMAP\n\tuniform sampler2D iridescenceMap;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tuniform sampler2D iridescenceThicknessMap;\n#endif",opaque_fragment:"#ifdef OPAQUE\ndiffuseColor.a = 1.0;\n#endif\n#ifdef USE_TRANSMISSION\ndiffuseColor.a *= material.transmissionAlpha;\n#endif\ngl_FragColor = vec4( outgoingLight, diffuseColor.a );",packing:"vec3 packNormalToRGB( const in vec3 normal ) {\n\treturn normalize( normal ) * 0.5 + 0.5;\n}\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n\treturn 2.0 * rgb.xyz - 1.0;\n}\nconst float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;\nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\nconst float ShiftRight8 = 1. / 256.;\nvec4 packDepthToRGBA( const in float v ) {\n\tvec4 r = vec4( fract( v * PackFactors ), v );\n\tr.yzw -= r.xyz * ShiftRight8;\treturn r * PackUpscale;\n}\nfloat unpackRGBAToDepth( const in vec4 v ) {\n\treturn dot( v, UnpackFactors );\n}\nvec2 packDepthToRG( in highp float v ) {\n\treturn packDepthToRGBA( v ).yx;\n}\nfloat unpackRGToDepth( const in highp vec2 v ) {\n\treturn unpackRGBAToDepth( vec4( v.xy, 0.0, 0.0 ) );\n}\nvec4 pack2HalfToRGBA( vec2 v ) {\n\tvec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );\n\treturn vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );\n}\nvec2 unpackRGBATo2Half( vec4 v ) {\n\treturn vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );\n}\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( viewZ + near ) / ( near - far );\n}\nfloat orthographicDepthToViewZ( const in float depth, const in float near, const in float far ) {\n\treturn depth * ( near - far ) - near;\n}\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );\n}\nfloat perspectiveDepthToViewZ( const in float depth, const in float near, const in float far ) {\n\treturn ( near * far ) / ( ( far - near ) * depth - far );\n}",premultiplied_alpha_fragment:"#ifdef PREMULTIPLIED_ALPHA\n\tgl_FragColor.rgb *= gl_FragColor.a;\n#endif",project_vertex:"vec4 mvPosition = vec4( transformed, 1.0 );\n#ifdef USE_INSTANCING\n\tmvPosition = instanceMatrix * mvPosition;\n#endif\nmvPosition = modelViewMatrix * mvPosition;\ngl_Position = projectionMatrix * mvPosition;",dithering_fragment:"#ifdef DITHERING\n\tgl_FragColor.rgb = dithering( gl_FragColor.rgb );\n#endif",dithering_pars_fragment:"#ifdef DITHERING\n\tvec3 dithering( vec3 color ) {\n\t\tfloat grid_position = rand( gl_FragCoord.xy );\n\t\tvec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );\n\t\tdither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );\n\t\treturn color + dither_shift_RGB;\n\t}\n#endif",roughnessmap_fragment:"float roughnessFactor = roughness;\n#ifdef USE_ROUGHNESSMAP\n\tvec4 texelRoughness = texture2D( roughnessMap, vRoughnessMapUv );\n\troughnessFactor *= texelRoughness.g;\n#endif",roughnessmap_pars_fragment:"#ifdef USE_ROUGHNESSMAP\n\tuniform sampler2D roughnessMap;\n#endif",shadowmap_pars_fragment:"#if NUM_SPOT_LIGHT_COORDS > 0\n\tvarying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];\n#endif\n#if NUM_SPOT_LIGHT_MAPS > 0\n\tuniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];\n#endif\n#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\t\treturn step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n\t}\n\tvec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {\n\t\treturn unpackRGBATo2Half( texture2D( shadow, uv ) );\n\t}\n\tfloat VSMShadow (sampler2D shadow, vec2 uv, float compare ){\n\t\tfloat occlusion = 1.0;\n\t\tvec2 distribution = texture2DDistribution( shadow, uv );\n\t\tfloat hard_shadow = step( compare , distribution.x );\n\t\tif (hard_shadow != 1.0 ) {\n\t\t\tfloat distance = compare - distribution.x ;\n\t\t\tfloat variance = max( 0.00000, distribution.y * distribution.y );\n\t\t\tfloat softness_probability = variance / (variance + distance * distance );\t\t\tsoftness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );\t\t\tocclusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );\n\t\t}\n\t\treturn occlusion;\n\t}\n\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\tfloat shadow = 1.0;\n\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\tshadowCoord.z += shadowBias;\n\t\tbool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;\n\t\tbool frustumTest = inFrustum && shadowCoord.z <= 1.0;\n\t\tif ( frustumTest ) {\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tfloat dx2 = dx0 / 2.0;\n\t\t\tfloat dy2 = dy0 / 2.0;\n\t\t\tfloat dx3 = dx1 / 2.0;\n\t\t\tfloat dy3 = dy1 / 2.0;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 17.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx = texelSize.x;\n\t\t\tfloat dy = texelSize.y;\n\t\t\tvec2 uv = shadowCoord.xy;\n\t\t\tvec2 f = fract( uv * shadowMapSize + 0.5 );\n\t\t\tuv -= f * texelSize;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, uv, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t f.y )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_VSM )\n\t\t\tshadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#else\n\t\t\tshadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#endif\n\t\t}\n\t\treturn shadow;\n\t}\n\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\n\t\tvec3 absV = abs( v );\n\t\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n\t\tabsV *= scaleToCube;\n\t\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\t\tvec2 planar = v.xy;\n\t\tfloat almostATexel = 1.5 * texelSizeY;\n\t\tfloat almostOne = 1.0 - almostATexel;\n\t\tif ( absV.z >= almostOne ) {\n\t\t\tif ( v.z > 0.0 )\n\t\t\t\tplanar.x = 4.0 - v.x;\n\t\t} else if ( absV.x >= almostOne ) {\n\t\t\tfloat signX = sign( v.x );\n\t\t\tplanar.x = v.z * signX + 2.0 * signX;\n\t\t} else if ( absV.y >= almostOne ) {\n\t\t\tfloat signY = sign( v.y );\n\t\t\tplanar.x = v.x + 2.0 * signY + 2.0;\n\t\t\tplanar.y = v.z * signY - 2.0;\n\t\t}\n\t\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\t}\n\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\n\t\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n\t\tvec3 lightToPosition = shadowCoord.xyz;\n\t\tfloat dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );\t\tdp += shadowBias;\n\t\tvec3 bd3D = normalize( lightToPosition );\n\t\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )\n\t\t\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n\t\t\treturn (\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\treturn texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n\t\t#endif\n\t}\n#endif",shadowmap_pars_vertex:"#if NUM_SPOT_LIGHT_COORDS > 0\n\tuniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];\n\tvarying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];\n#endif\n#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n#endif",shadowmap_vertex:"#if ( defined( USE_SHADOWMAP ) && ( NUM_DIR_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0 ) ) || ( NUM_SPOT_LIGHT_COORDS > 0 )\n\tvec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\tvec4 shadowWorldPosition;\n#endif\n#if defined( USE_SHADOWMAP )\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );\n\t\t\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );\n\t\t\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n#endif\n#if NUM_SPOT_LIGHT_COORDS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_COORDS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition;\n\t\t#if ( defined( USE_SHADOWMAP ) && UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\t\tshadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;\n\t\t#endif\n\t\tvSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n#endif",shadowmask_pars_fragment:"float getShadowMask() {\n\tfloat shadow = 1.0;\n\t#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tdirectionalLight = directionalLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tspotLight = spotLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tpointLight = pointLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#endif\n\treturn shadow;\n}",skinbase_vertex:"#ifdef USE_SKINNING\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n#endif",skinning_pars_vertex:"#ifdef USE_SKINNING\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\tuniform highp sampler2D boneTexture;\n\tuniform int boneTextureSize;\n\tmat4 getBoneMatrix( const in float i ) {\n\t\tfloat j = i * 4.0;\n\t\tfloat x = mod( j, float( boneTextureSize ) );\n\t\tfloat y = floor( j / float( boneTextureSize ) );\n\t\tfloat dx = 1.0 / float( boneTextureSize );\n\t\tfloat dy = 1.0 / float( boneTextureSize );\n\t\ty = dy * ( y + 0.5 );\n\t\tvec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\n\t\tvec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\n\t\tvec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\n\t\tvec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\n\t\tmat4 bone = mat4( v1, v2, v3, v4 );\n\t\treturn bone;\n\t}\n#endif",skinning_vertex:"#ifdef USE_SKINNING\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\ttransformed = ( bindMatrixInverse * skinned ).xyz;\n#endif",skinnormal_vertex:"#ifdef USE_SKINNING\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n\t#ifdef USE_TANGENT\n\t\tobjectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#endif\n#endif",specularmap_fragment:"float specularStrength;\n#ifdef USE_SPECULARMAP\n\tvec4 texelSpecular = texture2D( specularMap, vSpecularMapUv );\n\tspecularStrength = texelSpecular.r;\n#else\n\tspecularStrength = 1.0;\n#endif",specularmap_pars_fragment:"#ifdef USE_SPECULARMAP\n\tuniform sampler2D specularMap;\n#endif",tonemapping_fragment:"#if defined( TONE_MAPPING )\n\tgl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n#endif",tonemapping_pars_fragment:"#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\nuniform float toneMappingExposure;\nvec3 LinearToneMapping( vec3 color ) {\n\treturn saturate( toneMappingExposure * color );\n}\nvec3 ReinhardToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( color / ( vec3( 1.0 ) + color ) );\n}\nvec3 OptimizedCineonToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\tcolor = max( vec3( 0.0 ), color - 0.004 );\n\treturn pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n}\nvec3 RRTAndODTFit( vec3 v ) {\n\tvec3 a = v * ( v + 0.0245786 ) - 0.000090537;\n\tvec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;\n\treturn a / b;\n}\nvec3 ACESFilmicToneMapping( vec3 color ) {\n\tconst mat3 ACESInputMat = mat3(\n\t\tvec3( 0.59719, 0.07600, 0.02840 ),\t\tvec3( 0.35458, 0.90834, 0.13383 ),\n\t\tvec3( 0.04823, 0.01566, 0.83777 )\n\t);\n\tconst mat3 ACESOutputMat = mat3(\n\t\tvec3(  1.60475, -0.10208, -0.00327 ),\t\tvec3( -0.53108,  1.10813, -0.07276 ),\n\t\tvec3( -0.07367, -0.00605,  1.07602 )\n\t);\n\tcolor *= toneMappingExposure / 0.6;\n\tcolor = ACESInputMat * color;\n\tcolor = RRTAndODTFit( color );\n\tcolor = ACESOutputMat * color;\n\treturn saturate( color );\n}\nvec3 CustomToneMapping( vec3 color ) { return color; }",transmission_fragment:"#ifdef USE_TRANSMISSION\n\tmaterial.transmission = transmission;\n\tmaterial.transmissionAlpha = 1.0;\n\tmaterial.thickness = thickness;\n\tmaterial.attenuationDistance = attenuationDistance;\n\tmaterial.attenuationColor = attenuationColor;\n\t#ifdef USE_TRANSMISSIONMAP\n\t\tmaterial.transmission *= texture2D( transmissionMap, vTransmissionMapUv ).r;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tmaterial.thickness *= texture2D( thicknessMap, vThicknessMapUv ).g;\n\t#endif\n\tvec3 pos = vWorldPosition;\n\tvec3 v = normalize( cameraPosition - pos );\n\tvec3 n = inverseTransformDirection( normal, viewMatrix );\n\tvec4 transmitted = getIBLVolumeRefraction(\n\t\tn, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,\n\t\tpos, modelMatrix, viewMatrix, projectionMatrix, material.ior, material.thickness,\n\t\tmaterial.attenuationColor, material.attenuationDistance );\n\tmaterial.transmissionAlpha = mix( material.transmissionAlpha, transmitted.a, material.transmission );\n\ttotalDiffuse = mix( totalDiffuse, transmitted.rgb, material.transmission );\n#endif",transmission_pars_fragment:"#ifdef USE_TRANSMISSION\n\tuniform float transmission;\n\tuniform float thickness;\n\tuniform float attenuationDistance;\n\tuniform vec3 attenuationColor;\n\t#ifdef USE_TRANSMISSIONMAP\n\t\tuniform sampler2D transmissionMap;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tuniform sampler2D thicknessMap;\n\t#endif\n\tuniform vec2 transmissionSamplerSize;\n\tuniform sampler2D transmissionSamplerMap;\n\tuniform mat4 modelMatrix;\n\tuniform mat4 projectionMatrix;\n\tvarying vec3 vWorldPosition;\n\tfloat w0( float a ) {\n\t\treturn ( 1.0 / 6.0 ) * ( a * ( a * ( - a + 3.0 ) - 3.0 ) + 1.0 );\n\t}\n\tfloat w1( float a ) {\n\t\treturn ( 1.0 / 6.0 ) * ( a *  a * ( 3.0 * a - 6.0 ) + 4.0 );\n\t}\n\tfloat w2( float a ){\n\t\treturn ( 1.0 / 6.0 ) * ( a * ( a * ( - 3.0 * a + 3.0 ) + 3.0 ) + 1.0 );\n\t}\n\tfloat w3( float a ) {\n\t\treturn ( 1.0 / 6.0 ) * ( a * a * a );\n\t}\n\tfloat g0( float a ) {\n\t\treturn w0( a ) + w1( a );\n\t}\n\tfloat g1( float a ) {\n\t\treturn w2( a ) + w3( a );\n\t}\n\tfloat h0( float a ) {\n\t\treturn - 1.0 + w1( a ) / ( w0( a ) + w1( a ) );\n\t}\n\tfloat h1( float a ) {\n\t\treturn 1.0 + w3( a ) / ( w2( a ) + w3( a ) );\n\t}\n\tvec4 bicubic( sampler2D tex, vec2 uv, vec4 texelSize, float lod ) {\n\t\tuv = uv * texelSize.zw + 0.5;\n\t\tvec2 iuv = floor( uv );\n\t\tvec2 fuv = fract( uv );\n\t\tfloat g0x = g0( fuv.x );\n\t\tfloat g1x = g1( fuv.x );\n\t\tfloat h0x = h0( fuv.x );\n\t\tfloat h1x = h1( fuv.x );\n\t\tfloat h0y = h0( fuv.y );\n\t\tfloat h1y = h1( fuv.y );\n\t\tvec2 p0 = ( vec2( iuv.x + h0x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;\n\t\tvec2 p1 = ( vec2( iuv.x + h1x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;\n\t\tvec2 p2 = ( vec2( iuv.x + h0x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;\n\t\tvec2 p3 = ( vec2( iuv.x + h1x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;\n\t\treturn g0( fuv.y ) * ( g0x * textureLod( tex, p0, lod ) + g1x * textureLod( tex, p1, lod ) ) +\n\t\t\tg1( fuv.y ) * ( g0x * textureLod( tex, p2, lod ) + g1x * textureLod( tex, p3, lod ) );\n\t}\n\tvec4 textureBicubic( sampler2D sampler, vec2 uv, float lod ) {\n\t\tvec2 fLodSize = vec2( textureSize( sampler, int( lod ) ) );\n\t\tvec2 cLodSize = vec2( textureSize( sampler, int( lod + 1.0 ) ) );\n\t\tvec2 fLodSizeInv = 1.0 / fLodSize;\n\t\tvec2 cLodSizeInv = 1.0 / cLodSize;\n\t\tvec4 fSample = bicubic( sampler, uv, vec4( fLodSizeInv, fLodSize ), floor( lod ) );\n\t\tvec4 cSample = bicubic( sampler, uv, vec4( cLodSizeInv, cLodSize ), ceil( lod ) );\n\t\treturn mix( fSample, cSample, fract( lod ) );\n\t}\n\tvec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {\n\t\tvec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );\n\t\tvec3 modelScale;\n\t\tmodelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );\n\t\tmodelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );\n\t\tmodelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );\n\t\treturn normalize( refractionVector ) * thickness * modelScale;\n\t}\n\tfloat applyIorToRoughness( const in float roughness, const in float ior ) {\n\t\treturn roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );\n\t}\n\tvec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {\n\t\tfloat lod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );\n\t\treturn textureBicubic( transmissionSamplerMap, fragCoord.xy, lod );\n\t}\n\tvec3 volumeAttenuation( const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {\n\t\tif ( isinf( attenuationDistance ) ) {\n\t\t\treturn vec3( 1.0 );\n\t\t} else {\n\t\t\tvec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;\n\t\t\tvec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );\t\t\treturn transmittance;\n\t\t}\n\t}\n\tvec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,\n\t\tconst in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,\n\t\tconst in mat4 viewMatrix, const in mat4 projMatrix, const in float ior, const in float thickness,\n\t\tconst in vec3 attenuationColor, const in float attenuationDistance ) {\n\t\tvec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );\n\t\tvec3 refractedRayExit = position + transmissionRay;\n\t\tvec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );\n\t\tvec2 refractionCoords = ndcPos.xy / ndcPos.w;\n\t\trefractionCoords += 1.0;\n\t\trefractionCoords /= 2.0;\n\t\tvec4 transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );\n\t\tvec3 transmittance = diffuseColor * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance );\n\t\tvec3 attenuatedColor = transmittance * transmittedLight.rgb;\n\t\tvec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );\n\t\tfloat transmittanceFactor = ( transmittance.r + transmittance.g + transmittance.b ) / 3.0;\n\t\treturn vec4( ( 1.0 - F ) * attenuatedColor, 1.0 - ( 1.0 - transmittedLight.a ) * transmittanceFactor );\n\t}\n#endif",uv_pars_fragment:"#if defined( USE_UV ) || defined( USE_ANISOTROPY )\n\tvarying vec2 vUv;\n#endif\n#ifdef USE_MAP\n\tvarying vec2 vMapUv;\n#endif\n#ifdef USE_ALPHAMAP\n\tvarying vec2 vAlphaMapUv;\n#endif\n#ifdef USE_LIGHTMAP\n\tvarying vec2 vLightMapUv;\n#endif\n#ifdef USE_AOMAP\n\tvarying vec2 vAoMapUv;\n#endif\n#ifdef USE_BUMPMAP\n\tvarying vec2 vBumpMapUv;\n#endif\n#ifdef USE_NORMALMAP\n\tvarying vec2 vNormalMapUv;\n#endif\n#ifdef USE_EMISSIVEMAP\n\tvarying vec2 vEmissiveMapUv;\n#endif\n#ifdef USE_METALNESSMAP\n\tvarying vec2 vMetalnessMapUv;\n#endif\n#ifdef USE_ROUGHNESSMAP\n\tvarying vec2 vRoughnessMapUv;\n#endif\n#ifdef USE_ANISOTROPYMAP\n\tvarying vec2 vAnisotropyMapUv;\n#endif\n#ifdef USE_CLEARCOATMAP\n\tvarying vec2 vClearcoatMapUv;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tvarying vec2 vClearcoatNormalMapUv;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tvarying vec2 vClearcoatRoughnessMapUv;\n#endif\n#ifdef USE_IRIDESCENCEMAP\n\tvarying vec2 vIridescenceMapUv;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tvarying vec2 vIridescenceThicknessMapUv;\n#endif\n#ifdef USE_SHEEN_COLORMAP\n\tvarying vec2 vSheenColorMapUv;\n#endif\n#ifdef USE_SHEEN_ROUGHNESSMAP\n\tvarying vec2 vSheenRoughnessMapUv;\n#endif\n#ifdef USE_SPECULARMAP\n\tvarying vec2 vSpecularMapUv;\n#endif\n#ifdef USE_SPECULAR_COLORMAP\n\tvarying vec2 vSpecularColorMapUv;\n#endif\n#ifdef USE_SPECULAR_INTENSITYMAP\n\tvarying vec2 vSpecularIntensityMapUv;\n#endif\n#ifdef USE_TRANSMISSIONMAP\n\tuniform mat3 transmissionMapTransform;\n\tvarying vec2 vTransmissionMapUv;\n#endif\n#ifdef USE_THICKNESSMAP\n\tuniform mat3 thicknessMapTransform;\n\tvarying vec2 vThicknessMapUv;\n#endif",uv_pars_vertex:"#if defined( USE_UV ) || defined( USE_ANISOTROPY )\n\tvarying vec2 vUv;\n#endif\n#ifdef USE_MAP\n\tuniform mat3 mapTransform;\n\tvarying vec2 vMapUv;\n#endif\n#ifdef USE_ALPHAMAP\n\tuniform mat3 alphaMapTransform;\n\tvarying vec2 vAlphaMapUv;\n#endif\n#ifdef USE_LIGHTMAP\n\tuniform mat3 lightMapTransform;\n\tvarying vec2 vLightMapUv;\n#endif\n#ifdef USE_AOMAP\n\tuniform mat3 aoMapTransform;\n\tvarying vec2 vAoMapUv;\n#endif\n#ifdef USE_BUMPMAP\n\tuniform mat3 bumpMapTransform;\n\tvarying vec2 vBumpMapUv;\n#endif\n#ifdef USE_NORMALMAP\n\tuniform mat3 normalMapTransform;\n\tvarying vec2 vNormalMapUv;\n#endif\n#ifdef USE_DISPLACEMENTMAP\n\tuniform mat3 displacementMapTransform;\n\tvarying vec2 vDisplacementMapUv;\n#endif\n#ifdef USE_EMISSIVEMAP\n\tuniform mat3 emissiveMapTransform;\n\tvarying vec2 vEmissiveMapUv;\n#endif\n#ifdef USE_METALNESSMAP\n\tuniform mat3 metalnessMapTransform;\n\tvarying vec2 vMetalnessMapUv;\n#endif\n#ifdef USE_ROUGHNESSMAP\n\tuniform mat3 roughnessMapTransform;\n\tvarying vec2 vRoughnessMapUv;\n#endif\n#ifdef USE_ANISOTROPYMAP\n\tuniform mat3 anisotropyMapTransform;\n\tvarying vec2 vAnisotropyMapUv;\n#endif\n#ifdef USE_CLEARCOATMAP\n\tuniform mat3 clearcoatMapTransform;\n\tvarying vec2 vClearcoatMapUv;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tuniform mat3 clearcoatNormalMapTransform;\n\tvarying vec2 vClearcoatNormalMapUv;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tuniform mat3 clearcoatRoughnessMapTransform;\n\tvarying vec2 vClearcoatRoughnessMapUv;\n#endif\n#ifdef USE_SHEEN_COLORMAP\n\tuniform mat3 sheenColorMapTransform;\n\tvarying vec2 vSheenColorMapUv;\n#endif\n#ifdef USE_SHEEN_ROUGHNESSMAP\n\tuniform mat3 sheenRoughnessMapTransform;\n\tvarying vec2 vSheenRoughnessMapUv;\n#endif\n#ifdef USE_IRIDESCENCEMAP\n\tuniform mat3 iridescenceMapTransform;\n\tvarying vec2 vIridescenceMapUv;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tuniform mat3 iridescenceThicknessMapTransform;\n\tvarying vec2 vIridescenceThicknessMapUv;\n#endif\n#ifdef USE_SPECULARMAP\n\tuniform mat3 specularMapTransform;\n\tvarying vec2 vSpecularMapUv;\n#endif\n#ifdef USE_SPECULAR_COLORMAP\n\tuniform mat3 specularColorMapTransform;\n\tvarying vec2 vSpecularColorMapUv;\n#endif\n#ifdef USE_SPECULAR_INTENSITYMAP\n\tuniform mat3 specularIntensityMapTransform;\n\tvarying vec2 vSpecularIntensityMapUv;\n#endif\n#ifdef USE_TRANSMISSIONMAP\n\tuniform mat3 transmissionMapTransform;\n\tvarying vec2 vTransmissionMapUv;\n#endif\n#ifdef USE_THICKNESSMAP\n\tuniform mat3 thicknessMapTransform;\n\tvarying vec2 vThicknessMapUv;\n#endif",uv_vertex:"#if defined( USE_UV ) || defined( USE_ANISOTROPY )\n\tvUv = vec3( uv, 1 ).xy;\n#endif\n#ifdef USE_MAP\n\tvMapUv = ( mapTransform * vec3( MAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_ALPHAMAP\n\tvAlphaMapUv = ( alphaMapTransform * vec3( ALPHAMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_LIGHTMAP\n\tvLightMapUv = ( lightMapTransform * vec3( LIGHTMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_AOMAP\n\tvAoMapUv = ( aoMapTransform * vec3( AOMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_BUMPMAP\n\tvBumpMapUv = ( bumpMapTransform * vec3( BUMPMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_NORMALMAP\n\tvNormalMapUv = ( normalMapTransform * vec3( NORMALMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_DISPLACEMENTMAP\n\tvDisplacementMapUv = ( displacementMapTransform * vec3( DISPLACEMENTMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_EMISSIVEMAP\n\tvEmissiveMapUv = ( emissiveMapTransform * vec3( EMISSIVEMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_METALNESSMAP\n\tvMetalnessMapUv = ( metalnessMapTransform * vec3( METALNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_ROUGHNESSMAP\n\tvRoughnessMapUv = ( roughnessMapTransform * vec3( ROUGHNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_ANISOTROPYMAP\n\tvAnisotropyMapUv = ( anisotropyMapTransform * vec3( ANISOTROPYMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_CLEARCOATMAP\n\tvClearcoatMapUv = ( clearcoatMapTransform * vec3( CLEARCOATMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tvClearcoatNormalMapUv = ( clearcoatNormalMapTransform * vec3( CLEARCOAT_NORMALMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tvClearcoatRoughnessMapUv = ( clearcoatRoughnessMapTransform * vec3( CLEARCOAT_ROUGHNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_IRIDESCENCEMAP\n\tvIridescenceMapUv = ( iridescenceMapTransform * vec3( IRIDESCENCEMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tvIridescenceThicknessMapUv = ( iridescenceThicknessMapTransform * vec3( IRIDESCENCE_THICKNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SHEEN_COLORMAP\n\tvSheenColorMapUv = ( sheenColorMapTransform * vec3( SHEEN_COLORMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SHEEN_ROUGHNESSMAP\n\tvSheenRoughnessMapUv = ( sheenRoughnessMapTransform * vec3( SHEEN_ROUGHNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SPECULARMAP\n\tvSpecularMapUv = ( specularMapTransform * vec3( SPECULARMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SPECULAR_COLORMAP\n\tvSpecularColorMapUv = ( specularColorMapTransform * vec3( SPECULAR_COLORMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SPECULAR_INTENSITYMAP\n\tvSpecularIntensityMapUv = ( specularIntensityMapTransform * vec3( SPECULAR_INTENSITYMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_TRANSMISSIONMAP\n\tvTransmissionMapUv = ( transmissionMapTransform * vec3( TRANSMISSIONMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_THICKNESSMAP\n\tvThicknessMapUv = ( thicknessMapTransform * vec3( THICKNESSMAP_UV, 1 ) ).xy;\n#endif",worldpos_vertex:"#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0\n\tvec4 worldPosition = vec4( transformed, 1.0 );\n\t#ifdef USE_INSTANCING\n\t\tworldPosition = instanceMatrix * worldPosition;\n\t#endif\n\tworldPosition = modelMatrix * worldPosition;\n#endif",background_vert:"varying vec2 vUv;\nuniform mat3 uvTransform;\nvoid main() {\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\tgl_Position = vec4( position.xy, 1.0, 1.0 );\n}",background_frag:"uniform sampler2D t2D;\nuniform float backgroundIntensity;\nvarying vec2 vUv;\nvoid main() {\n\tvec4 texColor = texture2D( t2D, vUv );\n\ttexColor.rgb *= backgroundIntensity;\n\tgl_FragColor = texColor;\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n}",backgroundCube_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",backgroundCube_frag:"#ifdef ENVMAP_TYPE_CUBE\n\tuniform samplerCube envMap;\n#elif defined( ENVMAP_TYPE_CUBE_UV )\n\tuniform sampler2D envMap;\n#endif\nuniform float flipEnvMap;\nuniform float backgroundBlurriness;\nuniform float backgroundIntensity;\nvarying vec3 vWorldDirection;\n#include <cube_uv_reflection_fragment>\nvoid main() {\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 texColor = textureCube( envMap, vec3( flipEnvMap * vWorldDirection.x, vWorldDirection.yz ) );\n\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\tvec4 texColor = textureCubeUV( envMap, vWorldDirection, backgroundBlurriness );\n\t#else\n\t\tvec4 texColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t#endif\n\ttexColor.rgb *= backgroundIntensity;\n\tgl_FragColor = texColor;\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n}",cube_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",cube_frag:"uniform samplerCube tCube;\nuniform float tFlip;\nuniform float opacity;\nvarying vec3 vWorldDirection;\nvoid main() {\n\tvec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );\n\tgl_FragColor = texColor;\n\tgl_FragColor.a *= opacity;\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n}",depth_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvHighPrecisionZW = gl_Position.zw;\n}",depth_frag:"#if DEPTH_PACKING == 3200\n\tuniform float opacity;\n#endif\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#if DEPTH_PACKING == 3200\n\t\tdiffuseColor.a = opacity;\n\t#endif\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <logdepthbuf_fragment>\n\tfloat fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;\n\t#if DEPTH_PACKING == 3200\n\t\tgl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );\n\t#elif DEPTH_PACKING == 3201\n\t\tgl_FragColor = packDepthToRGBA( fragCoordZ );\n\t#endif\n}",distanceRGBA_vert:"#define DISTANCE\nvarying vec3 vWorldPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\tvWorldPosition = worldPosition.xyz;\n}",distanceRGBA_frag:"#define DISTANCE\nuniform vec3 referencePosition;\nuniform float nearDistance;\nuniform float farDistance;\nvarying vec3 vWorldPosition;\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main () {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\tfloat dist = length( vWorldPosition - referencePosition );\n\tdist = ( dist - nearDistance ) / ( farDistance - nearDistance );\n\tdist = saturate( dist );\n\tgl_FragColor = packDepthToRGBA( dist );\n}",equirect_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}",equirect_frag:"uniform sampler2D tEquirect;\nvarying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvec3 direction = normalize( vWorldDirection );\n\tvec2 sampleUV = equirectUv( direction );\n\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n}",linedashed_vert:"uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;\n#include <common>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\tvLineDistance = scale * lineDistance;\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",linedashed_frag:"uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\t\tdiscard;\n\t}\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",meshbasic_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinbase_vertex>\n\t\t#include <skinnormal_vertex>\n\t\t#include <defaultnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <fog_vertex>\n}",meshbasic_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <specularmap_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel = texture2D( lightMap, vLightMapUv );\n\t\treflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;\n\t#else\n\t\treflectedLight.indirectDiffuse += vec3( 1.0 );\n\t#endif\n\t#include <aomap_fragment>\n\treflectedLight.indirectDiffuse *= diffuseColor.rgb;\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\t#include <envmap_fragment>\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshlambert_vert:"#define LAMBERT\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshlambert_frag:"#define LAMBERT\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_lambert_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_lambert_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshmatcap_vert:"#define MATCAP\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n\tvViewPosition = - mvPosition.xyz;\n}",meshmatcap_frag:"#define MATCAP\nuniform vec3 diffuse;\nuniform float opacity;\nuniform sampler2D matcap;\nvarying vec3 vViewPosition;\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <fog_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tvec3 viewDir = normalize( vViewPosition );\n\tvec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );\n\tvec3 y = cross( viewDir, x );\n\tvec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;\n\t#ifdef USE_MATCAP\n\t\tvec4 matcapColor = texture2D( matcap, uv );\n\t#else\n\t\tvec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );\n\t#endif\n\tvec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshnormal_vert:"#define NORMAL\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )\n\tvarying vec3 vViewPosition;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n}",meshnormal_frag:"#define NORMAL\nuniform float opacity;\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )\n\tvarying vec3 vViewPosition;\n#endif\n#include <packing>\n#include <uv_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tgl_FragColor = vec4( packNormalToRGB( normal ), opacity );\n\t#ifdef OPAQUE\n\t\tgl_FragColor.a = 1.0;\n\t#endif\n}",meshphong_vert:"#define PHONG\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshphong_frag:"#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_phong_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshphysical_vert:"#define STANDARD\nvarying vec3 vViewPosition;\n#ifdef USE_TRANSMISSION\n\tvarying vec3 vWorldPosition;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n#ifdef USE_TRANSMISSION\n\tvWorldPosition = worldPosition.xyz;\n#endif\n}",meshphysical_frag:"#define STANDARD\n#ifdef PHYSICAL\n\t#define IOR\n\t#define USE_SPECULAR\n#endif\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n#ifdef IOR\n\tuniform float ior;\n#endif\n#ifdef USE_SPECULAR\n\tuniform float specularIntensity;\n\tuniform vec3 specularColor;\n\t#ifdef USE_SPECULAR_COLORMAP\n\t\tuniform sampler2D specularColorMap;\n\t#endif\n\t#ifdef USE_SPECULAR_INTENSITYMAP\n\t\tuniform sampler2D specularIntensityMap;\n\t#endif\n#endif\n#ifdef USE_CLEARCOAT\n\tuniform float clearcoat;\n\tuniform float clearcoatRoughness;\n#endif\n#ifdef USE_IRIDESCENCE\n\tuniform float iridescence;\n\tuniform float iridescenceIOR;\n\tuniform float iridescenceThicknessMinimum;\n\tuniform float iridescenceThicknessMaximum;\n#endif\n#ifdef USE_SHEEN\n\tuniform vec3 sheenColor;\n\tuniform float sheenRoughness;\n\t#ifdef USE_SHEEN_COLORMAP\n\t\tuniform sampler2D sheenColorMap;\n\t#endif\n\t#ifdef USE_SHEEN_ROUGHNESSMAP\n\t\tuniform sampler2D sheenRoughnessMap;\n\t#endif\n#endif\n#ifdef USE_ANISOTROPY\n\tuniform vec2 anisotropyVector;\n\t#ifdef USE_ANISOTROPYMAP\n\t\tuniform sampler2D anisotropyMap;\n\t#endif\n#endif\nvarying vec3 vViewPosition;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <iridescence_fragment>\n#include <cube_uv_reflection_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_physical_pars_fragment>\n#include <fog_pars_fragment>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_physical_pars_fragment>\n#include <transmission_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <clearcoat_pars_fragment>\n#include <iridescence_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <clearcoat_normal_fragment_begin>\n\t#include <clearcoat_normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_physical_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;\n\tvec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;\n\t#include <transmission_fragment>\n\tvec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;\n\t#ifdef USE_SHEEN\n\t\tfloat sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );\n\t\toutgoingLight = outgoingLight * sheenEnergyComp + sheenSpecular;\n\t#endif\n\t#ifdef USE_CLEARCOAT\n\t\tfloat dotNVcc = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );\n\t\tvec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );\n\t\toutgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + clearcoatSpecular * material.clearcoat;\n\t#endif\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshtoon_vert:"#define TOON\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshtoon_frag:"#define TOON\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_toon_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_toon_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",points_vert:"uniform float size;\nuniform float scale;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n#ifdef USE_POINTS_UV\n\tvarying vec2 vUv;\n\tuniform mat3 uvTransform;\n#endif\nvoid main() {\n\t#ifdef USE_POINTS_UV\n\t\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\t#endif\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\tgl_PointSize = size;\n\t#ifdef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );\n\t#endif\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <fog_vertex>\n}",points_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_particle_fragment>\n\t#include <color_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",shadow_vert:"#include <common>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <shadowmap_pars_vertex>\nvoid main() {\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",shadow_frag:"uniform vec3 color;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <logdepthbuf_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\nvoid main() {\n\t#include <logdepthbuf_fragment>\n\tgl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n}",sprite_vert:"uniform float rotation;\nuniform vec2 center;\n#include <common>\n#include <uv_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\tvec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\n\tvec2 scale;\n\tscale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );\n\tscale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );\n\t#ifndef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) scale *= - mvPosition.z;\n\t#endif\n\tvec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;\n\tvec2 rotatedPosition;\n\trotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\n\trotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\n\tmvPosition.xy += rotatedPosition;\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",sprite_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n}"},et={common:{diffuse:{value:new Qe(16777215)},opacity:{value:1},map:{value:null},mapTransform:{value:new un},alphaMap:{value:null},alphaMapTransform:{value:new un},alphaTest:{value:0}},specularmap:{specularMap:{value:null},specularMapTransform:{value:new un}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1},aoMapTransform:{value:new un}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1},lightMapTransform:{value:new un}},bumpmap:{bumpMap:{value:null},bumpMapTransform:{value:new un},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalMapTransform:{value:new un},normalScale:{value:new Be(1,1)}},displacementmap:{displacementMap:{value:null},displacementMapTransform:{value:new un},displacementScale:{value:1},displacementBias:{value:0}},emissivemap:{emissiveMap:{value:null},emissiveMapTransform:{value:new un}},metalnessmap:{metalnessMap:{value:null},metalnessMapTransform:{value:new un}},roughnessmap:{roughnessMap:{value:null},roughnessMapTransform:{value:new un}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new Qe(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new Qe(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaMapTransform:{value:new un},alphaTest:{value:0},uvTransform:{value:new un}},sprite:{diffuse:{value:new Qe(16777215)},opacity:{value:1},center:{value:new Be(.5,.5)},rotation:{value:0},map:{value:null},mapTransform:{value:new un},alphaMap:{value:null},alphaMapTransform:{value:new un},alphaTest:{value:0}}},Gs={basic:{uniforms:nr([et.common,et.specularmap,et.envmap,et.aomap,et.lightmap,et.fog]),vertexShader:rn.meshbasic_vert,fragmentShader:rn.meshbasic_frag},lambert:{uniforms:nr([et.common,et.specularmap,et.envmap,et.aomap,et.lightmap,et.emissivemap,et.bumpmap,et.normalmap,et.displacementmap,et.fog,et.lights,{emissive:{value:new Qe(0)}}]),vertexShader:rn.meshlambert_vert,fragmentShader:rn.meshlambert_frag},phong:{uniforms:nr([et.common,et.specularmap,et.envmap,et.aomap,et.lightmap,et.emissivemap,et.bumpmap,et.normalmap,et.displacementmap,et.fog,et.lights,{emissive:{value:new Qe(0)},specular:{value:new Qe(1118481)},shininess:{value:30}}]),vertexShader:rn.meshphong_vert,fragmentShader:rn.meshphong_frag},standard:{uniforms:nr([et.common,et.envmap,et.aomap,et.lightmap,et.emissivemap,et.bumpmap,et.normalmap,et.displacementmap,et.roughnessmap,et.metalnessmap,et.fog,et.lights,{emissive:{value:new Qe(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:rn.meshphysical_vert,fragmentShader:rn.meshphysical_frag},toon:{uniforms:nr([et.common,et.aomap,et.lightmap,et.emissivemap,et.bumpmap,et.normalmap,et.displacementmap,et.gradientmap,et.fog,et.lights,{emissive:{value:new Qe(0)}}]),vertexShader:rn.meshtoon_vert,fragmentShader:rn.meshtoon_frag},matcap:{uniforms:nr([et.common,et.bumpmap,et.normalmap,et.displacementmap,et.fog,{matcap:{value:null}}]),vertexShader:rn.meshmatcap_vert,fragmentShader:rn.meshmatcap_frag},points:{uniforms:nr([et.points,et.fog]),vertexShader:rn.points_vert,fragmentShader:rn.points_frag},dashed:{uniforms:nr([et.common,et.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:rn.linedashed_vert,fragmentShader:rn.linedashed_frag},depth:{uniforms:nr([et.common,et.displacementmap]),vertexShader:rn.depth_vert,fragmentShader:rn.depth_frag},normal:{uniforms:nr([et.common,et.bumpmap,et.normalmap,et.displacementmap,{opacity:{value:1}}]),vertexShader:rn.meshnormal_vert,fragmentShader:rn.meshnormal_frag},sprite:{uniforms:nr([et.sprite,et.fog]),vertexShader:rn.sprite_vert,fragmentShader:rn.sprite_frag},background:{uniforms:{uvTransform:{value:new un},t2D:{value:null},backgroundIntensity:{value:1}},vertexShader:rn.background_vert,fragmentShader:rn.background_frag},backgroundCube:{uniforms:{envMap:{value:null},flipEnvMap:{value:-1},backgroundBlurriness:{value:0},backgroundIntensity:{value:1}},vertexShader:rn.backgroundCube_vert,fragmentShader:rn.backgroundCube_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:rn.cube_vert,fragmentShader:rn.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:rn.equirect_vert,fragmentShader:rn.equirect_frag},distanceRGBA:{uniforms:nr([et.common,et.displacementmap,{referencePosition:{value:new q},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:rn.distanceRGBA_vert,fragmentShader:rn.distanceRGBA_frag},shadow:{uniforms:nr([et.lights,et.fog,{color:{value:new Qe(0)},opacity:{value:1}}]),vertexShader:rn.shadow_vert,fragmentShader:rn.shadow_frag}};Gs.physical={uniforms:nr([Gs.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatMapTransform:{value:new un},clearcoatNormalMap:{value:null},clearcoatNormalMapTransform:{value:new un},clearcoatNormalScale:{value:new Be(1,1)},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatRoughnessMapTransform:{value:new un},iridescence:{value:0},iridescenceMap:{value:null},iridescenceMapTransform:{value:new un},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},iridescenceThicknessMapTransform:{value:new un},sheen:{value:0},sheenColor:{value:new Qe(0)},sheenColorMap:{value:null},sheenColorMapTransform:{value:new un},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},sheenRoughnessMapTransform:{value:new un},transmission:{value:0},transmissionMap:{value:null},transmissionMapTransform:{value:new un},transmissionSamplerSize:{value:new Be},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},thicknessMapTransform:{value:new un},attenuationDistance:{value:0},attenuationColor:{value:new Qe(0)},specularColor:{value:new Qe(1,1,1)},specularColorMap:{value:null},specularColorMapTransform:{value:new un},specularIntensity:{value:1},specularIntensityMap:{value:null},specularIntensityMapTransform:{value:new un},anisotropyVector:{value:new Be},anisotropyMap:{value:null},anisotropyMapTransform:{value:new un}}]),vertexShader:rn.meshphysical_vert,fragmentShader:rn.meshphysical_frag};const Fp={r:0,b:0,g:0};function PG(n,e,t,i,r,s,o){const a=new Qe(0);let u,d,l=!0===s?0:1,f=null,p=0,_=null;function w(A,b){A.getRGB(Fp,WC(n)),i.buffers.color.setClear(Fp.r,Fp.g,Fp.b,b,o)}return{getClearColor:function(){return a},setClearColor:function(A,b=1){a.set(A),l=b,w(a,l)},getClearAlpha:function(){return l},setClearAlpha:function(A){l=A,w(a,l)},render:function y(A,b){let C=!1,T=!0===b.isScene?b.background:null;switch(T&&T.isTexture&&(T=(b.backgroundBlurriness>0?t:e).get(T)),null===T?w(a,l):T&&T.isColor&&(w(T,1),C=!0),n.xr.getEnvironmentBlendMode()){case"opaque":C=!0;break;case"additive":i.buffers.color.setClear(0,0,0,1,o),C=!0;break;case"alpha-blend":i.buffers.color.setClear(0,0,0,0,o),C=!0}(n.autoClear||C)&&n.clear(n.autoClearColor,n.autoClearDepth,n.autoClearStencil),T&&(T.isCubeTexture||T.mapping===Eh)?(void 0===d&&(d=new Gn(new Xa(1,1,1),new Zr({name:"BackgroundCubeMaterial",uniforms:Hc(Gs.backgroundCube.uniforms),vertexShader:Gs.backgroundCube.vertexShader,fragmentShader:Gs.backgroundCube.fragmentShader,side:1,depthTest:!1,depthWrite:!1,fog:!1})),d.geometry.deleteAttribute("normal"),d.geometry.deleteAttribute("uv"),d.onBeforeRender=function(k,G,K){this.matrixWorld.copyPosition(K.matrixWorld)},Object.defineProperty(d.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),r.update(d)),d.material.uniforms.envMap.value=T,d.material.uniforms.flipEnvMap.value=T.isCubeTexture&&!1===T.isRenderTargetTexture?-1:1,d.material.uniforms.backgroundBlurriness.value=b.backgroundBlurriness,d.material.uniforms.backgroundIntensity.value=b.backgroundIntensity,d.material.toneMapped=T.colorSpace!==jt,(f!==T||p!==T.version||_!==n.toneMapping)&&(d.material.needsUpdate=!0,f=T,p=T.version,_=n.toneMapping),d.layers.enableAll(),A.unshift(d,d.geometry,d.material,0,0,null)):T&&T.isTexture&&(void 0===u&&(u=new Gn(new Ja(2,2),new Zr({name:"BackgroundMaterial",uniforms:Hc(Gs.background.uniforms),vertexShader:Gs.background.vertexShader,fragmentShader:Gs.background.fragmentShader,side:0,depthTest:!1,depthWrite:!1,fog:!1})),u.geometry.deleteAttribute("normal"),Object.defineProperty(u.material,"map",{get:function(){return this.uniforms.t2D.value}}),r.update(u)),u.material.uniforms.t2D.value=T,u.material.uniforms.backgroundIntensity.value=b.backgroundIntensity,u.material.toneMapped=T.colorSpace!==jt,!0===T.matrixAutoUpdate&&T.updateMatrix(),u.material.uniforms.uvTransform.value.copy(T.matrix),(f!==T||p!==T.version||_!==n.toneMapping)&&(u.material.needsUpdate=!0,f=T,p=T.version,_=n.toneMapping),u.layers.enableAll(),A.unshift(u,u.geometry,u.material,0,0,null))}}}function LG(n,e,t,i){const r=n.getParameter(n.MAX_VERTEX_ATTRIBS),s=i.isWebGL2?null:e.get("OES_vertex_array_object"),o=i.isWebGL2||null!==s,a={},l=A(null);let u=l,d=!1;function _(ue){return i.isWebGL2?n.bindVertexArray(ue):s.bindVertexArrayOES(ue)}function y(ue){return i.isWebGL2?n.deleteVertexArray(ue):s.deleteVertexArrayOES(ue)}function A(ue){const _e=[],Le=[],Se=[];for(let De=0;De<r;De++)_e[De]=0,Le[De]=0,Se[De]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:_e,enabledAttributes:Le,attributeDivisors:Se,object:ue,attributes:{},index:null}}function T(){const ue=u.newAttributes;for(let _e=0,Le=ue.length;_e<Le;_e++)ue[_e]=0}function I(ue){N(ue,0)}function N(ue,_e){const Se=u.enabledAttributes,De=u.attributeDivisors;u.newAttributes[ue]=1,0===Se[ue]&&(n.enableVertexAttribArray(ue),Se[ue]=1),De[ue]!==_e&&((i.isWebGL2?n:e.get("ANGLE_instanced_arrays"))[i.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](ue,_e),De[ue]=_e)}function k(){const ue=u.newAttributes,_e=u.enabledAttributes;for(let Le=0,Se=_e.length;Le<Se;Le++)_e[Le]!==ue[Le]&&(n.disableVertexAttribArray(Le),_e[Le]=0)}function G(ue,_e,Le,Se,De,Fe,Ve){!0===Ve?n.vertexAttribIPointer(ue,_e,Le,De,Fe):n.vertexAttribPointer(ue,_e,Le,Se,De,Fe)}function Te(){le(),d=!0,u!==l&&(u=l,_(u.object))}function le(){l.geometry=null,l.program=null,l.wireframe=!1}return{setup:function f(ue,_e,Le,Se,De){let Fe=!1;if(o){const Ve=function w(ue,_e,Le){const Se=!0===Le.wireframe;let De=a[ue.id];void 0===De&&(De={},a[ue.id]=De);let Fe=De[_e.id];void 0===Fe&&(Fe={},De[_e.id]=Fe);let Ve=Fe[Se];return void 0===Ve&&(Ve=A(function p(){return i.isWebGL2?n.createVertexArray():s.createVertexArrayOES()}()),Fe[Se]=Ve),Ve}(Se,Le,_e);u!==Ve&&(u=Ve,_(u.object)),Fe=function b(ue,_e,Le,Se){const De=u.attributes,Fe=_e.attributes;let Ve=0;const he=Le.getAttributes();for(const Ce in he)if(he[Ce].location>=0){const tt=De[Ce];let it=Fe[Ce];if(void 0===it&&("instanceMatrix"===Ce&&ue.instanceMatrix&&(it=ue.instanceMatrix),"instanceColor"===Ce&&ue.instanceColor&&(it=ue.instanceColor)),void 0===tt||tt.attribute!==it||it&&tt.data!==it.data)return!0;Ve++}return u.attributesNum!==Ve||u.index!==Se}(ue,Se,Le,De),Fe&&function C(ue,_e,Le,Se){const De={},Fe=_e.attributes;let Ve=0;const he=Le.getAttributes();for(const Ce in he)if(he[Ce].location>=0){let tt=Fe[Ce];void 0===tt&&("instanceMatrix"===Ce&&ue.instanceMatrix&&(tt=ue.instanceMatrix),"instanceColor"===Ce&&ue.instanceColor&&(tt=ue.instanceColor));const it={};it.attribute=tt,tt&&tt.data&&(it.data=tt.data),De[Ce]=it,Ve++}u.attributes=De,u.attributesNum=Ve,u.index=Se}(ue,Se,Le,De)}else{const Ve=!0===_e.wireframe;(u.geometry!==Se.id||u.program!==Le.id||u.wireframe!==Ve)&&(u.geometry=Se.id,u.program=Le.id,u.wireframe=Ve,Fe=!0)}null!==De&&t.update(De,n.ELEMENT_ARRAY_BUFFER),(Fe||d)&&(d=!1,function K(ue,_e,Le,Se){if(!1===i.isWebGL2&&(ue.isInstancedMesh||Se.isInstancedBufferGeometry)&&null===e.get("ANGLE_instanced_arrays"))return;T();const De=Se.attributes,Fe=Le.getAttributes(),Ve=_e.defaultAttributeValues;for(const he in Fe){const Ce=Fe[he];if(Ce.location>=0){let Ye=De[he];if(void 0===Ye&&("instanceMatrix"===he&&ue.instanceMatrix&&(Ye=ue.instanceMatrix),"instanceColor"===he&&ue.instanceColor&&(Ye=ue.instanceColor)),void 0!==Ye){const tt=Ye.normalized,it=Ye.itemSize,gt=t.get(Ye);if(void 0===gt)continue;const Ct=gt.buffer,wt=gt.type,Tn=gt.bytesPerElement,Dn=!0===i.isWebGL2&&(wt===n.INT||wt===n.UNSIGNED_INT||1013===Ye.gpuType);if(Ye.isInterleavedBufferAttribute){const Nt=Ye.data,te=Nt.stride,Ze=Ye.offset;if(Nt.isInstancedInterleavedBuffer){for(let Re=0;Re<Ce.locationSize;Re++)N(Ce.location+Re,Nt.meshPerAttribute);!0!==ue.isInstancedMesh&&void 0===Se._maxInstanceCount&&(Se._maxInstanceCount=Nt.meshPerAttribute*Nt.count)}else for(let Re=0;Re<Ce.locationSize;Re++)I(Ce.location+Re);n.bindBuffer(n.ARRAY_BUFFER,Ct);for(let Re=0;Re<Ce.locationSize;Re++)G(Ce.location+Re,it/Ce.locationSize,wt,tt,te*Tn,(Ze+it/Ce.locationSize*Re)*Tn,Dn)}else{if(Ye.isInstancedBufferAttribute){for(let Nt=0;Nt<Ce.locationSize;Nt++)N(Ce.location+Nt,Ye.meshPerAttribute);!0!==ue.isInstancedMesh&&void 0===Se._maxInstanceCount&&(Se._maxInstanceCount=Ye.meshPerAttribute*Ye.count)}else for(let Nt=0;Nt<Ce.locationSize;Nt++)I(Ce.location+Nt);n.bindBuffer(n.ARRAY_BUFFER,Ct);for(let Nt=0;Nt<Ce.locationSize;Nt++)G(Ce.location+Nt,it/Ce.locationSize,wt,tt,it*Tn,it/Ce.locationSize*Nt*Tn,Dn)}}else if(void 0!==Ve){const tt=Ve[he];if(void 0!==tt)switch(tt.length){case 2:n.vertexAttrib2fv(Ce.location,tt);break;case 3:n.vertexAttrib3fv(Ce.location,tt);break;case 4:n.vertexAttrib4fv(Ce.location,tt);break;default:n.vertexAttrib1fv(Ce.location,tt)}}}}k()}(ue,_e,Le,Se),null!==De&&n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,t.get(De).buffer))},reset:Te,resetDefaultState:le,dispose:function L(){Te();for(const ue in a){const _e=a[ue];for(const Le in _e){const Se=_e[Le];for(const De in Se)y(Se[De].object),delete Se[De];delete _e[Le]}delete a[ue]}},releaseStatesOfGeometry:function H(ue){if(void 0===a[ue.id])return;const _e=a[ue.id];for(const Le in _e){const Se=_e[Le];for(const De in Se)y(Se[De].object),delete Se[De];delete _e[Le]}delete a[ue.id]},releaseStatesOfProgram:function me(ue){for(const _e in a){const Le=a[_e];if(void 0===Le[ue.id])continue;const Se=Le[ue.id];for(const De in Se)y(Se[De].object),delete Se[De];delete Le[ue.id]}},initAttributes:T,enableAttribute:I,disableUnusedAttributes:k}}function NG(n,e,t,i){const r=i.isWebGL2;let s;this.setMode=function o(u){s=u},this.render=function a(u,d){n.drawArrays(s,u,d),t.update(d,s,1)},this.renderInstances=function l(u,d,f){if(0===f)return;let p,_;if(r)p=n,_="drawArraysInstanced";else if(p=e.get("ANGLE_instanced_arrays"),_="drawArraysInstancedANGLE",null===p)return void console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");p[_](s,u,d,f),t.update(d,s,f)}}function BG(n,e,t){let i;function s(G){if("highp"===G){if(n.getShaderPrecisionFormat(n.VERTEX_SHADER,n.HIGH_FLOAT).precision>0&&n.getShaderPrecisionFormat(n.FRAGMENT_SHADER,n.HIGH_FLOAT).precision>0)return"highp";G="mediump"}return"mediump"===G&&n.getShaderPrecisionFormat(n.VERTEX_SHADER,n.MEDIUM_FLOAT).precision>0&&n.getShaderPrecisionFormat(n.FRAGMENT_SHADER,n.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}const o=typeof WebGL2RenderingContext<"u"&&"WebGL2RenderingContext"===n.constructor.name;let a=void 0!==t.precision?t.precision:"highp";const l=s(a);l!==a&&(console.warn("THREE.WebGLRenderer:",a,"not supported, using",l,"instead."),a=l);const u=o||e.has("WEBGL_draw_buffers"),d=!0===t.logarithmicDepthBuffer,f=n.getParameter(n.MAX_TEXTURE_IMAGE_UNITS),p=n.getParameter(n.MAX_VERTEX_TEXTURE_IMAGE_UNITS),_=n.getParameter(n.MAX_TEXTURE_SIZE),y=n.getParameter(n.MAX_CUBE_MAP_TEXTURE_SIZE),w=n.getParameter(n.MAX_VERTEX_ATTRIBS),A=n.getParameter(n.MAX_VERTEX_UNIFORM_VECTORS),b=n.getParameter(n.MAX_VARYING_VECTORS),C=n.getParameter(n.MAX_FRAGMENT_UNIFORM_VECTORS),T=p>0,I=o||e.has("OES_texture_float");return{isWebGL2:o,drawBuffers:u,getMaxAnisotropy:function r(){if(void 0!==i)return i;if(!0===e.has("EXT_texture_filter_anisotropic")){const G=e.get("EXT_texture_filter_anisotropic");i=n.getParameter(G.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else i=0;return i},getMaxPrecision:s,precision:a,logarithmicDepthBuffer:d,maxTextures:f,maxVertexTextures:p,maxTextureSize:_,maxCubemapSize:y,maxAttributes:w,maxVertexUniforms:A,maxVaryings:b,maxFragmentUniforms:C,vertexTextures:T,floatFragmentTextures:I,floatVertexTextures:T&&I,maxSamples:o?n.getParameter(n.MAX_SAMPLES):0}}function FG(n){const e=this;let t=null,i=0,r=!1,s=!1;const o=new Ya,a=new un,l={value:null,needsUpdate:!1};function d(f,p,_,y){const w=null!==f?f.length:0;let A=null;if(0!==w){if(A=l.value,!0!==y||null===A){const b=_+4*w,C=p.matrixWorldInverse;a.getNormalMatrix(C),(null===A||A.length<b)&&(A=new Float32Array(b));for(let T=0,I=_;T!==w;++T,I+=4)o.copy(f[T]).applyMatrix4(C,a),o.normal.toArray(A,I),A[I+3]=o.constant}l.value=A,l.needsUpdate=!0}return e.numPlanes=w,e.numIntersection=0,A}this.uniform=l,this.numPlanes=0,this.numIntersection=0,this.init=function(f,p){const _=0!==f.length||p||0!==i||r;return r=p,i=f.length,_},this.beginShadows=function(){s=!0,d(null)},this.endShadows=function(){s=!1},this.setGlobalState=function(f,p){t=d(f,p,0)},this.setState=function(f,p,_){const y=f.clippingPlanes,w=f.clipIntersection,A=f.clipShadows,b=n.get(f);if(!r||null===y||0===y.length||s&&!A)s?d(null):function u(){l.value!==t&&(l.value=t,l.needsUpdate=i>0),e.numPlanes=i,e.numIntersection=0}();else{const C=s?0:i,T=4*C;let I=b.clippingState||null;l.value=I,I=d(y,p,T,_);for(let N=0;N!==T;++N)I[N]=t[N];b.clippingState=I,this.numIntersection=w?this.numPlanes:0,this.numPlanes+=C}}}function OG(n){let e=new WeakMap;function t(o,a){return 303===a?o.mapping=Ba:304===a&&(o.mapping=Fa),o}function r(o){const a=o.target;a.removeEventListener("dispose",r);const l=e.get(a);void 0!==l&&(e.delete(a),l.dispose())}return{get:function i(o){if(o&&o.isTexture&&!1===o.isRenderTargetTexture){const a=o.mapping;if(303===a||304===a){if(e.has(o))return t(e.get(o).texture,o.mapping);{const l=o.image;if(l&&l.height>0){const u=new Rz(l.height/2);return u.fromEquirectangularTexture(n,o),e.set(o,u),o.addEventListener("dispose",r),t(u.texture,o.mapping)}return null}}}return o},dispose:function s(){e=new WeakMap}}}class Op extends Oy{constructor(e=-1,t=1,i=1,r=-1,s=.1,o=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=t,this.top=i,this.bottom=r,this.near=s,this.far=o,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=null===e.view?null:Object.assign({},e.view),this}setViewOffset(e,t,i,r,s,o){null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=i,this.view.offsetY=r,this.view.width=s,this.view.height=o,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),i=(this.right+this.left)/2,r=(this.top+this.bottom)/2;let s=i-e,o=i+e,a=r+t,l=r-t;if(null!==this.view&&this.view.enabled){const u=(this.right-this.left)/this.view.fullWidth/this.zoom,d=(this.top-this.bottom)/this.view.fullHeight/this.zoom;s+=u*this.view.offsetX,o=s+u*this.view.width,a-=d*this.view.offsetY,l=a-d*this.view.height}this.projectionMatrix.makeOrthographic(s,o,a,l,this.near,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,null!==this.view&&(t.object.view=Object.assign({},this.view)),t}}const jC=[.125,.215,.35,.446,.526,.582],Uy=new Op,$C=new Qe;let zy=null;const Qa=(1+Math.sqrt(5))/2,jc=1/Qa,XC=[new q(1,1,1),new q(-1,1,1),new q(1,1,-1),new q(-1,1,-1),new q(0,Qa,jc),new q(0,Qa,-jc),new q(jc,0,Qa),new q(-jc,0,Qa),new q(Qa,jc,0),new q(-Qa,jc,0)];class YC{constructor(e){this._renderer=e,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(e,t=0,i=.1,r=100){zy=this._renderer.getRenderTarget(),this._setSize(256);const s=this._allocateTargets();return s.depthBuffer=!0,this._sceneToCubeUV(e,i,r,s),t>0&&this._blur(s,0,0,t),this._applyPMREM(s),this._cleanup(s),s}fromEquirectangular(e,t=null){return this._fromTexture(e,t)}fromCubemap(e,t=null){return this._fromTexture(e,t)}compileCubemapShader(){null===this._cubemapMaterial&&(this._cubemapMaterial=KC(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){null===this._equirectMaterial&&(this._equirectMaterial=JC(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),null!==this._cubemapMaterial&&this._cubemapMaterial.dispose(),null!==this._equirectMaterial&&this._equirectMaterial.dispose()}_setSize(e){this._lodMax=Math.floor(Math.log2(e)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){null!==this._blurMaterial&&this._blurMaterial.dispose(),null!==this._pingPongRenderTarget&&this._pingPongRenderTarget.dispose();for(let e=0;e<this._lodPlanes.length;e++)this._lodPlanes[e].dispose()}_cleanup(e){this._renderer.setRenderTarget(zy),e.scissorTest=!1,Vp(e,0,0,e.width,e.height)}_fromTexture(e,t){this._setSize(e.mapping===Ba||e.mapping===Fa?0===e.image.length?16:e.image[0].width||e.image[0].image.width:e.image.width/4),zy=this._renderer.getRenderTarget();const i=t||this._allocateTargets();return this._textureToCubeUV(e,i),this._applyPMREM(i),this._cleanup(i),i}_allocateTargets(){const e=3*Math.max(this._cubeSize,112),t=4*this._cubeSize,i={magFilter:ei,minFilter:ei,generateMipmaps:!1,type:Dh,format:jr,colorSpace:zs,depthBuffer:!1},r=ZC(e,t,i);if(null===this._pingPongRenderTarget||this._pingPongRenderTarget.width!==e||this._pingPongRenderTarget.height!==t){null!==this._pingPongRenderTarget&&this._dispose(),this._pingPongRenderTarget=ZC(e,t,i);const{_lodMax:s}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=function VG(n){const e=[],t=[],i=[];let r=n;const s=n-4+1+jC.length;for(let o=0;o<s;o++){const a=Math.pow(2,r);t.push(a);let l=1/a;o>n-4?l=jC[o-n+4-1]:0===o&&(l=0),i.push(l);const u=1/(a-2),d=-u,f=1+u,p=[d,d,f,d,f,f,d,d,f,f,d,f],_=6,y=6,w=3,A=2,b=1,C=new Float32Array(w*y*_),T=new Float32Array(A*y*_),I=new Float32Array(b*y*_);for(let k=0;k<_;k++){const G=k%3*2/3-1,K=k>2?0:-1;C.set([G,K,0,G+2/3,K,0,G+2/3,K+1,0,G,K,0,G+2/3,K+1,0,G,K+1,0],w*y*k),T.set(p,A*y*k),I.set([k,k,k,k,k,k],b*y*k)}const N=new hn;N.setAttribute("position",new ni(C,w)),N.setAttribute("uv",new ni(T,A)),N.setAttribute("faceIndex",new ni(I,b)),e.push(N),r>4&&r--}return{lodPlanes:e,sizeLods:t,sigmas:i}}(s)),this._blurMaterial=function kG(n,e,t){const i=new Float32Array(20),r=new q(0,1,0);return new Zr({name:"SphericalGaussianBlur",defines:{n:20,CUBEUV_TEXEL_WIDTH:1/e,CUBEUV_TEXEL_HEIGHT:1/t,CUBEUV_MAX_MIP:`${n}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:i},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:r}},vertexShader:"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t",fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\t\t\tuniform int samples;\n\t\t\tuniform float weights[ n ];\n\t\t\tuniform bool latitudinal;\n\t\t\tuniform float dTheta;\n\t\t\tuniform float mipInt;\n\t\t\tuniform vec3 poleAxis;\n\n\t\t\t#define ENVMAP_TYPE_CUBE_UV\n\t\t\t#include <cube_uv_reflection_fragment>\n\n\t\t\tvec3 getSample( float theta, vec3 axis ) {\n\n\t\t\t\tfloat cosTheta = cos( theta );\n\t\t\t\t// Rodrigues' axis-angle rotation\n\t\t\t\tvec3 sampleDirection = vOutputDirection * cosTheta\n\t\t\t\t\t+ cross( axis, vOutputDirection ) * sin( theta )\n\t\t\t\t\t+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );\n\n\t\t\t\treturn bilinearCubeUV( envMap, sampleDirection, mipInt );\n\n\t\t\t}\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );\n\n\t\t\t\tif ( all( equal( axis, vec3( 0.0 ) ) ) ) {\n\n\t\t\t\t\taxis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );\n\n\t\t\t\t}\n\n\t\t\t\taxis = normalize( axis );\n\n\t\t\t\tgl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t\t\t\tgl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );\n\n\t\t\t\tfor ( int i = 1; i < n; i++ ) {\n\n\t\t\t\t\tif ( i >= samples ) {\n\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t}\n\n\t\t\t\t\tfloat theta = dTheta * float( i );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( theta, axis );\n\n\t\t\t\t}\n\n\t\t\t}\n\t\t",blending:0,depthTest:!1,depthWrite:!1})}(s,e,t)}return r}_compileMaterial(e){const t=new Gn(this._lodPlanes[0],e);this._renderer.compile(t,Uy)}_sceneToCubeUV(e,t,i,r){const a=new Fi(90,1,t,i),l=[1,-1,1,1,1,1],u=[1,1,1,-1,-1,-1],d=this._renderer,f=d.autoClear,p=d.toneMapping;d.getClearColor($C),d.toneMapping=mo,d.autoClear=!1;const _=new Xr({name:"PMREM.Background",side:1,depthWrite:!1,depthTest:!1}),y=new Gn(new Xa,_);let w=!1;const A=e.background;A?A.isColor&&(_.color.copy(A),e.background=null,w=!0):(_.color.copy($C),w=!0);for(let b=0;b<6;b++){const C=b%3;0===C?(a.up.set(0,l[b],0),a.lookAt(u[b],0,0)):1===C?(a.up.set(0,0,l[b]),a.lookAt(0,u[b],0)):(a.up.set(0,l[b],0),a.lookAt(0,0,u[b]));const T=this._cubeSize;Vp(r,C*T,b>2?T:0,T,T),d.setRenderTarget(r),w&&d.render(y,a),d.render(e,a)}y.geometry.dispose(),y.material.dispose(),d.toneMapping=p,d.autoClear=f,e.background=A}_textureToCubeUV(e,t){const i=this._renderer,r=e.mapping===Ba||e.mapping===Fa;r?(null===this._cubemapMaterial&&(this._cubemapMaterial=KC()),this._cubemapMaterial.uniforms.flipEnvMap.value=!1===e.isRenderTargetTexture?-1:1):null===this._equirectMaterial&&(this._equirectMaterial=JC());const s=r?this._cubemapMaterial:this._equirectMaterial,o=new Gn(this._lodPlanes[0],s);s.uniforms.envMap.value=e;const l=this._cubeSize;Vp(t,0,0,3*l,2*l),i.setRenderTarget(t),i.render(o,Uy)}_applyPMREM(e){const t=this._renderer,i=t.autoClear;t.autoClear=!1;for(let r=1;r<this._lodPlanes.length;r++){const s=Math.sqrt(this._sigmas[r]*this._sigmas[r]-this._sigmas[r-1]*this._sigmas[r-1]);this._blur(e,r-1,r,s,XC[(r-1)%XC.length])}t.autoClear=i}_blur(e,t,i,r,s){const o=this._pingPongRenderTarget;this._halfBlur(e,o,t,i,r,"latitudinal",s),this._halfBlur(o,e,i,i,r,"longitudinal",s)}_halfBlur(e,t,i,r,s,o,a){const l=this._renderer,u=this._blurMaterial;"latitudinal"!==o&&"longitudinal"!==o&&console.error("blur direction must be either latitudinal or longitudinal!");const f=new Gn(this._lodPlanes[r],u),p=u.uniforms,_=this._sizeLods[i]-1,y=isFinite(s)?Math.PI/(2*_):2*Math.PI/39,w=s/y,A=isFinite(s)?1+Math.floor(3*w):20;A>20&&console.warn(`sigmaRadians, ${s}, is too large and will clip, as it requested ${A} samples when the maximum is set to 20`);const b=[];let C=0;for(let G=0;G<20;++G){const K=G/w,L=Math.exp(-K*K/2);b.push(L),0===G?C+=L:G<A&&(C+=2*L)}for(let G=0;G<b.length;G++)b[G]=b[G]/C;p.envMap.value=e.texture,p.samples.value=A,p.weights.value=b,p.latitudinal.value="latitudinal"===o,a&&(p.poleAxis.value=a);const{_lodMax:T}=this;p.dTheta.value=y,p.mipInt.value=T-i;const I=this._sizeLods[r];Vp(t,3*I*(r>T-4?r-T+4:0),4*(this._cubeSize-I),3*I,2*I),l.setRenderTarget(t),l.render(f,Uy)}}function ZC(n,e,t){const i=new Wa(n,e,t);return i.texture.mapping=Eh,i.texture.name="PMREM.cubeUv",i.scissorTest=!0,i}function Vp(n,e,t,i,r){n.viewport.set(e,t,i,r),n.scissor.set(e,t,i,r)}function JC(){return new Zr({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t",fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\n\t\t\t#include <common>\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 outputDirection = normalize( vOutputDirection );\n\t\t\t\tvec2 uv = equirectUv( outputDirection );\n\n\t\t\t\tgl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );\n\n\t\t\t}\n\t\t",blending:0,depthTest:!1,depthWrite:!1})}function KC(){return new Zr({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t",fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tuniform float flipEnvMap;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform samplerCube envMap;\n\n\t\t\tvoid main() {\n\n\t\t\t\tgl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );\n\n\t\t\t}\n\t\t",blending:0,depthTest:!1,depthWrite:!1})}function UG(n){let e=new WeakMap,t=null;function s(a){const l=a.target;l.removeEventListener("dispose",s);const u=e.get(l);void 0!==u&&(e.delete(l),u.dispose())}return{get:function i(a){if(a&&a.isTexture){const l=a.mapping,u=303===l||304===l,d=l===Ba||l===Fa;if(u||d){if(a.isRenderTargetTexture&&!0===a.needsPMREMUpdate){a.needsPMREMUpdate=!1;let f=e.get(a);return null===t&&(t=new YC(n)),f=u?t.fromEquirectangular(a,f):t.fromCubemap(a,f),e.set(a,f),f.texture}if(e.has(a))return e.get(a).texture;{const f=a.image;if(u&&f&&f.height>0||d&&f&&function r(a){let l=0;for(let d=0;d<6;d++)void 0!==a[d]&&l++;return 6===l}(f)){null===t&&(t=new YC(n));const p=u?t.fromEquirectangular(a):t.fromCubemap(a);return e.set(a,p),a.addEventListener("dispose",s),p.texture}return null}}}return a},dispose:function o(){e=new WeakMap,null!==t&&(t.dispose(),t=null)}}}function zG(n){const e={};function t(i){if(void 0!==e[i])return e[i];let r;switch(i){case"WEBGL_depth_texture":r=n.getExtension("WEBGL_depth_texture")||n.getExtension("MOZ_WEBGL_depth_texture")||n.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":r=n.getExtension("EXT_texture_filter_anisotropic")||n.getExtension("MOZ_EXT_texture_filter_anisotropic")||n.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":r=n.getExtension("WEBGL_compressed_texture_s3tc")||n.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||n.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":r=n.getExtension("WEBGL_compressed_texture_pvrtc")||n.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:r=n.getExtension(i)}return e[i]=r,r}return{has:function(i){return null!==t(i)},init:function(i){i.isWebGL2?t("EXT_color_buffer_float"):(t("WEBGL_depth_texture"),t("OES_texture_float"),t("OES_texture_half_float"),t("OES_texture_half_float_linear"),t("OES_standard_derivatives"),t("OES_element_index_uint"),t("OES_vertex_array_object"),t("ANGLE_instanced_arrays")),t("OES_texture_float_linear"),t("EXT_color_buffer_half_float"),t("WEBGL_multisampled_render_to_texture")},get:function(i){const r=t(i);return null===r&&console.warn("THREE.WebGLRenderer: "+i+" extension not supported."),r}}}function HG(n,e,t,i){const r={},s=new WeakMap;function o(f){const p=f.target;null!==p.index&&e.remove(p.index);for(const y in p.attributes)e.remove(p.attributes[y]);for(const y in p.morphAttributes){const w=p.morphAttributes[y];for(let A=0,b=w.length;A<b;A++)e.remove(w[A])}p.removeEventListener("dispose",o),delete r[p.id];const _=s.get(p);_&&(e.remove(_),s.delete(p)),i.releaseStatesOfGeometry(p),!0===p.isInstancedBufferGeometry&&delete p._maxInstanceCount,t.memory.geometries--}function u(f){const p=[],_=f.index,y=f.attributes.position;let w=0;if(null!==_){const C=_.array;w=_.version;for(let T=0,I=C.length;T<I;T+=3){const N=C[T+0],k=C[T+1],G=C[T+2];p.push(N,k,k,G,G,N)}}else{w=y.version;for(let T=0,I=y.array.length/3-1;T<I;T+=3){const N=T+0,k=T+1,G=T+2;p.push(N,k,k,G,G,N)}}const A=new(wC(p)?VC:OC)(p,1);A.version=w;const b=s.get(f);b&&e.remove(b),s.set(f,A)}return{get:function a(f,p){return!0===r[p.id]||(p.addEventListener("dispose",o),r[p.id]=!0,t.memory.geometries++),p},update:function l(f){const p=f.attributes;for(const y in p)e.update(p[y],n.ARRAY_BUFFER);const _=f.morphAttributes;for(const y in _){const w=_[y];for(let A=0,b=w.length;A<b;A++)e.update(w[A],n.ARRAY_BUFFER)}},getWireframeAttribute:function d(f){const p=s.get(f);if(p){const _=f.index;null!==_&&p.version<_.version&&u(f)}else u(f);return s.get(f)}}}function GG(n,e,t,i){const r=i.isWebGL2;let s,a,l;this.setMode=function o(p){s=p},this.setIndex=function u(p){a=p.type,l=p.bytesPerElement},this.render=function d(p,_){n.drawElements(s,_,a,p*l),t.update(_,s,1)},this.renderInstances=function f(p,_,y){if(0===y)return;let w,A;if(r)w=n,A="drawElementsInstanced";else if(w=e.get("ANGLE_instanced_arrays"),A="drawElementsInstancedANGLE",null===w)return void console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");w[A](s,_,a,p*l,y),t.update(_,s,y)}}function WG(n){const t={frame:0,calls:0,triangles:0,points:0,lines:0};return{memory:{geometries:0,textures:0},render:t,programs:null,autoReset:!0,reset:function r(){t.calls=0,t.triangles=0,t.points=0,t.lines=0},update:function i(s,o,a){switch(t.calls++,o){case n.TRIANGLES:t.triangles+=a*(s/3);break;case n.LINES:t.lines+=a*(s/2);break;case n.LINE_STRIP:t.lines+=a*(s-1);break;case n.LINE_LOOP:t.lines+=a*s;break;case n.POINTS:t.points+=a*s;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",o)}}}}function qG(n,e){return n[0]-e[0]}function jG(n,e){return Math.abs(e[1])-Math.abs(n[1])}function $G(n,e,t){const i={},r=new Float32Array(8),s=new WeakMap,o=new Nn,a=[];for(let u=0;u<8;u++)a[u]=[u,0];return{update:function l(u,d,f){const p=u.morphTargetInfluences;if(!0===e.isWebGL2){const _=d.morphAttributes.position||d.morphAttributes.normal||d.morphAttributes.color,y=void 0!==_?_.length:0;let w=s.get(d);if(void 0===w||w.count!==y){let ue=function(){Te.dispose(),s.delete(d),d.removeEventListener("dispose",ue)};void 0!==w&&w.texture.dispose();const C=void 0!==d.morphAttributes.position,T=void 0!==d.morphAttributes.normal,I=void 0!==d.morphAttributes.color,N=d.morphAttributes.position||[],k=d.morphAttributes.normal||[],G=d.morphAttributes.color||[];let K=0;!0===C&&(K=1),!0===T&&(K=2),!0===I&&(K=3);let L=d.attributes.position.count*K,H=1;L>e.maxTextureSize&&(H=Math.ceil(L/e.maxTextureSize),L=e.maxTextureSize);const me=new Float32Array(L*H*4*y),Te=new by(me,L,H,y);Te.type=go,Te.needsUpdate=!0;const le=4*K;for(let _e=0;_e<y;_e++){const Le=N[_e],Se=k[_e],De=G[_e],Fe=L*H*4*_e;for(let Ve=0;Ve<Le.count;Ve++){const he=Ve*le;!0===C&&(o.fromBufferAttribute(Le,Ve),me[Fe+he+0]=o.x,me[Fe+he+1]=o.y,me[Fe+he+2]=o.z,me[Fe+he+3]=0),!0===T&&(o.fromBufferAttribute(Se,Ve),me[Fe+he+4]=o.x,me[Fe+he+5]=o.y,me[Fe+he+6]=o.z,me[Fe+he+7]=0),!0===I&&(o.fromBufferAttribute(De,Ve),me[Fe+he+8]=o.x,me[Fe+he+9]=o.y,me[Fe+he+10]=o.z,me[Fe+he+11]=4===De.itemSize?o.w:1)}}w={count:y,texture:Te,size:new Be(L,H)},s.set(d,w),d.addEventListener("dispose",ue)}let A=0;for(let C=0;C<p.length;C++)A+=p[C];const b=d.morphTargetsRelative?1:1-A;f.getUniforms().setValue(n,"morphTargetBaseInfluence",b),f.getUniforms().setValue(n,"morphTargetInfluences",p),f.getUniforms().setValue(n,"morphTargetsTexture",w.texture,t),f.getUniforms().setValue(n,"morphTargetsTextureSize",w.size)}else{const _=void 0===p?0:p.length;let y=i[d.id];if(void 0===y||y.length!==_){y=[];for(let T=0;T<_;T++)y[T]=[T,0];i[d.id]=y}for(let T=0;T<_;T++){const I=y[T];I[0]=T,I[1]=p[T]}y.sort(jG);for(let T=0;T<8;T++)T<_&&y[T][1]?(a[T][0]=y[T][0],a[T][1]=y[T][1]):(a[T][0]=Number.MAX_SAFE_INTEGER,a[T][1]=0);a.sort(qG);const w=d.morphAttributes.position,A=d.morphAttributes.normal;let b=0;for(let T=0;T<8;T++){const I=a[T],N=I[0],k=I[1];N!==Number.MAX_SAFE_INTEGER&&k?(w&&d.getAttribute("morphTarget"+T)!==w[N]&&d.setAttribute("morphTarget"+T,w[N]),A&&d.getAttribute("morphNormal"+T)!==A[N]&&d.setAttribute("morphNormal"+T,A[N]),r[T]=k,b+=k):(w&&!0===d.hasAttribute("morphTarget"+T)&&d.deleteAttribute("morphTarget"+T),A&&!0===d.hasAttribute("morphNormal"+T)&&d.deleteAttribute("morphNormal"+T),r[T]=0)}const C=d.morphTargetsRelative?1:1-b;f.getUniforms().setValue(n,"morphTargetBaseInfluence",C),f.getUniforms().setValue(n,"morphTargetInfluences",r)}}}}function XG(n,e,t,i){let r=new WeakMap;function a(l){const u=l.target;u.removeEventListener("dispose",a),t.remove(u.instanceMatrix),null!==u.instanceColor&&t.remove(u.instanceColor)}return{update:function s(l){const u=i.render.frame,f=e.get(l,l.geometry);if(r.get(f)!==u&&(e.update(f),r.set(f,u)),l.isInstancedMesh&&(!1===l.hasEventListener("dispose",a)&&l.addEventListener("dispose",a),r.get(l)!==u&&(t.update(l.instanceMatrix,n.ARRAY_BUFFER),null!==l.instanceColor&&t.update(l.instanceColor,n.ARRAY_BUFFER),r.set(l,u))),l.isSkinnedMesh){const p=l.skeleton;r.get(p)!==u&&(p.update(),r.set(p,u))}return f},dispose:function o(){r=new WeakMap}}}const QC=new _s,eD=new by,tD=new EC,nD=new Np,iD=[],rD=[],sD=new Float32Array(16),oD=new Float32Array(9),aD=new Float32Array(4);function $c(n,e,t){const i=n[0];if(i<=0||i>0)return n;const r=e*t;let s=iD[r];if(void 0===s&&(s=new Float32Array(r),iD[r]=s),0!==e){i.toArray(s,0);for(let o=1,a=0;o!==e;++o)a+=t,n[o].toArray(s,a)}return s}function Ti(n,e){if(n.length!==e.length)return!1;for(let t=0,i=n.length;t<i;t++)if(n[t]!==e[t])return!1;return!0}function Ci(n,e){for(let t=0,i=e.length;t<i;t++)n[t]=e[t]}function kp(n,e){let t=rD[e];void 0===t&&(t=new Int32Array(e),rD[e]=t);for(let i=0;i!==e;++i)t[i]=n.allocateTextureUnit();return t}function YG(n,e){const t=this.cache;t[0]!==e&&(n.uniform1f(this.addr,e),t[0]=e)}function ZG(n,e){const t=this.cache;if(void 0!==e.x)(t[0]!==e.x||t[1]!==e.y)&&(n.uniform2f(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(Ti(t,e))return;n.uniform2fv(this.addr,e),Ci(t,e)}}function JG(n,e){const t=this.cache;if(void 0!==e.x)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(n.uniform3f(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else if(void 0!==e.r)(t[0]!==e.r||t[1]!==e.g||t[2]!==e.b)&&(n.uniform3f(this.addr,e.r,e.g,e.b),t[0]=e.r,t[1]=e.g,t[2]=e.b);else{if(Ti(t,e))return;n.uniform3fv(this.addr,e),Ci(t,e)}}function KG(n,e){const t=this.cache;if(void 0!==e.x)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(n.uniform4f(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(Ti(t,e))return;n.uniform4fv(this.addr,e),Ci(t,e)}}function QG(n,e){const t=this.cache,i=e.elements;if(void 0===i){if(Ti(t,e))return;n.uniformMatrix2fv(this.addr,!1,e),Ci(t,e)}else{if(Ti(t,i))return;aD.set(i),n.uniformMatrix2fv(this.addr,!1,aD),Ci(t,i)}}function e4(n,e){const t=this.cache,i=e.elements;if(void 0===i){if(Ti(t,e))return;n.uniformMatrix3fv(this.addr,!1,e),Ci(t,e)}else{if(Ti(t,i))return;oD.set(i),n.uniformMatrix3fv(this.addr,!1,oD),Ci(t,i)}}function t4(n,e){const t=this.cache,i=e.elements;if(void 0===i){if(Ti(t,e))return;n.uniformMatrix4fv(this.addr,!1,e),Ci(t,e)}else{if(Ti(t,i))return;sD.set(i),n.uniformMatrix4fv(this.addr,!1,sD),Ci(t,i)}}function n4(n,e){const t=this.cache;t[0]!==e&&(n.uniform1i(this.addr,e),t[0]=e)}function i4(n,e){const t=this.cache;if(void 0!==e.x)(t[0]!==e.x||t[1]!==e.y)&&(n.uniform2i(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(Ti(t,e))return;n.uniform2iv(this.addr,e),Ci(t,e)}}function r4(n,e){const t=this.cache;if(void 0!==e.x)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(n.uniform3i(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else{if(Ti(t,e))return;n.uniform3iv(this.addr,e),Ci(t,e)}}function s4(n,e){const t=this.cache;if(void 0!==e.x)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(n.uniform4i(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(Ti(t,e))return;n.uniform4iv(this.addr,e),Ci(t,e)}}function o4(n,e){const t=this.cache;t[0]!==e&&(n.uniform1ui(this.addr,e),t[0]=e)}function a4(n,e){const t=this.cache;if(void 0!==e.x)(t[0]!==e.x||t[1]!==e.y)&&(n.uniform2ui(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(Ti(t,e))return;n.uniform2uiv(this.addr,e),Ci(t,e)}}function l4(n,e){const t=this.cache;if(void 0!==e.x)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(n.uniform3ui(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else{if(Ti(t,e))return;n.uniform3uiv(this.addr,e),Ci(t,e)}}function c4(n,e){const t=this.cache;if(void 0!==e.x)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(n.uniform4ui(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(Ti(t,e))return;n.uniform4uiv(this.addr,e),Ci(t,e)}}function u4(n,e,t){const i=this.cache,r=t.allocateTextureUnit();i[0]!==r&&(n.uniform1i(this.addr,r),i[0]=r),t.setTexture2D(e||QC,r)}function h4(n,e,t){const i=this.cache,r=t.allocateTextureUnit();i[0]!==r&&(n.uniform1i(this.addr,r),i[0]=r),t.setTexture3D(e||tD,r)}function d4(n,e,t){const i=this.cache,r=t.allocateTextureUnit();i[0]!==r&&(n.uniform1i(this.addr,r),i[0]=r),t.setTextureCube(e||nD,r)}function f4(n,e,t){const i=this.cache,r=t.allocateTextureUnit();i[0]!==r&&(n.uniform1i(this.addr,r),i[0]=r),t.setTexture2DArray(e||eD,r)}function m4(n,e){n.uniform1fv(this.addr,e)}function _4(n,e){const t=$c(e,this.size,2);n.uniform2fv(this.addr,t)}function g4(n,e){const t=$c(e,this.size,3);n.uniform3fv(this.addr,t)}function v4(n,e){const t=$c(e,this.size,4);n.uniform4fv(this.addr,t)}function y4(n,e){const t=$c(e,this.size,4);n.uniformMatrix2fv(this.addr,!1,t)}function x4(n,e){const t=$c(e,this.size,9);n.uniformMatrix3fv(this.addr,!1,t)}function b4(n,e){const t=$c(e,this.size,16);n.uniformMatrix4fv(this.addr,!1,t)}function A4(n,e){n.uniform1iv(this.addr,e)}function w4(n,e){n.uniform2iv(this.addr,e)}function M4(n,e){n.uniform3iv(this.addr,e)}function S4(n,e){n.uniform4iv(this.addr,e)}function E4(n,e){n.uniform1uiv(this.addr,e)}function T4(n,e){n.uniform2uiv(this.addr,e)}function C4(n,e){n.uniform3uiv(this.addr,e)}function D4(n,e){n.uniform4uiv(this.addr,e)}function I4(n,e,t){const i=this.cache,r=e.length,s=kp(t,r);Ti(i,s)||(n.uniform1iv(this.addr,s),Ci(i,s));for(let o=0;o!==r;++o)t.setTexture2D(e[o]||QC,s[o])}function R4(n,e,t){const i=this.cache,r=e.length,s=kp(t,r);Ti(i,s)||(n.uniform1iv(this.addr,s),Ci(i,s));for(let o=0;o!==r;++o)t.setTexture3D(e[o]||tD,s[o])}function P4(n,e,t){const i=this.cache,r=e.length,s=kp(t,r);Ti(i,s)||(n.uniform1iv(this.addr,s),Ci(i,s));for(let o=0;o!==r;++o)t.setTextureCube(e[o]||nD,s[o])}function L4(n,e,t){const i=this.cache,r=e.length,s=kp(t,r);Ti(i,s)||(n.uniform1iv(this.addr,s),Ci(i,s));for(let o=0;o!==r;++o)t.setTexture2DArray(e[o]||eD,s[o])}class B4{constructor(e,t,i){this.id=e,this.addr=i,this.cache=[],this.setValue=function p4(n){switch(n){case 5126:return YG;case 35664:return ZG;case 35665:return JG;case 35666:return KG;case 35674:return QG;case 35675:return e4;case 35676:return t4;case 5124:case 35670:return n4;case 35667:case 35671:return i4;case 35668:case 35672:return r4;case 35669:case 35673:return s4;case 5125:return o4;case 36294:return a4;case 36295:return l4;case 36296:return c4;case 35678:case 36198:case 36298:case 36306:case 35682:return u4;case 35679:case 36299:case 36307:return h4;case 35680:case 36300:case 36308:case 36293:return d4;case 36289:case 36303:case 36311:case 36292:return f4}}(t.type)}}class F4{constructor(e,t,i){this.id=e,this.addr=i,this.cache=[],this.size=t.size,this.setValue=function N4(n){switch(n){case 5126:return m4;case 35664:return _4;case 35665:return g4;case 35666:return v4;case 35674:return y4;case 35675:return x4;case 35676:return b4;case 5124:case 35670:return A4;case 35667:case 35671:return w4;case 35668:case 35672:return M4;case 35669:case 35673:return S4;case 5125:return E4;case 36294:return T4;case 36295:return C4;case 36296:return D4;case 35678:case 36198:case 36298:case 36306:case 35682:return I4;case 35679:case 36299:case 36307:return R4;case 35680:case 36300:case 36308:case 36293:return P4;case 36289:case 36303:case 36311:case 36292:return L4}}(t.type)}}class O4{constructor(e){this.id=e,this.seq=[],this.map={}}setValue(e,t,i){const r=this.seq;for(let s=0,o=r.length;s!==o;++s){const a=r[s];a.setValue(e,t[a.id],i)}}}const Gy=/(\w+)(\])?(\[|\.)?/g;function lD(n,e){n.seq.push(e),n.map[e.id]=e}function V4(n,e,t){const i=n.name,r=i.length;for(Gy.lastIndex=0;;){const s=Gy.exec(i);let a=s[1];const u=s[3];if("]"===s[2]&&(a|=0),void 0===u||"["===u&&Gy.lastIndex+2===r){lD(t,void 0===u?new B4(a,n,e):new F4(a,n,e));break}{let f=t.map[a];void 0===f&&(f=new O4(a),lD(t,f)),t=f}}}class Up{constructor(e,t){this.seq=[],this.map={};const i=e.getProgramParameter(t,e.ACTIVE_UNIFORMS);for(let r=0;r<i;++r){const s=e.getActiveUniform(t,r);V4(s,e.getUniformLocation(t,s.name),this)}}setValue(e,t,i,r){const s=this.map[t];void 0!==s&&s.setValue(e,i,r)}setOptional(e,t,i){const r=t[i];void 0!==r&&this.setValue(e,i,r)}static upload(e,t,i,r){for(let s=0,o=t.length;s!==o;++s){const a=t[s],l=i[a.id];!1!==l.needsUpdate&&a.setValue(e,l.value,r)}}static seqWithValue(e,t){const i=[];for(let r=0,s=e.length;r!==s;++r){const o=e[r];o.id in t&&i.push(o)}return i}}function cD(n,e,t){const i=n.createShader(e);return n.shaderSource(i,t),n.compileShader(i),i}let k4=0;function uD(n,e,t){const i=n.getShaderParameter(e,n.COMPILE_STATUS),r=n.getShaderInfoLog(e).trim();if(i&&""===r)return"";const s=/ERROR: 0:(\d+)/.exec(r);if(s){const o=parseInt(s[1]);return t.toUpperCase()+"\n\n"+r+"\n\n"+function U4(n,e){const t=n.split("\n"),i=[],r=Math.max(e-6,0),s=Math.min(e+6,t.length);for(let o=r;o<s;o++){const a=o+1;i.push(`${a===e?">":" "} ${a}: ${t[o]}`)}return i.join("\n")}(n.getShaderSource(e),o)}return r}function H4(n,e){const t=function z4(n){switch(n){case zs:return["Linear","( value )"];case jt:return["sRGB","( value )"];default:return console.warn("THREE.WebGLProgram: Unsupported color space:",n),["Linear","( value )"]}}(e);return"vec4 "+n+"( vec4 value ) { return LinearTo"+t[0]+t[1]+"; }"}function G4(n,e){let t;switch(e){case g3:t="Linear";break;case v3:t="Reinhard";break;case y3:t="OptimizedCineon";break;case x3:t="ACESFilmic";break;case b3:t="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",e),t="Linear"}return"vec3 "+n+"( vec3 color ) { return "+t+"ToneMapping( color ); }"}function Uh(n){return""!==n}function hD(n,e){const t=e.numSpotLightShadows+e.numSpotLightMaps-e.numSpotLightShadowsWithMaps;return n.replace(/NUM_DIR_LIGHTS/g,e.numDirLights).replace(/NUM_SPOT_LIGHTS/g,e.numSpotLights).replace(/NUM_SPOT_LIGHT_MAPS/g,e.numSpotLightMaps).replace(/NUM_SPOT_LIGHT_COORDS/g,t).replace(/NUM_RECT_AREA_LIGHTS/g,e.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,e.numPointLights).replace(/NUM_HEMI_LIGHTS/g,e.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,e.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS/g,e.numSpotLightShadowsWithMaps).replace(/NUM_SPOT_LIGHT_SHADOWS/g,e.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,e.numPointLightShadows)}function dD(n,e){return n.replace(/NUM_CLIPPING_PLANES/g,e.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,e.numClippingPlanes-e.numClipIntersection)}const $4=/^[ \t]*#include +<([\w\d./]+)>/gm;function Wy(n){return n.replace($4,Y4)}const X4=new Map([["encodings_fragment","colorspace_fragment"],["encodings_pars_fragment","colorspace_pars_fragment"],["output_fragment","opaque_fragment"]]);function Y4(n,e){let t=rn[e];if(void 0===t){const i=X4.get(e);if(void 0===i)throw new Error("Can not resolve #include <"+e+">");t=rn[i],console.warn('THREE.WebGLRenderer: Shader chunk "%s" has been deprecated. Use "%s" instead.',e,i)}return Wy(t)}const Z4=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function fD(n){return n.replace(Z4,J4)}function J4(n,e,t,i){let r="";for(let s=parseInt(e);s<parseInt(t);s++)r+=i.replace(/\[\s*i\s*\]/g,"[ "+s+" ]").replace(/UNROLLED_LOOP_INDEX/g,s);return r}function pD(n){let e="precision "+n.precision+" float;\nprecision "+n.precision+" int;";return"highp"===n.precision?e+="\n#define HIGH_PRECISION":"mediump"===n.precision?e+="\n#define MEDIUM_PRECISION":"lowp"===n.precision&&(e+="\n#define LOW_PRECISION"),e}function i5(n,e,t,i){const r=n.getContext(),s=t.defines;let o=t.vertexShader,a=t.fragmentShader;const l=function K4(n){let e="SHADOWMAP_TYPE_BASIC";return n.shadowMapType===PT?e="SHADOWMAP_TYPE_PCF":n.shadowMapType===LT?e="SHADOWMAP_TYPE_PCF_SOFT":n.shadowMapType===fo&&(e="SHADOWMAP_TYPE_VSM"),e}(t),u=function Q4(n){let e="ENVMAP_TYPE_CUBE";if(n.envMap)switch(n.envMapMode){case Ba:case Fa:e="ENVMAP_TYPE_CUBE";break;case Eh:e="ENVMAP_TYPE_CUBE_UV"}return e}(t),d=function e5(n){let e="ENVMAP_MODE_REFLECTION";return n.envMap&&n.envMapMode===Fa&&(e="ENVMAP_MODE_REFRACTION"),e}(t),f=function t5(n){let e="ENVMAP_BLENDING_NONE";if(n.envMap)switch(n.combine){case cp:e="ENVMAP_BLENDING_MULTIPLY";break;case m3:e="ENVMAP_BLENDING_MIX";break;case _3:e="ENVMAP_BLENDING_ADD"}return e}(t),p=function n5(n){const e=n.envMapCubeUVHeight;if(null===e)return null;const t=Math.log2(e)-2,i=1/e;return{texelWidth:1/(3*Math.max(Math.pow(2,t),112)),texelHeight:i,maxMip:t}}(t),_=t.isWebGL2?"":function W4(n){return[n.extensionDerivatives||n.envMapCubeUVHeight||n.bumpMap||n.normalMapTangentSpace||n.clearcoatNormalMap||n.flatShading||"physical"===n.shaderID?"#extension GL_OES_standard_derivatives : enable":"",(n.extensionFragDepth||n.logarithmicDepthBuffer)&&n.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",n.extensionDrawBuffers&&n.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(n.extensionShaderTextureLOD||n.envMap||n.transmission)&&n.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(Uh).join("\n")}(t),y=function q4(n){const e=[];for(const t in n){const i=n[t];!1!==i&&e.push("#define "+t+" "+i)}return e.join("\n")}(s),w=r.createProgram();let A,b,C=t.glslVersion?"#version "+t.glslVersion+"\n":"";t.isRawShaderMaterial?(A=["#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,y].filter(Uh).join("\n"),A.length>0&&(A+="\n"),b=[_,"#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,y].filter(Uh).join("\n"),b.length>0&&(b+="\n")):(A=[pD(t),"#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,y,t.instancing?"#define USE_INSTANCING":"",t.instancingColor?"#define USE_INSTANCING_COLOR":"",t.useFog&&t.fog?"#define USE_FOG":"",t.useFog&&t.fogExp2?"#define FOG_EXP2":"",t.map?"#define USE_MAP":"",t.envMap?"#define USE_ENVMAP":"",t.envMap?"#define "+d:"",t.lightMap?"#define USE_LIGHTMAP":"",t.aoMap?"#define USE_AOMAP":"",t.bumpMap?"#define USE_BUMPMAP":"",t.normalMap?"#define USE_NORMALMAP":"",t.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",t.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",t.displacementMap?"#define USE_DISPLACEMENTMAP":"",t.emissiveMap?"#define USE_EMISSIVEMAP":"",t.anisotropyMap?"#define USE_ANISOTROPYMAP":"",t.clearcoatMap?"#define USE_CLEARCOATMAP":"",t.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",t.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",t.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",t.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",t.specularMap?"#define USE_SPECULARMAP":"",t.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",t.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",t.roughnessMap?"#define USE_ROUGHNESSMAP":"",t.metalnessMap?"#define USE_METALNESSMAP":"",t.alphaMap?"#define USE_ALPHAMAP":"",t.alphaHash?"#define USE_ALPHAHASH":"",t.transmission?"#define USE_TRANSMISSION":"",t.transmissionMap?"#define USE_TRANSMISSIONMAP":"",t.thicknessMap?"#define USE_THICKNESSMAP":"",t.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",t.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",t.mapUv?"#define MAP_UV "+t.mapUv:"",t.alphaMapUv?"#define ALPHAMAP_UV "+t.alphaMapUv:"",t.lightMapUv?"#define LIGHTMAP_UV "+t.lightMapUv:"",t.aoMapUv?"#define AOMAP_UV "+t.aoMapUv:"",t.emissiveMapUv?"#define EMISSIVEMAP_UV "+t.emissiveMapUv:"",t.bumpMapUv?"#define BUMPMAP_UV "+t.bumpMapUv:"",t.normalMapUv?"#define NORMALMAP_UV "+t.normalMapUv:"",t.displacementMapUv?"#define DISPLACEMENTMAP_UV "+t.displacementMapUv:"",t.metalnessMapUv?"#define METALNESSMAP_UV "+t.metalnessMapUv:"",t.roughnessMapUv?"#define ROUGHNESSMAP_UV "+t.roughnessMapUv:"",t.anisotropyMapUv?"#define ANISOTROPYMAP_UV "+t.anisotropyMapUv:"",t.clearcoatMapUv?"#define CLEARCOATMAP_UV "+t.clearcoatMapUv:"",t.clearcoatNormalMapUv?"#define CLEARCOAT_NORMALMAP_UV "+t.clearcoatNormalMapUv:"",t.clearcoatRoughnessMapUv?"#define CLEARCOAT_ROUGHNESSMAP_UV "+t.clearcoatRoughnessMapUv:"",t.iridescenceMapUv?"#define IRIDESCENCEMAP_UV "+t.iridescenceMapUv:"",t.iridescenceThicknessMapUv?"#define IRIDESCENCE_THICKNESSMAP_UV "+t.iridescenceThicknessMapUv:"",t.sheenColorMapUv?"#define SHEEN_COLORMAP_UV "+t.sheenColorMapUv:"",t.sheenRoughnessMapUv?"#define SHEEN_ROUGHNESSMAP_UV "+t.sheenRoughnessMapUv:"",t.specularMapUv?"#define SPECULARMAP_UV "+t.specularMapUv:"",t.specularColorMapUv?"#define SPECULAR_COLORMAP_UV "+t.specularColorMapUv:"",t.specularIntensityMapUv?"#define SPECULAR_INTENSITYMAP_UV "+t.specularIntensityMapUv:"",t.transmissionMapUv?"#define TRANSMISSIONMAP_UV "+t.transmissionMapUv:"",t.thicknessMapUv?"#define THICKNESSMAP_UV "+t.thicknessMapUv:"",t.vertexTangents&&!1===t.flatShading?"#define USE_TANGENT":"",t.vertexColors?"#define USE_COLOR":"",t.vertexAlphas?"#define USE_COLOR_ALPHA":"",t.vertexUv1s?"#define USE_UV1":"",t.vertexUv2s?"#define USE_UV2":"",t.vertexUv3s?"#define USE_UV3":"",t.pointsUvs?"#define USE_POINTS_UV":"",t.flatShading?"#define FLAT_SHADED":"",t.skinning?"#define USE_SKINNING":"",t.morphTargets?"#define USE_MORPHTARGETS":"",t.morphNormals&&!1===t.flatShading?"#define USE_MORPHNORMALS":"",t.morphColors&&t.isWebGL2?"#define USE_MORPHCOLORS":"",t.morphTargetsCount>0&&t.isWebGL2?"#define MORPHTARGETS_TEXTURE":"",t.morphTargetsCount>0&&t.isWebGL2?"#define MORPHTARGETS_TEXTURE_STRIDE "+t.morphTextureStride:"",t.morphTargetsCount>0&&t.isWebGL2?"#define MORPHTARGETS_COUNT "+t.morphTargetsCount:"",t.doubleSided?"#define DOUBLE_SIDED":"",t.flipSided?"#define FLIP_SIDED":"",t.shadowMapEnabled?"#define USE_SHADOWMAP":"",t.shadowMapEnabled?"#define "+l:"",t.sizeAttenuation?"#define USE_SIZEATTENUATION":"",t.useLegacyLights?"#define LEGACY_LIGHTS":"",t.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",t.logarithmicDepthBuffer&&t.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","\tattribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","\tattribute vec3 instanceColor;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_UV1","\tattribute vec2 uv1;","#endif","#ifdef USE_UV2","\tattribute vec2 uv2;","#endif","#ifdef USE_UV3","\tattribute vec2 uv3;","#endif","#ifdef USE_TANGENT","\tattribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","\tattribute vec4 color;","#elif defined( USE_COLOR )","\tattribute vec3 color;","#endif","#if ( defined( USE_MORPHTARGETS ) && ! defined( MORPHTARGETS_TEXTURE ) )","\tattribute vec3 morphTarget0;","\tattribute vec3 morphTarget1;","\tattribute vec3 morphTarget2;","\tattribute vec3 morphTarget3;","\t#ifdef USE_MORPHNORMALS","\t\tattribute vec3 morphNormal0;","\t\tattribute vec3 morphNormal1;","\t\tattribute vec3 morphNormal2;","\t\tattribute vec3 morphNormal3;","\t#else","\t\tattribute vec3 morphTarget4;","\t\tattribute vec3 morphTarget5;","\t\tattribute vec3 morphTarget6;","\t\tattribute vec3 morphTarget7;","\t#endif","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;","#endif","\n"].filter(Uh).join("\n"),b=[_,pD(t),"#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,y,t.useFog&&t.fog?"#define USE_FOG":"",t.useFog&&t.fogExp2?"#define FOG_EXP2":"",t.map?"#define USE_MAP":"",t.matcap?"#define USE_MATCAP":"",t.envMap?"#define USE_ENVMAP":"",t.envMap?"#define "+u:"",t.envMap?"#define "+d:"",t.envMap?"#define "+f:"",p?"#define CUBEUV_TEXEL_WIDTH "+p.texelWidth:"",p?"#define CUBEUV_TEXEL_HEIGHT "+p.texelHeight:"",p?"#define CUBEUV_MAX_MIP "+p.maxMip+".0":"",t.lightMap?"#define USE_LIGHTMAP":"",t.aoMap?"#define USE_AOMAP":"",t.bumpMap?"#define USE_BUMPMAP":"",t.normalMap?"#define USE_NORMALMAP":"",t.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",t.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",t.emissiveMap?"#define USE_EMISSIVEMAP":"",t.anisotropy?"#define USE_ANISOTROPY":"",t.anisotropyMap?"#define USE_ANISOTROPYMAP":"",t.clearcoat?"#define USE_CLEARCOAT":"",t.clearcoatMap?"#define USE_CLEARCOATMAP":"",t.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",t.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",t.iridescence?"#define USE_IRIDESCENCE":"",t.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",t.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",t.specularMap?"#define USE_SPECULARMAP":"",t.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",t.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",t.roughnessMap?"#define USE_ROUGHNESSMAP":"",t.metalnessMap?"#define USE_METALNESSMAP":"",t.alphaMap?"#define USE_ALPHAMAP":"",t.alphaTest?"#define USE_ALPHATEST":"",t.alphaHash?"#define USE_ALPHAHASH":"",t.sheen?"#define USE_SHEEN":"",t.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",t.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",t.transmission?"#define USE_TRANSMISSION":"",t.transmissionMap?"#define USE_TRANSMISSIONMAP":"",t.thicknessMap?"#define USE_THICKNESSMAP":"",t.vertexTangents&&!1===t.flatShading?"#define USE_TANGENT":"",t.vertexColors||t.instancingColor?"#define USE_COLOR":"",t.vertexAlphas?"#define USE_COLOR_ALPHA":"",t.vertexUv1s?"#define USE_UV1":"",t.vertexUv2s?"#define USE_UV2":"",t.vertexUv3s?"#define USE_UV3":"",t.pointsUvs?"#define USE_POINTS_UV":"",t.gradientMap?"#define USE_GRADIENTMAP":"",t.flatShading?"#define FLAT_SHADED":"",t.doubleSided?"#define DOUBLE_SIDED":"",t.flipSided?"#define FLIP_SIDED":"",t.shadowMapEnabled?"#define USE_SHADOWMAP":"",t.shadowMapEnabled?"#define "+l:"",t.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",t.useLegacyLights?"#define LEGACY_LIGHTS":"",t.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",t.logarithmicDepthBuffer&&t.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",t.toneMapping!==mo?"#define TONE_MAPPING":"",t.toneMapping!==mo?rn.tonemapping_pars_fragment:"",t.toneMapping!==mo?G4("toneMapping",t.toneMapping):"",t.dithering?"#define DITHERING":"",t.opaque?"#define OPAQUE":"",rn.colorspace_pars_fragment,H4("linearToOutputTexel",t.outputColorSpace),t.useDepthPacking?"#define DEPTH_PACKING "+t.depthPacking:"","\n"].filter(Uh).join("\n")),o=Wy(o),o=hD(o,t),o=dD(o,t),a=Wy(a),a=hD(a,t),a=dD(a,t),o=fD(o),a=fD(a),t.isWebGL2&&!0!==t.isRawShaderMaterial&&(C="#version 300 es\n",A=["precision mediump sampler2DArray;","#define attribute in","#define varying out","#define texture2D texture"].join("\n")+"\n"+A,b=["#define varying in",t.glslVersion===xC?"":"layout(location = 0) out highp vec4 pc_fragColor;",t.glslVersion===xC?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join("\n")+"\n"+b);const I=C+b+a,N=cD(r,r.VERTEX_SHADER,C+A+o),k=cD(r,r.FRAGMENT_SHADER,I);if(r.attachShader(w,N),r.attachShader(w,k),void 0!==t.index0AttributeName?r.bindAttribLocation(w,0,t.index0AttributeName):!0===t.morphTargets&&r.bindAttribLocation(w,0,"position"),r.linkProgram(w),n.debug.checkShaderErrors){const L=r.getProgramInfoLog(w).trim(),H=r.getShaderInfoLog(N).trim(),me=r.getShaderInfoLog(k).trim();let Te=!0,le=!0;if(!1===r.getProgramParameter(w,r.LINK_STATUS))if(Te=!1,"function"==typeof n.debug.onShaderError)n.debug.onShaderError(r,w,N,k);else{const ue=uD(r,N,"vertex"),_e=uD(r,k,"fragment");console.error("THREE.WebGLProgram: Shader Error "+r.getError()+" - VALIDATE_STATUS "+r.getProgramParameter(w,r.VALIDATE_STATUS)+"\n\nProgram Info Log: "+L+"\n"+ue+"\n"+_e)}else""!==L?console.warn("THREE.WebGLProgram: Program Info Log:",L):(""===H||""===me)&&(le=!1);le&&(this.diagnostics={runnable:Te,programLog:L,vertexShader:{log:H,prefix:A},fragmentShader:{log:me,prefix:b}})}let G,K;return r.deleteShader(N),r.deleteShader(k),this.getUniforms=function(){return void 0===G&&(G=new Up(r,w)),G},this.getAttributes=function(){return void 0===K&&(K=function j4(n,e){const t={},i=n.getProgramParameter(e,n.ACTIVE_ATTRIBUTES);for(let r=0;r<i;r++){const s=n.getActiveAttrib(e,r),o=s.name;let a=1;s.type===n.FLOAT_MAT2&&(a=2),s.type===n.FLOAT_MAT3&&(a=3),s.type===n.FLOAT_MAT4&&(a=4),t[o]={type:s.type,location:n.getAttribLocation(e,o),locationSize:a}}return t}(r,w)),K},this.destroy=function(){i.releaseStatesOfProgram(this),r.deleteProgram(w),this.program=void 0},this.type=t.shaderType,this.name=t.shaderName,this.id=k4++,this.cacheKey=e,this.usedTimes=1,this.program=w,this.vertexShader=N,this.fragmentShader=k,this}let r5=0;class s5{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(e){const i=e.fragmentShader,r=this._getShaderStage(e.vertexShader),s=this._getShaderStage(i),o=this._getShaderCacheForMaterial(e);return!1===o.has(r)&&(o.add(r),r.usedTimes++),!1===o.has(s)&&(o.add(s),s.usedTimes++),this}remove(e){const t=this.materialCache.get(e);for(const i of t)i.usedTimes--,0===i.usedTimes&&this.shaderCache.delete(i.code);return this.materialCache.delete(e),this}getVertexShaderID(e){return this._getShaderStage(e.vertexShader).id}getFragmentShaderID(e){return this._getShaderStage(e.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(e){const t=this.materialCache;let i=t.get(e);return void 0===i&&(i=new Set,t.set(e,i)),i}_getShaderStage(e){const t=this.shaderCache;let i=t.get(e);return void 0===i&&(i=new o5(e),t.set(e,i)),i}}class o5{constructor(e){this.id=r5++,this.code=e,this.usedTimes=0}}function a5(n,e,t,i,r,s,o){const a=new Cy,l=new s5,u=[],d=r.isWebGL2,f=r.logarithmicDepthBuffer,p=r.vertexTextures;let _=r.precision;const y={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};function w(L){return 0===L?"uv":`uv${L}`}return{getParameters:function A(L,H,me,Te,le){const ue=Te.fog,_e=le.geometry,Se=(L.isMeshStandardMaterial?t:e).get(L.envMap||(L.isMeshStandardMaterial?Te.environment:null)),De=Se&&Se.mapping===Eh?Se.image.height:null,Fe=y[L.type];null!==L.precision&&(_=r.getMaxPrecision(L.precision),_!==L.precision&&console.warn("THREE.WebGLProgram.getParameters:",L.precision,"not supported, using",_,"instead."));const Ve=_e.morphAttributes.position||_e.morphAttributes.normal||_e.morphAttributes.color,he=void 0!==Ve?Ve.length:0;let Ye,tt,it,gt,Ce=0;if(void 0!==_e.morphAttributes.position&&(Ce=1),void 0!==_e.morphAttributes.normal&&(Ce=2),void 0!==_e.morphAttributes.color&&(Ce=3),Fe){const Xs=Gs[Fe];Ye=Xs.vertexShader,tt=Xs.fragmentShader}else Ye=L.vertexShader,tt=L.fragmentShader,l.update(L),it=l.getVertexShaderID(L),gt=l.getFragmentShaderID(L);const Ct=n.getRenderTarget(),wt=!0===le.isInstancedMesh,Tn=!!L.map,Nt=!!Se,te=!!L.aoMap,Ze=!!L.lightMap,Re=!!L.bumpMap,je=!!L.normalMap,ke=!!L.displacementMap,It=!!L.emissiveMap,ft=!!L.metalnessMap,vt=!!L.roughnessMap,Qt=L.anisotropy>0,yn=L.clearcoat>0,ri=L.iridescence>0,J=L.sheen>0,z=L.transmission>0,be=Qt&&!!L.anisotropyMap,We=yn&&!!L.clearcoatMap,qe=yn&&!!L.clearcoatNormalMap,st=yn&&!!L.clearcoatRoughnessMap,Et=ri&&!!L.iridescenceMap,ot=ri&&!!L.iridescenceThicknessMap,Ee=J&&!!L.sheenColorMap,Bt=J&&!!L.sheenRoughnessMap,Ft=!!L.specularMap,kt=!!L.specularColorMap,yt=!!L.specularIntensityMap,xt=z&&!!L.transmissionMap,pn=z&&!!L.thicknessMap,ie=!!L.alphaMap,Je=!!L.extensions,ct=!!_e.attributes.uv1,In=!!_e.attributes.uv2,Jn=!!_e.attributes.uv3;return{isWebGL2:d,shaderID:Fe,shaderType:L.type,shaderName:L.name,vertexShader:Ye,fragmentShader:tt,defines:L.defines,customVertexShaderID:it,customFragmentShaderID:gt,isRawShaderMaterial:!0===L.isRawShaderMaterial,glslVersion:L.glslVersion,precision:_,instancing:wt,instancingColor:wt&&null!==le.instanceColor,supportsVertexTextures:p,outputColorSpace:null===Ct?n.outputColorSpace:!0===Ct.isXRRenderTarget?Ct.texture.colorSpace:zs,map:Tn,matcap:!!L.matcap,envMap:Nt,envMapMode:Nt&&Se.mapping,envMapCubeUVHeight:De,aoMap:te,lightMap:Ze,bumpMap:Re,normalMap:je,displacementMap:p&&ke,emissiveMap:It,normalMapObjectSpace:je&&1===L.normalMapType,normalMapTangentSpace:je&&0===L.normalMapType,metalnessMap:ft,roughnessMap:vt,anisotropy:Qt,anisotropyMap:be,clearcoat:yn,clearcoatMap:We,clearcoatNormalMap:qe,clearcoatRoughnessMap:st,iridescence:ri,iridescenceMap:Et,iridescenceThicknessMap:ot,sheen:J,sheenColorMap:Ee,sheenRoughnessMap:Bt,specularMap:Ft,specularColorMap:kt,specularIntensityMap:yt,transmission:z,transmissionMap:xt,thicknessMap:pn,gradientMap:!!L.gradientMap,opaque:!1===L.transparent&&1===L.blending,alphaMap:ie,alphaTest:L.alphaTest>0,alphaHash:!!L.alphaHash,combine:L.combine,mapUv:Tn&&w(L.map.channel),aoMapUv:te&&w(L.aoMap.channel),lightMapUv:Ze&&w(L.lightMap.channel),bumpMapUv:Re&&w(L.bumpMap.channel),normalMapUv:je&&w(L.normalMap.channel),displacementMapUv:ke&&w(L.displacementMap.channel),emissiveMapUv:It&&w(L.emissiveMap.channel),metalnessMapUv:ft&&w(L.metalnessMap.channel),roughnessMapUv:vt&&w(L.roughnessMap.channel),anisotropyMapUv:be&&w(L.anisotropyMap.channel),clearcoatMapUv:We&&w(L.clearcoatMap.channel),clearcoatNormalMapUv:qe&&w(L.clearcoatNormalMap.channel),clearcoatRoughnessMapUv:st&&w(L.clearcoatRoughnessMap.channel),iridescenceMapUv:Et&&w(L.iridescenceMap.channel),iridescenceThicknessMapUv:ot&&w(L.iridescenceThicknessMap.channel),sheenColorMapUv:Ee&&w(L.sheenColorMap.channel),sheenRoughnessMapUv:Bt&&w(L.sheenRoughnessMap.channel),specularMapUv:Ft&&w(L.specularMap.channel),specularColorMapUv:kt&&w(L.specularColorMap.channel),specularIntensityMapUv:yt&&w(L.specularIntensityMap.channel),transmissionMapUv:xt&&w(L.transmissionMap.channel),thicknessMapUv:pn&&w(L.thicknessMap.channel),alphaMapUv:ie&&w(L.alphaMap.channel),vertexTangents:!!_e.attributes.tangent&&(je||Qt),vertexColors:L.vertexColors,vertexAlphas:!0===L.vertexColors&&!!_e.attributes.color&&4===_e.attributes.color.itemSize,vertexUv1s:ct,vertexUv2s:In,vertexUv3s:Jn,pointsUvs:!0===le.isPoints&&!!_e.attributes.uv&&(Tn||ie),fog:!!ue,useFog:!0===L.fog,fogExp2:ue&&ue.isFogExp2,flatShading:!0===L.flatShading,sizeAttenuation:!0===L.sizeAttenuation,logarithmicDepthBuffer:f,skinning:!0===le.isSkinnedMesh,morphTargets:void 0!==_e.morphAttributes.position,morphNormals:void 0!==_e.morphAttributes.normal,morphColors:void 0!==_e.morphAttributes.color,morphTargetsCount:he,morphTextureStride:Ce,numDirLights:H.directional.length,numPointLights:H.point.length,numSpotLights:H.spot.length,numSpotLightMaps:H.spotLightMap.length,numRectAreaLights:H.rectArea.length,numHemiLights:H.hemi.length,numDirLightShadows:H.directionalShadowMap.length,numPointLightShadows:H.pointShadowMap.length,numSpotLightShadows:H.spotShadowMap.length,numSpotLightShadowsWithMaps:H.numSpotLightShadowsWithMaps,numClippingPlanes:o.numPlanes,numClipIntersection:o.numIntersection,dithering:L.dithering,shadowMapEnabled:n.shadowMap.enabled&&me.length>0,shadowMapType:n.shadowMap.type,toneMapping:L.toneMapped?n.toneMapping:mo,useLegacyLights:n.useLegacyLights,premultipliedAlpha:L.premultipliedAlpha,doubleSided:2===L.side,flipSided:1===L.side,useDepthPacking:L.depthPacking>=0,depthPacking:L.depthPacking||0,index0AttributeName:L.index0AttributeName,extensionDerivatives:Je&&!0===L.extensions.derivatives,extensionFragDepth:Je&&!0===L.extensions.fragDepth,extensionDrawBuffers:Je&&!0===L.extensions.drawBuffers,extensionShaderTextureLOD:Je&&!0===L.extensions.shaderTextureLOD,rendererExtensionFragDepth:d||i.has("EXT_frag_depth"),rendererExtensionDrawBuffers:d||i.has("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:d||i.has("EXT_shader_texture_lod"),customProgramCacheKey:L.customProgramCacheKey()}},getProgramCacheKey:function b(L){const H=[];if(L.shaderID?H.push(L.shaderID):(H.push(L.customVertexShaderID),H.push(L.customFragmentShaderID)),void 0!==L.defines)for(const me in L.defines)H.push(me),H.push(L.defines[me]);return!1===L.isRawShaderMaterial&&(function C(L,H){L.push(H.precision),L.push(H.outputColorSpace),L.push(H.envMapMode),L.push(H.envMapCubeUVHeight),L.push(H.mapUv),L.push(H.alphaMapUv),L.push(H.lightMapUv),L.push(H.aoMapUv),L.push(H.bumpMapUv),L.push(H.normalMapUv),L.push(H.displacementMapUv),L.push(H.emissiveMapUv),L.push(H.metalnessMapUv),L.push(H.roughnessMapUv),L.push(H.anisotropyMapUv),L.push(H.clearcoatMapUv),L.push(H.clearcoatNormalMapUv),L.push(H.clearcoatRoughnessMapUv),L.push(H.iridescenceMapUv),L.push(H.iridescenceThicknessMapUv),L.push(H.sheenColorMapUv),L.push(H.sheenRoughnessMapUv),L.push(H.specularMapUv),L.push(H.specularColorMapUv),L.push(H.specularIntensityMapUv),L.push(H.transmissionMapUv),L.push(H.thicknessMapUv),L.push(H.combine),L.push(H.fogExp2),L.push(H.sizeAttenuation),L.push(H.morphTargetsCount),L.push(H.morphAttributeCount),L.push(H.numDirLights),L.push(H.numPointLights),L.push(H.numSpotLights),L.push(H.numSpotLightMaps),L.push(H.numHemiLights),L.push(H.numRectAreaLights),L.push(H.numDirLightShadows),L.push(H.numPointLightShadows),L.push(H.numSpotLightShadows),L.push(H.numSpotLightShadowsWithMaps),L.push(H.shadowMapType),L.push(H.toneMapping),L.push(H.numClippingPlanes),L.push(H.numClipIntersection),L.push(H.depthPacking)}(H,L),function T(L,H){a.disableAll(),H.isWebGL2&&a.enable(0),H.supportsVertexTextures&&a.enable(1),H.instancing&&a.enable(2),H.instancingColor&&a.enable(3),H.matcap&&a.enable(4),H.envMap&&a.enable(5),H.normalMapObjectSpace&&a.enable(6),H.normalMapTangentSpace&&a.enable(7),H.clearcoat&&a.enable(8),H.iridescence&&a.enable(9),H.alphaTest&&a.enable(10),H.vertexColors&&a.enable(11),H.vertexAlphas&&a.enable(12),H.vertexUv1s&&a.enable(13),H.vertexUv2s&&a.enable(14),H.vertexUv3s&&a.enable(15),H.vertexTangents&&a.enable(16),H.anisotropy&&a.enable(17),L.push(a.mask),a.disableAll(),H.fog&&a.enable(0),H.useFog&&a.enable(1),H.flatShading&&a.enable(2),H.logarithmicDepthBuffer&&a.enable(3),H.skinning&&a.enable(4),H.morphTargets&&a.enable(5),H.morphNormals&&a.enable(6),H.morphColors&&a.enable(7),H.premultipliedAlpha&&a.enable(8),H.shadowMapEnabled&&a.enable(9),H.useLegacyLights&&a.enable(10),H.doubleSided&&a.enable(11),H.flipSided&&a.enable(12),H.useDepthPacking&&a.enable(13),H.dithering&&a.enable(14),H.transmission&&a.enable(15),H.sheen&&a.enable(16),H.opaque&&a.enable(17),H.pointsUvs&&a.enable(18),L.push(a.mask)}(H,L),H.push(n.outputColorSpace)),H.push(L.customProgramCacheKey),H.join()},getUniforms:function I(L){const H=y[L.type];let me;return me=H?Fy.clone(Gs[H].uniforms):L.uniforms,me},acquireProgram:function N(L,H){let me;for(let Te=0,le=u.length;Te<le;Te++){const ue=u[Te];if(ue.cacheKey===H){me=ue,++me.usedTimes;break}}return void 0===me&&(me=new i5(n,H,L,s),u.push(me)),me},releaseProgram:function k(L){if(0==--L.usedTimes){const H=u.indexOf(L);u[H]=u[u.length-1],u.pop(),L.destroy()}},releaseShaderCache:function G(L){l.remove(L)},programs:u,dispose:function K(){l.dispose()}}}function l5(){let n=new WeakMap;return{get:function e(s){let o=n.get(s);return void 0===o&&(o={},n.set(s,o)),o},remove:function t(s){n.delete(s)},update:function i(s,o,a){n.get(s)[o]=a},dispose:function r(){n=new WeakMap}}}function c5(n,e){return n.groupOrder!==e.groupOrder?n.groupOrder-e.groupOrder:n.renderOrder!==e.renderOrder?n.renderOrder-e.renderOrder:n.material.id!==e.material.id?n.material.id-e.material.id:n.z!==e.z?n.z-e.z:n.id-e.id}function mD(n,e){return n.groupOrder!==e.groupOrder?n.groupOrder-e.groupOrder:n.renderOrder!==e.renderOrder?n.renderOrder-e.renderOrder:n.z!==e.z?e.z-n.z:n.id-e.id}function _D(){const n=[];let e=0;const t=[],i=[],r=[];function o(f,p,_,y,w,A){let b=n[e];return void 0===b?(b={id:f.id,object:f,geometry:p,material:_,groupOrder:y,renderOrder:f.renderOrder,z:w,group:A},n[e]=b):(b.id=f.id,b.object=f,b.geometry=p,b.material=_,b.groupOrder=y,b.renderOrder=f.renderOrder,b.z=w,b.group=A),e++,b}return{opaque:t,transmissive:i,transparent:r,init:function s(){e=0,t.length=0,i.length=0,r.length=0},push:function a(f,p,_,y,w,A){const b=o(f,p,_,y,w,A);_.transmission>0?i.push(b):!0===_.transparent?r.push(b):t.push(b)},unshift:function l(f,p,_,y,w,A){const b=o(f,p,_,y,w,A);_.transmission>0?i.unshift(b):!0===_.transparent?r.unshift(b):t.unshift(b)},finish:function d(){for(let f=e,p=n.length;f<p;f++){const _=n[f];if(null===_.id)break;_.id=null,_.object=null,_.geometry=null,_.material=null,_.group=null}},sort:function u(f,p){t.length>1&&t.sort(f||c5),i.length>1&&i.sort(p||mD),r.length>1&&r.sort(p||mD)}}}function u5(){let n=new WeakMap;return{get:function e(i,r){const s=n.get(i);let o;return void 0===s?(o=new _D,n.set(i,[o])):r>=s.length?(o=new _D,s.push(o)):o=s[r],o},dispose:function t(){n=new WeakMap}}}function h5(){const n={};return{get:function(e){if(void 0!==n[e.id])return n[e.id];let t;switch(e.type){case"DirectionalLight":t={direction:new q,color:new Qe};break;case"SpotLight":t={position:new q,direction:new q,color:new Qe,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":t={position:new q,color:new Qe,distance:0,decay:0};break;case"HemisphereLight":t={direction:new q,skyColor:new Qe,groundColor:new Qe};break;case"RectAreaLight":t={color:new Qe,position:new q,halfWidth:new q,halfHeight:new q}}return n[e.id]=t,t}}}let f5=0;function p5(n,e){return(e.castShadow?2:0)-(n.castShadow?2:0)+(e.map?1:0)-(n.map?1:0)}function m5(n,e){const t=new h5,i=function d5(){const n={};return{get:function(e){if(void 0!==n[e.id])return n[e.id];let t;switch(e.type){case"DirectionalLight":case"SpotLight":t={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Be};break;case"PointLight":t={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Be,shadowCameraNear:1,shadowCameraFar:1e3}}return n[e.id]=t,t}}}(),r={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1,numSpotMaps:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotLightMap:[],spotShadow:[],spotShadowMap:[],spotLightMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numSpotLightShadowsWithMaps:0};for(let d=0;d<9;d++)r.probe.push(new q);const s=new q,o=new Wt,a=new Wt;return{setup:function l(d,f){let p=0,_=0,y=0;for(let me=0;me<9;me++)r.probe[me].set(0,0,0);let w=0,A=0,b=0,C=0,T=0,I=0,N=0,k=0,G=0,K=0;d.sort(p5);const L=!0===f?Math.PI:1;for(let me=0,Te=d.length;me<Te;me++){const le=d[me],ue=le.color,_e=le.intensity,Le=le.distance,Se=le.shadow&&le.shadow.map?le.shadow.map.texture:null;if(le.isAmbientLight)p+=ue.r*_e*L,_+=ue.g*_e*L,y+=ue.b*_e*L;else if(le.isLightProbe)for(let De=0;De<9;De++)r.probe[De].addScaledVector(le.sh.coefficients[De],_e);else if(le.isDirectionalLight){const De=t.get(le);if(De.color.copy(le.color).multiplyScalar(le.intensity*L),le.castShadow){const Fe=le.shadow,Ve=i.get(le);Ve.shadowBias=Fe.bias,Ve.shadowNormalBias=Fe.normalBias,Ve.shadowRadius=Fe.radius,Ve.shadowMapSize=Fe.mapSize,r.directionalShadow[w]=Ve,r.directionalShadowMap[w]=Se,r.directionalShadowMatrix[w]=le.shadow.matrix,I++}r.directional[w]=De,w++}else if(le.isSpotLight){const De=t.get(le);De.position.setFromMatrixPosition(le.matrixWorld),De.color.copy(ue).multiplyScalar(_e*L),De.distance=Le,De.coneCos=Math.cos(le.angle),De.penumbraCos=Math.cos(le.angle*(1-le.penumbra)),De.decay=le.decay,r.spot[b]=De;const Fe=le.shadow;if(le.map&&(r.spotLightMap[G]=le.map,G++,Fe.updateMatrices(le),le.castShadow&&K++),r.spotLightMatrix[b]=Fe.matrix,le.castShadow){const Ve=i.get(le);Ve.shadowBias=Fe.bias,Ve.shadowNormalBias=Fe.normalBias,Ve.shadowRadius=Fe.radius,Ve.shadowMapSize=Fe.mapSize,r.spotShadow[b]=Ve,r.spotShadowMap[b]=Se,k++}b++}else if(le.isRectAreaLight){const De=t.get(le);De.color.copy(ue).multiplyScalar(_e),De.halfWidth.set(.5*le.width,0,0),De.halfHeight.set(0,.5*le.height,0),r.rectArea[C]=De,C++}else if(le.isPointLight){const De=t.get(le);if(De.color.copy(le.color).multiplyScalar(le.intensity*L),De.distance=le.distance,De.decay=le.decay,le.castShadow){const Fe=le.shadow,Ve=i.get(le);Ve.shadowBias=Fe.bias,Ve.shadowNormalBias=Fe.normalBias,Ve.shadowRadius=Fe.radius,Ve.shadowMapSize=Fe.mapSize,Ve.shadowCameraNear=Fe.camera.near,Ve.shadowCameraFar=Fe.camera.far,r.pointShadow[A]=Ve,r.pointShadowMap[A]=Se,r.pointShadowMatrix[A]=le.shadow.matrix,N++}r.point[A]=De,A++}else if(le.isHemisphereLight){const De=t.get(le);De.skyColor.copy(le.color).multiplyScalar(_e*L),De.groundColor.copy(le.groundColor).multiplyScalar(_e*L),r.hemi[T]=De,T++}}C>0&&(e.isWebGL2||!0===n.has("OES_texture_float_linear")?(r.rectAreaLTC1=et.LTC_FLOAT_1,r.rectAreaLTC2=et.LTC_FLOAT_2):!0===n.has("OES_texture_half_float_linear")?(r.rectAreaLTC1=et.LTC_HALF_1,r.rectAreaLTC2=et.LTC_HALF_2):console.error("THREE.WebGLRenderer: Unable to use RectAreaLight. Missing WebGL extensions.")),r.ambient[0]=p,r.ambient[1]=_,r.ambient[2]=y;const H=r.hash;(H.directionalLength!==w||H.pointLength!==A||H.spotLength!==b||H.rectAreaLength!==C||H.hemiLength!==T||H.numDirectionalShadows!==I||H.numPointShadows!==N||H.numSpotShadows!==k||H.numSpotMaps!==G)&&(r.directional.length=w,r.spot.length=b,r.rectArea.length=C,r.point.length=A,r.hemi.length=T,r.directionalShadow.length=I,r.directionalShadowMap.length=I,r.pointShadow.length=N,r.pointShadowMap.length=N,r.spotShadow.length=k,r.spotShadowMap.length=k,r.directionalShadowMatrix.length=I,r.pointShadowMatrix.length=N,r.spotLightMatrix.length=k+G-K,r.spotLightMap.length=G,r.numSpotLightShadowsWithMaps=K,H.directionalLength=w,H.pointLength=A,H.spotLength=b,H.rectAreaLength=C,H.hemiLength=T,H.numDirectionalShadows=I,H.numPointShadows=N,H.numSpotShadows=k,H.numSpotMaps=G,r.version=f5++)},setupView:function u(d,f){let p=0,_=0,y=0,w=0,A=0;const b=f.matrixWorldInverse;for(let C=0,T=d.length;C<T;C++){const I=d[C];if(I.isDirectionalLight){const N=r.directional[p];N.direction.setFromMatrixPosition(I.matrixWorld),s.setFromMatrixPosition(I.target.matrixWorld),N.direction.sub(s),N.direction.transformDirection(b),p++}else if(I.isSpotLight){const N=r.spot[y];N.position.setFromMatrixPosition(I.matrixWorld),N.position.applyMatrix4(b),N.direction.setFromMatrixPosition(I.matrixWorld),s.setFromMatrixPosition(I.target.matrixWorld),N.direction.sub(s),N.direction.transformDirection(b),y++}else if(I.isRectAreaLight){const N=r.rectArea[w];N.position.setFromMatrixPosition(I.matrixWorld),N.position.applyMatrix4(b),a.identity(),o.copy(I.matrixWorld),o.premultiply(b),a.extractRotation(o),N.halfWidth.set(.5*I.width,0,0),N.halfHeight.set(0,.5*I.height,0),N.halfWidth.applyMatrix4(a),N.halfHeight.applyMatrix4(a),w++}else if(I.isPointLight){const N=r.point[_];N.position.setFromMatrixPosition(I.matrixWorld),N.position.applyMatrix4(b),_++}else if(I.isHemisphereLight){const N=r.hemi[A];N.direction.setFromMatrixPosition(I.matrixWorld),N.direction.transformDirection(b),A++}}},state:r}}function gD(n,e){const t=new m5(n,e),i=[],r=[];return{init:function s(){i.length=0,r.length=0},state:{lightsArray:i,shadowsArray:r,lights:t},setupLights:function l(f){t.setup(i,f)},setupLightsView:function u(f){t.setupView(i,f)},pushLight:function o(f){i.push(f)},pushShadow:function a(f){r.push(f)}}}function _5(n,e){let t=new WeakMap;return{get:function i(s,o=0){const a=t.get(s);let l;return void 0===a?(l=new gD(n,e),t.set(s,[l])):o>=a.length?(l=new gD(n,e),a.push(l)):l=a[o],l},dispose:function r(){t=new WeakMap}}}class vD extends $r{constructor(e){super(),this.isMeshDepthMaterial=!0,this.type="MeshDepthMaterial",this.depthPacking=3200,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(e)}copy(e){return super.copy(e),this.depthPacking=e.depthPacking,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this}}class yD extends $r{constructor(e){super(),this.isMeshDistanceMaterial=!0,this.type="MeshDistanceMaterial",this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(e)}copy(e){return super.copy(e),this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this}}function y5(n,e,t){let i=new ky;const r=new Be,s=new Be,o=new Nn,a=new vD({depthPacking:3201}),l=new yD,u={},d=t.maxTextureSize,f={0:1,1:0,2:2},p=new Zr({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new Be},radius:{value:4}},vertexShader:"void main() {\n\tgl_Position = vec4( position, 1.0 );\n}",fragmentShader:"uniform sampler2D shadow_pass;\nuniform vec2 resolution;\nuniform float radius;\n#include <packing>\nvoid main() {\n\tconst float samples = float( VSM_SAMPLES );\n\tfloat mean = 0.0;\n\tfloat squared_mean = 0.0;\n\tfloat uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );\n\tfloat uvStart = samples <= 1.0 ? 0.0 : - 1.0;\n\tfor ( float i = 0.0; i < samples; i ++ ) {\n\t\tfloat uvOffset = uvStart + i * uvStride;\n\t\t#ifdef HORIZONTAL_PASS\n\t\t\tvec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );\n\t\t\tmean += distribution.x;\n\t\t\tsquared_mean += distribution.y * distribution.y + distribution.x * distribution.x;\n\t\t#else\n\t\t\tfloat depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );\n\t\t\tmean += depth;\n\t\t\tsquared_mean += depth * depth;\n\t\t#endif\n\t}\n\tmean = mean / samples;\n\tsquared_mean = squared_mean / samples;\n\tfloat std_dev = sqrt( squared_mean - mean * mean );\n\tgl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );\n}"}),_=p.clone();_.defines.HORIZONTAL_PASS=1;const y=new hn;y.setAttribute("position",new ni(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const w=new Gn(y,p),A=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=PT;let b=this.type;function C(N,k){const G=e.update(w);p.defines.VSM_SAMPLES!==N.blurSamples&&(p.defines.VSM_SAMPLES=N.blurSamples,_.defines.VSM_SAMPLES=N.blurSamples,p.needsUpdate=!0,_.needsUpdate=!0),null===N.mapPass&&(N.mapPass=new Wa(r.x,r.y)),p.uniforms.shadow_pass.value=N.map.texture,p.uniforms.resolution.value=N.mapSize,p.uniforms.radius.value=N.radius,n.setRenderTarget(N.mapPass),n.clear(),n.renderBufferDirect(k,null,G,p,w,null),_.uniforms.shadow_pass.value=N.mapPass.texture,_.uniforms.resolution.value=N.mapSize,_.uniforms.radius.value=N.radius,n.setRenderTarget(N.map),n.clear(),n.renderBufferDirect(k,null,G,_,w,null)}function T(N,k,G,K){let L=null;const H=!0===G.isPointLight?N.customDistanceMaterial:N.customDepthMaterial;if(void 0!==H)L=H;else if(L=!0===G.isPointLight?l:a,n.localClippingEnabled&&!0===k.clipShadows&&Array.isArray(k.clippingPlanes)&&0!==k.clippingPlanes.length||k.displacementMap&&0!==k.displacementScale||k.alphaMap&&k.alphaTest>0||k.map&&k.alphaTest>0){const me=L.uuid,Te=k.uuid;let le=u[me];void 0===le&&(le={},u[me]=le);let ue=le[Te];void 0===ue&&(ue=L.clone(),le[Te]=ue),L=ue}return L.visible=k.visible,L.wireframe=k.wireframe,L.side=K===fo?null!==k.shadowSide?k.shadowSide:k.side:null!==k.shadowSide?k.shadowSide:f[k.side],L.alphaMap=k.alphaMap,L.alphaTest=k.alphaTest,L.map=k.map,L.clipShadows=k.clipShadows,L.clippingPlanes=k.clippingPlanes,L.clipIntersection=k.clipIntersection,L.displacementMap=k.displacementMap,L.displacementScale=k.displacementScale,L.displacementBias=k.displacementBias,L.wireframeLinewidth=k.wireframeLinewidth,L.linewidth=k.linewidth,!0===G.isPointLight&&!0===L.isMeshDistanceMaterial&&(n.properties.get(L).light=G),L}function I(N,k,G,K,L){if(!1===N.visible)return;if(N.layers.test(k.layers)&&(N.isMesh||N.isLine||N.isPoints)&&(N.castShadow||N.receiveShadow&&L===fo)&&(!N.frustumCulled||i.intersectsObject(N))){N.modelViewMatrix.multiplyMatrices(G.matrixWorldInverse,N.matrixWorld);const Te=e.update(N),le=N.material;if(Array.isArray(le)){const ue=Te.groups;for(let _e=0,Le=ue.length;_e<Le;_e++){const Se=ue[_e],De=le[Se.materialIndex];if(De&&De.visible){const Fe=T(N,De,K,L);n.renderBufferDirect(G,null,Te,Fe,N,Se)}}}else if(le.visible){const ue=T(N,le,K,L);n.renderBufferDirect(G,null,Te,ue,N,null)}}const me=N.children;for(let Te=0,le=me.length;Te<le;Te++)I(me[Te],k,G,K,L)}this.render=function(N,k,G){if(!1===A.enabled||!1===A.autoUpdate&&!1===A.needsUpdate||0===N.length)return;const K=n.getRenderTarget(),L=n.getActiveCubeFace(),H=n.getActiveMipmapLevel(),me=n.state;me.setBlending(0),me.buffers.color.setClear(1,1,1,1),me.buffers.depth.setTest(!0),me.setScissorTest(!1);const Te=b!==fo&&this.type===fo,le=b===fo&&this.type!==fo;for(let ue=0,_e=N.length;ue<_e;ue++){const Le=N[ue],Se=Le.shadow;if(void 0===Se){console.warn("THREE.WebGLShadowMap:",Le,"has no shadow.");continue}if(!1===Se.autoUpdate&&!1===Se.needsUpdate)continue;r.copy(Se.mapSize);const De=Se.getFrameExtents();if(r.multiply(De),s.copy(Se.mapSize),(r.x>d||r.y>d)&&(r.x>d&&(s.x=Math.floor(d/De.x),r.x=s.x*De.x,Se.mapSize.x=s.x),r.y>d&&(s.y=Math.floor(d/De.y),r.y=s.y*De.y,Se.mapSize.y=s.y)),null===Se.map||!0===Te||!0===le){const Ve=this.type!==fo?{minFilter:ui,magFilter:ui}:{};null!==Se.map&&Se.map.dispose(),Se.map=new Wa(r.x,r.y,Ve),Se.map.texture.name=Le.name+".shadowMap",Se.camera.updateProjectionMatrix()}n.setRenderTarget(Se.map),n.clear();const Fe=Se.getViewportCount();for(let Ve=0;Ve<Fe;Ve++){const he=Se.getViewport(Ve);o.set(s.x*he.x,s.y*he.y,s.x*he.z,s.y*he.w),me.viewport(o),Se.updateMatrices(Le,Ve),i=Se.getFrustum(),I(k,G,Se.camera,Le,this.type)}!0!==Se.isPointLightShadow&&this.type===fo&&C(Se,G),Se.needsUpdate=!1}b=this.type,A.needsUpdate=!1,n.setRenderTarget(K,L,H)}}function x5(n,e,t){const i=t.isWebGL2,a=new function r(){let ie=!1;const at=new Nn;let ye=null;const Je=new Nn(0,0,0,0);return{setMask:function(ct){ye!==ct&&!ie&&(n.colorMask(ct,ct,ct,ct),ye=ct)},setLocked:function(ct){ie=ct},setClear:function(ct,In,Jn,Oi,Xs){!0===Xs&&(ct*=Oi,In*=Oi,Jn*=Oi),at.set(ct,In,Jn,Oi),!1===Je.equals(at)&&(n.clearColor(ct,In,Jn,Oi),Je.copy(at))},reset:function(){ie=!1,ye=null,Je.set(-1,0,0,0)}}},l=new function s(){let ie=!1,at=null,ye=null,Je=null;return{setTest:function(ct){ct?Ct(n.DEPTH_TEST):wt(n.DEPTH_TEST)},setMask:function(ct){at!==ct&&!ie&&(n.depthMask(ct),at=ct)},setFunc:function(ct){if(ye!==ct){switch(ct){case 0:n.depthFunc(n.NEVER);break;case 1:n.depthFunc(n.ALWAYS);break;case 2:n.depthFunc(n.LESS);break;case 3:default:n.depthFunc(n.LEQUAL);break;case 4:n.depthFunc(n.EQUAL);break;case 5:n.depthFunc(n.GEQUAL);break;case 6:n.depthFunc(n.GREATER);break;case 7:n.depthFunc(n.NOTEQUAL)}ye=ct}},setLocked:function(ct){ie=ct},setClear:function(ct){Je!==ct&&(n.clearDepth(ct),Je=ct)},reset:function(){ie=!1,at=null,ye=null,Je=null}}},u=new function o(){let ie=!1,at=null,ye=null,Je=null,ct=null,In=null,Jn=null,Oi=null,Xs=null;return{setTest:function(si){ie||(si?Ct(n.STENCIL_TEST):wt(n.STENCIL_TEST))},setMask:function(si){at!==si&&!ie&&(n.stencilMask(si),at=si)},setFunc:function(si,Ys,sr){(ye!==si||Je!==Ys||ct!==sr)&&(n.stencilFunc(si,Ys,sr),ye=si,Je=Ys,ct=sr)},setOp:function(si,Ys,sr){(In!==si||Jn!==Ys||Oi!==sr)&&(n.stencilOp(si,Ys,sr),In=si,Jn=Ys,Oi=sr)},setLocked:function(si){ie=si},setClear:function(si){Xs!==si&&(n.clearStencil(si),Xs=si)},reset:function(){ie=!1,at=null,ye=null,Je=null,ct=null,In=null,Jn=null,Oi=null,Xs=null}}},d=new WeakMap,f=new WeakMap;let p={},_={},y=new WeakMap,w=[],A=null,b=!1,C=null,T=null,I=null,N=null,k=null,G=null,K=null,L=!1,H=null,me=null,Te=null,le=null,ue=null;const _e=n.getParameter(n.MAX_COMBINED_TEXTURE_IMAGE_UNITS);let Le=!1,Se=0;const De=n.getParameter(n.VERSION);-1!==De.indexOf("WebGL")?(Se=parseFloat(/^WebGL (\d)/.exec(De)[1]),Le=Se>=1):-1!==De.indexOf("OpenGL ES")&&(Se=parseFloat(/^OpenGL ES (\d)/.exec(De)[1]),Le=Se>=2);let Fe=null,Ve={};const he=n.getParameter(n.SCISSOR_BOX),Ce=n.getParameter(n.VIEWPORT),Ye=(new Nn).fromArray(he),tt=(new Nn).fromArray(Ce);function it(ie,at,ye,Je){const ct=new Uint8Array(4),In=n.createTexture();n.bindTexture(ie,In),n.texParameteri(ie,n.TEXTURE_MIN_FILTER,n.NEAREST),n.texParameteri(ie,n.TEXTURE_MAG_FILTER,n.NEAREST);for(let Jn=0;Jn<ye;Jn++)!i||ie!==n.TEXTURE_3D&&ie!==n.TEXTURE_2D_ARRAY?n.texImage2D(at+Jn,0,n.RGBA,1,1,0,n.RGBA,n.UNSIGNED_BYTE,ct):n.texImage3D(at,0,n.RGBA,1,1,Je,0,n.RGBA,n.UNSIGNED_BYTE,ct);return In}const gt={};function Ct(ie){!0!==p[ie]&&(n.enable(ie),p[ie]=!0)}function wt(ie){!1!==p[ie]&&(n.disable(ie),p[ie]=!1)}gt[n.TEXTURE_2D]=it(n.TEXTURE_2D,n.TEXTURE_2D,1),gt[n.TEXTURE_CUBE_MAP]=it(n.TEXTURE_CUBE_MAP,n.TEXTURE_CUBE_MAP_POSITIVE_X,6),i&&(gt[n.TEXTURE_2D_ARRAY]=it(n.TEXTURE_2D_ARRAY,n.TEXTURE_2D_ARRAY,1,1),gt[n.TEXTURE_3D]=it(n.TEXTURE_3D,n.TEXTURE_3D,1,1)),a.setClear(0,0,0,1),l.setClear(1),u.setClear(0),Ct(n.DEPTH_TEST),l.setFunc(3),ke(!1),It(1),Ct(n.CULL_FACE),Re(0);const te={100:n.FUNC_ADD,101:n.FUNC_SUBTRACT,102:n.FUNC_REVERSE_SUBTRACT};if(i)te[103]=n.MIN,te[104]=n.MAX;else{const ie=e.get("EXT_blend_minmax");null!==ie&&(te[103]=ie.MIN_EXT,te[104]=ie.MAX_EXT)}const Ze={200:n.ZERO,201:n.ONE,202:n.SRC_COLOR,204:n.SRC_ALPHA,210:n.SRC_ALPHA_SATURATE,208:n.DST_COLOR,206:n.DST_ALPHA,203:n.ONE_MINUS_SRC_COLOR,205:n.ONE_MINUS_SRC_ALPHA,209:n.ONE_MINUS_DST_COLOR,207:n.ONE_MINUS_DST_ALPHA};function Re(ie,at,ye,Je,ct,In,Jn,Oi){if(0!==ie){if(!1===b&&(Ct(n.BLEND),b=!0),5===ie)ct=ct||at,In=In||ye,Jn=Jn||Je,(at!==T||ct!==k)&&(n.blendEquationSeparate(te[at],te[ct]),T=at,k=ct),(ye!==I||Je!==N||In!==G||Jn!==K)&&(n.blendFuncSeparate(Ze[ye],Ze[Je],Ze[In],Ze[Jn]),I=ye,N=Je,G=In,K=Jn),C=ie,L=!1;else if(ie!==C||Oi!==L){if((100!==T||100!==k)&&(n.blendEquation(n.FUNC_ADD),T=100,k=100),Oi)switch(ie){case 1:n.blendFuncSeparate(n.ONE,n.ONE_MINUS_SRC_ALPHA,n.ONE,n.ONE_MINUS_SRC_ALPHA);break;case 2:n.blendFunc(n.ONE,n.ONE);break;case 3:n.blendFuncSeparate(n.ZERO,n.ONE_MINUS_SRC_COLOR,n.ZERO,n.ONE);break;case 4:n.blendFuncSeparate(n.ZERO,n.SRC_COLOR,n.ZERO,n.SRC_ALPHA);break;default:console.error("THREE.WebGLState: Invalid blending: ",ie)}else switch(ie){case 1:n.blendFuncSeparate(n.SRC_ALPHA,n.ONE_MINUS_SRC_ALPHA,n.ONE,n.ONE_MINUS_SRC_ALPHA);break;case 2:n.blendFunc(n.SRC_ALPHA,n.ONE);break;case 3:n.blendFuncSeparate(n.ZERO,n.ONE_MINUS_SRC_COLOR,n.ZERO,n.ONE);break;case 4:n.blendFunc(n.ZERO,n.SRC_COLOR);break;default:console.error("THREE.WebGLState: Invalid blending: ",ie)}I=null,N=null,G=null,K=null,C=ie,L=Oi}}else!0===b&&(wt(n.BLEND),b=!1)}function ke(ie){H!==ie&&(n.frontFace(ie?n.CW:n.CCW),H=ie)}function It(ie){0!==ie?(Ct(n.CULL_FACE),ie!==me&&n.cullFace(1===ie?n.BACK:2===ie?n.FRONT:n.FRONT_AND_BACK)):wt(n.CULL_FACE),me=ie}function vt(ie,at,ye){ie?(Ct(n.POLYGON_OFFSET_FILL),(le!==at||ue!==ye)&&(n.polygonOffset(at,ye),le=at,ue=ye)):wt(n.POLYGON_OFFSET_FILL)}return{buffers:{color:a,depth:l,stencil:u},enable:Ct,disable:wt,bindFramebuffer:function Tn(ie,at){return _[ie]!==at&&(n.bindFramebuffer(ie,at),_[ie]=at,i&&(ie===n.DRAW_FRAMEBUFFER&&(_[n.FRAMEBUFFER]=at),ie===n.FRAMEBUFFER&&(_[n.DRAW_FRAMEBUFFER]=at)),!0)},drawBuffers:function Dn(ie,at){let ye=w,Je=!1;if(ie)if(ye=y.get(at),void 0===ye&&(ye=[],y.set(at,ye)),ie.isWebGLMultipleRenderTargets){const ct=ie.texture;if(ye.length!==ct.length||ye[0]!==n.COLOR_ATTACHMENT0){for(let In=0,Jn=ct.length;In<Jn;In++)ye[In]=n.COLOR_ATTACHMENT0+In;ye.length=ct.length,Je=!0}}else ye[0]!==n.COLOR_ATTACHMENT0&&(ye[0]=n.COLOR_ATTACHMENT0,Je=!0);else ye[0]!==n.BACK&&(ye[0]=n.BACK,Je=!0);Je&&(t.isWebGL2?n.drawBuffers(ye):e.get("WEBGL_draw_buffers").drawBuffersWEBGL(ye))},useProgram:function Nt(ie){return A!==ie&&(n.useProgram(ie),A=ie,!0)},setBlending:Re,setMaterial:function je(ie,at){2===ie.side?wt(n.CULL_FACE):Ct(n.CULL_FACE);let ye=1===ie.side;at&&(ye=!ye),ke(ye),1===ie.blending&&!1===ie.transparent?Re(0):Re(ie.blending,ie.blendEquation,ie.blendSrc,ie.blendDst,ie.blendEquationAlpha,ie.blendSrcAlpha,ie.blendDstAlpha,ie.premultipliedAlpha),l.setFunc(ie.depthFunc),l.setTest(ie.depthTest),l.setMask(ie.depthWrite),a.setMask(ie.colorWrite);const Je=ie.stencilWrite;u.setTest(Je),Je&&(u.setMask(ie.stencilWriteMask),u.setFunc(ie.stencilFunc,ie.stencilRef,ie.stencilFuncMask),u.setOp(ie.stencilFail,ie.stencilZFail,ie.stencilZPass)),vt(ie.polygonOffset,ie.polygonOffsetFactor,ie.polygonOffsetUnits),!0===ie.alphaToCoverage?Ct(n.SAMPLE_ALPHA_TO_COVERAGE):wt(n.SAMPLE_ALPHA_TO_COVERAGE)},setFlipSided:ke,setCullFace:It,setLineWidth:function ft(ie){ie!==Te&&(Le&&n.lineWidth(ie),Te=ie)},setPolygonOffset:vt,setScissorTest:function Qt(ie){ie?Ct(n.SCISSOR_TEST):wt(n.SCISSOR_TEST)},activeTexture:function yn(ie){void 0===ie&&(ie=n.TEXTURE0+_e-1),Fe!==ie&&(n.activeTexture(ie),Fe=ie)},bindTexture:function ri(ie,at,ye){void 0===ye&&(ye=null===Fe?n.TEXTURE0+_e-1:Fe);let Je=Ve[ye];void 0===Je&&(Je={type:void 0,texture:void 0},Ve[ye]=Je),(Je.type!==ie||Je.texture!==at)&&(Fe!==ye&&(n.activeTexture(ye),Fe=ye),n.bindTexture(ie,at||gt[ie]),Je.type=ie,Je.texture=at)},unbindTexture:function J(){const ie=Ve[Fe];void 0!==ie&&void 0!==ie.type&&(n.bindTexture(ie.type,null),ie.type=void 0,ie.texture=void 0)},compressedTexImage2D:function z(){try{n.compressedTexImage2D.apply(n,arguments)}catch(ie){console.error("THREE.WebGLState:",ie)}},compressedTexImage3D:function be(){try{n.compressedTexImage3D.apply(n,arguments)}catch(ie){console.error("THREE.WebGLState:",ie)}},texImage2D:function Bt(){try{n.texImage2D.apply(n,arguments)}catch(ie){console.error("THREE.WebGLState:",ie)}},texImage3D:function Ft(){try{n.texImage3D.apply(n,arguments)}catch(ie){console.error("THREE.WebGLState:",ie)}},updateUBOMapping:function xt(ie,at){let ye=f.get(at);void 0===ye&&(ye=new WeakMap,f.set(at,ye));let Je=ye.get(ie);void 0===Je&&(Je=n.getUniformBlockIndex(at,ie.name),ye.set(ie,Je))},uniformBlockBinding:function pn(ie,at){const Je=f.get(at).get(ie);d.get(at)!==Je&&(n.uniformBlockBinding(at,Je,ie.__bindingPointIndex),d.set(at,Je))},texStorage2D:function ot(){try{n.texStorage2D.apply(n,arguments)}catch(ie){console.error("THREE.WebGLState:",ie)}},texStorage3D:function Ee(){try{n.texStorage3D.apply(n,arguments)}catch(ie){console.error("THREE.WebGLState:",ie)}},texSubImage2D:function We(){try{n.texSubImage2D.apply(n,arguments)}catch(ie){console.error("THREE.WebGLState:",ie)}},texSubImage3D:function qe(){try{n.texSubImage3D.apply(n,arguments)}catch(ie){console.error("THREE.WebGLState:",ie)}},compressedTexSubImage2D:function st(){try{n.compressedTexSubImage2D.apply(n,arguments)}catch(ie){console.error("THREE.WebGLState:",ie)}},compressedTexSubImage3D:function Et(){try{n.compressedTexSubImage3D.apply(n,arguments)}catch(ie){console.error("THREE.WebGLState:",ie)}},scissor:function kt(ie){!1===Ye.equals(ie)&&(n.scissor(ie.x,ie.y,ie.z,ie.w),Ye.copy(ie))},viewport:function yt(ie){!1===tt.equals(ie)&&(n.viewport(ie.x,ie.y,ie.z,ie.w),tt.copy(ie))},reset:function kn(){n.disable(n.BLEND),n.disable(n.CULL_FACE),n.disable(n.DEPTH_TEST),n.disable(n.POLYGON_OFFSET_FILL),n.disable(n.SCISSOR_TEST),n.disable(n.STENCIL_TEST),n.disable(n.SAMPLE_ALPHA_TO_COVERAGE),n.blendEquation(n.FUNC_ADD),n.blendFunc(n.ONE,n.ZERO),n.blendFuncSeparate(n.ONE,n.ZERO,n.ONE,n.ZERO),n.colorMask(!0,!0,!0,!0),n.clearColor(0,0,0,0),n.depthMask(!0),n.depthFunc(n.LESS),n.clearDepth(1),n.stencilMask(4294967295),n.stencilFunc(n.ALWAYS,0,4294967295),n.stencilOp(n.KEEP,n.KEEP,n.KEEP),n.clearStencil(0),n.cullFace(n.BACK),n.frontFace(n.CCW),n.polygonOffset(0,0),n.activeTexture(n.TEXTURE0),n.bindFramebuffer(n.FRAMEBUFFER,null),!0===i&&(n.bindFramebuffer(n.DRAW_FRAMEBUFFER,null),n.bindFramebuffer(n.READ_FRAMEBUFFER,null)),n.useProgram(null),n.lineWidth(1),n.scissor(0,0,n.canvas.width,n.canvas.height),n.viewport(0,0,n.canvas.width,n.canvas.height),p={},Fe=null,Ve={},_={},y=new WeakMap,w=[],A=null,b=!1,C=null,T=null,I=null,N=null,k=null,G=null,K=null,L=!1,H=null,me=null,Te=null,le=null,ue=null,Ye.set(0,0,n.canvas.width,n.canvas.height),tt.set(0,0,n.canvas.width,n.canvas.height),a.reset(),l.reset(),u.reset()}}}function b5(n,e,t,i,r,s,o){const a=r.isWebGL2,l=r.maxTextures,u=r.maxCubemapSize,d=r.maxTextureSize,f=r.maxSamples,p=e.has("WEBGL_multisampled_render_to_texture")?e.get("WEBGL_multisampled_render_to_texture"):null,_=!(typeof navigator>"u")&&/OculusBrowser/g.test(navigator.userAgent),y=new WeakMap;let w;const A=new WeakMap;let b=!1;try{b=typeof OffscreenCanvas<"u"&&null!==new OffscreenCanvas(1,1).getContext("2d")}catch{}function C(J,z){return b?new OffscreenCanvas(J,z):Ph("canvas")}function T(J,z,be,We){let qe=1;if((J.width>We||J.height>We)&&(qe=We/Math.max(J.width,J.height)),qe<1||!0===z){if(typeof HTMLImageElement<"u"&&J instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&J instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&J instanceof ImageBitmap){const st=z?_p:Math.floor,Et=st(qe*J.width),ot=st(qe*J.height);void 0===w&&(w=C(Et,ot));const Ee=be?C(Et,ot):w;return Ee.width=Et,Ee.height=ot,Ee.getContext("2d").drawImage(J,0,0,Et,ot),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+J.width+"x"+J.height+") to ("+Et+"x"+ot+")."),Ee}return"data"in J&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+J.width+"x"+J.height+")."),J}return J}function I(J){return gy(J.width)&&gy(J.height)}function k(J,z){return J.generateMipmaps&&z&&J.minFilter!==ui&&J.minFilter!==ei}function G(J){n.generateMipmap(J)}function K(J,z,be,We,qe=!1){if(!1===a)return z;if(null!==J){if(void 0!==n[J])return n[J];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+J+"'")}let st=z;return z===n.RED&&(be===n.FLOAT&&(st=n.R32F),be===n.HALF_FLOAT&&(st=n.R16F),be===n.UNSIGNED_BYTE&&(st=n.R8)),z===n.RG&&(be===n.FLOAT&&(st=n.RG32F),be===n.HALF_FLOAT&&(st=n.RG16F),be===n.UNSIGNED_BYTE&&(st=n.RG8)),z===n.RGBA&&(be===n.FLOAT&&(st=n.RGBA32F),be===n.HALF_FLOAT&&(st=n.RGBA16F),be===n.UNSIGNED_BYTE&&(st=We===jt&&!1===qe?n.SRGB8_ALPHA8:n.RGBA8),be===n.UNSIGNED_SHORT_4_4_4_4&&(st=n.RGBA4),be===n.UNSIGNED_SHORT_5_5_5_1&&(st=n.RGB5_A1)),(st===n.R16F||st===n.R32F||st===n.RG16F||st===n.RG32F||st===n.RGBA16F||st===n.RGBA32F)&&e.get("EXT_color_buffer_float"),st}function L(J,z,be){return!0===k(J,be)||J.isFramebufferTexture&&J.minFilter!==ui&&J.minFilter!==ei?Math.log2(Math.max(z.width,z.height))+1:void 0!==J.mipmaps&&J.mipmaps.length>0?J.mipmaps.length:J.isCompressedTexture&&Array.isArray(J.image)?z.mipmaps.length:1}function H(J){return J===ui||1004===J||1005===J?n.NEAREST:n.LINEAR}function me(J){const z=J.target;z.removeEventListener("dispose",me),function le(J){const z=i.get(J);if(void 0===z.__webglInit)return;const be=J.source,We=A.get(be);if(We){const qe=We[z.__cacheKey];qe.usedTimes--,0===qe.usedTimes&&ue(J),0===Object.keys(We).length&&A.delete(be)}i.remove(J)}(z),z.isVideoTexture&&y.delete(z)}function Te(J){const z=J.target;z.removeEventListener("dispose",Te),function _e(J){const z=J.texture,be=i.get(J),We=i.get(z);if(void 0!==We.__webglTexture&&(n.deleteTexture(We.__webglTexture),o.memory.textures--),J.depthTexture&&J.depthTexture.dispose(),J.isWebGLCubeRenderTarget)for(let qe=0;qe<6;qe++)n.deleteFramebuffer(be.__webglFramebuffer[qe]),be.__webglDepthbuffer&&n.deleteRenderbuffer(be.__webglDepthbuffer[qe]);else{if(n.deleteFramebuffer(be.__webglFramebuffer),be.__webglDepthbuffer&&n.deleteRenderbuffer(be.__webglDepthbuffer),be.__webglMultisampledFramebuffer&&n.deleteFramebuffer(be.__webglMultisampledFramebuffer),be.__webglColorRenderbuffer)for(let qe=0;qe<be.__webglColorRenderbuffer.length;qe++)be.__webglColorRenderbuffer[qe]&&n.deleteRenderbuffer(be.__webglColorRenderbuffer[qe]);be.__webglDepthRenderbuffer&&n.deleteRenderbuffer(be.__webglDepthRenderbuffer)}if(J.isWebGLMultipleRenderTargets)for(let qe=0,st=z.length;qe<st;qe++){const Et=i.get(z[qe]);Et.__webglTexture&&(n.deleteTexture(Et.__webglTexture),o.memory.textures--),i.remove(z[qe])}i.remove(z),i.remove(J)}(z)}function ue(J){const z=i.get(J);n.deleteTexture(z.__webglTexture),delete A.get(J.source)[z.__cacheKey],o.memory.textures--}let Le=0;function Ve(J,z){const be=i.get(J);if(J.isVideoTexture&&function yn(J){const z=o.render.frame;y.get(J)!==z&&(y.set(J,z),J.update())}(J),!1===J.isRenderTargetTexture&&J.version>0&&be.__version!==J.version){const We=J.image;if(null===We)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else{if(!1!==We.complete)return void Tn(be,J,z);console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete")}}t.bindTexture(n.TEXTURE_2D,be.__webglTexture,n.TEXTURE0+z)}const tt={[Oa]:n.REPEAT,[$i]:n.CLAMP_TO_EDGE,1002:n.MIRRORED_REPEAT},it={[ui]:n.NEAREST,1004:n.NEAREST_MIPMAP_NEAREST,1005:n.NEAREST_MIPMAP_LINEAR,[ei]:n.LINEAR,1007:n.LINEAR_MIPMAP_NEAREST,[_o]:n.LINEAR_MIPMAP_LINEAR},gt={512:n.NEVER,519:n.ALWAYS,513:n.LESS,515:n.LEQUAL,514:n.EQUAL,518:n.GEQUAL,516:n.GREATER,517:n.NOTEQUAL};function Ct(J,z,be){if(be?(n.texParameteri(J,n.TEXTURE_WRAP_S,tt[z.wrapS]),n.texParameteri(J,n.TEXTURE_WRAP_T,tt[z.wrapT]),(J===n.TEXTURE_3D||J===n.TEXTURE_2D_ARRAY)&&n.texParameteri(J,n.TEXTURE_WRAP_R,tt[z.wrapR]),n.texParameteri(J,n.TEXTURE_MAG_FILTER,it[z.magFilter]),n.texParameteri(J,n.TEXTURE_MIN_FILTER,it[z.minFilter])):(n.texParameteri(J,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE),n.texParameteri(J,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE),(J===n.TEXTURE_3D||J===n.TEXTURE_2D_ARRAY)&&n.texParameteri(J,n.TEXTURE_WRAP_R,n.CLAMP_TO_EDGE),(z.wrapS!==$i||z.wrapT!==$i)&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),n.texParameteri(J,n.TEXTURE_MAG_FILTER,H(z.magFilter)),n.texParameteri(J,n.TEXTURE_MIN_FILTER,H(z.minFilter)),z.minFilter!==ui&&z.minFilter!==ei&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.")),z.compareFunction&&(n.texParameteri(J,n.TEXTURE_COMPARE_MODE,n.COMPARE_REF_TO_TEXTURE),n.texParameteri(J,n.TEXTURE_COMPARE_FUNC,gt[z.compareFunction])),!0===e.has("EXT_texture_filter_anisotropic")){const We=e.get("EXT_texture_filter_anisotropic");if(z.magFilter===ui||1005!==z.minFilter&&z.minFilter!==_o||z.type===go&&!1===e.has("OES_texture_float_linear")||!1===a&&z.type===Dh&&!1===e.has("OES_texture_half_float_linear"))return;(z.anisotropy>1||i.get(z).__currentAnisotropy)&&(n.texParameterf(J,We.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(z.anisotropy,r.getMaxAnisotropy())),i.get(z).__currentAnisotropy=z.anisotropy)}}function wt(J,z){let be=!1;void 0===J.__webglInit&&(J.__webglInit=!0,z.addEventListener("dispose",me));const We=z.source;let qe=A.get(We);void 0===qe&&(qe={},A.set(We,qe));const st=function Fe(J){const z=[];return z.push(J.wrapS),z.push(J.wrapT),z.push(J.wrapR||0),z.push(J.magFilter),z.push(J.minFilter),z.push(J.anisotropy),z.push(J.internalFormat),z.push(J.format),z.push(J.type),z.push(J.generateMipmaps),z.push(J.premultiplyAlpha),z.push(J.flipY),z.push(J.unpackAlignment),z.push(J.colorSpace),z.join()}(z);if(st!==J.__cacheKey){void 0===qe[st]&&(qe[st]={texture:n.createTexture(),usedTimes:0},o.memory.textures++,be=!0),qe[st].usedTimes++;const Et=qe[J.__cacheKey];void 0!==Et&&(qe[J.__cacheKey].usedTimes--,0===Et.usedTimes&&ue(z)),J.__cacheKey=st,J.__webglTexture=qe[st].texture}return be}function Tn(J,z,be){let We=n.TEXTURE_2D;(z.isDataArrayTexture||z.isCompressedArrayTexture)&&(We=n.TEXTURE_2D_ARRAY),z.isData3DTexture&&(We=n.TEXTURE_3D);const qe=wt(J,z),st=z.source;t.bindTexture(We,J.__webglTexture,n.TEXTURE0+be);const Et=i.get(st);if(st.version!==Et.__version||!0===qe){t.activeTexture(n.TEXTURE0+be),n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,z.flipY),n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,z.premultiplyAlpha),n.pixelStorei(n.UNPACK_ALIGNMENT,z.unpackAlignment),n.pixelStorei(n.UNPACK_COLORSPACE_CONVERSION_WEBGL,n.NONE);const ot=function N(J){return!a&&(J.wrapS!==$i||J.wrapT!==$i||J.minFilter!==ui&&J.minFilter!==ei)}(z)&&!1===I(z.image);let Ee=T(z.image,ot,!1,d);Ee=ri(z,Ee);const Bt=I(Ee)||a,Ft=s.convert(z.format,z.colorSpace);let xt,kt=s.convert(z.type),yt=K(z.internalFormat,Ft,kt,z.colorSpace);Ct(We,z,Bt);const pn=z.mipmaps,kn=a&&!0!==z.isVideoTexture,ie=void 0===Et.__version||!0===qe,at=L(z,Ee,Bt);if(z.isDepthTexture)yt=n.DEPTH_COMPONENT,a?yt=z.type===go?n.DEPTH_COMPONENT32F:z.type===Ko?n.DEPTH_COMPONENT24:z.type===Va?n.DEPTH24_STENCIL8:n.DEPTH_COMPONENT16:z.type===go&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),z.format===ka&&yt===n.DEPTH_COMPONENT&&1012!==z.type&&z.type!==Ko&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),z.type=Ko,kt=s.convert(z.type)),z.format===xc&&yt===n.DEPTH_COMPONENT&&(yt=n.DEPTH_STENCIL,z.type!==Va&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),z.type=Va,kt=s.convert(z.type))),ie&&(kn?t.texStorage2D(n.TEXTURE_2D,1,yt,Ee.width,Ee.height):t.texImage2D(n.TEXTURE_2D,0,yt,Ee.width,Ee.height,0,Ft,kt,null));else if(z.isDataTexture)if(pn.length>0&&Bt){kn&&ie&&t.texStorage2D(n.TEXTURE_2D,at,yt,pn[0].width,pn[0].height);for(let ye=0,Je=pn.length;ye<Je;ye++)xt=pn[ye],kn?t.texSubImage2D(n.TEXTURE_2D,ye,0,0,xt.width,xt.height,Ft,kt,xt.data):t.texImage2D(n.TEXTURE_2D,ye,yt,xt.width,xt.height,0,Ft,kt,xt.data);z.generateMipmaps=!1}else kn?(ie&&t.texStorage2D(n.TEXTURE_2D,at,yt,Ee.width,Ee.height),t.texSubImage2D(n.TEXTURE_2D,0,0,0,Ee.width,Ee.height,Ft,kt,Ee.data)):t.texImage2D(n.TEXTURE_2D,0,yt,Ee.width,Ee.height,0,Ft,kt,Ee.data);else if(z.isCompressedTexture)if(z.isCompressedArrayTexture){kn&&ie&&t.texStorage3D(n.TEXTURE_2D_ARRAY,at,yt,pn[0].width,pn[0].height,Ee.depth);for(let ye=0,Je=pn.length;ye<Je;ye++)xt=pn[ye],z.format!==jr?null!==Ft?kn?t.compressedTexSubImage3D(n.TEXTURE_2D_ARRAY,ye,0,0,0,xt.width,xt.height,Ee.depth,Ft,xt.data,0,0):t.compressedTexImage3D(n.TEXTURE_2D_ARRAY,ye,yt,xt.width,xt.height,Ee.depth,0,xt.data,0,0):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):kn?t.texSubImage3D(n.TEXTURE_2D_ARRAY,ye,0,0,0,xt.width,xt.height,Ee.depth,Ft,kt,xt.data):t.texImage3D(n.TEXTURE_2D_ARRAY,ye,yt,xt.width,xt.height,Ee.depth,0,Ft,kt,xt.data)}else{kn&&ie&&t.texStorage2D(n.TEXTURE_2D,at,yt,pn[0].width,pn[0].height);for(let ye=0,Je=pn.length;ye<Je;ye++)xt=pn[ye],z.format!==jr?null!==Ft?kn?t.compressedTexSubImage2D(n.TEXTURE_2D,ye,0,0,xt.width,xt.height,Ft,xt.data):t.compressedTexImage2D(n.TEXTURE_2D,ye,yt,xt.width,xt.height,0,xt.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):kn?t.texSubImage2D(n.TEXTURE_2D,ye,0,0,xt.width,xt.height,Ft,kt,xt.data):t.texImage2D(n.TEXTURE_2D,ye,yt,xt.width,xt.height,0,Ft,kt,xt.data)}else if(z.isDataArrayTexture)kn?(ie&&t.texStorage3D(n.TEXTURE_2D_ARRAY,at,yt,Ee.width,Ee.height,Ee.depth),t.texSubImage3D(n.TEXTURE_2D_ARRAY,0,0,0,0,Ee.width,Ee.height,Ee.depth,Ft,kt,Ee.data)):t.texImage3D(n.TEXTURE_2D_ARRAY,0,yt,Ee.width,Ee.height,Ee.depth,0,Ft,kt,Ee.data);else if(z.isData3DTexture)kn?(ie&&t.texStorage3D(n.TEXTURE_3D,at,yt,Ee.width,Ee.height,Ee.depth),t.texSubImage3D(n.TEXTURE_3D,0,0,0,0,Ee.width,Ee.height,Ee.depth,Ft,kt,Ee.data)):t.texImage3D(n.TEXTURE_3D,0,yt,Ee.width,Ee.height,Ee.depth,0,Ft,kt,Ee.data);else if(z.isFramebufferTexture){if(ie)if(kn)t.texStorage2D(n.TEXTURE_2D,at,yt,Ee.width,Ee.height);else{let ye=Ee.width,Je=Ee.height;for(let ct=0;ct<at;ct++)t.texImage2D(n.TEXTURE_2D,ct,yt,ye,Je,0,Ft,kt,null),ye>>=1,Je>>=1}}else if(pn.length>0&&Bt){kn&&ie&&t.texStorage2D(n.TEXTURE_2D,at,yt,pn[0].width,pn[0].height);for(let ye=0,Je=pn.length;ye<Je;ye++)xt=pn[ye],kn?t.texSubImage2D(n.TEXTURE_2D,ye,0,0,Ft,kt,xt):t.texImage2D(n.TEXTURE_2D,ye,yt,Ft,kt,xt);z.generateMipmaps=!1}else kn?(ie&&t.texStorage2D(n.TEXTURE_2D,at,yt,Ee.width,Ee.height),t.texSubImage2D(n.TEXTURE_2D,0,0,0,Ft,kt,Ee)):t.texImage2D(n.TEXTURE_2D,0,yt,Ft,kt,Ee);k(z,Bt)&&G(We),Et.__version=st.version,z.onUpdate&&z.onUpdate(z)}J.__version=z.version}function Nt(J,z,be,We,qe){const st=s.convert(be.format,be.colorSpace),Et=s.convert(be.type),ot=K(be.internalFormat,st,Et,be.colorSpace);i.get(z).__hasExternalTextures||(qe===n.TEXTURE_3D||qe===n.TEXTURE_2D_ARRAY?t.texImage3D(qe,0,ot,z.width,z.height,z.depth,0,st,Et,null):t.texImage2D(qe,0,ot,z.width,z.height,0,st,Et,null)),t.bindFramebuffer(n.FRAMEBUFFER,J),Qt(z)?p.framebufferTexture2DMultisampleEXT(n.FRAMEBUFFER,We,qe,i.get(be).__webglTexture,0,vt(z)):(qe===n.TEXTURE_2D||qe>=n.TEXTURE_CUBE_MAP_POSITIVE_X&&qe<=n.TEXTURE_CUBE_MAP_NEGATIVE_Z)&&n.framebufferTexture2D(n.FRAMEBUFFER,We,qe,i.get(be).__webglTexture,0),t.bindFramebuffer(n.FRAMEBUFFER,null)}function te(J,z,be){if(n.bindRenderbuffer(n.RENDERBUFFER,J),z.depthBuffer&&!z.stencilBuffer){let We=n.DEPTH_COMPONENT16;if(be||Qt(z)){const qe=z.depthTexture;qe&&qe.isDepthTexture&&(qe.type===go?We=n.DEPTH_COMPONENT32F:qe.type===Ko&&(We=n.DEPTH_COMPONENT24));const st=vt(z);Qt(z)?p.renderbufferStorageMultisampleEXT(n.RENDERBUFFER,st,We,z.width,z.height):n.renderbufferStorageMultisample(n.RENDERBUFFER,st,We,z.width,z.height)}else n.renderbufferStorage(n.RENDERBUFFER,We,z.width,z.height);n.framebufferRenderbuffer(n.FRAMEBUFFER,n.DEPTH_ATTACHMENT,n.RENDERBUFFER,J)}else if(z.depthBuffer&&z.stencilBuffer){const We=vt(z);be&&!1===Qt(z)?n.renderbufferStorageMultisample(n.RENDERBUFFER,We,n.DEPTH24_STENCIL8,z.width,z.height):Qt(z)?p.renderbufferStorageMultisampleEXT(n.RENDERBUFFER,We,n.DEPTH24_STENCIL8,z.width,z.height):n.renderbufferStorage(n.RENDERBUFFER,n.DEPTH_STENCIL,z.width,z.height),n.framebufferRenderbuffer(n.FRAMEBUFFER,n.DEPTH_STENCIL_ATTACHMENT,n.RENDERBUFFER,J)}else{const We=!0===z.isWebGLMultipleRenderTargets?z.texture:[z.texture];for(let qe=0;qe<We.length;qe++){const st=We[qe],Et=s.convert(st.format,st.colorSpace),ot=s.convert(st.type),Ee=K(st.internalFormat,Et,ot,st.colorSpace),Bt=vt(z);be&&!1===Qt(z)?n.renderbufferStorageMultisample(n.RENDERBUFFER,Bt,Ee,z.width,z.height):Qt(z)?p.renderbufferStorageMultisampleEXT(n.RENDERBUFFER,Bt,Ee,z.width,z.height):n.renderbufferStorage(n.RENDERBUFFER,Ee,z.width,z.height)}}n.bindRenderbuffer(n.RENDERBUFFER,null)}function Re(J){const z=i.get(J),be=!0===J.isWebGLCubeRenderTarget;if(J.depthTexture&&!z.__autoAllocateDepthBuffer){if(be)throw new Error("target.depthTexture not supported in Cube render targets");!function Ze(J,z){if(z&&z.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(t.bindFramebuffer(n.FRAMEBUFFER,J),!z.depthTexture||!z.depthTexture.isDepthTexture)throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");(!i.get(z.depthTexture).__webglTexture||z.depthTexture.image.width!==z.width||z.depthTexture.image.height!==z.height)&&(z.depthTexture.image.width=z.width,z.depthTexture.image.height=z.height,z.depthTexture.needsUpdate=!0),Ve(z.depthTexture,0);const We=i.get(z.depthTexture).__webglTexture,qe=vt(z);if(z.depthTexture.format===ka)Qt(z)?p.framebufferTexture2DMultisampleEXT(n.FRAMEBUFFER,n.DEPTH_ATTACHMENT,n.TEXTURE_2D,We,0,qe):n.framebufferTexture2D(n.FRAMEBUFFER,n.DEPTH_ATTACHMENT,n.TEXTURE_2D,We,0);else{if(z.depthTexture.format!==xc)throw new Error("Unknown depthTexture format");Qt(z)?p.framebufferTexture2DMultisampleEXT(n.FRAMEBUFFER,n.DEPTH_STENCIL_ATTACHMENT,n.TEXTURE_2D,We,0,qe):n.framebufferTexture2D(n.FRAMEBUFFER,n.DEPTH_STENCIL_ATTACHMENT,n.TEXTURE_2D,We,0)}}(z.__webglFramebuffer,J)}else if(be){z.__webglDepthbuffer=[];for(let We=0;We<6;We++)t.bindFramebuffer(n.FRAMEBUFFER,z.__webglFramebuffer[We]),z.__webglDepthbuffer[We]=n.createRenderbuffer(),te(z.__webglDepthbuffer[We],J,!1)}else t.bindFramebuffer(n.FRAMEBUFFER,z.__webglFramebuffer),z.__webglDepthbuffer=n.createRenderbuffer(),te(z.__webglDepthbuffer,J,!1);t.bindFramebuffer(n.FRAMEBUFFER,null)}function vt(J){return Math.min(f,J.samples)}function Qt(J){const z=i.get(J);return a&&J.samples>0&&!0===e.has("WEBGL_multisampled_render_to_texture")&&!1!==z.__useRenderToTexture}function ri(J,z){const be=J.colorSpace,We=J.format,qe=J.type;return!0===J.isCompressedTexture||1035===J.format||be!==zs&&""!==be&&(be===jt?!1===a?!0===e.has("EXT_sRGB")&&We===jr?(J.format=1035,J.minFilter=ei,J.generateMipmaps=!1):z=SC.sRGBToLinear(z):(We!==jr||qe!==Jo)&&console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):console.error("THREE.WebGLTextures: Unsupported texture color space:",be)),z}this.allocateTextureUnit=function De(){const J=Le;return J>=l&&console.warn("THREE.WebGLTextures: Trying to use "+J+" texture units while this GPU supports only "+l),Le+=1,J},this.resetTextureUnits=function Se(){Le=0},this.setTexture2D=Ve,this.setTexture2DArray=function he(J,z){const be=i.get(J);J.version>0&&be.__version!==J.version?Tn(be,J,z):t.bindTexture(n.TEXTURE_2D_ARRAY,be.__webglTexture,n.TEXTURE0+z)},this.setTexture3D=function Ce(J,z){const be=i.get(J);J.version>0&&be.__version!==J.version?Tn(be,J,z):t.bindTexture(n.TEXTURE_3D,be.__webglTexture,n.TEXTURE0+z)},this.setTextureCube=function Ye(J,z){const be=i.get(J);J.version>0&&be.__version!==J.version?function Dn(J,z,be){if(6!==z.image.length)return;const We=wt(J,z),qe=z.source;t.bindTexture(n.TEXTURE_CUBE_MAP,J.__webglTexture,n.TEXTURE0+be);const st=i.get(qe);if(qe.version!==st.__version||!0===We){t.activeTexture(n.TEXTURE0+be),n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,z.flipY),n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,z.premultiplyAlpha),n.pixelStorei(n.UNPACK_ALIGNMENT,z.unpackAlignment),n.pixelStorei(n.UNPACK_COLORSPACE_CONVERSION_WEBGL,n.NONE);const Et=z.isCompressedTexture||z.image[0].isCompressedTexture,ot=z.image[0]&&z.image[0].isDataTexture,Ee=[];for(let ye=0;ye<6;ye++)Ee[ye]=Et||ot?ot?z.image[ye].image:z.image[ye]:T(z.image[ye],!1,!0,u),Ee[ye]=ri(z,Ee[ye]);const Bt=Ee[0],Ft=I(Bt)||a,kt=s.convert(z.format,z.colorSpace),yt=s.convert(z.type),xt=K(z.internalFormat,kt,yt,z.colorSpace),pn=a&&!0!==z.isVideoTexture,kn=void 0===st.__version||!0===We;let at,ie=L(z,Bt,Ft);if(Ct(n.TEXTURE_CUBE_MAP,z,Ft),Et){pn&&kn&&t.texStorage2D(n.TEXTURE_CUBE_MAP,ie,xt,Bt.width,Bt.height);for(let ye=0;ye<6;ye++){at=Ee[ye].mipmaps;for(let Je=0;Je<at.length;Je++){const ct=at[Je];z.format!==jr?null!==kt?pn?t.compressedTexSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+ye,Je,0,0,ct.width,ct.height,kt,ct.data):t.compressedTexImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+ye,Je,xt,ct.width,ct.height,0,ct.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):pn?t.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+ye,Je,0,0,ct.width,ct.height,kt,yt,ct.data):t.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+ye,Je,xt,ct.width,ct.height,0,kt,yt,ct.data)}}}else{at=z.mipmaps,pn&&kn&&(at.length>0&&ie++,t.texStorage2D(n.TEXTURE_CUBE_MAP,ie,xt,Ee[0].width,Ee[0].height));for(let ye=0;ye<6;ye++)if(ot){pn?t.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+ye,0,0,0,Ee[ye].width,Ee[ye].height,kt,yt,Ee[ye].data):t.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+ye,0,xt,Ee[ye].width,Ee[ye].height,0,kt,yt,Ee[ye].data);for(let Je=0;Je<at.length;Je++){const In=at[Je].image[ye].image;pn?t.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+ye,Je+1,0,0,In.width,In.height,kt,yt,In.data):t.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+ye,Je+1,xt,In.width,In.height,0,kt,yt,In.data)}}else{pn?t.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+ye,0,0,0,kt,yt,Ee[ye]):t.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+ye,0,xt,kt,yt,Ee[ye]);for(let Je=0;Je<at.length;Je++){const ct=at[Je];pn?t.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+ye,Je+1,0,0,kt,yt,ct.image[ye]):t.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+ye,Je+1,xt,kt,yt,ct.image[ye])}}}k(z,Ft)&&G(n.TEXTURE_CUBE_MAP),st.__version=qe.version,z.onUpdate&&z.onUpdate(z)}J.__version=z.version}(be,J,z):t.bindTexture(n.TEXTURE_CUBE_MAP,be.__webglTexture,n.TEXTURE0+z)},this.rebindTextures=function je(J,z,be){const We=i.get(J);void 0!==z&&Nt(We.__webglFramebuffer,J,J.texture,n.COLOR_ATTACHMENT0,n.TEXTURE_2D),void 0!==be&&Re(J)},this.setupRenderTarget=function ke(J){const z=J.texture,be=i.get(J),We=i.get(z);J.addEventListener("dispose",Te),!0!==J.isWebGLMultipleRenderTargets&&(void 0===We.__webglTexture&&(We.__webglTexture=n.createTexture()),We.__version=z.version,o.memory.textures++);const qe=!0===J.isWebGLCubeRenderTarget,st=!0===J.isWebGLMultipleRenderTargets,Et=I(J)||a;if(qe){be.__webglFramebuffer=[];for(let ot=0;ot<6;ot++)be.__webglFramebuffer[ot]=n.createFramebuffer()}else{if(be.__webglFramebuffer=n.createFramebuffer(),st)if(r.drawBuffers){const ot=J.texture;for(let Ee=0,Bt=ot.length;Ee<Bt;Ee++){const Ft=i.get(ot[Ee]);void 0===Ft.__webglTexture&&(Ft.__webglTexture=n.createTexture(),o.memory.textures++)}}else console.warn("THREE.WebGLRenderer: WebGLMultipleRenderTargets can only be used with WebGL2 or WEBGL_draw_buffers extension.");if(a&&J.samples>0&&!1===Qt(J)){const ot=st?z:[z];be.__webglMultisampledFramebuffer=n.createFramebuffer(),be.__webglColorRenderbuffer=[],t.bindFramebuffer(n.FRAMEBUFFER,be.__webglMultisampledFramebuffer);for(let Ee=0;Ee<ot.length;Ee++){const Bt=ot[Ee];be.__webglColorRenderbuffer[Ee]=n.createRenderbuffer(),n.bindRenderbuffer(n.RENDERBUFFER,be.__webglColorRenderbuffer[Ee]);const Ft=s.convert(Bt.format,Bt.colorSpace),kt=s.convert(Bt.type),yt=K(Bt.internalFormat,Ft,kt,Bt.colorSpace,!0===J.isXRRenderTarget),xt=vt(J);n.renderbufferStorageMultisample(n.RENDERBUFFER,xt,yt,J.width,J.height),n.framebufferRenderbuffer(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0+Ee,n.RENDERBUFFER,be.__webglColorRenderbuffer[Ee])}n.bindRenderbuffer(n.RENDERBUFFER,null),J.depthBuffer&&(be.__webglDepthRenderbuffer=n.createRenderbuffer(),te(be.__webglDepthRenderbuffer,J,!0)),t.bindFramebuffer(n.FRAMEBUFFER,null)}}if(qe){t.bindTexture(n.TEXTURE_CUBE_MAP,We.__webglTexture),Ct(n.TEXTURE_CUBE_MAP,z,Et);for(let ot=0;ot<6;ot++)Nt(be.__webglFramebuffer[ot],J,z,n.COLOR_ATTACHMENT0,n.TEXTURE_CUBE_MAP_POSITIVE_X+ot);k(z,Et)&&G(n.TEXTURE_CUBE_MAP),t.unbindTexture()}else if(st){const ot=J.texture;for(let Ee=0,Bt=ot.length;Ee<Bt;Ee++){const Ft=ot[Ee],kt=i.get(Ft);t.bindTexture(n.TEXTURE_2D,kt.__webglTexture),Ct(n.TEXTURE_2D,Ft,Et),Nt(be.__webglFramebuffer,J,Ft,n.COLOR_ATTACHMENT0+Ee,n.TEXTURE_2D),k(Ft,Et)&&G(n.TEXTURE_2D)}t.unbindTexture()}else{let ot=n.TEXTURE_2D;(J.isWebGL3DRenderTarget||J.isWebGLArrayRenderTarget)&&(a?ot=J.isWebGL3DRenderTarget?n.TEXTURE_3D:n.TEXTURE_2D_ARRAY:console.error("THREE.WebGLTextures: THREE.Data3DTexture and THREE.DataArrayTexture only supported with WebGL2.")),t.bindTexture(ot,We.__webglTexture),Ct(ot,z,Et),Nt(be.__webglFramebuffer,J,z,n.COLOR_ATTACHMENT0,ot),k(z,Et)&&G(ot),t.unbindTexture()}J.depthBuffer&&Re(J)},this.updateRenderTargetMipmap=function It(J){const z=I(J)||a,be=!0===J.isWebGLMultipleRenderTargets?J.texture:[J.texture];for(let We=0,qe=be.length;We<qe;We++){const st=be[We];if(k(st,z)){const Et=J.isWebGLCubeRenderTarget?n.TEXTURE_CUBE_MAP:n.TEXTURE_2D,ot=i.get(st).__webglTexture;t.bindTexture(Et,ot),G(Et),t.unbindTexture()}}},this.updateMultisampleRenderTarget=function ft(J){if(a&&J.samples>0&&!1===Qt(J)){const z=J.isWebGLMultipleRenderTargets?J.texture:[J.texture],be=J.width,We=J.height;let qe=n.COLOR_BUFFER_BIT;const st=[],Et=J.stencilBuffer?n.DEPTH_STENCIL_ATTACHMENT:n.DEPTH_ATTACHMENT,ot=i.get(J),Ee=!0===J.isWebGLMultipleRenderTargets;if(Ee)for(let Bt=0;Bt<z.length;Bt++)t.bindFramebuffer(n.FRAMEBUFFER,ot.__webglMultisampledFramebuffer),n.framebufferRenderbuffer(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0+Bt,n.RENDERBUFFER,null),t.bindFramebuffer(n.FRAMEBUFFER,ot.__webglFramebuffer),n.framebufferTexture2D(n.DRAW_FRAMEBUFFER,n.COLOR_ATTACHMENT0+Bt,n.TEXTURE_2D,null,0);t.bindFramebuffer(n.READ_FRAMEBUFFER,ot.__webglMultisampledFramebuffer),t.bindFramebuffer(n.DRAW_FRAMEBUFFER,ot.__webglFramebuffer);for(let Bt=0;Bt<z.length;Bt++){st.push(n.COLOR_ATTACHMENT0+Bt),J.depthBuffer&&st.push(Et);const Ft=void 0!==ot.__ignoreDepthValues&&ot.__ignoreDepthValues;if(!1===Ft&&(J.depthBuffer&&(qe|=n.DEPTH_BUFFER_BIT),J.stencilBuffer&&(qe|=n.STENCIL_BUFFER_BIT)),Ee&&n.framebufferRenderbuffer(n.READ_FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.RENDERBUFFER,ot.__webglColorRenderbuffer[Bt]),!0===Ft&&(n.invalidateFramebuffer(n.READ_FRAMEBUFFER,[Et]),n.invalidateFramebuffer(n.DRAW_FRAMEBUFFER,[Et])),Ee){const kt=i.get(z[Bt]).__webglTexture;n.framebufferTexture2D(n.DRAW_FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,kt,0)}n.blitFramebuffer(0,0,be,We,0,0,be,We,qe,n.NEAREST),_&&n.invalidateFramebuffer(n.READ_FRAMEBUFFER,st)}if(t.bindFramebuffer(n.READ_FRAMEBUFFER,null),t.bindFramebuffer(n.DRAW_FRAMEBUFFER,null),Ee)for(let Bt=0;Bt<z.length;Bt++){t.bindFramebuffer(n.FRAMEBUFFER,ot.__webglMultisampledFramebuffer),n.framebufferRenderbuffer(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0+Bt,n.RENDERBUFFER,ot.__webglColorRenderbuffer[Bt]);const Ft=i.get(z[Bt]).__webglTexture;t.bindFramebuffer(n.FRAMEBUFFER,ot.__webglFramebuffer),n.framebufferTexture2D(n.DRAW_FRAMEBUFFER,n.COLOR_ATTACHMENT0+Bt,n.TEXTURE_2D,Ft,0)}t.bindFramebuffer(n.DRAW_FRAMEBUFFER,ot.__webglMultisampledFramebuffer)}},this.setupDepthRenderbuffer=Re,this.setupFrameBufferTexture=Nt,this.useMultisampledRTT=Qt}function A5(n,e,t){const i=t.isWebGL2;return{convert:function r(s,o=""){let a;if(s===Jo)return n.UNSIGNED_BYTE;if(1017===s)return n.UNSIGNED_SHORT_4_4_4_4;if(1018===s)return n.UNSIGNED_SHORT_5_5_5_1;if(1010===s)return n.BYTE;if(1011===s)return n.SHORT;if(1012===s)return n.UNSIGNED_SHORT;if(1013===s)return n.INT;if(s===Ko)return n.UNSIGNED_INT;if(s===go)return n.FLOAT;if(s===Dh)return i?n.HALF_FLOAT:(a=e.get("OES_texture_half_float"),null!==a?a.HALF_FLOAT_OES:null);if(1021===s)return n.ALPHA;if(s===jr)return n.RGBA;if(1024===s)return n.LUMINANCE;if(1025===s)return n.LUMINANCE_ALPHA;if(s===ka)return n.DEPTH_COMPONENT;if(s===xc)return n.DEPTH_STENCIL;if(1035===s)return a=e.get("EXT_sRGB"),null!==a?a.SRGB_ALPHA_EXT:null;if(1028===s)return n.RED;if(1029===s)return n.RED_INTEGER;if(1030===s)return n.RG;if(1031===s)return n.RG_INTEGER;if(1033===s)return n.RGBA_INTEGER;if(33776===s||33777===s||33778===s||33779===s)if(o===jt){if(a=e.get("WEBGL_compressed_texture_s3tc_srgb"),null===a)return null;if(33776===s)return a.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(33777===s)return a.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(33778===s)return a.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(33779===s)return a.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else{if(a=e.get("WEBGL_compressed_texture_s3tc"),null===a)return null;if(33776===s)return a.COMPRESSED_RGB_S3TC_DXT1_EXT;if(33777===s)return a.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(33778===s)return a.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(33779===s)return a.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(35840===s||35841===s||35842===s||35843===s){if(a=e.get("WEBGL_compressed_texture_pvrtc"),null===a)return null;if(35840===s)return a.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(35841===s)return a.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(35842===s)return a.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(35843===s)return a.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(36196===s)return a=e.get("WEBGL_compressed_texture_etc1"),null!==a?a.COMPRESSED_RGB_ETC1_WEBGL:null;if(37492===s||37496===s){if(a=e.get("WEBGL_compressed_texture_etc"),null===a)return null;if(37492===s)return o===jt?a.COMPRESSED_SRGB8_ETC2:a.COMPRESSED_RGB8_ETC2;if(37496===s)return o===jt?a.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:a.COMPRESSED_RGBA8_ETC2_EAC}if(37808===s||37809===s||37810===s||37811===s||37812===s||37813===s||37814===s||37815===s||37816===s||37817===s||37818===s||37819===s||37820===s||37821===s){if(a=e.get("WEBGL_compressed_texture_astc"),null===a)return null;if(37808===s)return o===jt?a.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:a.COMPRESSED_RGBA_ASTC_4x4_KHR;if(37809===s)return o===jt?a.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:a.COMPRESSED_RGBA_ASTC_5x4_KHR;if(37810===s)return o===jt?a.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:a.COMPRESSED_RGBA_ASTC_5x5_KHR;if(37811===s)return o===jt?a.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:a.COMPRESSED_RGBA_ASTC_6x5_KHR;if(37812===s)return o===jt?a.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:a.COMPRESSED_RGBA_ASTC_6x6_KHR;if(37813===s)return o===jt?a.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:a.COMPRESSED_RGBA_ASTC_8x5_KHR;if(37814===s)return o===jt?a.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:a.COMPRESSED_RGBA_ASTC_8x6_KHR;if(37815===s)return o===jt?a.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:a.COMPRESSED_RGBA_ASTC_8x8_KHR;if(37816===s)return o===jt?a.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:a.COMPRESSED_RGBA_ASTC_10x5_KHR;if(37817===s)return o===jt?a.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:a.COMPRESSED_RGBA_ASTC_10x6_KHR;if(37818===s)return o===jt?a.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:a.COMPRESSED_RGBA_ASTC_10x8_KHR;if(37819===s)return o===jt?a.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:a.COMPRESSED_RGBA_ASTC_10x10_KHR;if(37820===s)return o===jt?a.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:a.COMPRESSED_RGBA_ASTC_12x10_KHR;if(37821===s)return o===jt?a.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:a.COMPRESSED_RGBA_ASTC_12x12_KHR}if(36492===s){if(a=e.get("EXT_texture_compression_bptc"),null===a)return null;if(36492===s)return o===jt?a.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:a.COMPRESSED_RGBA_BPTC_UNORM_EXT}if(36283===s||36284===s||36285===s||36286===s){if(a=e.get("EXT_texture_compression_rgtc"),null===a)return null;if(36492===s)return a.COMPRESSED_RED_RGTC1_EXT;if(36284===s)return a.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(36285===s)return a.COMPRESSED_RED_GREEN_RGTC2_EXT;if(36286===s)return a.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}return s===Va?i?n.UNSIGNED_INT_24_8:(a=e.get("WEBGL_depth_texture"),null!==a?a.UNSIGNED_INT_24_8_WEBGL:null):void 0!==n[s]?n[s]:null}}}class w5 extends Fi{constructor(e=[]){super(),this.isArrayCamera=!0,this.cameras=e}}class ia extends vi{constructor(){super(),this.isGroup=!0,this.type="Group"}}const M5={type:"move"};class qy{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return null===this._hand&&(this._hand=new ia,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return null===this._targetRay&&(this._targetRay=new ia,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new q,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new q),this._targetRay}getGripSpace(){return null===this._grip&&(this._grip=new ia,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new q,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new q),this._grip}dispatchEvent(e){return null!==this._targetRay&&this._targetRay.dispatchEvent(e),null!==this._grip&&this._grip.dispatchEvent(e),null!==this._hand&&this._hand.dispatchEvent(e),this}connect(e){if(e&&e.hand){const t=this._hand;if(t)for(const i of e.hand.values())this._getHandJoint(t,i)}return this.dispatchEvent({type:"connected",data:e}),this}disconnect(e){return this.dispatchEvent({type:"disconnected",data:e}),null!==this._targetRay&&(this._targetRay.visible=!1),null!==this._grip&&(this._grip.visible=!1),null!==this._hand&&(this._hand.visible=!1),this}update(e,t,i){let r=null,s=null,o=null;const a=this._targetRay,l=this._grip,u=this._hand;if(e&&"visible-blurred"!==t.session.visibilityState){if(u&&e.hand){o=!0;for(const w of e.hand.values()){const A=t.getJointPose(w,i),b=this._getHandJoint(u,w);null!==A&&(b.matrix.fromArray(A.transform.matrix),b.matrix.decompose(b.position,b.rotation,b.scale),b.matrixWorldNeedsUpdate=!0,b.jointRadius=A.radius),b.visible=null!==A}const p=u.joints["index-finger-tip"].position.distanceTo(u.joints["thumb-tip"].position),_=.02,y=.005;u.inputState.pinching&&p>_+y?(u.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:e.handedness,target:this})):!u.inputState.pinching&&p<=_-y&&(u.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:e.handedness,target:this}))}else null!==l&&e.gripSpace&&(s=t.getPose(e.gripSpace,i),null!==s&&(l.matrix.fromArray(s.transform.matrix),l.matrix.decompose(l.position,l.rotation,l.scale),l.matrixWorldNeedsUpdate=!0,s.linearVelocity?(l.hasLinearVelocity=!0,l.linearVelocity.copy(s.linearVelocity)):l.hasLinearVelocity=!1,s.angularVelocity?(l.hasAngularVelocity=!0,l.angularVelocity.copy(s.angularVelocity)):l.hasAngularVelocity=!1));null!==a&&(r=t.getPose(e.targetRaySpace,i),null===r&&null!==s&&(r=s),null!==r&&(a.matrix.fromArray(r.transform.matrix),a.matrix.decompose(a.position,a.rotation,a.scale),a.matrixWorldNeedsUpdate=!0,r.linearVelocity?(a.hasLinearVelocity=!0,a.linearVelocity.copy(r.linearVelocity)):a.hasLinearVelocity=!1,r.angularVelocity?(a.hasAngularVelocity=!0,a.angularVelocity.copy(r.angularVelocity)):a.hasAngularVelocity=!1,this.dispatchEvent(M5)))}return null!==a&&(a.visible=null!==r),null!==l&&(l.visible=null!==s),null!==u&&(u.visible=null!==o),this}_getHandJoint(e,t){if(void 0===e.joints[t.jointName]){const i=new ia;i.matrixAutoUpdate=!1,i.visible=!1,e.joints[t.jointName]=i,e.add(i)}return e.joints[t.jointName]}}class S5 extends _s{constructor(e,t,i,r,s,o,a,l,u,d){if((d=void 0!==d?d:ka)!==ka&&d!==xc)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");void 0===i&&d===ka&&(i=Ko),void 0===i&&d===xc&&(i=Va),super(null,r,s,o,a,l,d,i,u),this.isDepthTexture=!0,this.image={width:e,height:t},this.magFilter=void 0!==a?a:ui,this.minFilter=void 0!==l?l:ui,this.flipY=!1,this.generateMipmaps=!1,this.compareFunction=null}copy(e){return super.copy(e),this.compareFunction=e.compareFunction,this}toJSON(e){const t=super.toJSON(e);return null!==this.compareFunction&&(t.compareFunction=this.compareFunction),t}}class E5 extends Mc{constructor(e,t){super();const i=this;let r=null,s=1,o=null,a="local-floor",l=1,u=null,d=null,f=null,p=null,_=null,y=null;const w=t.getContextAttributes();let A=null,b=null;const C=[],T=[],I=new Fi;I.layers.enable(1),I.viewport=new Nn;const N=new Fi;N.layers.enable(2),N.viewport=new Nn;const k=[I,N],G=new w5;G.layers.enable(1),G.layers.enable(2);let K=null,L=null;function H(he){const Ce=T.indexOf(he.inputSource);if(-1===Ce)return;const Ye=C[Ce];void 0!==Ye&&(Ye.update(he.inputSource,he.frame,u||o),Ye.dispatchEvent({type:he.type,data:he.inputSource}))}function me(){r.removeEventListener("select",H),r.removeEventListener("selectstart",H),r.removeEventListener("selectend",H),r.removeEventListener("squeeze",H),r.removeEventListener("squeezestart",H),r.removeEventListener("squeezeend",H),r.removeEventListener("end",me),r.removeEventListener("inputsourceschange",Te);for(let he=0;he<C.length;he++){const Ce=T[he];null!==Ce&&(T[he]=null,C[he].disconnect(Ce))}K=null,L=null,e.setRenderTarget(A),_=null,p=null,f=null,r=null,b=null,Ve.stop(),i.isPresenting=!1,i.dispatchEvent({type:"sessionend"})}function Te(he){for(let Ce=0;Ce<he.removed.length;Ce++){const Ye=he.removed[Ce],tt=T.indexOf(Ye);tt>=0&&(T[tt]=null,C[tt].disconnect(Ye))}for(let Ce=0;Ce<he.added.length;Ce++){const Ye=he.added[Ce];let tt=T.indexOf(Ye);if(-1===tt){for(let gt=0;gt<C.length;gt++){if(gt>=T.length){T.push(Ye),tt=gt;break}if(null===T[gt]){T[gt]=Ye,tt=gt;break}}if(-1===tt)break}const it=C[tt];it&&it.connect(Ye)}}this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(he){let Ce=C[he];return void 0===Ce&&(Ce=new qy,C[he]=Ce),Ce.getTargetRaySpace()},this.getControllerGrip=function(he){let Ce=C[he];return void 0===Ce&&(Ce=new qy,C[he]=Ce),Ce.getGripSpace()},this.getHand=function(he){let Ce=C[he];return void 0===Ce&&(Ce=new qy,C[he]=Ce),Ce.getHandSpace()},this.setFramebufferScaleFactor=function(he){s=he,!0===i.isPresenting&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(he){a=he,!0===i.isPresenting&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return u||o},this.setReferenceSpace=function(he){u=he},this.getBaseLayer=function(){return null!==p?p:_},this.getBinding=function(){return f},this.getFrame=function(){return y},this.getSession=function(){return r},this.setSession=function(){var he=IT(function*(Ce){if(r=Ce,null!==r){if(A=e.getRenderTarget(),r.addEventListener("select",H),r.addEventListener("selectstart",H),r.addEventListener("selectend",H),r.addEventListener("squeeze",H),r.addEventListener("squeezestart",H),r.addEventListener("squeezeend",H),r.addEventListener("end",me),r.addEventListener("inputsourceschange",Te),!0!==w.xrCompatible&&(yield t.makeXRCompatible()),void 0===r.renderState.layers||!1===e.capabilities.isWebGL2)_=new XRWebGLLayer(r,t,{antialias:void 0!==r.renderState.layers||w.antialias,alpha:!0,depth:w.depth,stencil:w.stencil,framebufferScaleFactor:s}),r.updateRenderState({baseLayer:_}),b=new Wa(_.framebufferWidth,_.framebufferHeight,{format:jr,type:Jo,colorSpace:e.outputColorSpace,stencilBuffer:w.stencil});else{let Ye=null,tt=null,it=null;w.depth&&(it=w.stencil?t.DEPTH24_STENCIL8:t.DEPTH_COMPONENT24,Ye=w.stencil?xc:ka,tt=w.stencil?Va:Ko);const gt={colorFormat:t.RGBA8,depthFormat:it,scaleFactor:s};f=new XRWebGLBinding(r,t),p=f.createProjectionLayer(gt),r.updateRenderState({layers:[p]}),b=new Wa(p.textureWidth,p.textureHeight,{format:jr,type:Jo,depthTexture:new S5(p.textureWidth,p.textureHeight,tt,void 0,void 0,void 0,void 0,void 0,void 0,Ye),stencilBuffer:w.stencil,colorSpace:e.outputColorSpace,samples:w.antialias?4:0}),e.properties.get(b).__ignoreDepthValues=p.ignoreDepthValues}b.isXRRenderTarget=!0,this.setFoveation(l),u=null,o=yield r.requestReferenceSpace(a),Ve.setContext(r),Ve.start(),i.isPresenting=!0,i.dispatchEvent({type:"sessionstart"})}});return function(Ce){return he.apply(this,arguments)}}(),this.getEnvironmentBlendMode=function(){if(null!==r)return r.environmentBlendMode};const le=new q,ue=new q;function Le(he,Ce){null===Ce?he.matrixWorld.copy(he.matrix):he.matrixWorld.multiplyMatrices(Ce.matrixWorld,he.matrix),he.matrixWorldInverse.copy(he.matrixWorld).invert()}this.updateCamera=function(he){if(null===r)return;G.near=N.near=I.near=he.near,G.far=N.far=I.far=he.far,(K!==G.near||L!==G.far)&&(r.updateRenderState({depthNear:G.near,depthFar:G.far}),K=G.near,L=G.far);const Ce=he.parent,Ye=G.cameras;Le(G,Ce);for(let tt=0;tt<Ye.length;tt++)Le(Ye[tt],Ce);2===Ye.length?function _e(he,Ce,Ye){le.setFromMatrixPosition(Ce.matrixWorld),ue.setFromMatrixPosition(Ye.matrixWorld);const tt=le.distanceTo(ue),it=Ce.projectionMatrix.elements,gt=Ye.projectionMatrix.elements,Ct=it[14]/(it[10]-1),wt=it[14]/(it[10]+1),Tn=(it[9]+1)/it[5],Dn=(it[9]-1)/it[5],Nt=(it[8]-1)/it[0],te=(gt[8]+1)/gt[0],Ze=Ct*Nt,Re=Ct*te,je=tt/(-Nt+te),ke=je*-Nt;Ce.matrixWorld.decompose(he.position,he.quaternion,he.scale),he.translateX(ke),he.translateZ(je),he.matrixWorld.compose(he.position,he.quaternion,he.scale),he.matrixWorldInverse.copy(he.matrixWorld).invert();const It=Ct+je,ft=wt+je;he.projectionMatrix.makePerspective(Ze-ke,Re+(tt-ke),Tn*wt/ft*It,Dn*wt/ft*It,It,ft),he.projectionMatrixInverse.copy(he.projectionMatrix).invert()}(G,I,N):G.projectionMatrix.copy(I.projectionMatrix),function Se(he,Ce,Ye){null===Ye?he.matrix.copy(Ce.matrixWorld):(he.matrix.copy(Ye.matrixWorld),he.matrix.invert(),he.matrix.multiply(Ce.matrixWorld)),he.matrix.decompose(he.position,he.quaternion,he.scale),he.updateMatrixWorld(!0);const tt=he.children;for(let it=0,gt=tt.length;it<gt;it++)tt[it].updateMatrixWorld(!0);he.projectionMatrix.copy(Ce.projectionMatrix),he.projectionMatrixInverse.copy(Ce.projectionMatrixInverse),he.isPerspectiveCamera&&(he.fov=2*Sc*Math.atan(1/he.projectionMatrix.elements[5]),he.zoom=1)}(he,G,Ce)},this.getCamera=function(){return G},this.getFoveation=function(){if(null!==p||null!==_)return l},this.setFoveation=function(he){l=he,null!==p&&(p.fixedFoveation=he),null!==_&&void 0!==_.fixedFoveation&&(_.fixedFoveation=he)};let De=null;const Ve=new qC;Ve.setAnimationLoop(function Fe(he,Ce){if(d=Ce.getViewerPose(u||o),y=Ce,null!==d){const Ye=d.views;null!==_&&(e.setRenderTargetFramebuffer(b,_.framebuffer),e.setRenderTarget(b));let tt=!1;Ye.length!==G.cameras.length&&(G.cameras.length=0,tt=!0);for(let it=0;it<Ye.length;it++){const gt=Ye[it];let Ct=null;if(null!==_)Ct=_.getViewport(gt);else{const Tn=f.getViewSubImage(p,gt);Ct=Tn.viewport,0===it&&(e.setRenderTargetTextures(b,Tn.colorTexture,p.ignoreDepthValues?void 0:Tn.depthStencilTexture),e.setRenderTarget(b))}let wt=k[it];void 0===wt&&(wt=new Fi,wt.layers.enable(it),wt.viewport=new Nn,k[it]=wt),wt.matrix.fromArray(gt.transform.matrix),wt.matrix.decompose(wt.position,wt.quaternion,wt.scale),wt.projectionMatrix.fromArray(gt.projectionMatrix),wt.projectionMatrixInverse.copy(wt.projectionMatrix).invert(),wt.viewport.set(Ct.x,Ct.y,Ct.width,Ct.height),0===it&&(G.matrix.copy(wt.matrix),G.matrix.decompose(G.position,G.quaternion,G.scale)),!0===tt&&G.cameras.push(wt)}}for(let Ye=0;Ye<C.length;Ye++){const tt=T[Ye],it=C[Ye];null!==tt&&void 0!==it&&it.update(tt,Ce,u||o)}De&&De(he,Ce),Ce.detectedPlanes&&i.dispatchEvent({type:"planesdetected",data:Ce}),y=null}),this.setAnimationLoop=function(he){De=he},this.dispose=function(){}}}function T5(n,e){function t(A,b){!0===A.matrixAutoUpdate&&A.updateMatrix(),b.value.copy(A.matrix)}function s(A,b){A.opacity.value=b.opacity,b.color&&A.diffuse.value.copy(b.color),b.emissive&&A.emissive.value.copy(b.emissive).multiplyScalar(b.emissiveIntensity),b.map&&(A.map.value=b.map,t(b.map,A.mapTransform)),b.alphaMap&&(A.alphaMap.value=b.alphaMap,t(b.alphaMap,A.alphaMapTransform)),b.bumpMap&&(A.bumpMap.value=b.bumpMap,t(b.bumpMap,A.bumpMapTransform),A.bumpScale.value=b.bumpScale,1===b.side&&(A.bumpScale.value*=-1)),b.normalMap&&(A.normalMap.value=b.normalMap,t(b.normalMap,A.normalMapTransform),A.normalScale.value.copy(b.normalScale),1===b.side&&A.normalScale.value.negate()),b.displacementMap&&(A.displacementMap.value=b.displacementMap,t(b.displacementMap,A.displacementMapTransform),A.displacementScale.value=b.displacementScale,A.displacementBias.value=b.displacementBias),b.emissiveMap&&(A.emissiveMap.value=b.emissiveMap,t(b.emissiveMap,A.emissiveMapTransform)),b.specularMap&&(A.specularMap.value=b.specularMap,t(b.specularMap,A.specularMapTransform)),b.alphaTest>0&&(A.alphaTest.value=b.alphaTest);const C=e.get(b).envMap;if(C&&(A.envMap.value=C,A.flipEnvMap.value=C.isCubeTexture&&!1===C.isRenderTargetTexture?-1:1,A.reflectivity.value=b.reflectivity,A.ior.value=b.ior,A.refractionRatio.value=b.refractionRatio),b.lightMap){A.lightMap.value=b.lightMap;const T=!0===n.useLegacyLights?Math.PI:1;A.lightMapIntensity.value=b.lightMapIntensity*T,t(b.lightMap,A.lightMapTransform)}b.aoMap&&(A.aoMap.value=b.aoMap,A.aoMapIntensity.value=b.aoMapIntensity,t(b.aoMap,A.aoMapTransform))}return{refreshFogUniforms:function i(A,b){b.color.getRGB(A.fogColor.value,WC(n)),b.isFog?(A.fogNear.value=b.near,A.fogFar.value=b.far):b.isFogExp2&&(A.fogDensity.value=b.density)},refreshMaterialUniforms:function r(A,b,C,T,I){b.isMeshBasicMaterial||b.isMeshLambertMaterial?s(A,b):b.isMeshToonMaterial?(s(A,b),function f(A,b){b.gradientMap&&(A.gradientMap.value=b.gradientMap)}(A,b)):b.isMeshPhongMaterial?(s(A,b),function d(A,b){A.specular.value.copy(b.specular),A.shininess.value=Math.max(b.shininess,1e-4)}(A,b)):b.isMeshStandardMaterial?(s(A,b),function p(A,b){A.metalness.value=b.metalness,b.metalnessMap&&(A.metalnessMap.value=b.metalnessMap,t(b.metalnessMap,A.metalnessMapTransform)),A.roughness.value=b.roughness,b.roughnessMap&&(A.roughnessMap.value=b.roughnessMap,t(b.roughnessMap,A.roughnessMapTransform)),e.get(b).envMap&&(A.envMapIntensity.value=b.envMapIntensity)}(A,b),b.isMeshPhysicalMaterial&&function _(A,b,C){A.ior.value=b.ior,b.sheen>0&&(A.sheenColor.value.copy(b.sheenColor).multiplyScalar(b.sheen),A.sheenRoughness.value=b.sheenRoughness,b.sheenColorMap&&(A.sheenColorMap.value=b.sheenColorMap,t(b.sheenColorMap,A.sheenColorMapTransform)),b.sheenRoughnessMap&&(A.sheenRoughnessMap.value=b.sheenRoughnessMap,t(b.sheenRoughnessMap,A.sheenRoughnessMapTransform))),b.clearcoat>0&&(A.clearcoat.value=b.clearcoat,A.clearcoatRoughness.value=b.clearcoatRoughness,b.clearcoatMap&&(A.clearcoatMap.value=b.clearcoatMap,t(b.clearcoatMap,A.clearcoatMapTransform)),b.clearcoatRoughnessMap&&(A.clearcoatRoughnessMap.value=b.clearcoatRoughnessMap,t(b.clearcoatRoughnessMap,A.clearcoatRoughnessMapTransform)),b.clearcoatNormalMap&&(A.clearcoatNormalMap.value=b.clearcoatNormalMap,t(b.clearcoatNormalMap,A.clearcoatNormalMapTransform),A.clearcoatNormalScale.value.copy(b.clearcoatNormalScale),1===b.side&&A.clearcoatNormalScale.value.negate())),b.iridescence>0&&(A.iridescence.value=b.iridescence,A.iridescenceIOR.value=b.iridescenceIOR,A.iridescenceThicknessMinimum.value=b.iridescenceThicknessRange[0],A.iridescenceThicknessMaximum.value=b.iridescenceThicknessRange[1],b.iridescenceMap&&(A.iridescenceMap.value=b.iridescenceMap,t(b.iridescenceMap,A.iridescenceMapTransform)),b.iridescenceThicknessMap&&(A.iridescenceThicknessMap.value=b.iridescenceThicknessMap,t(b.iridescenceThicknessMap,A.iridescenceThicknessMapTransform))),b.transmission>0&&(A.transmission.value=b.transmission,A.transmissionSamplerMap.value=C.texture,A.transmissionSamplerSize.value.set(C.width,C.height),b.transmissionMap&&(A.transmissionMap.value=b.transmissionMap,t(b.transmissionMap,A.transmissionMapTransform)),A.thickness.value=b.thickness,b.thicknessMap&&(A.thicknessMap.value=b.thicknessMap,t(b.thicknessMap,A.thicknessMapTransform)),A.attenuationDistance.value=b.attenuationDistance,A.attenuationColor.value.copy(b.attenuationColor)),b.anisotropy>0&&(A.anisotropyVector.value.set(b.anisotropy*Math.cos(b.anisotropyRotation),b.anisotropy*Math.sin(b.anisotropyRotation)),b.anisotropyMap&&(A.anisotropyMap.value=b.anisotropyMap,t(b.anisotropyMap,A.anisotropyMapTransform))),A.specularIntensity.value=b.specularIntensity,A.specularColor.value.copy(b.specularColor),b.specularColorMap&&(A.specularColorMap.value=b.specularColorMap,t(b.specularColorMap,A.specularColorMapTransform)),b.specularIntensityMap&&(A.specularIntensityMap.value=b.specularIntensityMap,t(b.specularIntensityMap,A.specularIntensityMapTransform))}(A,b,I)):b.isMeshMatcapMaterial?(s(A,b),function y(A,b){b.matcap&&(A.matcap.value=b.matcap)}(A,b)):b.isMeshDepthMaterial?s(A,b):b.isMeshDistanceMaterial?(s(A,b),function w(A,b){const C=e.get(b).light;A.referencePosition.value.setFromMatrixPosition(C.matrixWorld),A.nearDistance.value=C.shadow.camera.near,A.farDistance.value=C.shadow.camera.far}(A,b)):b.isMeshNormalMaterial?s(A,b):b.isLineBasicMaterial?(function o(A,b){A.diffuse.value.copy(b.color),A.opacity.value=b.opacity,b.map&&(A.map.value=b.map,t(b.map,A.mapTransform))}(A,b),b.isLineDashedMaterial&&function a(A,b){A.dashSize.value=b.dashSize,A.totalSize.value=b.dashSize+b.gapSize,A.scale.value=b.scale}(A,b)):b.isPointsMaterial?function l(A,b,C,T){A.diffuse.value.copy(b.color),A.opacity.value=b.opacity,A.size.value=b.size*C,A.scale.value=.5*T,b.map&&(A.map.value=b.map,t(b.map,A.uvTransform)),b.alphaMap&&(A.alphaMap.value=b.alphaMap,t(b.alphaMap,A.alphaMapTransform)),b.alphaTest>0&&(A.alphaTest.value=b.alphaTest)}(A,b,C,T):b.isSpriteMaterial?function u(A,b){A.diffuse.value.copy(b.color),A.opacity.value=b.opacity,A.rotation.value=b.rotation,b.map&&(A.map.value=b.map,t(b.map,A.mapTransform)),b.alphaMap&&(A.alphaMap.value=b.alphaMap,t(b.alphaMap,A.alphaMapTransform)),b.alphaTest>0&&(A.alphaTest.value=b.alphaTest)}(A,b):b.isShadowMaterial?(A.color.value.copy(b.color),A.opacity.value=b.opacity):b.isShaderMaterial&&(b.uniformsNeedUpdate=!1)}}}function C5(n,e,t,i){let r={},s={},o=[];const a=t.isWebGL2?n.getParameter(n.MAX_UNIFORM_BUFFER_BINDINGS):0;function _(C,T,I){const N=C.value;if(void 0===I[T]){if("number"==typeof N)I[T]=N;else{const k=Array.isArray(N)?N:[N],G=[];for(let K=0;K<k.length;K++)G.push(k[K].clone());I[T]=G}return!0}if("number"==typeof N){if(I[T]!==N)return I[T]=N,!0}else{const k=Array.isArray(I[T])?I[T]:[I[T]],G=Array.isArray(N)?N:[N];for(let K=0;K<k.length;K++){const L=k[K];if(!1===L.equals(G[K]))return L.copy(G[K]),!0}}return!1}function w(C){const T={boundary:0,storage:0};return"number"==typeof C?(T.boundary=4,T.storage=4):C.isVector2?(T.boundary=8,T.storage=8):C.isVector3||C.isColor?(T.boundary=16,T.storage=12):C.isVector4?(T.boundary=16,T.storage=16):C.isMatrix3?(T.boundary=48,T.storage=48):C.isMatrix4?(T.boundary=64,T.storage=64):C.isTexture?console.warn("THREE.WebGLRenderer: Texture samplers can not be part of an uniforms group."):console.warn("THREE.WebGLRenderer: Unsupported uniform value type.",C),T}function A(C){const T=C.target;T.removeEventListener("dispose",A);const I=o.indexOf(T.__bindingPointIndex);o.splice(I,1),n.deleteBuffer(r[T.id]),delete r[T.id],delete s[T.id]}return{bind:function l(C,T){i.uniformBlockBinding(C,T.program)},update:function u(C,T){let I=r[C.id];void 0===I&&(function y(C){const T=C.uniforms;let I=0;let k=0;for(let G=0,K=T.length;G<K;G++){const L=T[G],H={boundary:0,storage:0},me=Array.isArray(L.value)?L.value:[L.value];for(let Te=0,le=me.length;Te<le;Te++){const _e=w(me[Te]);H.boundary+=_e.boundary,H.storage+=_e.storage}L.__data=new Float32Array(H.storage/Float32Array.BYTES_PER_ELEMENT),L.__offset=I,G>0&&(k=I%16,0!==k&&16-k-H.boundary<0&&(I+=16-k,L.__offset=I)),I+=H.storage}k=I%16,k>0&&(I+=16-k),C.__size=I,C.__cache={}}(C),I=function d(C){const T=function f(){for(let C=0;C<a;C++)if(-1===o.indexOf(C))return o.push(C),C;return console.error("THREE.WebGLRenderer: Maximum number of simultaneously usable uniforms groups reached."),0}();C.__bindingPointIndex=T;const I=n.createBuffer(),N=C.__size,k=C.usage;return n.bindBuffer(n.UNIFORM_BUFFER,I),n.bufferData(n.UNIFORM_BUFFER,N,k),n.bindBuffer(n.UNIFORM_BUFFER,null),n.bindBufferBase(n.UNIFORM_BUFFER,T,I),I}(C),r[C.id]=I,C.addEventListener("dispose",A)),i.updateUBOMapping(C,T.program);const k=e.render.frame;s[C.id]!==k&&(function p(C){const I=C.uniforms,N=C.__cache;n.bindBuffer(n.UNIFORM_BUFFER,r[C.id]);for(let k=0,G=I.length;k<G;k++){const K=I[k];if(!0===_(K,k,N)){const L=K.__offset,H=Array.isArray(K.value)?K.value:[K.value];let me=0;for(let Te=0;Te<H.length;Te++){const le=H[Te],ue=w(le);"number"==typeof le?(K.__data[0]=le,n.bufferSubData(n.UNIFORM_BUFFER,L+me,K.__data)):le.isMatrix3?(K.__data[0]=le.elements[0],K.__data[1]=le.elements[1],K.__data[2]=le.elements[2],K.__data[3]=le.elements[0],K.__data[4]=le.elements[3],K.__data[5]=le.elements[4],K.__data[6]=le.elements[5],K.__data[7]=le.elements[0],K.__data[8]=le.elements[6],K.__data[9]=le.elements[7],K.__data[10]=le.elements[8],K.__data[11]=le.elements[0]):(le.toArray(K.__data,me),me+=ue.storage/Float32Array.BYTES_PER_ELEMENT)}n.bufferSubData(n.UNIFORM_BUFFER,L,K.__data)}}n.bindBuffer(n.UNIFORM_BUFFER,null)}(C),s[C.id]=k)},dispose:function b(){for(const C in r)n.deleteBuffer(r[C]);o=[],r={},s={}}}}function D5(){const n=Ph("canvas");return n.style.display="block",n}class xD{constructor(e={}){const{canvas:t=D5(),context:i=null,depth:r=!0,stencil:s=!0,alpha:o=!1,antialias:a=!1,premultipliedAlpha:l=!0,preserveDrawingBuffer:u=!1,powerPreference:d="default",failIfMajorPerformanceCaveat:f=!1}=e;let p;this.isWebGLRenderer=!0,p=null!==i?i.getContextAttributes().alpha:o;const _=new Uint32Array(4),y=new Int32Array(4);let w=null,A=null;const b=[],C=[];this.domElement=t,this.debug={checkShaderErrors:!0,onShaderError:null},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.outputColorSpace=jt,this.useLegacyLights=!0,this.toneMapping=mo,this.toneMappingExposure=1;const T=this;let I=!1,N=0,k=0,G=null,K=-1,L=null;const H=new Nn,me=new Nn;let Te=null;const le=new Qe(0);let ue=0,_e=t.width,Le=t.height,Se=1,De=null,Fe=null;const Ve=new Nn(0,0,_e,Le),he=new Nn(0,0,_e,Le);let Ce=!1;const Ye=new ky;let tt=!1,it=!1,gt=null;const Ct=new Wt,wt=new Be,Tn=new q,Dn={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function Nt(){return null===G?Se:1}let Re,je,ke,It,ft,vt,Qt,yn,ri,J,z,be,We,qe,st,Et,ot,Ee,Bt,Ft,kt,yt,xt,pn,te=i;function Ze($,fe){for(let we=0;we<$.length;we++){const Me=t.getContext($[we],fe);if(null!==Me)return Me}return null}try{const $={alpha:!0,depth:r,stencil:s,antialias:a,premultipliedAlpha:l,preserveDrawingBuffer:u,powerPreference:d,failIfMajorPerformanceCaveat:f};if("setAttribute"in t&&t.setAttribute("data-engine","three.js r154"),t.addEventListener("webglcontextlost",at,!1),t.addEventListener("webglcontextrestored",ye,!1),t.addEventListener("webglcontextcreationerror",Je,!1),null===te){const fe=["webgl2","webgl","experimental-webgl"];if(!0===T.isWebGL1Renderer&&fe.shift(),te=Ze(fe,$),null===te)throw Ze(fe)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}typeof WebGLRenderingContext<"u"&&te instanceof WebGLRenderingContext&&console.warn("THREE.WebGLRenderer: WebGL 1 support was deprecated in r153 and will be removed in r163."),void 0===te.getShaderPrecisionFormat&&(te.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch($){throw console.error("THREE.WebGLRenderer: "+$.message),$}function kn(){Re=new zG(te),je=new BG(te,Re,e),Re.init(je),yt=new A5(te,Re,je),ke=new x5(te,Re,je),It=new WG(te),ft=new l5,vt=new b5(te,Re,ke,ft,je,yt,It),Qt=new OG(T),yn=new UG(T),ri=new Nz(te,je),xt=new LG(te,Re,ri,je),J=new HG(te,ri,It,xt),z=new XG(te,J,ri,It),Bt=new $G(te,je,vt),Et=new FG(ft),be=new a5(T,Qt,yn,Re,je,xt,Et),We=new T5(T,ft),qe=new u5,st=new _5(Re,je),Ee=new PG(T,Qt,yn,ke,z,p,l),ot=new y5(T,z,je),pn=new C5(te,It,je,ke),Ft=new NG(te,Re,It,je),kt=new GG(te,Re,It,je),It.programs=be.programs,T.capabilities=je,T.extensions=Re,T.properties=ft,T.renderLists=qe,T.shadowMap=ot,T.state=ke,T.info=It}kn();const ie=new E5(T,te);function at($){$.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),I=!0}function ye(){console.log("THREE.WebGLRenderer: Context Restored."),I=!1;const $=It.autoReset,fe=ot.enabled,we=ot.autoUpdate,ce=ot.needsUpdate,Me=ot.type;kn(),It.autoReset=$,ot.enabled=fe,ot.autoUpdate=we,ot.needsUpdate=ce,ot.type=Me}function Je($){console.error("THREE.WebGLRenderer: A WebGL context could not be created. Reason: ",$.statusMessage)}function ct($){const fe=$.target;fe.removeEventListener("dispose",ct),function In($){(function Jn($){const fe=ft.get($).programs;void 0!==fe&&(fe.forEach(function(we){be.releaseProgram(we)}),$.isShaderMaterial&&be.releaseShaderCache($))})($),ft.remove($)}(fe)}this.xr=ie,this.getContext=function(){return te},this.getContextAttributes=function(){return te.getContextAttributes()},this.forceContextLoss=function(){const $=Re.get("WEBGL_lose_context");$&&$.loseContext()},this.forceContextRestore=function(){const $=Re.get("WEBGL_lose_context");$&&$.restoreContext()},this.getPixelRatio=function(){return Se},this.setPixelRatio=function($){void 0!==$&&(Se=$,this.setSize(_e,Le,!1))},this.getSize=function($){return $.set(_e,Le)},this.setSize=function($,fe,we=!0){ie.isPresenting?console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting."):(_e=$,Le=fe,t.width=Math.floor($*Se),t.height=Math.floor(fe*Se),!0===we&&(t.style.width=$+"px",t.style.height=fe+"px"),this.setViewport(0,0,$,fe))},this.getDrawingBufferSize=function($){return $.set(_e*Se,Le*Se).floor()},this.setDrawingBufferSize=function($,fe,we){_e=$,Le=fe,Se=we,t.width=Math.floor($*we),t.height=Math.floor(fe*we),this.setViewport(0,0,$,fe)},this.getCurrentViewport=function($){return $.copy(H)},this.getViewport=function($){return $.copy(Ve)},this.setViewport=function($,fe,we,ce){$.isVector4?Ve.set($.x,$.y,$.z,$.w):Ve.set($,fe,we,ce),ke.viewport(H.copy(Ve).multiplyScalar(Se).floor())},this.getScissor=function($){return $.copy(he)},this.setScissor=function($,fe,we,ce){$.isVector4?he.set($.x,$.y,$.z,$.w):he.set($,fe,we,ce),ke.scissor(me.copy(he).multiplyScalar(Se).floor())},this.getScissorTest=function(){return Ce},this.setScissorTest=function($){ke.setScissorTest(Ce=$)},this.setOpaqueSort=function($){De=$},this.setTransparentSort=function($){Fe=$},this.getClearColor=function($){return $.copy(Ee.getClearColor())},this.setClearColor=function(){Ee.setClearColor.apply(Ee,arguments)},this.getClearAlpha=function(){return Ee.getClearAlpha()},this.setClearAlpha=function(){Ee.setClearAlpha.apply(Ee,arguments)},this.clear=function($=!0,fe=!0,we=!0){let ce=0;if($){let Me=!1;if(null!==G){const _t=G.texture.format;Me=1033===_t||1031===_t||1029===_t}if(Me){const _t=G.texture.type,Ot=_t===Jo||_t===Ko||1012===_t||_t===Va||1017===_t||1018===_t,$t=Ee.getClearColor(),Kt=Ee.getClearAlpha(),mn=$t.r,tn=$t.g,cn=$t.b;Ot?(_[0]=mn,_[1]=tn,_[2]=cn,_[3]=Kt,te.clearBufferuiv(te.COLOR,0,_)):(y[0]=mn,y[1]=tn,y[2]=cn,y[3]=Kt,te.clearBufferiv(te.COLOR,0,y))}else ce|=te.COLOR_BUFFER_BIT}fe&&(ce|=te.DEPTH_BUFFER_BIT),we&&(ce|=te.STENCIL_BUFFER_BIT),te.clear(ce)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){t.removeEventListener("webglcontextlost",at,!1),t.removeEventListener("webglcontextrestored",ye,!1),t.removeEventListener("webglcontextcreationerror",Je,!1),qe.dispose(),st.dispose(),ft.dispose(),Qt.dispose(),yn.dispose(),z.dispose(),xt.dispose(),pn.dispose(),be.dispose(),ie.dispose(),ie.removeEventListener("sessionstart",si),ie.removeEventListener("sessionend",Ys),gt&&(gt.dispose(),gt=null),sr.stop()},this.renderBufferDirect=function($,fe,we,ce,Me,_t){null===fe&&(fe=Dn);const Ot=Me.isMesh&&Me.matrixWorld.determinant()<0,$t=function Pq($,fe,we,ce,Me){!0!==fe.isScene&&(fe=Dn),vt.resetTextureUnits();const _t=fe.fog,$t=null===G?T.outputColorSpace:!0===G.isXRRenderTarget?G.texture.colorSpace:zs,Kt=(ce.isMeshStandardMaterial?yn:Qt).get(ce.envMap||(ce.isMeshStandardMaterial?fe.environment:null)),mn=!0===ce.vertexColors&&!!we.attributes.color&&4===we.attributes.color.itemSize,tn=!!we.attributes.tangent&&(!!ce.normalMap||ce.anisotropy>0),cn=!!we.morphAttributes.position,oi=!!we.morphAttributes.normal,di=!!we.morphAttributes.color,Ms=ce.toneMapped?T.toneMapping:mo,Ro=we.morphAttributes.position||we.morphAttributes.normal||we.morphAttributes.color,xi=void 0!==Ro?Ro.length:0,wn=ft.get(ce),nx=A.state.lights;!0!==tt||!0!==it&&$===L||Et.setState(ce,$,$===L&&ce.id===K);let Vi=!1;ce.version===wn.__version?(wn.needsLights&&wn.lightsStateVersion!==nx.state.version||wn.outputColorSpace!==$t||Me.isInstancedMesh&&!1===wn.instancing||!Me.isInstancedMesh&&!0===wn.instancing||Me.isSkinnedMesh&&!1===wn.skinning||!Me.isSkinnedMesh&&!0===wn.skinning||wn.envMap!==Kt||!0===ce.fog&&wn.fog!==_t||void 0!==wn.numClippingPlanes&&(wn.numClippingPlanes!==Et.numPlanes||wn.numIntersection!==Et.numIntersection)||wn.vertexAlphas!==mn||wn.vertexTangents!==tn||wn.morphTargets!==cn||wn.morphNormals!==oi||wn.morphColors!==di||wn.toneMapping!==Ms||!0===je.isWebGL2&&wn.morphTargetsCount!==xi)&&(Vi=!0):(Vi=!0,wn.__version=ce.version);let pl=wn.currentProgram;!0===Vi&&(pl=Sm(ce,fe,Me));let hI=!1,pd=!1,ix=!1;const or=pl.getUniforms(),ml=wn.uniforms;if(ke.useProgram(pl.program)&&(hI=!0,pd=!0,ix=!0),ce.id!==K&&(K=ce.id,pd=!0),hI||L!==$){if(or.setValue(te,"projectionMatrix",$.projectionMatrix),je.logarithmicDepthBuffer&&or.setValue(te,"logDepthBufFC",2/(Math.log($.far+1)/Math.LN2)),L!==$&&(L=$,pd=!0,ix=!0),ce.isShaderMaterial||ce.isMeshPhongMaterial||ce.isMeshToonMaterial||ce.isMeshStandardMaterial||ce.envMap){const Br=or.map.cameraPosition;void 0!==Br&&Br.setValue(te,Tn.setFromMatrixPosition($.matrixWorld))}(ce.isMeshPhongMaterial||ce.isMeshToonMaterial||ce.isMeshLambertMaterial||ce.isMeshBasicMaterial||ce.isMeshStandardMaterial||ce.isShaderMaterial)&&or.setValue(te,"isOrthographic",!0===$.isOrthographicCamera),(ce.isMeshPhongMaterial||ce.isMeshToonMaterial||ce.isMeshLambertMaterial||ce.isMeshBasicMaterial||ce.isMeshStandardMaterial||ce.isShaderMaterial||ce.isShadowMaterial||Me.isSkinnedMesh)&&or.setValue(te,"viewMatrix",$.matrixWorldInverse)}if(Me.isSkinnedMesh){or.setOptional(te,Me,"bindMatrix"),or.setOptional(te,Me,"bindMatrixInverse");const Br=Me.skeleton;Br&&(je.floatVertexTextures?(null===Br.boneTexture&&Br.computeBoneTexture(),or.setValue(te,"boneTexture",Br.boneTexture,vt),or.setValue(te,"boneTextureSize",Br.boneTextureSize)):console.warn("THREE.WebGLRenderer: SkinnedMesh can only be used with WebGL 2. With WebGL 1 OES_texture_float and vertex textures support is required."))}const rx=we.morphAttributes;if((void 0!==rx.position||void 0!==rx.normal||void 0!==rx.color&&!0===je.isWebGL2)&&Bt.update(Me,we,pl),(pd||wn.receiveShadow!==Me.receiveShadow)&&(wn.receiveShadow=Me.receiveShadow,or.setValue(te,"receiveShadow",Me.receiveShadow)),ce.isMeshGouraudMaterial&&null!==ce.envMap&&(ml.envMap.value=Kt,ml.flipEnvMap.value=Kt.isCubeTexture&&!1===Kt.isRenderTargetTexture?-1:1),pd&&(or.setValue(te,"toneMappingExposure",T.toneMappingExposure),wn.needsLights&&function Lq($,fe){$.ambientLightColor.needsUpdate=fe,$.lightProbe.needsUpdate=fe,$.directionalLights.needsUpdate=fe,$.directionalLightShadows.needsUpdate=fe,$.pointLights.needsUpdate=fe,$.pointLightShadows.needsUpdate=fe,$.spotLights.needsUpdate=fe,$.spotLightShadows.needsUpdate=fe,$.rectAreaLights.needsUpdate=fe,$.hemisphereLights.needsUpdate=fe}(ml,ix),_t&&!0===ce.fog&&We.refreshFogUniforms(ml,_t),We.refreshMaterialUniforms(ml,ce,Se,Le,gt),Up.upload(te,wn.uniformsList,ml,vt)),ce.isShaderMaterial&&!0===ce.uniformsNeedUpdate&&(Up.upload(te,wn.uniformsList,ml,vt),ce.uniformsNeedUpdate=!1),ce.isSpriteMaterial&&or.setValue(te,"center",Me.center),or.setValue(te,"modelViewMatrix",Me.modelViewMatrix),or.setValue(te,"normalMatrix",Me.normalMatrix),or.setValue(te,"modelMatrix",Me.matrixWorld),ce.isShaderMaterial||ce.isRawShaderMaterial){const Br=ce.uniformsGroups;for(let sx=0,Bq=Br.length;sx<Bq;sx++)if(je.isWebGL2){const dI=Br[sx];pn.update(dI,pl),pn.bind(dI,pl)}else console.warn("THREE.WebGLRenderer: Uniform Buffer Objects can only be used with WebGL 2.")}return pl}($,fe,we,ce,Me);ke.setMaterial(ce,Ot);let Kt=we.index,mn=1;!0===ce.wireframe&&(Kt=J.getWireframeAttribute(we),mn=2);const tn=we.drawRange,cn=we.attributes.position;let oi=tn.start*mn,di=(tn.start+tn.count)*mn;null!==_t&&(oi=Math.max(oi,_t.start*mn),di=Math.min(di,(_t.start+_t.count)*mn)),null!==Kt?(oi=Math.max(oi,0),di=Math.min(di,Kt.count)):null!=cn&&(oi=Math.max(oi,0),di=Math.min(di,cn.count));const Ms=di-oi;if(Ms<0||Ms===1/0)return;xt.setup(Me,ce,$t,we,Kt);let Ro,xi=Ft;if(null!==Kt&&(Ro=ri.get(Kt),xi=kt,xi.setIndex(Ro)),Me.isMesh)!0===ce.wireframe?(ke.setLineWidth(ce.wireframeLinewidth*Nt()),xi.setMode(te.LINES)):xi.setMode(te.TRIANGLES);else if(Me.isLine){let wn=ce.linewidth;void 0===wn&&(wn=1),ke.setLineWidth(wn*Nt()),xi.setMode(Me.isLineSegments?te.LINES:Me.isLineLoop?te.LINE_LOOP:te.LINE_STRIP)}else Me.isPoints?xi.setMode(te.POINTS):Me.isSprite&&xi.setMode(te.TRIANGLES);if(Me.isInstancedMesh)xi.renderInstances(oi,Ms,Me.count);else if(we.isInstancedBufferGeometry){const nx=Math.min(we.instanceCount,void 0!==we._maxInstanceCount?we._maxInstanceCount:1/0);xi.renderInstances(oi,Ms,nx)}else xi.render(oi,Ms)},this.compile=function($,fe){function we(ce,Me,_t){!0===ce.transparent&&2===ce.side&&!1===ce.forceSinglePass?(ce.side=1,ce.needsUpdate=!0,Sm(ce,Me,_t),ce.side=0,ce.needsUpdate=!0,Sm(ce,Me,_t),ce.side=2):Sm(ce,Me,_t)}A=st.get($),A.init(),C.push(A),$.traverseVisible(function(ce){ce.isLight&&ce.layers.test(fe.layers)&&(A.pushLight(ce),ce.castShadow&&A.pushShadow(ce))}),A.setupLights(T.useLegacyLights),$.traverse(function(ce){const Me=ce.material;if(Me)if(Array.isArray(Me))for(let _t=0;_t<Me.length;_t++)we(Me[_t],$,ce);else we(Me,$,ce)}),C.pop(),A=null};let Oi=null;function si(){sr.stop()}function Ys(){sr.start()}const sr=new qC;function aI($,fe,we,ce){if(!1===$.visible)return;if($.layers.test(fe.layers))if($.isGroup)we=$.renderOrder;else if($.isLOD)!0===$.autoUpdate&&$.update(fe);else if($.isLight)A.pushLight($),$.castShadow&&A.pushShadow($);else if($.isSprite){if(!$.frustumCulled||Ye.intersectsSprite($)){ce&&Tn.setFromMatrixPosition($.matrixWorld).applyMatrix4(Ct);const Ot=z.update($),$t=$.material;$t.visible&&w.push($,Ot,$t,we,Tn.z,null)}}else if(($.isMesh||$.isLine||$.isPoints)&&(!$.frustumCulled||Ye.intersectsObject($))){const Ot=z.update($),$t=$.material;if(ce&&(void 0!==$.boundingSphere?(null===$.boundingSphere&&$.computeBoundingSphere(),Tn.copy($.boundingSphere.center)):(null===Ot.boundingSphere&&Ot.computeBoundingSphere(),Tn.copy(Ot.boundingSphere.center)),Tn.applyMatrix4($.matrixWorld).applyMatrix4(Ct)),Array.isArray($t)){const Kt=Ot.groups;for(let mn=0,tn=Kt.length;mn<tn;mn++){const cn=Kt[mn],oi=$t[cn.materialIndex];oi&&oi.visible&&w.push($,Ot,oi,we,Tn.z,cn)}}else $t.visible&&w.push($,Ot,$t,we,Tn.z,null)}const _t=$.children;for(let Ot=0,$t=_t.length;Ot<$t;Ot++)aI(_t[Ot],fe,we,ce)}function lI($,fe,we,ce){const Me=$.opaque,_t=$.transmissive,Ot=$.transparent;A.setupLightsView(we),!0===tt&&Et.setGlobalState(T.clippingPlanes,we),_t.length>0&&function Rq($,fe,we,ce){const Me=je.isWebGL2;null===gt&&(gt=new Wa(1,1,{generateMipmaps:!0,type:Re.has("EXT_color_buffer_half_float")?Dh:Jo,minFilter:_o,samples:Me?4:0})),T.getDrawingBufferSize(wt),Me?gt.setSize(wt.x,wt.y):gt.setSize(_p(wt.x),_p(wt.y));const _t=T.getRenderTarget();T.setRenderTarget(gt),T.getClearColor(le),ue=T.getClearAlpha(),ue<1&&T.setClearColor(16777215,.5),T.clear();const Ot=T.toneMapping;T.toneMapping=mo,Mm($,we,ce),vt.updateMultisampleRenderTarget(gt),vt.updateRenderTargetMipmap(gt);let $t=!1;for(let Kt=0,mn=fe.length;Kt<mn;Kt++){const tn=fe[Kt],cn=tn.object,oi=tn.geometry,di=tn.material,Ms=tn.group;if(2===di.side&&cn.layers.test(ce.layers)){const Ro=di.side;di.side=1,di.needsUpdate=!0,cI(cn,we,ce,oi,di,Ms),di.side=Ro,di.needsUpdate=!0,$t=!0}}!0===$t&&(vt.updateMultisampleRenderTarget(gt),vt.updateRenderTargetMipmap(gt)),T.setRenderTarget(_t),T.setClearColor(le,ue),T.toneMapping=Ot}(Me,_t,fe,we),ce&&ke.viewport(H.copy(ce)),Me.length>0&&Mm(Me,fe,we),_t.length>0&&Mm(_t,fe,we),Ot.length>0&&Mm(Ot,fe,we),ke.buffers.depth.setTest(!0),ke.buffers.depth.setMask(!0),ke.buffers.color.setMask(!0),ke.setPolygonOffset(!1)}function Mm($,fe,we){const ce=!0===fe.isScene?fe.overrideMaterial:null;for(let Me=0,_t=$.length;Me<_t;Me++){const Ot=$[Me],$t=Ot.object,Kt=Ot.geometry,mn=null===ce?Ot.material:ce,tn=Ot.group;$t.layers.test(we.layers)&&cI($t,fe,we,Kt,mn,tn)}}function cI($,fe,we,ce,Me,_t){$.onBeforeRender(T,fe,we,ce,Me,_t),$.modelViewMatrix.multiplyMatrices(we.matrixWorldInverse,$.matrixWorld),$.normalMatrix.getNormalMatrix($.modelViewMatrix),Me.onBeforeRender(T,fe,we,ce,$,_t),!0===Me.transparent&&2===Me.side&&!1===Me.forceSinglePass?(Me.side=1,Me.needsUpdate=!0,T.renderBufferDirect(we,fe,ce,Me,$,_t),Me.side=0,Me.needsUpdate=!0,T.renderBufferDirect(we,fe,ce,Me,$,_t),Me.side=2):T.renderBufferDirect(we,fe,ce,Me,$,_t),$.onAfterRender(T,fe,we,ce,Me,_t)}function Sm($,fe,we){!0!==fe.isScene&&(fe=Dn);const ce=ft.get($),Me=A.state.lights,Ot=Me.state.version,$t=be.getParameters($,Me.state,A.state.shadowsArray,fe,we),Kt=be.getProgramCacheKey($t);let mn=ce.programs;ce.environment=$.isMeshStandardMaterial?fe.environment:null,ce.fog=fe.fog,ce.envMap=($.isMeshStandardMaterial?yn:Qt).get($.envMap||ce.environment),void 0===mn&&($.addEventListener("dispose",ct),mn=new Map,ce.programs=mn);let tn=mn.get(Kt);if(void 0!==tn){if(ce.currentProgram===tn&&ce.lightsStateVersion===Ot)return uI($,$t),tn}else $t.uniforms=be.getUniforms($),$.onBuild(we,$t,T),$.onBeforeCompile($t,T),tn=be.acquireProgram($t,Kt),mn.set(Kt,tn),ce.uniforms=$t.uniforms;const cn=ce.uniforms;(!$.isShaderMaterial&&!$.isRawShaderMaterial||!0===$.clipping)&&(cn.clippingPlanes=Et.uniform),uI($,$t),ce.needsLights=function Nq($){return $.isMeshLambertMaterial||$.isMeshToonMaterial||$.isMeshPhongMaterial||$.isMeshStandardMaterial||$.isShadowMaterial||$.isShaderMaterial&&!0===$.lights}($),ce.lightsStateVersion=Ot,ce.needsLights&&(cn.ambientLightColor.value=Me.state.ambient,cn.lightProbe.value=Me.state.probe,cn.directionalLights.value=Me.state.directional,cn.directionalLightShadows.value=Me.state.directionalShadow,cn.spotLights.value=Me.state.spot,cn.spotLightShadows.value=Me.state.spotShadow,cn.rectAreaLights.value=Me.state.rectArea,cn.ltc_1.value=Me.state.rectAreaLTC1,cn.ltc_2.value=Me.state.rectAreaLTC2,cn.pointLights.value=Me.state.point,cn.pointLightShadows.value=Me.state.pointShadow,cn.hemisphereLights.value=Me.state.hemi,cn.directionalShadowMap.value=Me.state.directionalShadowMap,cn.directionalShadowMatrix.value=Me.state.directionalShadowMatrix,cn.spotShadowMap.value=Me.state.spotShadowMap,cn.spotLightMatrix.value=Me.state.spotLightMatrix,cn.spotLightMap.value=Me.state.spotLightMap,cn.pointShadowMap.value=Me.state.pointShadowMap,cn.pointShadowMatrix.value=Me.state.pointShadowMatrix);const oi=tn.getUniforms(),di=Up.seqWithValue(oi.seq,cn);return ce.currentProgram=tn,ce.uniformsList=di,tn}function uI($,fe){const we=ft.get($);we.outputColorSpace=fe.outputColorSpace,we.instancing=fe.instancing,we.skinning=fe.skinning,we.morphTargets=fe.morphTargets,we.morphNormals=fe.morphNormals,we.morphColors=fe.morphColors,we.morphTargetsCount=fe.morphTargetsCount,we.numClippingPlanes=fe.numClippingPlanes,we.numIntersection=fe.numClipIntersection,we.vertexAlphas=fe.vertexAlphas,we.vertexTangents=fe.vertexTangents,we.toneMapping=fe.toneMapping}sr.setAnimationLoop(function Xs($){Oi&&Oi($)}),typeof self<"u"&&sr.setContext(self),this.setAnimationLoop=function($){Oi=$,ie.setAnimationLoop($),null===$?sr.stop():sr.start()},ie.addEventListener("sessionstart",si),ie.addEventListener("sessionend",Ys),this.render=function($,fe){if(void 0===fe||!0===fe.isCamera){if(!0!==I){if(!0===$.matrixWorldAutoUpdate&&$.updateMatrixWorld(),null===fe.parent&&!0===fe.matrixWorldAutoUpdate&&fe.updateMatrixWorld(),!0===ie.enabled&&!0===ie.isPresenting&&(!0===ie.cameraAutoUpdate&&ie.updateCamera(fe),fe=ie.getCamera()),!0===$.isScene&&$.onBeforeRender(T,$,fe,G),A=st.get($,C.length),A.init(),C.push(A),Ct.multiplyMatrices(fe.projectionMatrix,fe.matrixWorldInverse),Ye.setFromProjectionMatrix(Ct),it=this.localClippingEnabled,tt=Et.init(this.clippingPlanes,it),w=qe.get($,b.length),w.init(),b.push(w),aI($,fe,0,T.sortObjects),w.finish(),!0===T.sortObjects&&w.sort(De,Fe),this.info.render.frame++,!0===tt&&Et.beginShadows(),ot.render(A.state.shadowsArray,$,fe),!0===tt&&Et.endShadows(),!0===this.info.autoReset&&this.info.reset(),Ee.render(w,$),A.setupLights(T.useLegacyLights),fe.isArrayCamera){const ce=fe.cameras;for(let Me=0,_t=ce.length;Me<_t;Me++){const Ot=ce[Me];lI(w,$,Ot,Ot.viewport)}}else lI(w,$,fe);null!==G&&(vt.updateMultisampleRenderTarget(G),vt.updateRenderTargetMipmap(G)),!0===$.isScene&&$.onAfterRender(T,$,fe),xt.resetDefaultState(),K=-1,L=null,C.pop(),A=C.length>0?C[C.length-1]:null,b.pop(),w=b.length>0?b[b.length-1]:null}}else console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.")},this.getActiveCubeFace=function(){return N},this.getActiveMipmapLevel=function(){return k},this.getRenderTarget=function(){return G},this.setRenderTargetTextures=function($,fe,we){ft.get($.texture).__webglTexture=fe,ft.get($.depthTexture).__webglTexture=we;const ce=ft.get($);ce.__hasExternalTextures=!0,ce.__hasExternalTextures&&(ce.__autoAllocateDepthBuffer=void 0===we,ce.__autoAllocateDepthBuffer||!0===Re.has("WEBGL_multisampled_render_to_texture")&&(console.warn("THREE.WebGLRenderer: Render-to-texture extension was disabled because an external texture was provided"),ce.__useRenderToTexture=!1))},this.setRenderTargetFramebuffer=function($,fe){const we=ft.get($);we.__webglFramebuffer=fe,we.__useDefaultFramebuffer=void 0===fe},this.setRenderTarget=function($,fe=0,we=0){G=$,N=fe,k=we;let ce=!0,Me=null,_t=!1,Ot=!1;if($){const Kt=ft.get($);void 0!==Kt.__useDefaultFramebuffer?(ke.bindFramebuffer(te.FRAMEBUFFER,null),ce=!1):void 0===Kt.__webglFramebuffer?vt.setupRenderTarget($):Kt.__hasExternalTextures&&vt.rebindTextures($,ft.get($.texture).__webglTexture,ft.get($.depthTexture).__webglTexture);const mn=$.texture;(mn.isData3DTexture||mn.isDataArrayTexture||mn.isCompressedArrayTexture)&&(Ot=!0);const tn=ft.get($).__webglFramebuffer;$.isWebGLCubeRenderTarget?(Me=tn[fe],_t=!0):Me=je.isWebGL2&&$.samples>0&&!1===vt.useMultisampledRTT($)?ft.get($).__webglMultisampledFramebuffer:tn,H.copy($.viewport),me.copy($.scissor),Te=$.scissorTest}else H.copy(Ve).multiplyScalar(Se).floor(),me.copy(he).multiplyScalar(Se).floor(),Te=Ce;if(ke.bindFramebuffer(te.FRAMEBUFFER,Me)&&je.drawBuffers&&ce&&ke.drawBuffers($,Me),ke.viewport(H),ke.scissor(me),ke.setScissorTest(Te),_t){const Kt=ft.get($.texture);te.framebufferTexture2D(te.FRAMEBUFFER,te.COLOR_ATTACHMENT0,te.TEXTURE_CUBE_MAP_POSITIVE_X+fe,Kt.__webglTexture,we)}else if(Ot){const Kt=ft.get($.texture);te.framebufferTextureLayer(te.FRAMEBUFFER,te.COLOR_ATTACHMENT0,Kt.__webglTexture,we||0,fe||0)}K=-1},this.readRenderTargetPixels=function($,fe,we,ce,Me,_t,Ot){if(!$||!$.isWebGLRenderTarget)return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let $t=ft.get($).__webglFramebuffer;if($.isWebGLCubeRenderTarget&&void 0!==Ot&&($t=$t[Ot]),$t){ke.bindFramebuffer(te.FRAMEBUFFER,$t);try{const Kt=$.texture,mn=Kt.format,tn=Kt.type;if(mn!==jr&&yt.convert(mn)!==te.getParameter(te.IMPLEMENTATION_COLOR_READ_FORMAT))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");const cn=tn===Dh&&(Re.has("EXT_color_buffer_half_float")||je.isWebGL2&&Re.has("EXT_color_buffer_float"));if(!(tn===Jo||yt.convert(tn)===te.getParameter(te.IMPLEMENTATION_COLOR_READ_TYPE)||tn===go&&(je.isWebGL2||Re.has("OES_texture_float")||Re.has("WEBGL_color_buffer_float"))||cn))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");fe>=0&&fe<=$.width-ce&&we>=0&&we<=$.height-Me&&te.readPixels(fe,we,ce,Me,yt.convert(mn),yt.convert(tn),_t)}finally{const Kt=null!==G?ft.get(G).__webglFramebuffer:null;ke.bindFramebuffer(te.FRAMEBUFFER,Kt)}}},this.copyFramebufferToTexture=function($,fe,we=0){const ce=Math.pow(2,-we),Me=Math.floor(fe.image.width*ce),_t=Math.floor(fe.image.height*ce);vt.setTexture2D(fe,0),te.copyTexSubImage2D(te.TEXTURE_2D,we,0,0,$.x,$.y,Me,_t),ke.unbindTexture()},this.copyTextureToTexture=function($,fe,we,ce=0){const Me=fe.image.width,_t=fe.image.height,Ot=yt.convert(we.format),$t=yt.convert(we.type);vt.setTexture2D(we,0),te.pixelStorei(te.UNPACK_FLIP_Y_WEBGL,we.flipY),te.pixelStorei(te.UNPACK_PREMULTIPLY_ALPHA_WEBGL,we.premultiplyAlpha),te.pixelStorei(te.UNPACK_ALIGNMENT,we.unpackAlignment),fe.isDataTexture?te.texSubImage2D(te.TEXTURE_2D,ce,$.x,$.y,Me,_t,Ot,$t,fe.image.data):fe.isCompressedTexture?te.compressedTexSubImage2D(te.TEXTURE_2D,ce,$.x,$.y,fe.mipmaps[0].width,fe.mipmaps[0].height,Ot,fe.mipmaps[0].data):te.texSubImage2D(te.TEXTURE_2D,ce,$.x,$.y,Ot,$t,fe.image),0===ce&&we.generateMipmaps&&te.generateMipmap(te.TEXTURE_2D),ke.unbindTexture()},this.copyTextureToTexture3D=function($,fe,we,ce,Me=0){if(T.isWebGL1Renderer)return void console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: can only be used with WebGL2.");const _t=$.max.x-$.min.x+1,Ot=$.max.y-$.min.y+1,$t=$.max.z-$.min.z+1,Kt=yt.convert(ce.format),mn=yt.convert(ce.type);let tn;if(ce.isData3DTexture)vt.setTexture3D(ce,0),tn=te.TEXTURE_3D;else{if(!ce.isDataArrayTexture)return void console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");vt.setTexture2DArray(ce,0),tn=te.TEXTURE_2D_ARRAY}te.pixelStorei(te.UNPACK_FLIP_Y_WEBGL,ce.flipY),te.pixelStorei(te.UNPACK_PREMULTIPLY_ALPHA_WEBGL,ce.premultiplyAlpha),te.pixelStorei(te.UNPACK_ALIGNMENT,ce.unpackAlignment);const cn=te.getParameter(te.UNPACK_ROW_LENGTH),oi=te.getParameter(te.UNPACK_IMAGE_HEIGHT),di=te.getParameter(te.UNPACK_SKIP_PIXELS),Ms=te.getParameter(te.UNPACK_SKIP_ROWS),Ro=te.getParameter(te.UNPACK_SKIP_IMAGES),xi=we.isCompressedTexture?we.mipmaps[0]:we.image;te.pixelStorei(te.UNPACK_ROW_LENGTH,xi.width),te.pixelStorei(te.UNPACK_IMAGE_HEIGHT,xi.height),te.pixelStorei(te.UNPACK_SKIP_PIXELS,$.min.x),te.pixelStorei(te.UNPACK_SKIP_ROWS,$.min.y),te.pixelStorei(te.UNPACK_SKIP_IMAGES,$.min.z),we.isDataTexture||we.isData3DTexture?te.texSubImage3D(tn,Me,fe.x,fe.y,fe.z,_t,Ot,$t,Kt,mn,xi.data):we.isCompressedArrayTexture?(console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: untested support for compressed srcTexture."),te.compressedTexSubImage3D(tn,Me,fe.x,fe.y,fe.z,_t,Ot,$t,Kt,xi.data)):te.texSubImage3D(tn,Me,fe.x,fe.y,fe.z,_t,Ot,$t,Kt,mn,xi),te.pixelStorei(te.UNPACK_ROW_LENGTH,cn),te.pixelStorei(te.UNPACK_IMAGE_HEIGHT,oi),te.pixelStorei(te.UNPACK_SKIP_PIXELS,di),te.pixelStorei(te.UNPACK_SKIP_ROWS,Ms),te.pixelStorei(te.UNPACK_SKIP_IMAGES,Ro),0===Me&&ce.generateMipmaps&&te.generateMipmap(tn),ke.unbindTexture()},this.initTexture=function($){$.isCubeTexture?vt.setTextureCube($,0):$.isData3DTexture?vt.setTexture3D($,0):$.isDataArrayTexture||$.isCompressedArrayTexture?vt.setTexture2DArray($,0):vt.setTexture2D($,0),ke.unbindTexture()},this.resetState=function(){N=0,k=0,G=null,ke.reset(),xt.reset()},typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}get coordinateSystem(){return vo}get physicallyCorrectLights(){return console.warn("THREE.WebGLRenderer: the property .physicallyCorrectLights has been removed. Set renderer.useLegacyLights instead."),!this.useLegacyLights}set physicallyCorrectLights(e){console.warn("THREE.WebGLRenderer: the property .physicallyCorrectLights has been removed. Set renderer.useLegacyLights instead."),this.useLegacyLights=!e}get outputEncoding(){return console.warn("THREE.WebGLRenderer: Property .outputEncoding has been removed. Use .outputColorSpace instead."),this.outputColorSpace===jt?Ua:3e3}set outputEncoding(e){console.warn("THREE.WebGLRenderer: Property .outputEncoding has been removed. Use .outputColorSpace instead."),this.outputColorSpace=e===Ua?jt:zs}}(class I5 extends xD{}).prototype.isWebGL1Renderer=!0;class bD extends vi{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.backgroundBlurriness=0,this.backgroundIntensity=1,this.overrideMaterial=null,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(e,t){return super.copy(e,t),null!==e.background&&(this.background=e.background.clone()),null!==e.environment&&(this.environment=e.environment.clone()),null!==e.fog&&(this.fog=e.fog.clone()),this.backgroundBlurriness=e.backgroundBlurriness,this.backgroundIntensity=e.backgroundIntensity,null!==e.overrideMaterial&&(this.overrideMaterial=e.overrideMaterial.clone()),this.matrixAutoUpdate=e.matrixAutoUpdate,this}toJSON(e){const t=super.toJSON(e);return null!==this.fog&&(t.object.fog=this.fog.toJSON()),this.backgroundBlurriness>0&&(t.object.backgroundBlurriness=this.backgroundBlurriness),1!==this.backgroundIntensity&&(t.object.backgroundIntensity=this.backgroundIntensity),t}}class Xy{constructor(e,t){this.isInterleavedBuffer=!0,this.array=e,this.stride=t,this.count=void 0!==e?e.length/t:0,this.usage=35044,this.updateRange={offset:0,count:-1},this.version=0,this.uuid=Ir()}onUploadCallback(){}set needsUpdate(e){!0===e&&this.version++}setUsage(e){return this.usage=e,this}copy(e){return this.array=new e.array.constructor(e.array),this.count=e.count,this.stride=e.stride,this.usage=e.usage,this}copyAt(e,t,i){e*=this.stride,i*=t.stride;for(let r=0,s=this.stride;r<s;r++)this.array[e+r]=t.array[i+r];return this}set(e,t=0){return this.array.set(e,t),this}clone(e){void 0===e.arrayBuffers&&(e.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=Ir()),void 0===e.arrayBuffers[this.array.buffer._uuid]&&(e.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const t=new this.array.constructor(e.arrayBuffers[this.array.buffer._uuid]),i=new this.constructor(t,this.stride);return i.setUsage(this.usage),i}onUpload(e){return this.onUploadCallback=e,this}toJSON(e){return void 0===e.arrayBuffers&&(e.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=Ir()),void 0===e.arrayBuffers[this.array.buffer._uuid]&&(e.arrayBuffers[this.array.buffer._uuid]=Array.from(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}const ir=new q;class el{constructor(e,t,i,r=!1){this.isInterleavedBufferAttribute=!0,this.name="",this.data=e,this.itemSize=t,this.offset=i,this.normalized=r}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(e){this.data.needsUpdate=e}applyMatrix4(e){for(let t=0,i=this.data.count;t<i;t++)ir.fromBufferAttribute(this,t),ir.applyMatrix4(e),this.setXYZ(t,ir.x,ir.y,ir.z);return this}applyNormalMatrix(e){for(let t=0,i=this.count;t<i;t++)ir.fromBufferAttribute(this,t),ir.applyNormalMatrix(e),this.setXYZ(t,ir.x,ir.y,ir.z);return this}transformDirection(e){for(let t=0,i=this.count;t<i;t++)ir.fromBufferAttribute(this,t),ir.transformDirection(e),this.setXYZ(t,ir.x,ir.y,ir.z);return this}setX(e,t){return this.normalized&&(t=ln(t,this.array)),this.data.array[e*this.data.stride+this.offset]=t,this}setY(e,t){return this.normalized&&(t=ln(t,this.array)),this.data.array[e*this.data.stride+this.offset+1]=t,this}setZ(e,t){return this.normalized&&(t=ln(t,this.array)),this.data.array[e*this.data.stride+this.offset+2]=t,this}setW(e,t){return this.normalized&&(t=ln(t,this.array)),this.data.array[e*this.data.stride+this.offset+3]=t,this}getX(e){let t=this.data.array[e*this.data.stride+this.offset];return this.normalized&&(t=Rr(t,this.array)),t}getY(e){let t=this.data.array[e*this.data.stride+this.offset+1];return this.normalized&&(t=Rr(t,this.array)),t}getZ(e){let t=this.data.array[e*this.data.stride+this.offset+2];return this.normalized&&(t=Rr(t,this.array)),t}getW(e){let t=this.data.array[e*this.data.stride+this.offset+3];return this.normalized&&(t=Rr(t,this.array)),t}setXY(e,t,i){return e=e*this.data.stride+this.offset,this.normalized&&(t=ln(t,this.array),i=ln(i,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=i,this}setXYZ(e,t,i,r){return e=e*this.data.stride+this.offset,this.normalized&&(t=ln(t,this.array),i=ln(i,this.array),r=ln(r,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=i,this.data.array[e+2]=r,this}setXYZW(e,t,i,r,s){return e=e*this.data.stride+this.offset,this.normalized&&(t=ln(t,this.array),i=ln(i,this.array),r=ln(r,this.array),s=ln(s,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=i,this.data.array[e+2]=r,this.data.array[e+3]=s,this}clone(e){if(void 0===e){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interleaved buffer attribute will de-interleave buffer data.");const t=[];for(let i=0;i<this.count;i++){const r=i*this.data.stride+this.offset;for(let s=0;s<this.itemSize;s++)t.push(this.data.array[r+s])}return new ni(new this.array.constructor(t),this.itemSize,this.normalized)}return void 0===e.interleavedBuffers&&(e.interleavedBuffers={}),void 0===e.interleavedBuffers[this.data.uuid]&&(e.interleavedBuffers[this.data.uuid]=this.data.clone(e)),new el(e.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(e){if(void 0===e){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interleaved buffer attribute will de-interleave buffer data.");const t=[];for(let i=0;i<this.count;i++){const r=i*this.data.stride+this.offset;for(let s=0;s<this.itemSize;s++)t.push(this.data.array[r+s])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:t,normalized:this.normalized}}return void 0===e.interleavedBuffers&&(e.interleavedBuffers={}),void 0===e.interleavedBuffers[this.data.uuid]&&(e.interleavedBuffers[this.data.uuid]=this.data.toJSON(e)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}const TD=new q,CD=new Nn,DD=new Nn,L5=new q,ID=new Wt,Kc=new q,Zy=new gs,RD=new Wt,Jy=new Fh;class PD extends Gn{constructor(e,t){super(e,t),this.isSkinnedMesh=!0,this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new Wt,this.bindMatrixInverse=new Wt,this.boundingBox=null,this.boundingSphere=null}computeBoundingBox(){const e=this.geometry;null===this.boundingBox&&(this.boundingBox=new Hs),this.boundingBox.makeEmpty();const t=e.getAttribute("position");for(let i=0;i<t.count;i++)Kc.fromBufferAttribute(t,i),this.applyBoneTransform(i,Kc),this.boundingBox.expandByPoint(Kc)}computeBoundingSphere(){const e=this.geometry;null===this.boundingSphere&&(this.boundingSphere=new gs),this.boundingSphere.makeEmpty();const t=e.getAttribute("position");for(let i=0;i<t.count;i++)Kc.fromBufferAttribute(t,i),this.applyBoneTransform(i,Kc),this.boundingSphere.expandByPoint(Kc)}copy(e,t){return super.copy(e,t),this.bindMode=e.bindMode,this.bindMatrix.copy(e.bindMatrix),this.bindMatrixInverse.copy(e.bindMatrixInverse),this.skeleton=e.skeleton,null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone()),null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),this}raycast(e,t){const r=this.matrixWorld;void 0!==this.material&&(null===this.boundingSphere&&this.computeBoundingSphere(),Zy.copy(this.boundingSphere),Zy.applyMatrix4(r),!1!==e.ray.intersectsSphere(Zy)&&(RD.copy(r).invert(),Jy.copy(e.ray).applyMatrix4(RD),(null===this.boundingBox||!1!==Jy.intersectsBox(this.boundingBox))&&this._computeIntersections(e,t,Jy)))}getVertexPosition(e,t){return super.getVertexPosition(e,t),this.applyBoneTransform(e,t),t}bind(e,t){this.skeleton=e,void 0===t&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),t=this.matrixWorld),this.bindMatrix.copy(t),this.bindMatrixInverse.copy(t).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(){const e=new Nn,t=this.geometry.attributes.skinWeight;for(let i=0,r=t.count;i<r;i++){e.fromBufferAttribute(t,i);const s=1/e.manhattanLength();s!==1/0?e.multiplyScalar(s):e.set(1,0,0,0),t.setXYZW(i,e.x,e.y,e.z,e.w)}}updateMatrixWorld(e){super.updateMatrixWorld(e),"attached"===this.bindMode?this.bindMatrixInverse.copy(this.matrixWorld).invert():"detached"===this.bindMode?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}applyBoneTransform(e,t){const i=this.skeleton,r=this.geometry;CD.fromBufferAttribute(r.attributes.skinIndex,e),DD.fromBufferAttribute(r.attributes.skinWeight,e),TD.copy(t).applyMatrix4(this.bindMatrix),t.set(0,0,0);for(let s=0;s<4;s++){const o=DD.getComponent(s);if(0!==o){const a=CD.getComponent(s);ID.multiplyMatrices(i.bones[a].matrixWorld,i.boneInverses[a]),t.addScaledVector(L5.copy(TD).applyMatrix4(ID),o)}}return t.applyMatrix4(this.bindMatrixInverse)}boneTransform(e,t){return console.warn("THREE.SkinnedMesh: .boneTransform() was renamed to .applyBoneTransform() in r151."),this.applyBoneTransform(e,t)}}class Ky extends vi{constructor(){super(),this.isBone=!0,this.type="Bone"}}class Wh extends _s{constructor(e=null,t=1,i=1,r,s,o,a,l,u=ui,d=ui,f,p){super(null,o,a,l,u,d,r,s,f,p),this.isDataTexture=!0,this.image={data:e,width:t,height:i},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}const LD=new Wt,N5=new Wt;class qp{constructor(e=[],t=[]){this.uuid=Ir(),this.bones=e.slice(0),this.boneInverses=t,this.boneMatrices=null,this.boneTexture=null,this.boneTextureSize=0,this.init()}init(){const e=this.bones,t=this.boneInverses;if(this.boneMatrices=new Float32Array(16*e.length),0===t.length)this.calculateInverses();else if(e.length!==t.length){console.warn("THREE.Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(let i=0,r=this.bones.length;i<r;i++)this.boneInverses.push(new Wt)}}calculateInverses(){this.boneInverses.length=0;for(let e=0,t=this.bones.length;e<t;e++){const i=new Wt;this.bones[e]&&i.copy(this.bones[e].matrixWorld).invert(),this.boneInverses.push(i)}}pose(){for(let e=0,t=this.bones.length;e<t;e++){const i=this.bones[e];i&&i.matrixWorld.copy(this.boneInverses[e]).invert()}for(let e=0,t=this.bones.length;e<t;e++){const i=this.bones[e];i&&(i.parent&&i.parent.isBone?(i.matrix.copy(i.parent.matrixWorld).invert(),i.matrix.multiply(i.matrixWorld)):i.matrix.copy(i.matrixWorld),i.matrix.decompose(i.position,i.quaternion,i.scale))}}update(){const e=this.bones,t=this.boneInverses,i=this.boneMatrices,r=this.boneTexture;for(let s=0,o=e.length;s<o;s++)LD.multiplyMatrices(e[s]?e[s].matrixWorld:N5,t[s]),LD.toArray(i,16*s);null!==r&&(r.needsUpdate=!0)}clone(){return new qp(this.bones,this.boneInverses)}computeBoneTexture(){let e=Math.sqrt(4*this.bones.length);e=AC(e),e=Math.max(e,4);const t=new Float32Array(e*e*4);t.set(this.boneMatrices);const i=new Wh(t,e,e,jr,go);return i.needsUpdate=!0,this.boneMatrices=t,this.boneTexture=i,this.boneTextureSize=e,this}getBoneByName(e){for(let t=0,i=this.bones.length;t<i;t++){const r=this.bones[t];if(r.name===e)return r}}dispose(){null!==this.boneTexture&&(this.boneTexture.dispose(),this.boneTexture=null)}fromJSON(e,t){this.uuid=e.uuid;for(let i=0,r=e.bones.length;i<r;i++){const s=e.bones[i];let o=t[s];void 0===o&&(console.warn("THREE.Skeleton: No bone found with UUID:",s),o=new Ky),this.bones.push(o),this.boneInverses.push((new Wt).fromArray(e.boneInverses[i]))}return this.init(),this}toJSON(){const e={metadata:{version:4.6,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};e.uuid=this.uuid;const t=this.bones,i=this.boneInverses;for(let r=0,s=t.length;r<s;r++)e.bones.push(t[r].uuid),e.boneInverses.push(i[r].toArray());return e}}class qh extends ni{constructor(e,t,i,r=1){super(e,t,i),this.isInstancedBufferAttribute=!0,this.meshPerAttribute=r}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}toJSON(){const e=super.toJSON();return e.meshPerAttribute=this.meshPerAttribute,e.isInstancedBufferAttribute=!0,e}}const Qc=new Wt,ND=new Wt,jp=[],BD=new Hs,B5=new Wt,jh=new Gn,$h=new gs;class Qy extends Gn{constructor(e,t,i){super(e,t),this.isInstancedMesh=!0,this.instanceMatrix=new qh(new Float32Array(16*i),16),this.instanceColor=null,this.count=i,this.boundingBox=null,this.boundingSphere=null;for(let r=0;r<i;r++)this.setMatrixAt(r,B5)}computeBoundingBox(){const e=this.geometry,t=this.count;null===this.boundingBox&&(this.boundingBox=new Hs),null===e.boundingBox&&e.computeBoundingBox(),this.boundingBox.makeEmpty();for(let i=0;i<t;i++)this.getMatrixAt(i,Qc),BD.copy(e.boundingBox).applyMatrix4(Qc),this.boundingBox.union(BD)}computeBoundingSphere(){const e=this.geometry,t=this.count;null===this.boundingSphere&&(this.boundingSphere=new gs),null===e.boundingSphere&&e.computeBoundingSphere(),this.boundingSphere.makeEmpty();for(let i=0;i<t;i++)this.getMatrixAt(i,Qc),$h.copy(e.boundingSphere).applyMatrix4(Qc),this.boundingSphere.union($h)}copy(e,t){return super.copy(e,t),this.instanceMatrix.copy(e.instanceMatrix),null!==e.instanceColor&&(this.instanceColor=e.instanceColor.clone()),this.count=e.count,null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone()),null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),this}getColorAt(e,t){t.fromArray(this.instanceColor.array,3*e)}getMatrixAt(e,t){t.fromArray(this.instanceMatrix.array,16*e)}raycast(e,t){const i=this.matrixWorld,r=this.count;if(jh.geometry=this.geometry,jh.material=this.material,void 0!==jh.material&&(null===this.boundingSphere&&this.computeBoundingSphere(),$h.copy(this.boundingSphere),$h.applyMatrix4(i),!1!==e.ray.intersectsSphere($h)))for(let s=0;s<r;s++){this.getMatrixAt(s,Qc),ND.multiplyMatrices(i,Qc),jh.matrixWorld=ND,jh.raycast(e,jp);for(let o=0,a=jp.length;o<a;o++){const l=jp[o];l.instanceId=s,l.object=this,t.push(l)}jp.length=0}}setColorAt(e,t){null===this.instanceColor&&(this.instanceColor=new qh(new Float32Array(3*this.instanceMatrix.count),3)),t.toArray(this.instanceColor.array,3*e)}setMatrixAt(e,t){t.toArray(this.instanceMatrix.array,16*e)}updateMorphTargets(){}dispose(){this.dispatchEvent({type:"dispose"})}}class rr extends $r{constructor(e){super(),this.isLineBasicMaterial=!0,this.type="LineBasicMaterial",this.color=new Qe(16777215),this.map=null,this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this.fog=e.fog,this}}const FD=new q,OD=new q,VD=new Wt,e0=new Fh,$p=new gs;class tl extends vi{constructor(e=new hn,t=new rr){super(),this.isLine=!0,this.type="Line",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),this.material=e.material,this.geometry=e.geometry,this}computeLineDistances(){const e=this.geometry;if(null===e.index){const t=e.attributes.position,i=[0];for(let r=1,s=t.count;r<s;r++)FD.fromBufferAttribute(t,r-1),OD.fromBufferAttribute(t,r),i[r]=i[r-1],i[r]+=FD.distanceTo(OD);e.setAttribute("lineDistance",new ht(i,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}raycast(e,t){const i=this.geometry,r=this.matrixWorld,s=e.params.Line.threshold,o=i.drawRange;if(null===i.boundingSphere&&i.computeBoundingSphere(),$p.copy(i.boundingSphere),$p.applyMatrix4(r),$p.radius+=s,!1===e.ray.intersectsSphere($p))return;VD.copy(r).invert(),e0.copy(e.ray).applyMatrix4(VD);const a=s/((this.scale.x+this.scale.y+this.scale.z)/3),l=a*a,u=new q,d=new q,f=new q,p=new q,_=this.isLineSegments?2:1,y=i.index,A=i.attributes.position;if(null!==y)for(let T=Math.max(0,o.start),I=Math.min(y.count,o.start+o.count)-1;T<I;T+=_){const N=y.getX(T),k=y.getX(T+1);if(u.fromBufferAttribute(A,N),d.fromBufferAttribute(A,k),e0.distanceSqToSegment(u,d,p,f)>l)continue;p.applyMatrix4(this.matrixWorld);const K=e.ray.origin.distanceTo(p);K<e.near||K>e.far||t.push({distance:K,point:f.clone().applyMatrix4(this.matrixWorld),index:T,face:null,faceIndex:null,object:this})}else for(let T=Math.max(0,o.start),I=Math.min(A.count,o.start+o.count)-1;T<I;T+=_){if(u.fromBufferAttribute(A,T),d.fromBufferAttribute(A,T+1),e0.distanceSqToSegment(u,d,p,f)>l)continue;p.applyMatrix4(this.matrixWorld);const k=e.ray.origin.distanceTo(p);k<e.near||k>e.far||t.push({distance:k,point:f.clone().applyMatrix4(this.matrixWorld),index:T,face:null,faceIndex:null,object:this})}}updateMorphTargets(){const t=this.geometry.morphAttributes,i=Object.keys(t);if(i.length>0){const r=t[i[0]];if(void 0!==r){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let s=0,o=r.length;s<o;s++){const a=r[s].name||String(s);this.morphTargetInfluences.push(0),this.morphTargetDictionary[a]=s}}}}}const kD=new q,UD=new q;class nl extends tl{constructor(e,t){super(e,t),this.isLineSegments=!0,this.type="LineSegments"}computeLineDistances(){const e=this.geometry;if(null===e.index){const t=e.attributes.position,i=[];for(let r=0,s=t.count;r<s;r+=2)kD.fromBufferAttribute(t,r),UD.fromBufferAttribute(t,r+1),i[r]=0===r?0:i[r-1],i[r+1]=i[r]+kD.distanceTo(UD);e.setAttribute("lineDistance",new ht(i,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}}class zD extends tl{constructor(e,t){super(e,t),this.isLineLoop=!0,this.type="LineLoop"}}class t0 extends $r{constructor(e){super(),this.isPointsMaterial=!0,this.type="PointsMaterial",this.color=new Qe(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}}const HD=new Wt,n0=new Fh,Xp=new gs,Yp=new q;class r0 extends vi{constructor(e=new hn,t=new t0){super(),this.isPoints=!0,this.type="Points",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),this.material=e.material,this.geometry=e.geometry,this}raycast(e,t){const i=this.geometry,r=this.matrixWorld,s=e.params.Points.threshold,o=i.drawRange;if(null===i.boundingSphere&&i.computeBoundingSphere(),Xp.copy(i.boundingSphere),Xp.applyMatrix4(r),Xp.radius+=s,!1===e.ray.intersectsSphere(Xp))return;HD.copy(r).invert(),n0.copy(e.ray).applyMatrix4(HD);const a=s/((this.scale.x+this.scale.y+this.scale.z)/3),l=a*a,u=i.index,f=i.attributes.position;if(null!==u)for(let y=Math.max(0,o.start),w=Math.min(u.count,o.start+o.count);y<w;y++){const A=u.getX(y);Yp.fromBufferAttribute(f,A),GD(Yp,A,l,r,e,t,this)}else for(let y=Math.max(0,o.start),w=Math.min(f.count,o.start+o.count);y<w;y++)Yp.fromBufferAttribute(f,y),GD(Yp,y,l,r,e,t,this)}updateMorphTargets(){const t=this.geometry.morphAttributes,i=Object.keys(t);if(i.length>0){const r=t[i[0]];if(void 0!==r){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let s=0,o=r.length;s<o;s++){const a=r[s].name||String(s);this.morphTargetInfluences.push(0),this.morphTargetDictionary[a]=s}}}}}function GD(n,e,t,i,r,s,o){const a=n0.distanceSqToPoint(n);if(a<t){const l=new q;n0.closestPointToPoint(n,l),l.applyMatrix4(i);const u=r.ray.origin.distanceTo(l);if(u<r.near||u>r.far)return;s.push({distance:u,distanceToRay:Math.sqrt(a),point:l,index:e,face:null,object:o})}}class Ws{constructor(){this.type="Curve",this.arcLengthDivisions=200}getPoint(){return console.warn("THREE.Curve: .getPoint() not implemented."),null}getPointAt(e,t){const i=this.getUtoTmapping(e);return this.getPoint(i,t)}getPoints(e=5){const t=[];for(let i=0;i<=e;i++)t.push(this.getPoint(i/e));return t}getSpacedPoints(e=5){const t=[];for(let i=0;i<=e;i++)t.push(this.getPointAt(i/e));return t}getLength(){const e=this.getLengths();return e[e.length-1]}getLengths(e=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const t=[];let i,r=this.getPoint(0),s=0;t.push(0);for(let o=1;o<=e;o++)i=this.getPoint(o/e),s+=i.distanceTo(r),t.push(s),r=i;return this.cacheArcLengths=t,t}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(e,t){const i=this.getLengths();let r=0;const s=i.length;let o;o=t||e*i[s-1];let u,a=0,l=s-1;for(;a<=l;)if(r=Math.floor(a+(l-a)/2),u=i[r]-o,u<0)a=r+1;else{if(!(u>0)){l=r;break}l=r-1}if(r=l,i[r]===o)return r/(s-1);const d=i[r];return(r+(o-d)/(i[r+1]-d))/(s-1)}getTangent(e,t){let r=e-1e-4,s=e+1e-4;r<0&&(r=0),s>1&&(s=1);const o=this.getPoint(r),a=this.getPoint(s),l=t||(o.isVector2?new Be:new q);return l.copy(a).sub(o).normalize(),l}getTangentAt(e,t){const i=this.getUtoTmapping(e);return this.getTangent(i,t)}computeFrenetFrames(e,t){const i=new q,r=[],s=[],o=[],a=new q,l=new Wt;for(let _=0;_<=e;_++)r[_]=this.getTangentAt(_/e,new q);s[0]=new q,o[0]=new q;let u=Number.MAX_VALUE;const d=Math.abs(r[0].x),f=Math.abs(r[0].y),p=Math.abs(r[0].z);d<=u&&(u=d,i.set(1,0,0)),f<=u&&(u=f,i.set(0,1,0)),p<=u&&i.set(0,0,1),a.crossVectors(r[0],i).normalize(),s[0].crossVectors(r[0],a),o[0].crossVectors(r[0],s[0]);for(let _=1;_<=e;_++){if(s[_]=s[_-1].clone(),o[_]=o[_-1].clone(),a.crossVectors(r[_-1],r[_]),a.length()>Number.EPSILON){a.normalize();const y=Math.acos(ti(r[_-1].dot(r[_]),-1,1));s[_].applyMatrix4(l.makeRotationAxis(a,y))}o[_].crossVectors(r[_],s[_])}if(!0===t){let _=Math.acos(ti(s[0].dot(s[e]),-1,1));_/=e,r[0].dot(a.crossVectors(s[0],s[e]))>0&&(_=-_);for(let y=1;y<=e;y++)s[y].applyMatrix4(l.makeRotationAxis(r[y],_*y)),o[y].crossVectors(r[y],s[y])}return{tangents:r,normals:s,binormals:o}}clone(){return(new this.constructor).copy(this)}copy(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}toJSON(){const e={metadata:{version:4.6,type:"Curve",generator:"Curve.toJSON"}};return e.arcLengthDivisions=this.arcLengthDivisions,e.type=this.type,e}fromJSON(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}}class s0 extends Ws{constructor(e=0,t=0,i=1,r=1,s=0,o=2*Math.PI,a=!1,l=0){super(),this.isEllipseCurve=!0,this.type="EllipseCurve",this.aX=e,this.aY=t,this.xRadius=i,this.yRadius=r,this.aStartAngle=s,this.aEndAngle=o,this.aClockwise=a,this.aRotation=l}getPoint(e,t){const i=t||new Be,r=2*Math.PI;let s=this.aEndAngle-this.aStartAngle;const o=Math.abs(s)<Number.EPSILON;for(;s<0;)s+=r;for(;s>r;)s-=r;s<Number.EPSILON&&(s=o?0:r),!0===this.aClockwise&&!o&&(s===r?s=-r:s-=r);const a=this.aStartAngle+e*s;let l=this.aX+this.xRadius*Math.cos(a),u=this.aY+this.yRadius*Math.sin(a);if(0!==this.aRotation){const d=Math.cos(this.aRotation),f=Math.sin(this.aRotation),p=l-this.aX,_=u-this.aY;l=p*d-_*f+this.aX,u=p*f+_*d+this.aY}return i.set(l,u)}copy(e){return super.copy(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}toJSON(){const e=super.toJSON();return e.aX=this.aX,e.aY=this.aY,e.xRadius=this.xRadius,e.yRadius=this.yRadius,e.aStartAngle=this.aStartAngle,e.aEndAngle=this.aEndAngle,e.aClockwise=this.aClockwise,e.aRotation=this.aRotation,e}fromJSON(e){return super.fromJSON(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}}function o0(){let n=0,e=0,t=0,i=0;function r(s,o,a,l){n=s,e=a,t=-3*s+3*o-2*a-l,i=2*s-2*o+a+l}return{initCatmullRom:function(s,o,a,l,u){r(o,a,u*(a-s),u*(l-o))},initNonuniformCatmullRom:function(s,o,a,l,u,d,f){let p=(o-s)/u-(a-s)/(u+d)+(a-o)/d,_=(a-o)/d-(l-o)/(d+f)+(l-a)/f;p*=d,_*=d,r(o,a,p,_)},calc:function(s){const o=s*s;return n+e*s+t*o+i*(o*s)}}}const Zp=new q,a0=new o0,l0=new o0,c0=new o0;function WD(n,e,t,i,r){const s=.5*(i-e),o=.5*(r-t),a=n*n;return(2*t-2*i+s+o)*(n*a)+(-3*t+3*i-2*s-o)*a+s*n+t}function Xh(n,e,t,i){return function k5(n,e){const t=1-n;return t*t*e}(n,e)+function U5(n,e){return 2*(1-n)*n*e}(n,t)+function z5(n,e){return n*n*e}(n,i)}function Yh(n,e,t,i,r){return function H5(n,e){const t=1-n;return t*t*t*e}(n,e)+function G5(n,e){const t=1-n;return 3*t*t*n*e}(n,t)+function W5(n,e){return 3*(1-n)*n*n*e}(n,i)+function q5(n,e){return n*n*n*e}(n,r)}class qD extends Ws{constructor(e=new Be,t=new Be,i=new Be,r=new Be){super(),this.isCubicBezierCurve=!0,this.type="CubicBezierCurve",this.v0=e,this.v1=t,this.v2=i,this.v3=r}getPoint(e,t=new Be){const i=t,r=this.v0,s=this.v1,o=this.v2,a=this.v3;return i.set(Yh(e,r.x,s.x,o.x,a.x),Yh(e,r.y,s.y,o.y,a.y)),i}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}class u0 extends Ws{constructor(e=new Be,t=new Be){super(),this.isLineCurve=!0,this.type="LineCurve",this.v1=e,this.v2=t}getPoint(e,t=new Be){const i=t;return 1===e?i.copy(this.v2):(i.copy(this.v2).sub(this.v1),i.multiplyScalar(e).add(this.v1)),i}getPointAt(e,t){return this.getPoint(e,t)}getTangent(e,t=new Be){return t.subVectors(this.v2,this.v1).normalize()}getTangentAt(e,t){return this.getTangent(e,t)}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class jD extends Ws{constructor(e=new Be,t=new Be,i=new Be){super(),this.isQuadraticBezierCurve=!0,this.type="QuadraticBezierCurve",this.v0=e,this.v1=t,this.v2=i}getPoint(e,t=new Be){const i=t,r=this.v0,s=this.v1,o=this.v2;return i.set(Xh(e,r.x,s.x,o.x),Xh(e,r.y,s.y,o.y)),i}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class XD extends Ws{constructor(e=[]){super(),this.isSplineCurve=!0,this.type="SplineCurve",this.points=e}getPoint(e,t=new Be){const i=t,r=this.points,s=(r.length-1)*e,o=Math.floor(s),a=s-o,l=r[0===o?o:o-1],u=r[o],d=r[o>r.length-2?r.length-1:o+1],f=r[o>r.length-3?r.length-1:o+2];return i.set(WD(a,l.x,u.x,d.x,f.x),WD(a,l.y,u.y,d.y,f.y)),i}copy(e){super.copy(e),this.points=[];for(let t=0,i=e.points.length;t<i;t++)this.points.push(e.points[t].clone());return this}toJSON(){const e=super.toJSON();e.points=[];for(let t=0,i=this.points.length;t<i;t++)e.points.push(this.points[t].toArray());return e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,i=e.points.length;t<i;t++){const r=e.points[t];this.points.push((new Be).fromArray(r))}return this}}var h0=Object.freeze({__proto__:null,ArcCurve:class O5 extends s0{constructor(e,t,i,r,s,o){super(e,t,i,i,r,s,o),this.isArcCurve=!0,this.type="ArcCurve"}},CatmullRomCurve3:class V5 extends Ws{constructor(e=[],t=!1,i="centripetal",r=.5){super(),this.isCatmullRomCurve3=!0,this.type="CatmullRomCurve3",this.points=e,this.closed=t,this.curveType=i,this.tension=r}getPoint(e,t=new q){const i=t,r=this.points,s=r.length,o=(s-(this.closed?0:1))*e;let u,d,a=Math.floor(o),l=o-a;this.closed?a+=a>0?0:(Math.floor(Math.abs(a)/s)+1)*s:0===l&&a===s-1&&(a=s-2,l=1),this.closed||a>0?u=r[(a-1)%s]:(Zp.subVectors(r[0],r[1]).add(r[0]),u=Zp);const f=r[a%s],p=r[(a+1)%s];if(this.closed||a+2<s?d=r[(a+2)%s]:(Zp.subVectors(r[s-1],r[s-2]).add(r[s-1]),d=Zp),"centripetal"===this.curveType||"chordal"===this.curveType){const _="chordal"===this.curveType?.5:.25;let y=Math.pow(u.distanceToSquared(f),_),w=Math.pow(f.distanceToSquared(p),_),A=Math.pow(p.distanceToSquared(d),_);w<1e-4&&(w=1),y<1e-4&&(y=w),A<1e-4&&(A=w),a0.initNonuniformCatmullRom(u.x,f.x,p.x,d.x,y,w,A),l0.initNonuniformCatmullRom(u.y,f.y,p.y,d.y,y,w,A),c0.initNonuniformCatmullRom(u.z,f.z,p.z,d.z,y,w,A)}else"catmullrom"===this.curveType&&(a0.initCatmullRom(u.x,f.x,p.x,d.x,this.tension),l0.initCatmullRom(u.y,f.y,p.y,d.y,this.tension),c0.initCatmullRom(u.z,f.z,p.z,d.z,this.tension));return i.set(a0.calc(l),l0.calc(l),c0.calc(l)),i}copy(e){super.copy(e),this.points=[];for(let t=0,i=e.points.length;t<i;t++)this.points.push(e.points[t].clone());return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}toJSON(){const e=super.toJSON();e.points=[];for(let t=0,i=this.points.length;t<i;t++)e.points.push(this.points[t].toArray());return e.closed=this.closed,e.curveType=this.curveType,e.tension=this.tension,e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,i=e.points.length;t<i;t++){const r=e.points[t];this.points.push((new q).fromArray(r))}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}},CubicBezierCurve:qD,CubicBezierCurve3:class j5 extends Ws{constructor(e=new q,t=new q,i=new q,r=new q){super(),this.isCubicBezierCurve3=!0,this.type="CubicBezierCurve3",this.v0=e,this.v1=t,this.v2=i,this.v3=r}getPoint(e,t=new q){const i=t,r=this.v0,s=this.v1,o=this.v2,a=this.v3;return i.set(Yh(e,r.x,s.x,o.x,a.x),Yh(e,r.y,s.y,o.y,a.y),Yh(e,r.z,s.z,o.z,a.z)),i}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}},EllipseCurve:s0,LineCurve:u0,LineCurve3:class $5 extends Ws{constructor(e=new q,t=new q){super(),this.isLineCurve3=!0,this.type="LineCurve3",this.v1=e,this.v2=t}getPoint(e,t=new q){const i=t;return 1===e?i.copy(this.v2):(i.copy(this.v2).sub(this.v1),i.multiplyScalar(e).add(this.v1)),i}getPointAt(e,t){return this.getPoint(e,t)}getTangent(e,t=new q){return t.subVectors(this.v2,this.v1).normalize()}getTangentAt(e,t){return this.getTangent(e,t)}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}},QuadraticBezierCurve:jD,QuadraticBezierCurve3:class $D extends Ws{constructor(e=new q,t=new q,i=new q){super(),this.isQuadraticBezierCurve3=!0,this.type="QuadraticBezierCurve3",this.v0=e,this.v1=t,this.v2=i}getPoint(e,t=new q){const i=t,r=this.v0,s=this.v1,o=this.v2;return i.set(Xh(e,r.x,s.x,o.x),Xh(e,r.y,s.y,o.y),Xh(e,r.z,s.z,o.z)),i}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}},SplineCurve:XD});class X5 extends Ws{constructor(){super(),this.type="CurvePath",this.curves=[],this.autoClose=!1}add(e){this.curves.push(e)}closePath(){const e=this.curves[0].getPoint(0),t=this.curves[this.curves.length-1].getPoint(1);e.equals(t)||this.curves.push(new u0(t,e))}getPoint(e,t){const i=e*this.getLength(),r=this.getCurveLengths();let s=0;for(;s<r.length;){if(r[s]>=i){const o=r[s]-i,a=this.curves[s],l=a.getLength();return a.getPointAt(0===l?0:1-o/l,t)}s++}return null}getLength(){const e=this.getCurveLengths();return e[e.length-1]}updateArcLengths(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}getCurveLengths(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;const e=[];let t=0;for(let i=0,r=this.curves.length;i<r;i++)t+=this.curves[i].getLength(),e.push(t);return this.cacheLengths=e,e}getSpacedPoints(e=40){const t=[];for(let i=0;i<=e;i++)t.push(this.getPoint(i/e));return this.autoClose&&t.push(t[0]),t}getPoints(e=12){const t=[];let i;for(let r=0,s=this.curves;r<s.length;r++){const o=s[r],l=o.getPoints(o.isEllipseCurve?2*e:o.isLineCurve||o.isLineCurve3?1:o.isSplineCurve?e*o.points.length:e);for(let u=0;u<l.length;u++){const d=l[u];i&&i.equals(d)||(t.push(d),i=d)}}return this.autoClose&&t.length>1&&!t[t.length-1].equals(t[0])&&t.push(t[0]),t}copy(e){super.copy(e),this.curves=[];for(let t=0,i=e.curves.length;t<i;t++)this.curves.push(e.curves[t].clone());return this.autoClose=e.autoClose,this}toJSON(){const e=super.toJSON();e.autoClose=this.autoClose,e.curves=[];for(let t=0,i=this.curves.length;t<i;t++)e.curves.push(this.curves[t].toJSON());return e}fromJSON(e){super.fromJSON(e),this.autoClose=e.autoClose,this.curves=[];for(let t=0,i=e.curves.length;t<i;t++){const r=e.curves[t];this.curves.push((new h0[r.type]).fromJSON(r))}return this}}class Jp extends X5{constructor(e){super(),this.type="Path",this.currentPoint=new Be,e&&this.setFromPoints(e)}setFromPoints(e){this.moveTo(e[0].x,e[0].y);for(let t=1,i=e.length;t<i;t++)this.lineTo(e[t].x,e[t].y);return this}moveTo(e,t){return this.currentPoint.set(e,t),this}lineTo(e,t){const i=new u0(this.currentPoint.clone(),new Be(e,t));return this.curves.push(i),this.currentPoint.set(e,t),this}quadraticCurveTo(e,t,i,r){const s=new jD(this.currentPoint.clone(),new Be(e,t),new Be(i,r));return this.curves.push(s),this.currentPoint.set(i,r),this}bezierCurveTo(e,t,i,r,s,o){const a=new qD(this.currentPoint.clone(),new Be(e,t),new Be(i,r),new Be(s,o));return this.curves.push(a),this.currentPoint.set(s,o),this}splineThru(e){const t=[this.currentPoint.clone()].concat(e),i=new XD(t);return this.curves.push(i),this.currentPoint.copy(e[e.length-1]),this}arc(e,t,i,r,s,o){return this.absarc(e+this.currentPoint.x,t+this.currentPoint.y,i,r,s,o),this}absarc(e,t,i,r,s,o){return this.absellipse(e,t,i,i,r,s,o),this}ellipse(e,t,i,r,s,o,a,l){return this.absellipse(e+this.currentPoint.x,t+this.currentPoint.y,i,r,s,o,a,l),this}absellipse(e,t,i,r,s,o,a,l){const u=new s0(e,t,i,r,s,o,a,l);if(this.curves.length>0){const f=u.getPoint(0);f.equals(this.currentPoint)||this.lineTo(f.x,f.y)}this.curves.push(u);const d=u.getPoint(1);return this.currentPoint.copy(d),this}copy(e){return super.copy(e),this.currentPoint.copy(e.currentPoint),this}toJSON(){const e=super.toJSON();return e.currentPoint=this.currentPoint.toArray(),e}fromJSON(e){return super.fromJSON(e),this.currentPoint.fromArray(e.currentPoint),this}}class eu extends hn{constructor(e=1,t=1,i=1,r=32,s=1,o=!1,a=0,l=2*Math.PI){super(),this.type="CylinderGeometry",this.parameters={radiusTop:e,radiusBottom:t,height:i,radialSegments:r,heightSegments:s,openEnded:o,thetaStart:a,thetaLength:l};const u=this;r=Math.floor(r),s=Math.floor(s);const d=[],f=[],p=[],_=[];let y=0;const w=[],A=i/2;let b=0;function T(I){const N=y,k=new Be,G=new q;let K=0;const L=!0===I?e:t,H=!0===I?1:-1;for(let Te=1;Te<=r;Te++)f.push(0,A*H,0),p.push(0,H,0),_.push(.5,.5),y++;const me=y;for(let Te=0;Te<=r;Te++){const ue=Te/r*l+a,_e=Math.cos(ue),Le=Math.sin(ue);G.x=L*Le,G.y=A*H,G.z=L*_e,f.push(G.x,G.y,G.z),p.push(0,H,0),k.x=.5*_e+.5,k.y=.5*Le*H+.5,_.push(k.x,k.y),y++}for(let Te=0;Te<r;Te++){const le=N+Te,ue=me+Te;!0===I?d.push(ue,ue+1,le):d.push(ue+1,ue,le),K+=3}u.addGroup(b,K,!0===I?1:2),b+=K}(function C(){const I=new q,N=new q;let k=0;const G=(t-e)/i;for(let K=0;K<=s;K++){const L=[],H=K/s,me=H*(t-e)+e;for(let Te=0;Te<=r;Te++){const le=Te/r,ue=le*l+a,_e=Math.sin(ue),Le=Math.cos(ue);N.x=me*_e,N.y=-H*i+A,N.z=me*Le,f.push(N.x,N.y,N.z),I.set(_e,G,Le).normalize(),p.push(I.x,I.y,I.z),_.push(le,1-H),L.push(y++)}w.push(L)}for(let K=0;K<r;K++)for(let L=0;L<s;L++){const me=w[L+1][K],Te=w[L+1][K+1],le=w[L][K+1];d.push(w[L][K],me,le),d.push(me,Te,le),k+=6}u.addGroup(b,k,0),b+=k})(),!1===o&&(e>0&&T(!0),t>0&&T(!1)),this.setIndex(d),this.setAttribute("position",new ht(f,3)),this.setAttribute("normal",new ht(p,3)),this.setAttribute("uv",new ht(_,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new eu(e.radiusTop,e.radiusBottom,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}const Qp=new q,em=new q,_0=new q,tm=new Lr;class nm extends hn{constructor(e=null,t=1){if(super(),this.type="EdgesGeometry",this.parameters={geometry:e,thresholdAngle:t},null!==e){const r=Math.pow(10,4),s=Math.cos(Ga*t),o=e.getIndex(),a=e.getAttribute("position"),l=o?o.count:a.count,u=[0,0,0],d=["a","b","c"],f=new Array(3),p={},_=[];for(let y=0;y<l;y+=3){o?(u[0]=o.getX(y),u[1]=o.getX(y+1),u[2]=o.getX(y+2)):(u[0]=y,u[1]=y+1,u[2]=y+2);const{a:w,b:A,c:b}=tm;if(w.fromBufferAttribute(a,u[0]),A.fromBufferAttribute(a,u[1]),b.fromBufferAttribute(a,u[2]),tm.getNormal(_0),f[0]=`${Math.round(w.x*r)},${Math.round(w.y*r)},${Math.round(w.z*r)}`,f[1]=`${Math.round(A.x*r)},${Math.round(A.y*r)},${Math.round(A.z*r)}`,f[2]=`${Math.round(b.x*r)},${Math.round(b.y*r)},${Math.round(b.z*r)}`,f[0]!==f[1]&&f[1]!==f[2]&&f[2]!==f[0])for(let C=0;C<3;C++){const T=(C+1)%3,I=f[C],N=f[T],k=tm[d[C]],G=tm[d[T]],K=`${I}_${N}`,L=`${N}_${I}`;L in p&&p[L]?(_0.dot(p[L].normal)<=s&&(_.push(k.x,k.y,k.z),_.push(G.x,G.y,G.z)),p[L]=null):K in p||(p[K]={index0:u[C],index1:u[T],normal:_0.clone()})}}for(const y in p)if(p[y]){const{index0:w,index1:A}=p[y];Qp.fromBufferAttribute(a,w),em.fromBufferAttribute(a,A),_.push(Qp.x,Qp.y,Qp.z),_.push(em.x,em.y,em.z)}this.setAttribute("position",new ht(_,3))}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}}class To extends Jp{constructor(e){super(e),this.uuid=Ir(),this.type="Shape",this.holes=[]}getPointsHoles(e){const t=[];for(let i=0,r=this.holes.length;i<r;i++)t[i]=this.holes[i].getPoints(e);return t}extractPoints(e){return{shape:this.getPoints(e),holes:this.getPointsHoles(e)}}copy(e){super.copy(e),this.holes=[];for(let t=0,i=e.holes.length;t<i;t++)this.holes.push(e.holes[t].clone());return this}toJSON(){const e=super.toJSON();e.uuid=this.uuid,e.holes=[];for(let t=0,i=this.holes.length;t<i;t++)e.holes.push(this.holes[t].toJSON());return e}fromJSON(e){super.fromJSON(e),this.uuid=e.uuid,this.holes=[];for(let t=0,i=e.holes.length;t<i;t++){const r=e.holes[t];this.holes.push((new Jp).fromJSON(r))}return this}}function YD(n,e,t,i,r){let s,o;if(r===function hW(n,e,t,i){let r=0;for(let s=e,o=t-i;s<t;s+=i)r+=(n[o]-n[s])*(n[s+1]+n[o+1]),o=s;return r}(n,e,t,i)>0)for(s=e;s<t;s+=i)o=KD(s,n[s],n[s+1],o);else for(s=t-i;s>=e;s-=i)o=KD(s,n[s],n[s+1],o);return o&&im(o,o.next)&&(Kh(o),o=o.next),o}function rl(n,e){if(!n)return n;e||(e=n);let i,t=n;do{if(i=!1,t.steiner||!im(t,t.next)&&0!==Zn(t.prev,t,t.next))t=t.next;else{if(Kh(t),t=e=t.prev,t===t.next)break;i=!0}}while(i||t!==e);return e}function Zh(n,e,t,i,r,s,o){if(!n)return;!o&&s&&function sW(n,e,t,i){let r=n;do{0===r.z&&(r.z=g0(r.x,r.y,e,t,i)),r.prevZ=r.prev,r.nextZ=r.next,r=r.next}while(r!==n);r.prevZ.nextZ=null,r.prevZ=null,function oW(n){let e,t,i,r,s,o,a,l,u=1;do{for(t=n,n=null,s=null,o=0;t;){for(o++,i=t,a=0,e=0;e<u&&(a++,i=i.nextZ,i);e++);for(l=u;a>0||l>0&&i;)0!==a&&(0===l||!i||t.z<=i.z)?(r=t,t=t.nextZ,a--):(r=i,i=i.nextZ,l--),s?s.nextZ=r:n=r,r.prevZ=s,s=r;t=i}s.nextZ=null,u*=2}while(o>1)}(r)}(n,i,r,s);let l,u,a=n;for(;n.prev!==n.next;)if(l=n.prev,u=n.next,s?J5(n,i,r,s):Z5(n))e.push(l.i/t|0),e.push(n.i/t|0),e.push(u.i/t|0),Kh(n),n=u.next,a=u.next;else if((n=u)===a){o?1===o?Zh(n=K5(rl(n),e,t),e,t,i,r,s,2):2===o&&Q5(n,e,t,i,r,s):Zh(rl(n),e,t,i,r,s,1);break}}function Z5(n){const e=n.prev,t=n,i=n.next;if(Zn(e,t,i)>=0)return!1;const r=e.x,s=t.x,o=i.x,a=e.y,l=t.y,u=i.y,d=r<s?r<o?r:o:s<o?s:o,f=a<l?a<u?a:u:l<u?l:u,p=r>s?r>o?r:o:s>o?s:o,_=a>l?a>u?a:u:l>u?l:u;let y=i.next;for(;y!==e;){if(y.x>=d&&y.x<=p&&y.y>=f&&y.y<=_&&tu(r,a,s,l,o,u,y.x,y.y)&&Zn(y.prev,y,y.next)>=0)return!1;y=y.next}return!0}function J5(n,e,t,i){const r=n.prev,s=n,o=n.next;if(Zn(r,s,o)>=0)return!1;const a=r.x,l=s.x,u=o.x,d=r.y,f=s.y,p=o.y,_=a<l?a<u?a:u:l<u?l:u,y=d<f?d<p?d:p:f<p?f:p,w=a>l?a>u?a:u:l>u?l:u,A=d>f?d>p?d:p:f>p?f:p,b=g0(_,y,e,t,i),C=g0(w,A,e,t,i);let T=n.prevZ,I=n.nextZ;for(;T&&T.z>=b&&I&&I.z<=C;){if(T.x>=_&&T.x<=w&&T.y>=y&&T.y<=A&&T!==r&&T!==o&&tu(a,d,l,f,u,p,T.x,T.y)&&Zn(T.prev,T,T.next)>=0||(T=T.prevZ,I.x>=_&&I.x<=w&&I.y>=y&&I.y<=A&&I!==r&&I!==o&&tu(a,d,l,f,u,p,I.x,I.y)&&Zn(I.prev,I,I.next)>=0))return!1;I=I.nextZ}for(;T&&T.z>=b;){if(T.x>=_&&T.x<=w&&T.y>=y&&T.y<=A&&T!==r&&T!==o&&tu(a,d,l,f,u,p,T.x,T.y)&&Zn(T.prev,T,T.next)>=0)return!1;T=T.prevZ}for(;I&&I.z<=C;){if(I.x>=_&&I.x<=w&&I.y>=y&&I.y<=A&&I!==r&&I!==o&&tu(a,d,l,f,u,p,I.x,I.y)&&Zn(I.prev,I,I.next)>=0)return!1;I=I.nextZ}return!0}function K5(n,e,t){let i=n;do{const r=i.prev,s=i.next.next;!im(r,s)&&ZD(r,i,i.next,s)&&Jh(r,s)&&Jh(s,r)&&(e.push(r.i/t|0),e.push(i.i/t|0),e.push(s.i/t|0),Kh(i),Kh(i.next),i=n=s),i=i.next}while(i!==n);return rl(i)}function Q5(n,e,t,i,r,s){let o=n;do{let a=o.next.next;for(;a!==o.prev;){if(o.i!==a.i&&lW(o,a)){let l=JD(o,a);return o=rl(o,o.next),l=rl(l,l.next),Zh(o,e,t,i,r,s,0),void Zh(l,e,t,i,r,s,0)}a=a.next}o=o.next}while(o!==n)}function tW(n,e){return n.x-e.x}function nW(n,e){const t=function iW(n,e){let r,t=e,i=-1/0;const s=n.x,o=n.y;do{if(o<=t.y&&o>=t.next.y&&t.next.y!==t.y){const p=t.x+(o-t.y)*(t.next.x-t.x)/(t.next.y-t.y);if(p<=s&&p>i&&(i=p,r=t.x<t.next.x?t:t.next,p===s))return r}t=t.next}while(t!==e);if(!r)return null;const a=r,l=r.x,u=r.y;let f,d=1/0;t=r;do{s>=t.x&&t.x>=l&&s!==t.x&&tu(o<u?s:i,o,l,u,o<u?i:s,o,t.x,t.y)&&(f=Math.abs(o-t.y)/(s-t.x),Jh(t,n)&&(f<d||f===d&&(t.x>r.x||t.x===r.x&&rW(r,t)))&&(r=t,d=f)),t=t.next}while(t!==a);return r}(n,e);if(!t)return e;const i=JD(t,n);return rl(i,i.next),rl(t,t.next)}function rW(n,e){return Zn(n.prev,n,e.prev)<0&&Zn(e.next,n,n.next)<0}function g0(n,e,t,i,r){return(n=1431655765&((n=858993459&((n=252645135&((n=16711935&((n=(n-t)*r|0)|n<<8))|n<<4))|n<<2))|n<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-i)*r|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function aW(n){let e=n,t=n;do{(e.x<t.x||e.x===t.x&&e.y<t.y)&&(t=e),e=e.next}while(e!==n);return t}function tu(n,e,t,i,r,s,o,a){return(r-o)*(e-a)>=(n-o)*(s-a)&&(n-o)*(i-a)>=(t-o)*(e-a)&&(t-o)*(s-a)>=(r-o)*(i-a)}function lW(n,e){return n.next.i!==e.i&&n.prev.i!==e.i&&!function cW(n,e){let t=n;do{if(t.i!==n.i&&t.next.i!==n.i&&t.i!==e.i&&t.next.i!==e.i&&ZD(t,t.next,n,e))return!0;t=t.next}while(t!==n);return!1}(n,e)&&(Jh(n,e)&&Jh(e,n)&&function uW(n,e){let t=n,i=!1;const r=(n.x+e.x)/2,s=(n.y+e.y)/2;do{t.y>s!=t.next.y>s&&t.next.y!==t.y&&r<(t.next.x-t.x)*(s-t.y)/(t.next.y-t.y)+t.x&&(i=!i),t=t.next}while(t!==n);return i}(n,e)&&(Zn(n.prev,n,e.prev)||Zn(n,e.prev,e))||im(n,e)&&Zn(n.prev,n,n.next)>0&&Zn(e.prev,e,e.next)>0)}function Zn(n,e,t){return(e.y-n.y)*(t.x-e.x)-(e.x-n.x)*(t.y-e.y)}function im(n,e){return n.x===e.x&&n.y===e.y}function ZD(n,e,t,i){const r=sm(Zn(n,e,t)),s=sm(Zn(n,e,i)),o=sm(Zn(t,i,n)),a=sm(Zn(t,i,e));return!!(r!==s&&o!==a||0===r&&rm(n,t,e)||0===s&&rm(n,i,e)||0===o&&rm(t,n,i)||0===a&&rm(t,e,i))}function rm(n,e,t){return e.x<=Math.max(n.x,t.x)&&e.x>=Math.min(n.x,t.x)&&e.y<=Math.max(n.y,t.y)&&e.y>=Math.min(n.y,t.y)}function sm(n){return n>0?1:n<0?-1:0}function Jh(n,e){return Zn(n.prev,n,n.next)<0?Zn(n,e,n.next)>=0&&Zn(n,n.prev,e)>=0:Zn(n,e,n.prev)<0||Zn(n,n.next,e)<0}function JD(n,e){const t=new v0(n.i,n.x,n.y),i=new v0(e.i,e.x,e.y),r=n.next,s=e.prev;return n.next=e,e.prev=n,t.next=r,r.prev=t,i.next=t,t.prev=i,s.next=i,i.prev=s,i}function KD(n,e,t,i){const r=new v0(n,e,t);return i?(r.next=i.next,r.prev=i,i.next.prev=r,i.next=r):(r.prev=r,r.next=r),r}function Kh(n){n.next.prev=n.prev,n.prev.next=n.next,n.prevZ&&(n.prevZ.nextZ=n.nextZ),n.nextZ&&(n.nextZ.prevZ=n.prevZ)}function v0(n,e,t){this.i=n,this.x=e,this.y=t,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}class Co{static area(e){const t=e.length;let i=0;for(let r=t-1,s=0;s<t;r=s++)i+=e[r].x*e[s].y-e[s].x*e[r].y;return.5*i}static isClockWise(e){return Co.area(e)<0}static triangulateShape(e,t){const i=[],r=[],s=[];QD(e),e1(i,e);let o=e.length;t.forEach(QD);for(let l=0;l<t.length;l++)r.push(o),o+=t[l].length,e1(i,t[l]);const a=function(n,e,t=2){const i=e&&e.length,r=i?e[0]*t:n.length;let s=YD(n,0,r,t,!0);const o=[];if(!s||s.next===s.prev)return o;let a,l,u,d,f,p,_;if(i&&(s=function eW(n,e,t,i){const r=[];let s,o,a,l,u;for(s=0,o=e.length;s<o;s++)a=e[s]*i,l=s<o-1?e[s+1]*i:n.length,u=YD(n,a,l,i,!1),u===u.next&&(u.steiner=!0),r.push(aW(u));for(r.sort(tW),s=0;s<r.length;s++)t=nW(r[s],t);return t}(n,e,s,t)),n.length>80*t){a=u=n[0],l=d=n[1];for(let y=t;y<r;y+=t)f=n[y],p=n[y+1],f<a&&(a=f),p<l&&(l=p),f>u&&(u=f),p>d&&(d=p);_=Math.max(u-a,d-l),_=0!==_?32767/_:0}return Zh(s,o,t,a,l,_,0),o}(i,r);for(let l=0;l<a.length;l+=3)s.push(a.slice(l,l+3));return s}}function QD(n){const e=n.length;e>2&&n[e-1].equals(n[0])&&n.pop()}function e1(n,e){for(let t=0;t<e.length;t++)n.push(e[t].x),n.push(e[t].y)}class nu extends hn{constructor(e=new To([new Be(.5,.5),new Be(-.5,.5),new Be(-.5,-.5),new Be(.5,-.5)]),t={}){super(),this.type="ExtrudeGeometry",this.parameters={shapes:e,options:t},e=Array.isArray(e)?e:[e];const i=this,r=[],s=[];for(let a=0,l=e.length;a<l;a++)o(e[a]);function o(a){const l=[],u=void 0!==t.curveSegments?t.curveSegments:12,d=void 0!==t.steps?t.steps:1,f=void 0!==t.depth?t.depth:1;let p=void 0===t.bevelEnabled||t.bevelEnabled,_=void 0!==t.bevelThickness?t.bevelThickness:.2,y=void 0!==t.bevelSize?t.bevelSize:_-.1,w=void 0!==t.bevelOffset?t.bevelOffset:0,A=void 0!==t.bevelSegments?t.bevelSegments:3;const b=t.extrudePath,C=void 0!==t.UVGenerator?t.UVGenerator:dW;let T,N,k,G,K,I=!1;b&&(T=b.getSpacedPoints(d),I=!0,p=!1,N=b.computeFrenetFrames(d,!1),k=new q,G=new q,K=new q),p||(A=0,_=0,y=0,w=0);const L=a.extractPoints(u);let H=L.shape;const me=L.holes;if(!Co.isClockWise(H)){H=H.reverse();for(let te=0,Ze=me.length;te<Ze;te++){const Re=me[te];Co.isClockWise(Re)&&(me[te]=Re.reverse())}}const le=Co.triangulateShape(H,me),ue=H;for(let te=0,Ze=me.length;te<Ze;te++)H=H.concat(me[te]);function _e(te,Ze,Re){return Ze||console.error("THREE.ExtrudeGeometry: vec does not exist"),te.clone().addScaledVector(Ze,Re)}const Le=H.length,Se=le.length;function De(te,Ze,Re){let je,ke,It;const ft=te.x-Ze.x,vt=te.y-Ze.y,Qt=Re.x-te.x,yn=Re.y-te.y,ri=ft*ft+vt*vt;if(Math.abs(ft*yn-vt*Qt)>Number.EPSILON){const z=Math.sqrt(ri),be=Math.sqrt(Qt*Qt+yn*yn),We=Ze.x-vt/z,qe=Ze.y+ft/z,ot=((Re.x-yn/be-We)*yn-(Re.y+Qt/be-qe)*Qt)/(ft*yn-vt*Qt);je=We+ft*ot-te.x,ke=qe+vt*ot-te.y;const Ee=je*je+ke*ke;if(Ee<=2)return new Be(je,ke);It=Math.sqrt(Ee/2)}else{let z=!1;ft>Number.EPSILON?Qt>Number.EPSILON&&(z=!0):ft<-Number.EPSILON?Qt<-Number.EPSILON&&(z=!0):Math.sign(vt)===Math.sign(yn)&&(z=!0),z?(je=-vt,ke=ft,It=Math.sqrt(ri)):(je=ft,ke=vt,It=Math.sqrt(ri/2))}return new Be(je/It,ke/It)}const Fe=[];for(let te=0,Ze=ue.length,Re=Ze-1,je=te+1;te<Ze;te++,Re++,je++)Re===Ze&&(Re=0),je===Ze&&(je=0),Fe[te]=De(ue[te],ue[Re],ue[je]);const Ve=[];let he,Ce=Fe.concat();for(let te=0,Ze=me.length;te<Ze;te++){const Re=me[te];he=[];for(let je=0,ke=Re.length,It=ke-1,ft=je+1;je<ke;je++,It++,ft++)It===ke&&(It=0),ft===ke&&(ft=0),he[je]=De(Re[je],Re[It],Re[ft]);Ve.push(he),Ce=Ce.concat(he)}for(let te=0;te<A;te++){const Ze=te/A,Re=_*Math.cos(Ze*Math.PI/2),je=y*Math.sin(Ze*Math.PI/2)+w;for(let ke=0,It=ue.length;ke<It;ke++){const ft=_e(ue[ke],Fe[ke],je);Ct(ft.x,ft.y,-Re)}for(let ke=0,It=me.length;ke<It;ke++){const ft=me[ke];he=Ve[ke];for(let vt=0,Qt=ft.length;vt<Qt;vt++){const yn=_e(ft[vt],he[vt],je);Ct(yn.x,yn.y,-Re)}}}const Ye=y+w;for(let te=0;te<Le;te++){const Ze=p?_e(H[te],Ce[te],Ye):H[te];I?(G.copy(N.normals[0]).multiplyScalar(Ze.x),k.copy(N.binormals[0]).multiplyScalar(Ze.y),K.copy(T[0]).add(G).add(k),Ct(K.x,K.y,K.z)):Ct(Ze.x,Ze.y,0)}for(let te=1;te<=d;te++)for(let Ze=0;Ze<Le;Ze++){const Re=p?_e(H[Ze],Ce[Ze],Ye):H[Ze];I?(G.copy(N.normals[te]).multiplyScalar(Re.x),k.copy(N.binormals[te]).multiplyScalar(Re.y),K.copy(T[te]).add(G).add(k),Ct(K.x,K.y,K.z)):Ct(Re.x,Re.y,f/d*te)}for(let te=A-1;te>=0;te--){const Ze=te/A,Re=_*Math.cos(Ze*Math.PI/2),je=y*Math.sin(Ze*Math.PI/2)+w;for(let ke=0,It=ue.length;ke<It;ke++){const ft=_e(ue[ke],Fe[ke],je);Ct(ft.x,ft.y,f+Re)}for(let ke=0,It=me.length;ke<It;ke++){const ft=me[ke];he=Ve[ke];for(let vt=0,Qt=ft.length;vt<Qt;vt++){const yn=_e(ft[vt],he[vt],je);I?Ct(yn.x,yn.y+T[d-1].y,T[d-1].x+Re):Ct(yn.x,yn.y,f+Re)}}}function gt(te,Ze){let Re=te.length;for(;--Re>=0;){const je=Re;let ke=Re-1;ke<0&&(ke=te.length-1);for(let It=0,ft=d+2*A;It<ft;It++){const vt=Le*It,Qt=Le*(It+1);Tn(Ze+je+vt,Ze+ke+vt,Ze+ke+Qt,Ze+je+Qt)}}}function Ct(te,Ze,Re){l.push(te),l.push(Ze),l.push(Re)}function wt(te,Ze,Re){Dn(te),Dn(Ze),Dn(Re);const je=r.length/3,ke=C.generateTopUV(i,r,je-3,je-2,je-1);Nt(ke[0]),Nt(ke[1]),Nt(ke[2])}function Tn(te,Ze,Re,je){Dn(te),Dn(Ze),Dn(je),Dn(Ze),Dn(Re),Dn(je);const ke=r.length/3,It=C.generateSideWallUV(i,r,ke-6,ke-3,ke-2,ke-1);Nt(It[0]),Nt(It[1]),Nt(It[3]),Nt(It[1]),Nt(It[2]),Nt(It[3])}function Dn(te){r.push(l[3*te+0]),r.push(l[3*te+1]),r.push(l[3*te+2])}function Nt(te){s.push(te.x),s.push(te.y)}(function tt(){const te=r.length/3;if(p){let Ze=0,Re=Le*Ze;for(let je=0;je<Se;je++){const ke=le[je];wt(ke[2]+Re,ke[1]+Re,ke[0]+Re)}Ze=d+2*A,Re=Le*Ze;for(let je=0;je<Se;je++){const ke=le[je];wt(ke[0]+Re,ke[1]+Re,ke[2]+Re)}}else{for(let Ze=0;Ze<Se;Ze++){const Re=le[Ze];wt(Re[2],Re[1],Re[0])}for(let Ze=0;Ze<Se;Ze++){const Re=le[Ze];wt(Re[0]+Le*d,Re[1]+Le*d,Re[2]+Le*d)}}i.addGroup(te,r.length/3-te,0)})(),function it(){const te=r.length/3;let Ze=0;gt(ue,Ze),Ze+=ue.length;for(let Re=0,je=me.length;Re<je;Re++){const ke=me[Re];gt(ke,Ze),Ze+=ke.length}i.addGroup(te,r.length/3-te,1)}()}this.setAttribute("position",new ht(r,3)),this.setAttribute("uv",new ht(s,2)),this.computeVertexNormals()}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}toJSON(){const e=super.toJSON();return function fW(n,e,t){if(t.shapes=[],Array.isArray(n))for(let i=0,r=n.length;i<r;i++)t.shapes.push(n[i].uuid);else t.shapes.push(n.uuid);return t.options=Object.assign({},e),void 0!==e.extrudePath&&(t.options.extrudePath=e.extrudePath.toJSON()),t}(this.parameters.shapes,this.parameters.options,e)}static fromJSON(e,t){const i=[];for(let s=0,o=e.shapes.length;s<o;s++)i.push(t[e.shapes[s]]);const r=e.options.extrudePath;return void 0!==r&&(e.options.extrudePath=(new h0[r.type]).fromJSON(r)),new nu(i,e.options)}}const dW={generateTopUV:function(n,e,t,i,r){const a=e[3*i],l=e[3*i+1],u=e[3*r],d=e[3*r+1];return[new Be(e[3*t],e[3*t+1]),new Be(a,l),new Be(u,d)]},generateSideWallUV:function(n,e,t,i,r,s){const o=e[3*t],a=e[3*t+1],l=e[3*t+2],u=e[3*i],d=e[3*i+1],f=e[3*i+2],p=e[3*r],_=e[3*r+1],y=e[3*r+2],w=e[3*s],A=e[3*s+1],b=e[3*s+2];return Math.abs(a-d)<Math.abs(o-u)?[new Be(o,1-l),new Be(u,1-f),new Be(p,1-y),new Be(w,1-b)]:[new Be(a,1-l),new Be(d,1-f),new Be(_,1-y),new Be(A,1-b)]}};class lm extends $r{constructor(e){super(),this.isMeshStandardMaterial=!0,this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new Qe(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Qe(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new Be(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.defines={STANDARD:""},this.color.copy(e.color),this.roughness=e.roughness,this.metalness=e.metalness,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.roughnessMap=e.roughnessMap,this.metalnessMap=e.metalnessMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapIntensity=e.envMapIntensity,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class Do extends lm{constructor(e){super(),this.isMeshPhysicalMaterial=!0,this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.anisotropyRotation=0,this.anisotropyMap=null,this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new Be(1,1),this.clearcoatNormalMap=null,this.ior=1.5,Object.defineProperty(this,"reflectivity",{get:function(){return ti(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(t){this.ior=(1+.4*t)/(1-.4*t)}}),this.iridescenceMap=null,this.iridescenceIOR=1.3,this.iridescenceThicknessRange=[100,400],this.iridescenceThicknessMap=null,this.sheenColor=new Qe(0),this.sheenColorMap=null,this.sheenRoughness=1,this.sheenRoughnessMap=null,this.transmissionMap=null,this.thickness=0,this.thicknessMap=null,this.attenuationDistance=1/0,this.attenuationColor=new Qe(1,1,1),this.specularIntensity=1,this.specularIntensityMap=null,this.specularColor=new Qe(1,1,1),this.specularColorMap=null,this._anisotropy=0,this._clearcoat=0,this._iridescence=0,this._sheen=0,this._transmission=0,this.setValues(e)}get anisotropy(){return this._anisotropy}set anisotropy(e){this._anisotropy>0!=e>0&&this.version++,this._anisotropy=e}get clearcoat(){return this._clearcoat}set clearcoat(e){this._clearcoat>0!=e>0&&this.version++,this._clearcoat=e}get iridescence(){return this._iridescence}set iridescence(e){this._iridescence>0!=e>0&&this.version++,this._iridescence=e}get sheen(){return this._sheen}set sheen(e){this._sheen>0!=e>0&&this.version++,this._sheen=e}get transmission(){return this._transmission}set transmission(e){this._transmission>0!=e>0&&this.version++,this._transmission=e}copy(e){return super.copy(e),this.defines={STANDARD:"",PHYSICAL:""},this.anisotropy=e.anisotropy,this.anisotropyRotation=e.anisotropyRotation,this.anisotropyMap=e.anisotropyMap,this.clearcoat=e.clearcoat,this.clearcoatMap=e.clearcoatMap,this.clearcoatRoughness=e.clearcoatRoughness,this.clearcoatRoughnessMap=e.clearcoatRoughnessMap,this.clearcoatNormalMap=e.clearcoatNormalMap,this.clearcoatNormalScale.copy(e.clearcoatNormalScale),this.ior=e.ior,this.iridescence=e.iridescence,this.iridescenceMap=e.iridescenceMap,this.iridescenceIOR=e.iridescenceIOR,this.iridescenceThicknessRange=[...e.iridescenceThicknessRange],this.iridescenceThicknessMap=e.iridescenceThicknessMap,this.sheen=e.sheen,this.sheenColor.copy(e.sheenColor),this.sheenColorMap=e.sheenColorMap,this.sheenRoughness=e.sheenRoughness,this.sheenRoughnessMap=e.sheenRoughnessMap,this.transmission=e.transmission,this.transmissionMap=e.transmissionMap,this.thickness=e.thickness,this.thicknessMap=e.thicknessMap,this.attenuationDistance=e.attenuationDistance,this.attenuationColor.copy(e.attenuationColor),this.specularIntensity=e.specularIntensity,this.specularIntensityMap=e.specularIntensityMap,this.specularColor.copy(e.specularColor),this.specularColorMap=e.specularColorMap,this}}class cm extends $r{constructor(e){super(),this.isMeshLambertMaterial=!0,this.type="MeshLambertMaterial",this.color=new Qe(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Qe(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new Be(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=cp,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}function Jr(n,e,t){return E0(n)?new n.constructor(n.subarray(e,void 0!==t?t:n.length)):n.slice(e,t)}function sl(n,e,t){return!n||!t&&n.constructor===e?n:"number"==typeof e.BYTES_PER_ELEMENT?new e(n):Array.prototype.slice.call(n)}function E0(n){return ArrayBuffer.isView(n)&&!(n instanceof DataView)}function i1(n){const t=n.length,i=new Array(t);for(let r=0;r!==t;++r)i[r]=r;return i.sort(function e(r,s){return n[r]-n[s]}),i}function T0(n,e,t){const i=n.length,r=new n.constructor(i);for(let s=0,o=0;o!==i;++s){const a=t[s]*e;for(let l=0;l!==e;++l)r[o++]=n[a+l]}return r}function C0(n,e,t,i){let r=1,s=n[0];for(;void 0!==s&&void 0===s[i];)s=n[r++];if(void 0===s)return;let o=s[i];if(void 0!==o)if(Array.isArray(o))do{o=s[i],void 0!==o&&(e.push(s.time),t.push.apply(t,o)),s=n[r++]}while(void 0!==s);else if(void 0!==o.toArray)do{o=s[i],void 0!==o&&(e.push(s.time),o.toArray(t,t.length)),s=n[r++]}while(void 0!==s);else do{o=s[i],void 0!==o&&(e.push(s.time),t.push(o)),s=n[r++]}while(void 0!==s)}class Qh{constructor(e,t,i,r){this.parameterPositions=e,this._cachedIndex=0,this.resultBuffer=void 0!==r?r:new t.constructor(i),this.sampleValues=t,this.valueSize=i,this.settings=null,this.DefaultSettings_={}}evaluate(e){const t=this.parameterPositions;let i=this._cachedIndex,r=t[i],s=t[i-1];e:{t:{let o;n:{i:if(!(e<r)){for(let a=i+2;;){if(void 0===r){if(e<s)break i;return i=t.length,this._cachedIndex=i,this.copySampleValue_(i-1)}if(i===a)break;if(s=r,r=t[++i],e<r)break t}o=t.length;break n}if(e>=s)break e;{const a=t[1];e<a&&(i=2,s=a);for(let l=i-2;;){if(void 0===s)return this._cachedIndex=0,this.copySampleValue_(0);if(i===l)break;if(r=s,s=t[--i-1],e>=s)break t}o=i,i=0}}for(;i<o;){const a=i+o>>>1;e<t[a]?o=a:i=a+1}if(r=t[i],s=t[i-1],void 0===s)return this._cachedIndex=0,this.copySampleValue_(0);if(void 0===r)return i=t.length,this._cachedIndex=i,this.copySampleValue_(i-1)}this._cachedIndex=i,this.intervalChanged_(i,s,r)}return this.interpolate_(i,s,e,r)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(e){const t=this.resultBuffer,i=this.sampleValues,r=this.valueSize,s=e*r;for(let o=0;o!==r;++o)t[o]=i[s+o];return t}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}}class SW extends Qh{constructor(e,t,i,r){super(e,t,i,r),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:2400,endingEnd:2400}}intervalChanged_(e,t,i){const r=this.parameterPositions;let s=e-2,o=e+1,a=r[s],l=r[o];if(void 0===a)switch(this.getSettings_().endingStart){case 2401:s=e,a=2*t-i;break;case 2402:s=r.length-2,a=t+r[s]-r[s+1];break;default:s=e,a=i}if(void 0===l)switch(this.getSettings_().endingEnd){case 2401:o=e,l=2*i-t;break;case 2402:o=1,l=i+r[1]-r[0];break;default:o=e-1,l=t}const u=.5*(i-t),d=this.valueSize;this._weightPrev=u/(t-a),this._weightNext=u/(l-i),this._offsetPrev=s*d,this._offsetNext=o*d}interpolate_(e,t,i,r){const s=this.resultBuffer,o=this.sampleValues,a=this.valueSize,l=e*a,u=l-a,d=this._offsetPrev,f=this._offsetNext,p=this._weightPrev,_=this._weightNext,y=(i-t)/(r-t),w=y*y,A=w*y,b=-p*A+2*p*w-p*y,C=(1+p)*A+(-1.5-2*p)*w+(-.5+p)*y+1,T=(-1-_)*A+(1.5+_)*w+.5*y,I=_*A-_*w;for(let N=0;N!==a;++N)s[N]=b*o[d+N]+C*o[u+N]+T*o[l+N]+I*o[f+N];return s}}class r1 extends Qh{constructor(e,t,i,r){super(e,t,i,r)}interpolate_(e,t,i,r){const s=this.resultBuffer,o=this.sampleValues,a=this.valueSize,l=e*a,u=l-a,d=(i-t)/(r-t),f=1-d;for(let p=0;p!==a;++p)s[p]=o[u+p]*f+o[l+p]*d;return s}}class EW extends Qh{constructor(e,t,i,r){super(e,t,i,r)}interpolate_(e){return this.copySampleValue_(e-1)}}class qs{constructor(e,t,i,r){if(void 0===e)throw new Error("THREE.KeyframeTrack: track name is undefined");if(void 0===t||0===t.length)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+e);this.name=e,this.times=sl(t,this.TimeBufferType),this.values=sl(i,this.ValueBufferType),this.setInterpolation(r||this.DefaultInterpolation)}static toJSON(e){const t=e.constructor;let i;if(t.toJSON!==this.toJSON)i=t.toJSON(e);else{i={name:e.name,times:sl(e.times,Array),values:sl(e.values,Array)};const r=e.getInterpolation();r!==e.DefaultInterpolation&&(i.interpolation=r)}return i.type=e.ValueTypeName,i}InterpolantFactoryMethodDiscrete(e){return new EW(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodLinear(e){return new r1(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodSmooth(e){return new SW(this.times,this.values,this.getValueSize(),e)}setInterpolation(e){let t;switch(e){case Ih:t=this.InterpolantFactoryMethodDiscrete;break;case bc:t=this.InterpolantFactoryMethodLinear;break;case 2302:t=this.InterpolantFactoryMethodSmooth}if(void 0===t){const i="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(void 0===this.createInterpolant){if(e===this.DefaultInterpolation)throw new Error(i);this.setInterpolation(this.DefaultInterpolation)}return console.warn("THREE.KeyframeTrack:",i),this}return this.createInterpolant=t,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return Ih;case this.InterpolantFactoryMethodLinear:return bc;case this.InterpolantFactoryMethodSmooth:return 2302}}getValueSize(){return this.values.length/this.times.length}shift(e){if(0!==e){const t=this.times;for(let i=0,r=t.length;i!==r;++i)t[i]+=e}return this}scale(e){if(1!==e){const t=this.times;for(let i=0,r=t.length;i!==r;++i)t[i]*=e}return this}trim(e,t){const i=this.times,r=i.length;let s=0,o=r-1;for(;s!==r&&i[s]<e;)++s;for(;-1!==o&&i[o]>t;)--o;if(++o,0!==s||o!==r){s>=o&&(o=Math.max(o,1),s=o-1);const a=this.getValueSize();this.times=Jr(i,s,o),this.values=Jr(this.values,s*a,o*a)}return this}validate(){let e=!0;const t=this.getValueSize();t-Math.floor(t)!=0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),e=!1);const i=this.times,r=this.values,s=i.length;0===s&&(console.error("THREE.KeyframeTrack: Track is empty.",this),e=!1);let o=null;for(let a=0;a!==s;a++){const l=i[a];if("number"==typeof l&&isNaN(l)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,a,l),e=!1;break}if(null!==o&&o>l){console.error("THREE.KeyframeTrack: Out of order keys.",this,a,l,o),e=!1;break}o=l}if(void 0!==r&&E0(r))for(let a=0,l=r.length;a!==l;++a){const u=r[a];if(isNaN(u)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,a,u),e=!1;break}}return e}optimize(){const e=Jr(this.times),t=Jr(this.values),i=this.getValueSize(),r=2302===this.getInterpolation(),s=e.length-1;let o=1;for(let a=1;a<s;++a){let l=!1;const u=e[a];if(u!==e[a+1]&&(1!==a||u!==e[0]))if(r)l=!0;else{const f=a*i,p=f-i,_=f+i;for(let y=0;y!==i;++y){const w=t[f+y];if(w!==t[p+y]||w!==t[_+y]){l=!0;break}}}if(l){if(a!==o){e[o]=e[a];const f=a*i,p=o*i;for(let _=0;_!==i;++_)t[p+_]=t[f+_]}++o}}if(s>0){e[o]=e[s];for(let a=s*i,l=o*i,u=0;u!==i;++u)t[l+u]=t[a+u];++o}return o!==e.length?(this.times=Jr(e,0,o),this.values=Jr(t,0,o*i)):(this.times=e,this.values=t),this}clone(){const e=Jr(this.times,0),t=Jr(this.values,0),r=new(0,this.constructor)(this.name,e,t);return r.createInterpolant=this.createInterpolant,r}}qs.prototype.TimeBufferType=Float32Array,qs.prototype.ValueBufferType=Float32Array,qs.prototype.DefaultInterpolation=bc;class iu extends qs{}iu.prototype.ValueTypeName="bool",iu.prototype.ValueBufferType=Array,iu.prototype.DefaultInterpolation=Ih,iu.prototype.InterpolantFactoryMethodLinear=void 0,iu.prototype.InterpolantFactoryMethodSmooth=void 0;class s1 extends qs{}s1.prototype.ValueTypeName="color";class ru extends qs{}ru.prototype.ValueTypeName="number";class TW extends Qh{constructor(e,t,i,r){super(e,t,i,r)}interpolate_(e,t,i,r){const s=this.resultBuffer,o=this.sampleValues,a=this.valueSize,l=(i-t)/(r-t);let u=e*a;for(let d=u+a;u!==d;u+=4)Yi.slerpFlat(s,0,o,u-a,o,u,l);return s}}class ol extends qs{InterpolantFactoryMethodLinear(e){return new TW(this.times,this.values,this.getValueSize(),e)}}ol.prototype.ValueTypeName="quaternion",ol.prototype.DefaultInterpolation=bc,ol.prototype.InterpolantFactoryMethodSmooth=void 0;class su extends qs{}su.prototype.ValueTypeName="string",su.prototype.ValueBufferType=Array,su.prototype.DefaultInterpolation=Ih,su.prototype.InterpolantFactoryMethodLinear=void 0,su.prototype.InterpolantFactoryMethodSmooth=void 0;class ed extends qs{}ed.prototype.ValueTypeName="vector";class td{constructor(e,t=-1,i,r=2500){this.name=e,this.tracks=i,this.duration=t,this.blendMode=r,this.uuid=Ir(),this.duration<0&&this.resetDuration()}static parse(e){const t=[],i=e.tracks,r=1/(e.fps||1);for(let o=0,a=i.length;o!==a;++o)t.push(DW(i[o]).scale(r));const s=new this(e.name,e.duration,t,e.blendMode);return s.uuid=e.uuid,s}static toJSON(e){const t=[],i=e.tracks,r={name:e.name,duration:e.duration,tracks:t,uuid:e.uuid,blendMode:e.blendMode};for(let s=0,o=i.length;s!==o;++s)t.push(qs.toJSON(i[s]));return r}static CreateFromMorphTargetSequence(e,t,i,r){const s=t.length,o=[];for(let a=0;a<s;a++){let l=[],u=[];l.push((a+s-1)%s,a,(a+1)%s),u.push(0,1,0);const d=i1(l);l=T0(l,1,d),u=T0(u,1,d),!r&&0===l[0]&&(l.push(s),u.push(u[0])),o.push(new ru(".morphTargetInfluences["+t[a].name+"]",l,u).scale(1/i))}return new this(e,-1,o)}static findByName(e,t){let i=e;Array.isArray(e)||(i=e.geometry&&e.geometry.animations||e.animations);for(let r=0;r<i.length;r++)if(i[r].name===t)return i[r];return null}static CreateClipsFromMorphTargetSequences(e,t,i){const r={},s=/^([\w-]*?)([\d]+)$/;for(let a=0,l=e.length;a<l;a++){const u=e[a],d=u.name.match(s);if(d&&d.length>1){const f=d[1];let p=r[f];p||(r[f]=p=[]),p.push(u)}}const o=[];for(const a in r)o.push(this.CreateFromMorphTargetSequence(a,r[a],t,i));return o}static parseAnimation(e,t){if(!e)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;const i=function(f,p,_,y,w){if(0!==_.length){const A=[],b=[];C0(_,A,b,y),0!==A.length&&w.push(new f(p,A,b))}},r=[],s=e.name||"default",o=e.fps||30,a=e.blendMode;let l=e.length||-1;const u=e.hierarchy||[];for(let f=0;f<u.length;f++){const p=u[f].keys;if(p&&0!==p.length)if(p[0].morphTargets){const _={};let y;for(y=0;y<p.length;y++)if(p[y].morphTargets)for(let w=0;w<p[y].morphTargets.length;w++)_[p[y].morphTargets[w]]=-1;for(const w in _){const A=[],b=[];for(let C=0;C!==p[y].morphTargets.length;++C){const T=p[y];A.push(T.time),b.push(T.morphTarget===w?1:0)}r.push(new ru(".morphTargetInfluence["+w+"]",A,b))}l=_.length*o}else{const _=".bones["+t[f].name+"]";i(ed,_+".position",p,"pos",r),i(ol,_+".quaternion",p,"rot",r),i(ed,_+".scale",p,"scl",r)}}return 0===r.length?null:new this(s,l,r,a)}resetDuration(){let t=0;for(let i=0,r=this.tracks.length;i!==r;++i){const s=this.tracks[i];t=Math.max(t,s.times[s.times.length-1])}return this.duration=t,this}trim(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].trim(0,this.duration);return this}validate(){let e=!0;for(let t=0;t<this.tracks.length;t++)e=e&&this.tracks[t].validate();return e}optimize(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].optimize();return this}clone(){const e=[];for(let t=0;t<this.tracks.length;t++)e.push(this.tracks[t].clone());return new this.constructor(this.name,this.duration,e,this.blendMode)}toJSON(){return this.constructor.toJSON(this)}}function DW(n){if(void 0===n.type)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");const e=function CW(n){switch(n.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return ru;case"vector":case"vector2":case"vector3":case"vector4":return ed;case"color":return s1;case"quaternion":return ol;case"bool":case"boolean":return iu;case"string":return su}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+n)}(n.type);if(void 0===n.times){const t=[],i=[];C0(n.keys,t,i,"value"),n.times=t,n.values=i}return void 0!==e.parse?e.parse(n):new e(n.name,n.times,n.values,n.interpolation)}const ou={enabled:!1,files:{},add:function(n,e){!1!==this.enabled&&(this.files[n]=e)},get:function(n){if(!1!==this.enabled)return this.files[n]},remove:function(n){delete this.files[n]},clear:function(){this.files={}}};class o1{constructor(e,t,i){const r=this;let l,s=!1,o=0,a=0;const u=[];this.onStart=void 0,this.onLoad=e,this.onProgress=t,this.onError=i,this.itemStart=function(d){a++,!1===s&&void 0!==r.onStart&&r.onStart(d,o,a),s=!0},this.itemEnd=function(d){o++,void 0!==r.onProgress&&r.onProgress(d,o,a),o===a&&(s=!1,void 0!==r.onLoad&&r.onLoad())},this.itemError=function(d){void 0!==r.onError&&r.onError(d)},this.resolveURL=function(d){return l?l(d):d},this.setURLModifier=function(d){return l=d,this},this.addHandler=function(d,f){return u.push(d,f),this},this.removeHandler=function(d){const f=u.indexOf(d);return-1!==f&&u.splice(f,2),this},this.getHandler=function(d){for(let f=0,p=u.length;f<p;f+=2){const _=u[f],y=u[f+1];if(_.global&&(_.lastIndex=0),_.test(d))return y}return null}}}const a1=new o1;let nd=(()=>{class n{constructor(t){this.manager=void 0!==t?t:a1,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(t,i){const r=this;return new Promise(function(s,o){r.load(t,s,i,o)})}parse(){}setCrossOrigin(t){return this.crossOrigin=t,this}setWithCredentials(t){return this.withCredentials=t,this}setPath(t){return this.path=t,this}setResourcePath(t){return this.resourcePath=t,this}setRequestHeader(t){return this.requestHeader=t,this}}return n.DEFAULT_MATERIAL_NAME="__DEFAULT",n})();const Io={};class IW extends Error{constructor(e,t){super(e),this.response=t}}class bs extends nd{constructor(e){super(e)}load(e,t,i,r){void 0===e&&(e=""),void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);const s=ou.get(e);if(void 0!==s)return this.manager.itemStart(e),setTimeout(()=>{t&&t(s),this.manager.itemEnd(e)},0),s;if(void 0!==Io[e])return void Io[e].push({onLoad:t,onProgress:i,onError:r});Io[e]=[],Io[e].push({onLoad:t,onProgress:i,onError:r});const o=new Request(e,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"}),a=this.mimeType,l=this.responseType;fetch(o).then(u=>{if(200===u.status||0===u.status){if(0===u.status&&console.warn("THREE.FileLoader: HTTP Status 0 received."),typeof ReadableStream>"u"||void 0===u.body||void 0===u.body.getReader)return u;const d=Io[e],f=u.body.getReader(),p=u.headers.get("Content-Length")||u.headers.get("X-File-Size"),_=p?parseInt(p):0,y=0!==_;let w=0;const A=new ReadableStream({start(b){!function C(){f.read().then(({done:T,value:I})=>{if(T)b.close();else{w+=I.byteLength;const N=new ProgressEvent("progress",{lengthComputable:y,loaded:w,total:_});for(let k=0,G=d.length;k<G;k++){const K=d[k];K.onProgress&&K.onProgress(N)}b.enqueue(I),C()}})}()}});return new Response(A)}throw new IW(`fetch for "${u.url}" responded with ${u.status}: ${u.statusText}`,u)}).then(u=>{switch(l){case"arraybuffer":return u.arrayBuffer();case"blob":return u.blob();case"document":return u.text().then(d=>(new DOMParser).parseFromString(d,a));case"json":return u.json();default:if(void 0===a)return u.text();{const f=/charset="?([^;"\s]*)"?/i.exec(a),p=f&&f[1]?f[1].toLowerCase():void 0,_=new TextDecoder(p);return u.arrayBuffer().then(y=>_.decode(y))}}}).then(u=>{ou.add(e,u);const d=Io[e];delete Io[e];for(let f=0,p=d.length;f<p;f++){const _=d[f];_.onLoad&&_.onLoad(u)}}).catch(u=>{const d=Io[e];if(void 0===d)throw this.manager.itemError(e),u;delete Io[e];for(let f=0,p=d.length;f<p;f++){const _=d[f];_.onError&&_.onError(u)}this.manager.itemError(e)}).finally(()=>{this.manager.itemEnd(e)}),this.manager.itemStart(e)}setResponseType(e){return this.responseType=e,this}setMimeType(e){return this.mimeType=e,this}}class um extends nd{constructor(e){super(e)}load(e,t,i,r){void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);const s=this,o=ou.get(e);if(void 0!==o)return s.manager.itemStart(e),setTimeout(function(){t&&t(o),s.manager.itemEnd(e)},0),o;const a=Ph("img");function l(){d(),ou.add(e,this),t&&t(this),s.manager.itemEnd(e)}function u(f){d(),r&&r(f),s.manager.itemError(e),s.manager.itemEnd(e)}function d(){a.removeEventListener("load",l,!1),a.removeEventListener("error",u,!1)}return a.addEventListener("load",l,!1),a.addEventListener("error",u,!1),"data:"!==e.slice(0,5)&&void 0!==this.crossOrigin&&(a.crossOrigin=this.crossOrigin),s.manager.itemStart(e),a.src=e,a}}class l1 extends nd{constructor(e){super(e)}load(e,t,i,r){const s=new _s,o=new um(this.manager);return o.setCrossOrigin(this.crossOrigin),o.setPath(this.path),o.load(e,function(a){s.image=a,s.needsUpdate=!0,void 0!==t&&t(s)},i,r),s}}class hm extends vi{constructor(e,t=1){super(),this.isLight=!0,this.type="Light",this.color=new Qe(e),this.intensity=t}dispose(){}copy(e,t){return super.copy(e,t),this.color.copy(e.color),this.intensity=e.intensity,this}toJSON(e){const t=super.toJSON(e);return t.object.color=this.color.getHex(),t.object.intensity=this.intensity,void 0!==this.groundColor&&(t.object.groundColor=this.groundColor.getHex()),void 0!==this.distance&&(t.object.distance=this.distance),void 0!==this.angle&&(t.object.angle=this.angle),void 0!==this.decay&&(t.object.decay=this.decay),void 0!==this.penumbra&&(t.object.penumbra=this.penumbra),void 0!==this.shadow&&(t.object.shadow=this.shadow.toJSON()),t}}const D0=new Wt,c1=new q,u1=new q;class I0{constructor(e){this.camera=e,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new Be(512,512),this.map=null,this.mapPass=null,this.matrix=new Wt,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new ky,this._frameExtents=new Be(1,1),this._viewportCount=1,this._viewports=[new Nn(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(e){const t=this.camera,i=this.matrix;c1.setFromMatrixPosition(e.matrixWorld),t.position.copy(c1),u1.setFromMatrixPosition(e.target.matrixWorld),t.lookAt(u1),t.updateMatrixWorld(),D0.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),this._frustum.setFromProjectionMatrix(D0),i.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),i.multiply(D0)}getViewport(e){return this._viewports[e]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(e){return this.camera=e.camera.clone(),this.bias=e.bias,this.radius=e.radius,this.mapSize.copy(e.mapSize),this}clone(){return(new this.constructor).copy(this)}toJSON(){const e={};return 0!==this.bias&&(e.bias=this.bias),0!==this.normalBias&&(e.normalBias=this.normalBias),1!==this.radius&&(e.radius=this.radius),(512!==this.mapSize.x||512!==this.mapSize.y)&&(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}}class PW extends I0{constructor(){super(new Fi(50,1,.5,500)),this.isSpotLightShadow=!0,this.focus=1}updateMatrices(e){const t=this.camera,i=2*Sc*e.angle*this.focus,r=this.mapSize.width/this.mapSize.height,s=e.distance||t.far;(i!==t.fov||r!==t.aspect||s!==t.far)&&(t.fov=i,t.aspect=r,t.far=s,t.updateProjectionMatrix()),super.updateMatrices(e)}copy(e){return super.copy(e),this.focus=e.focus,this}}class h1 extends hm{constructor(e,t,i=0,r=Math.PI/3,s=0,o=2){super(e,t),this.isSpotLight=!0,this.type="SpotLight",this.position.copy(vi.DEFAULT_UP),this.updateMatrix(),this.target=new vi,this.distance=i,this.angle=r,this.penumbra=s,this.decay=o,this.map=null,this.shadow=new PW}get power(){return this.intensity*Math.PI}set power(e){this.intensity=e/Math.PI}dispose(){this.shadow.dispose()}copy(e,t){return super.copy(e,t),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}const d1=new Wt,id=new q,R0=new q;class LW extends I0{constructor(){super(new Fi(90,1,.5,500)),this.isPointLightShadow=!0,this._frameExtents=new Be(4,2),this._viewportCount=6,this._viewports=[new Nn(2,1,1,1),new Nn(0,1,1,1),new Nn(3,1,1,1),new Nn(1,1,1,1),new Nn(3,0,1,1),new Nn(1,0,1,1)],this._cubeDirections=[new q(1,0,0),new q(-1,0,0),new q(0,0,1),new q(0,0,-1),new q(0,1,0),new q(0,-1,0)],this._cubeUps=[new q(0,1,0),new q(0,1,0),new q(0,1,0),new q(0,1,0),new q(0,0,1),new q(0,0,-1)]}updateMatrices(e,t=0){const i=this.camera,r=this.matrix,s=e.distance||i.far;s!==i.far&&(i.far=s,i.updateProjectionMatrix()),id.setFromMatrixPosition(e.matrixWorld),i.position.copy(id),R0.copy(i.position),R0.add(this._cubeDirections[t]),i.up.copy(this._cubeUps[t]),i.lookAt(R0),i.updateMatrixWorld(),r.makeTranslation(-id.x,-id.y,-id.z),d1.multiplyMatrices(i.projectionMatrix,i.matrixWorldInverse),this._frustum.setFromProjectionMatrix(d1)}}class f1 extends hm{constructor(e,t,i=0,r=2){super(e,t),this.isPointLight=!0,this.type="PointLight",this.distance=i,this.decay=r,this.shadow=new LW}get power(){return 4*this.intensity*Math.PI}set power(e){this.intensity=e/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(e,t){return super.copy(e,t),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}}class NW extends I0{constructor(){super(new Op(-5,5,5,-5,.5,500)),this.isDirectionalLightShadow=!0}}class P0 extends hm{constructor(e,t){super(e,t),this.isDirectionalLight=!0,this.type="DirectionalLight",this.position.copy(vi.DEFAULT_UP),this.updateMatrix(),this.target=new vi,this.shadow=new NW}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}class p1 extends hm{constructor(e,t){super(e,t),this.isAmbientLight=!0,this.type="AmbientLight"}}class rd{static decodeText(e){if(typeof TextDecoder<"u")return(new TextDecoder).decode(e);let t="";for(let i=0,r=e.length;i<r;i++)t+=String.fromCharCode(e[i]);try{return decodeURIComponent(escape(t))}catch{return t}}static extractUrlBase(e){const t=e.lastIndexOf("/");return-1===t?"./":e.slice(0,t+1)}static resolveURL(e,t){return"string"!=typeof e||""===e?"":(/^https?:\/\//i.test(t)&&/^\//.test(e)&&(t=t.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(e)||/^data:.*,.*$/i.test(e)||/^blob:.*$/i.test(e)?e:t+e)}}class zW extends nd{constructor(e){super(e),this.isImageBitmapLoader=!0,typeof createImageBitmap>"u"&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),typeof fetch>"u"&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),this.options={premultiplyAlpha:"none"}}setOptions(e){return this.options=e,this}load(e,t,i,r){void 0===e&&(e=""),void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);const s=this,o=ou.get(e);if(void 0!==o)return s.manager.itemStart(e),setTimeout(function(){t&&t(o),s.manager.itemEnd(e)},0),o;const a={};a.credentials="anonymous"===this.crossOrigin?"same-origin":"include",a.headers=this.requestHeader,fetch(e,a).then(function(l){return l.blob()}).then(function(l){return createImageBitmap(l,Object.assign(s.options,{colorSpaceConversion:"none"}))}).then(function(l){ou.add(e,l),t&&t(l),s.manager.itemEnd(e)}).catch(function(l){r&&r(l),s.manager.itemError(e),s.manager.itemEnd(e)}),s.manager.itemStart(e)}}class x1{constructor(e=!0){this.autoStart=e,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=b1(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let e=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){const t=b1();e=(t-this.oldTime)/1e3,this.oldTime=t,this.elapsedTime+=e}return e}}function b1(){return(typeof performance>"u"?Date:performance).now()}const N0="\\[\\]\\.:\\/",qW=new RegExp("["+N0+"]","g"),B0="[^"+N0+"]",jW="[^"+N0.replace("\\.","")+"]",JW=new RegExp("^"+/((?:WC+[\/:])*)/.source.replace("WC",B0)+/(WCOD+)?/.source.replace("WCOD",jW)+/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",B0)+/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",B0)+"$"),KW=["material","materials","bones","map"];class QW{constructor(e,t,i){const r=i||Vn.parseTrackName(t);this._targetGroup=e,this._bindings=e.subscribe_(t,r)}getValue(e,t){this.bind();const r=this._bindings[this._targetGroup.nCachedObjects_];void 0!==r&&r.getValue(e,t)}setValue(e,t){const i=this._bindings;for(let r=this._targetGroup.nCachedObjects_,s=i.length;r!==s;++r)i[r].setValue(e,t)}bind(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,i=e.length;t!==i;++t)e[t].bind()}unbind(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,i=e.length;t!==i;++t)e[t].unbind()}}let Vn=(()=>{class n{constructor(t,i,r){this.path=i,this.parsedPath=r||n.parseTrackName(i),this.node=n.findNode(t,this.parsedPath.nodeName),this.rootNode=t,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(t,i,r){return t&&t.isAnimationObjectGroup?new n.Composite(t,i,r):new n(t,i,r)}static sanitizeNodeName(t){return t.replace(/\s/g,"_").replace(qW,"")}static parseTrackName(t){const i=JW.exec(t);if(null===i)throw new Error("PropertyBinding: Cannot parse trackName: "+t);const r={nodeName:i[2],objectName:i[3],objectIndex:i[4],propertyName:i[5],propertyIndex:i[6]},s=r.nodeName&&r.nodeName.lastIndexOf(".");if(void 0!==s&&-1!==s){const o=r.nodeName.substring(s+1);-1!==KW.indexOf(o)&&(r.nodeName=r.nodeName.substring(0,s),r.objectName=o)}if(null===r.propertyName||0===r.propertyName.length)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+t);return r}static findNode(t,i){if(void 0===i||""===i||"."===i||-1===i||i===t.name||i===t.uuid)return t;if(t.skeleton){const r=t.skeleton.getBoneByName(i);if(void 0!==r)return r}if(t.children){const r=function(o){for(let a=0;a<o.length;a++){const l=o[a];if(l.name===i||l.uuid===i)return l;const u=r(l.children);if(u)return u}return null},s=r(t.children);if(s)return s}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(t,i){t[i]=this.targetObject[this.propertyName]}_getValue_array(t,i){const r=this.resolvedProperty;for(let s=0,o=r.length;s!==o;++s)t[i++]=r[s]}_getValue_arrayElement(t,i){t[i]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(t,i){this.resolvedProperty.toArray(t,i)}_setValue_direct(t,i){this.targetObject[this.propertyName]=t[i]}_setValue_direct_setNeedsUpdate(t,i){this.targetObject[this.propertyName]=t[i],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(t,i){this.targetObject[this.propertyName]=t[i],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(t,i){const r=this.resolvedProperty;for(let s=0,o=r.length;s!==o;++s)r[s]=t[i++]}_setValue_array_setNeedsUpdate(t,i){const r=this.resolvedProperty;for(let s=0,o=r.length;s!==o;++s)r[s]=t[i++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(t,i){const r=this.resolvedProperty;for(let s=0,o=r.length;s!==o;++s)r[s]=t[i++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(t,i){this.resolvedProperty[this.propertyIndex]=t[i]}_setValue_arrayElement_setNeedsUpdate(t,i){this.resolvedProperty[this.propertyIndex]=t[i],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(t,i){this.resolvedProperty[this.propertyIndex]=t[i],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(t,i){this.resolvedProperty.fromArray(t,i)}_setValue_fromArray_setNeedsUpdate(t,i){this.resolvedProperty.fromArray(t,i),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(t,i){this.resolvedProperty.fromArray(t,i),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(t,i){this.bind(),this.getValue(t,i)}_setValue_unbound(t,i){this.bind(),this.setValue(t,i)}bind(){let t=this.node;const i=this.parsedPath,r=i.objectName,s=i.propertyName;let o=i.propertyIndex;if(t||(t=n.findNode(this.rootNode,i.nodeName),this.node=t),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!t)return void console.error("THREE.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.");if(r){let d=i.objectIndex;switch(r){case"materials":if(!t.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!t.material.materials)return void console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);t=t.material.materials;break;case"bones":if(!t.skeleton)return void console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);t=t.skeleton.bones;for(let f=0;f<t.length;f++)if(t[f].name===d){d=f;break}break;case"map":if("map"in t){t=t.map;break}if(!t.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!t.material.map)return void console.error("THREE.PropertyBinding: Can not bind to material.map as node.material does not have a map.",this);t=t.material.map;break;default:if(void 0===t[r])return void console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);t=t[r]}if(void 0!==d){if(void 0===t[d])return void console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,t);t=t[d]}}const a=t[s];if(void 0===a)return void console.error("THREE.PropertyBinding: Trying to update property for track: "+i.nodeName+"."+s+" but it wasn't found.",t);let l=this.Versioning.None;this.targetObject=t,void 0!==t.needsUpdate?l=this.Versioning.NeedsUpdate:void 0!==t.matrixWorldNeedsUpdate&&(l=this.Versioning.MatrixWorldNeedsUpdate);let u=this.BindingType.Direct;if(void 0!==o){if("morphTargetInfluences"===s){if(!t.geometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);if(!t.geometry.morphAttributes)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);void 0!==t.morphTargetDictionary[o]&&(o=t.morphTargetDictionary[o])}u=this.BindingType.ArrayElement,this.resolvedProperty=a,this.propertyIndex=o}else void 0!==a.fromArray&&void 0!==a.toArray?(u=this.BindingType.HasFromToArray,this.resolvedProperty=a):Array.isArray(a)?(u=this.BindingType.EntireArray,this.resolvedProperty=a):this.propertyName=s;this.getValue=this.GetterByBindingType[u],this.setValue=this.SetterByBindingTypeAndVersioning[u][l]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}return n.Composite=QW,n})();Vn.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},Vn.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},Vn.prototype.GetterByBindingType=[Vn.prototype._getValue_direct,Vn.prototype._getValue_array,Vn.prototype._getValue_arrayElement,Vn.prototype._getValue_toArray],Vn.prototype.SetterByBindingTypeAndVersioning=[[Vn.prototype._setValue_direct,Vn.prototype._setValue_direct_setNeedsUpdate,Vn.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[Vn.prototype._setValue_array,Vn.prototype._setValue_array_setNeedsUpdate,Vn.prototype._setValue_array_setMatrixWorldNeedsUpdate],[Vn.prototype._setValue_arrayElement,Vn.prototype._setValue_arrayElement_setNeedsUpdate,Vn.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[Vn.prototype._setValue_fromArray,Vn.prototype._setValue_fromArray_setNeedsUpdate,Vn.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]],new Float32Array(1);const _m=new q,ii=new Oy;class r8 extends nl{constructor(e){const t=new hn,i=new rr({color:16777215,vertexColors:!0,toneMapped:!1}),r=[],s=[],o={};function a(y,w){l(y),l(w)}function l(y){r.push(0,0,0),s.push(0,0,0),void 0===o[y]&&(o[y]=[]),o[y].push(r.length/3-1)}a("n1","n2"),a("n2","n4"),a("n4","n3"),a("n3","n1"),a("f1","f2"),a("f2","f4"),a("f4","f3"),a("f3","f1"),a("n1","f1"),a("n2","f2"),a("n3","f3"),a("n4","f4"),a("p","n1"),a("p","n2"),a("p","n3"),a("p","n4"),a("u1","u2"),a("u2","u3"),a("u3","u1"),a("c","t"),a("p","c"),a("cn1","cn2"),a("cn3","cn4"),a("cf1","cf2"),a("cf3","cf4"),t.setAttribute("position",new ht(r,3)),t.setAttribute("color",new ht(s,3)),super(t,i),this.type="CameraHelper",this.camera=e,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=o,this.update();const u=new Qe(16755200),d=new Qe(16711680),f=new Qe(43775),p=new Qe(16777215),_=new Qe(3355443);this.setColors(u,d,f,p,_)}setColors(e,t,i,r,s){const a=this.geometry.getAttribute("color");a.setXYZ(0,e.r,e.g,e.b),a.setXYZ(1,e.r,e.g,e.b),a.setXYZ(2,e.r,e.g,e.b),a.setXYZ(3,e.r,e.g,e.b),a.setXYZ(4,e.r,e.g,e.b),a.setXYZ(5,e.r,e.g,e.b),a.setXYZ(6,e.r,e.g,e.b),a.setXYZ(7,e.r,e.g,e.b),a.setXYZ(8,e.r,e.g,e.b),a.setXYZ(9,e.r,e.g,e.b),a.setXYZ(10,e.r,e.g,e.b),a.setXYZ(11,e.r,e.g,e.b),a.setXYZ(12,e.r,e.g,e.b),a.setXYZ(13,e.r,e.g,e.b),a.setXYZ(14,e.r,e.g,e.b),a.setXYZ(15,e.r,e.g,e.b),a.setXYZ(16,e.r,e.g,e.b),a.setXYZ(17,e.r,e.g,e.b),a.setXYZ(18,e.r,e.g,e.b),a.setXYZ(19,e.r,e.g,e.b),a.setXYZ(20,e.r,e.g,e.b),a.setXYZ(21,e.r,e.g,e.b),a.setXYZ(22,e.r,e.g,e.b),a.setXYZ(23,e.r,e.g,e.b),a.setXYZ(24,t.r,t.g,t.b),a.setXYZ(25,t.r,t.g,t.b),a.setXYZ(26,t.r,t.g,t.b),a.setXYZ(27,t.r,t.g,t.b),a.setXYZ(28,t.r,t.g,t.b),a.setXYZ(29,t.r,t.g,t.b),a.setXYZ(30,t.r,t.g,t.b),a.setXYZ(31,t.r,t.g,t.b),a.setXYZ(32,i.r,i.g,i.b),a.setXYZ(33,i.r,i.g,i.b),a.setXYZ(34,i.r,i.g,i.b),a.setXYZ(35,i.r,i.g,i.b),a.setXYZ(36,i.r,i.g,i.b),a.setXYZ(37,i.r,i.g,i.b),a.setXYZ(38,r.r,r.g,r.b),a.setXYZ(39,r.r,r.g,r.b),a.setXYZ(40,s.r,s.g,s.b),a.setXYZ(41,s.r,s.g,s.b),a.setXYZ(42,s.r,s.g,s.b),a.setXYZ(43,s.r,s.g,s.b),a.setXYZ(44,s.r,s.g,s.b),a.setXYZ(45,s.r,s.g,s.b),a.setXYZ(46,s.r,s.g,s.b),a.setXYZ(47,s.r,s.g,s.b),a.setXYZ(48,s.r,s.g,s.b),a.setXYZ(49,s.r,s.g,s.b),a.needsUpdate=!0}update(){const e=this.geometry,t=this.pointMap;ii.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse),hi("c",t,e,ii,0,0,-1),hi("t",t,e,ii,0,0,1),hi("n1",t,e,ii,-1,-1,-1),hi("n2",t,e,ii,1,-1,-1),hi("n3",t,e,ii,-1,1,-1),hi("n4",t,e,ii,1,1,-1),hi("f1",t,e,ii,-1,-1,1),hi("f2",t,e,ii,1,-1,1),hi("f3",t,e,ii,-1,1,1),hi("f4",t,e,ii,1,1,1),hi("u1",t,e,ii,.7,1.1,-1),hi("u2",t,e,ii,-.7,1.1,-1),hi("u3",t,e,ii,0,2,-1),hi("cf1",t,e,ii,-1,0,1),hi("cf2",t,e,ii,1,0,1),hi("cf3",t,e,ii,0,-1,1),hi("cf4",t,e,ii,0,1,1),hi("cn1",t,e,ii,-1,0,-1),hi("cn2",t,e,ii,1,0,-1),hi("cn3",t,e,ii,0,-1,-1),hi("cn4",t,e,ii,0,1,-1),e.getAttribute("position").needsUpdate=!0}dispose(){this.geometry.dispose(),this.material.dispose()}}function hi(n,e,t,i,r,s,o){_m.set(r,s,o).unproject(i);const a=e[n];if(void 0!==a){const l=t.getAttribute("position");for(let u=0,d=a.length;u<d;u++)l.setXYZ(a[u],_m.x,_m.y,_m.z)}}const N1=new q;let vm,V0;class s8 extends vi{constructor(e=new q(0,0,1),t=new q(0,0,0),i=1,r=16776960,s=.2*i,o=.2*s){super(),this.type="ArrowHelper",void 0===vm&&(vm=new hn,vm.setAttribute("position",new ht([0,0,0,0,1,0],3)),V0=new eu(0,.5,1,5,1),V0.translate(0,-.5,0)),this.position.copy(t),this.line=new tl(vm,new rr({color:r,toneMapped:!1})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new Gn(V0,new Xr({color:r,toneMapped:!1})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(e),this.setLength(i,s,o)}setDirection(e){if(e.y>.99999)this.quaternion.set(0,0,0,1);else if(e.y<-.99999)this.quaternion.set(1,0,0,0);else{N1.set(e.z,0,-e.x).normalize();const t=Math.acos(e.y);this.quaternion.setFromAxisAngle(N1,t)}}setLength(e,t=.2*e,i=.2*t){this.line.scale.set(1,Math.max(1e-4,e-t),1),this.line.updateMatrix(),this.cone.scale.set(i,t,i),this.cone.position.y=e,this.cone.updateMatrix()}setColor(e){this.line.material.color.set(e),this.cone.material.color.set(e)}copy(e){return super.copy(e,!1),this.line.copy(e.line),this.cone.copy(e.cone),this}dispose(){this.line.geometry.dispose(),this.line.material.dispose(),this.cone.geometry.dispose(),this.cone.material.dispose()}}typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:"154"}})),typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__="154");var js=Pt(700),B1=Pt(755);const dl={mapSvgUrl:"assets/map.svg",terrainHeightMapUrl:"assets/terrain.png",waterHeightMapUrl:"assets/water.png",meshes:["bush_1","bush_2","bush_3","grass_1","grass_2","rock","tree_1","tree_2"],DEBUG:!1};class o8 extends vi{get speed(){return this.body.getLinearVelocity().length()}constructor(e){super(),this.settings={velocityTurningTorque:.05,thrustTurningTorque:.9,turningFriction:.6,sidewaysDrag:2,frontalDrag:.2,thrust:2.5,baseCameraDistance:1,cameraDistanceVelocityScale:.2,yPosition:.04,mainColor:15680580,accentColor:16486972,lineColor:4210752,wakeLength:.5,foamColor:14876159,swayMultiplierX:.015,swayMaxX:.05,swayMultiplierZ:.015,swayMaxZ:.04};const t=new To;t.moveTo(0,0),t.lineTo(0,-.05),t.lineTo(.25,-.05),t.bezierCurveTo(.3,-.05,.35,-.05,.4,0),t.lineTo(0,0);const i=new To;i.moveTo(0,0),i.lineTo(.05,0),i.lineTo(.02,.14),i.lineTo(0,.14),i.lineTo(0,0);const r=new To;r.ellipse(0,0,.08,.005,0,2*Math.PI,!1,0);const s=new nu(t,{bevelEnabled:!1,depth:.22}),o=new nu(i,{bevelEnabled:!1,depth:.002}).translate(0,.001,-.001),a=new nu(r,{bevelEnabled:!1,depth:.002}).rotateY(-Math.PI/2),l=new eu(.01,.01,.03).rotateZ(Math.PI/2),u=new Xa(.04,.14,.002).translate(-.02,0,0),d=new Ja(this.settings.wakeLength,.12).rotateX(-Math.PI/2);this.mainMaterial=new cm({color:this.settings.mainColor}),this.accentMaterial=new cm({color:this.settings.accentColor}),this.lineMaterial=new rr({color:this.settings.lineColor}),this.foamMaterial=new Zr({uniforms:{time:{value:0},vel:{value:0},velAngle:{value:0},color:{value:new Qe(this.settings.foamColor)}},vertexShader:c8,fragmentShader:u8,transparent:!0}),this.wakeMaterial=new Zr({uniforms:Fy.merge([{time:{value:0},throttle:{value:0}},et.lights]),vertexShader:a8,fragmentShader:l8,lights:!0,polygonOffset:!0,polygonOffsetFactor:-1,transparent:!0}),this.hull=new Gn(s,this.mainMaterial),this.rudder=new Gn(u,this.accentMaterial),this.propeller=new Gn(a,this.accentMaterial),this.propMount=new Gn(o,this.mainMaterial),this.engine=new Gn(l,new cm({color:this.settings.lineColor})),this.wake=new Gn(d,this.wakeMaterial),this.foam=new r0(this.generateFoamGeometry(),this.foamMaterial),this.hull.add(new nl(new nm(s),this.lineMaterial)),this.rudder.add(new nl(new nm(u),this.lineMaterial)),this.propMount.add(new nl(new nm(o),this.lineMaterial)),this.hull.castShadow=!0,this.hull.receiveShadow=!0,this.rudder.castShadow=!0,this.rudder.receiveShadow=!0,this.propeller.castShadow=!0,this.propeller.receiveShadow=!0,this.engine.castShadow=!0,this.engine.receiveShadow=!0,this.propMount.castShadow=!0,this.propMount.receiveShadow=!0,this.wake.receiveShadow=!0,this.hull.position.set(-.2,0,-.11),this.rudder.position.set(0,.07,.11),this.propeller.position.set(.054,.1,.11),this.engine.position.set(.035,.1,.11),this.propMount.position.set(0,0,.11),this.wake.position.set(-.2-this.settings.wakeLength/2,-this.settings.yPosition,0),this.foam.position.set(-.2,-this.settings.yPosition,0),this.hull.add(this.propeller,this.rudder,this.engine,this.propMount),this.add(this.hull,this.wake,this.foam),this.position.setY(this.settings.yPosition),dl.DEBUG&&(this.debugArrow=new s8,this.debugArrow.position.setY(.1),this.add(this.debugArrow)),this.body=e.createBody({type:"dynamic"}),this.body.createFixture({shape:new js.Box(.2,.11),friction:0}),this.body.setMassData({center:js.Vec2(0,0),I:1,mass:1}),this.sound=new B1.Howl({src:["assets/prop.mp3"],volume:0,loop:!0})}updateCamera(e,t){const i=Math.max(this.settings.baseCameraDistance,this.settings.baseCameraDistance*this.body.getLinearVelocity().length()*this.settings.cameraDistanceVelocityScale),r=new q(-i,.6*i,0).applyAxisAngle(new q(0,1,0),t);e.position.copy(r.applyQuaternion(this.quaternion).add(this.position)),e.lookAt(this.position)}calculateForces(e){const t=new js.Vec2;t.add(js.Vec2(e.throttle*this.settings.thrust,0));const i=Math.sin(-e.yaw*Math.PI/2)*(e.throttle*this.settings.thrustTurningTorque+this.body.getLinearVelocity().length()*this.settings.velocityTurningTorque),r=this.settings.turningFriction*this.body.getAngularVelocity();this.body.applyTorque(i-r);const s=this.body.getLocalVector(this.body.getLinearVelocity().clone().neg());s.x*=this.settings.frontalDrag,s.y*=this.settings.sidewaysDrag,t.add(s),this.body.applyForceToCenter(this.body.getWorldVector(t)),this.applySway(t),this.updateControlSurfaces(e),this.updateSound(e)}syncBodyAndMesh(){const e=this.body.getPosition();this.position.set(e.x,this.settings.yPosition,-e.y),this.rotation.set(0,this.body.getAngle(),0);const t=this.body.getLocalVector(this.body.getLinearVelocity());if(this.foamMaterial.uniforms.vel.value=t.length(),this.foamMaterial.uniforms.velAngle.value=Math.atan2(t.y,t.x),this.debugArrow){const i=this.body.getLocalVector(this.body.getLinearVelocity().clone());i.normalize(),this.debugArrow.setDirection(new q(i.x,0,-i.y)),this.debugArrow.setLength(this.body.getLinearVelocity().length()/4)}}reset(){this.body.setPosition(js.Vec2()),this.body.setAngle(0),this.body.setLinearVelocity(js.Vec2()),this.body.setAngularVelocity(0)}updateTime(e){this.wakeMaterial.uniforms.time.value=e,this.foamMaterial.uniforms.time.value=e}updateControlSurfaces(e){this.propeller.rotateX(e.throttle),this.rudder.rotation.set(0,e.yaw*Math.PI/4,0),this.wakeMaterial.uniforms.throttle.value=e.throttle}updateSound(e){this.sound.volume(Math.abs(e.throttle))}applySway(e){this.hull.rotation.x=-yo.clamp(e.y*this.settings.swayMultiplierX,-this.settings.swayMaxX,this.settings.swayMaxX),this.hull.rotation.z=yo.clamp(e.x*this.settings.swayMultiplierZ,-this.settings.swayMaxZ,this.settings.swayMaxZ)}generateFoamGeometry(){const e=[],t=[],i=[],r=[],s=[],o=[];for(let l=0;l<200;l++)e.push(0,0,yo.randFloatSpread(.22)),t.push(yo.randFloat(.2,1)),i.push(yo.randFloat(.2,1)),r.push(yo.randFloat(.8,1)),s.push(yo.randFloat(.5,1)),o.push(yo.randFloatSpread(.8));const a=new hn;return a.setAttribute("position",new ht(e,3)),a.setAttribute("jumpHeight",new ht(t,1)),a.setAttribute("jumpLength",new ht(i,1)),a.setAttribute("jumpSpeed",new ht(r,1)),a.setAttribute("jumpStop",new ht(s,1)),a.setAttribute("jumpAngleMod",new ht(o,1)),a}}const a8="\n    #include <common>\n    #include <shadowmap_pars_vertex>\n    \n    varying vec2 vUv;\n\n    void main() {\n        #include <begin_vertex>\n        #include <beginnormal_vertex>\n        #include <project_vertex>\n        #include <worldpos_vertex>\n        #include <defaultnormal_vertex> \n        #include <shadowmap_vertex>\n\n        vUv = uv;\n    }\n",l8="\n    #include <common>\n    #include <packing>\n    #include <lights_pars_begin>\n    #include <shadowmap_pars_fragment>\n    #include <shadowmask_pars_fragment>\n    #include <noise_3d>\n\n    uniform float time;\n    uniform float throttle;\n\n    varying vec2 vUv;\n\n    void main() {\n        float noise = 0.5 + snoise(vec3(vUv.x*6.0, vUv.y*2.0, time*3.0))/2.0;\n        float chance = sin(vUv.y * 3.1415) * sin(vUv.x * 3.1415);\n        bool transparent = noise > chance;\n\n        gl_FragColor = vec4( mix(vec3(1,1,1), vec3(0,0,0), (1.0 - getShadowMask() ) * 0.5), transparent ? 0.0 : throttle);\n    }\n",c8="\n    uniform float time;\n    uniform float vel;\n    uniform float velAngle;\n\n    attribute float jumpHeight;\n    attribute float jumpLength;\n    attribute float jumpSpeed;\n    attribute float jumpStop;\n    attribute float jumpAngleMod;\n\n    varying float jumpProgress;\n    varying float jumpEnd;\n\n    void main() {\n        float x = mod(time * jumpSpeed, jumpLength);\n\n        jumpProgress = x / jumpLength;\n        jumpEnd = jumpStop;\n\n        float y = - jumpHeight * x * (x - jumpLength);\n\n        float angle = velAngle + jumpAngleMod;\n        float realX = cos(angle) * -x;\n        float realZ = sin(angle) * x;\n\n        vec3 offset = vec3(realX, y, realZ) * vel / 10.0;\n\n        gl_PointSize = 2.0;\n        gl_Position = projectionMatrix * modelViewMatrix * vec4(position + offset, 1);\n    }\n",u8="\n    uniform vec3 color;\n\n    varying float jumpProgress;\n    varying float jumpEnd;\n\n    void main() {\n        if(jumpProgress >= jumpEnd) discard; \n\n        float opacity = (1.0 - smoothstep(jumpEnd - 0.2, jumpEnd, jumpProgress));\n        gl_FragColor = vec4(color, opacity);\n    }\n";class h8{constructor(){this.keyMap={KeyW:"throttleUp",KeyS:"throttleDown",KeyA:"yawLeft",KeyD:"yawRight",ArrowRight:"lookRight",ArrowLeft:"lookLeft",ArrowDown:"lookBack",ArrowUp:"lookFront"},this.axisValues={yaw:0,throttle:0},this.keyState={throttleUp:!1,throttleDown:!1,yawLeft:!1,yawRight:!1,lookRight:!1,lookLeft:!1,lookBack:!1,lookFront:!1}}onKeyEvent(e){this.keyMap[e.code]&&(this.keyState[this.keyMap[e.code]]="keydown"==e.type)}stepAxisValues(){return this.axisValues.throttle=this.stepSingleAxis(this.keyState.throttleDown,this.keyState.throttleUp,this.axisValues.throttle),this.axisValues.yaw=this.stepSingleAxis(this.keyState.yawLeft,this.keyState.yawRight,this.axisValues.yaw),this.axisValues.throttle=this.minMaxAndRound(this.axisValues.throttle,-.5,1),this.axisValues.yaw=this.minMaxAndRound(this.axisValues.yaw,-1,1),this.axisValues}getCameraDirection(){return this.keyState.lookFront&&this.keyState.lookLeft?-Math.PI/4:this.keyState.lookFront&&this.keyState.lookRight?Math.PI/4:this.keyState.lookFront?0:this.keyState.lookBack&&this.keyState.lookLeft?3*-Math.PI/4:this.keyState.lookBack&&this.keyState.lookRight?3*Math.PI/4:this.keyState.lookBack?Math.PI:this.keyState.lookLeft?3*Math.PI/2:this.keyState.lookRight?Math.PI/2:0}stepSingleAxis(e,t,i){return t!=e?i+=.02*(t?1:-1):0!=i&&(i+=i>0?-.02:.02),i}minMaxAndRound(e,t,i){return Math.round(100*Math.min(Math.max(e,t),i))/100}}function au(n,e){var t=n.__state.conversionName.toString(),i=Math.round(n.r),r=Math.round(n.g),s=Math.round(n.b),o=n.a,a=Math.round(n.h),l=n.s.toFixed(1),u=n.v.toFixed(1);if(e||"THREE_CHAR_HEX"===t||"SIX_CHAR_HEX"===t){for(var d=n.hex.toString(16);d.length<6;)d="0"+d;return"#"+d}return"CSS_RGB"===t?"rgb("+i+","+r+","+s+")":"CSS_RGBA"===t?"rgba("+i+","+r+","+s+","+o+")":"HEX"===t?"0x"+n.hex.toString(16):"RGB_ARRAY"===t?"["+i+","+r+","+s+"]":"RGBA_ARRAY"===t?"["+i+","+r+","+s+","+o+"]":"RGB_OBJ"===t?"{r:"+i+",g:"+r+",b:"+s+"}":"RGBA_OBJ"===t?"{r:"+i+",g:"+r+",b:"+s+",a:"+o+"}":"HSV_OBJ"===t?"{h:"+a+",s:"+l+",v:"+u+"}":"HSVA_OBJ"===t?"{h:"+a+",s:"+l+",v:"+u+",a:"+o+"}":"unknown format"}var F1=Array.prototype.forEach,sd=Array.prototype.slice,Pe={BREAK:{},extend:function(e){return this.each(sd.call(arguments,1),function(t){(this.isObject(t)?Object.keys(t):[]).forEach(function(r){this.isUndefined(t[r])||(e[r]=t[r])}.bind(this))},this),e},defaults:function(e){return this.each(sd.call(arguments,1),function(t){(this.isObject(t)?Object.keys(t):[]).forEach(function(r){this.isUndefined(e[r])&&(e[r]=t[r])}.bind(this))},this),e},compose:function(){var e=sd.call(arguments);return function(){for(var t=sd.call(arguments),i=e.length-1;i>=0;i--)t=[e[i].apply(this,t)];return t[0]}},each:function(e,t,i){if(e)if(F1&&e.forEach&&e.forEach===F1)e.forEach(t,i);else if(e.length===e.length+0){var s,r=void 0;for(r=0,s=e.length;r<s;r++)if(r in e&&t.call(i,e[r],r)===this.BREAK)return}else for(var o in e)if(t.call(i,e[o],o)===this.BREAK)return},defer:function(e){setTimeout(e,0)},debounce:function(e,t,i){var r=void 0;return function(){var s=this,o=arguments,l=i||!r;clearTimeout(r),r=setTimeout(function a(){r=null,i||e.apply(s,o)},t),l&&e.apply(s,o)}},toArray:function(e){return e.toArray?e.toArray():sd.call(e)},isUndefined:function(e){return void 0===e},isNull:function(e){return null===e},isNaN:function(n){function e(t){return n.apply(this,arguments)}return e.toString=function(){return n.toString()},e}(function(n){return isNaN(n)}),isArray:Array.isArray||function(n){return n.constructor===Array},isObject:function(e){return e===Object(e)},isNumber:function(e){return e===e+0},isString:function(e){return e===e+""},isBoolean:function(e){return!1===e||!0===e},isFunction:function(e){return e instanceof Function}},f8=[{litmus:Pe.isString,conversions:{THREE_CHAR_HEX:{read:function(e){var t=e.match(/^#([A-F0-9])([A-F0-9])([A-F0-9])$/i);return null!==t&&{space:"HEX",hex:parseInt("0x"+t[1].toString()+t[1].toString()+t[2].toString()+t[2].toString()+t[3].toString()+t[3].toString(),0)}},write:au},SIX_CHAR_HEX:{read:function(e){var t=e.match(/^#([A-F0-9]{6})$/i);return null!==t&&{space:"HEX",hex:parseInt("0x"+t[1].toString(),0)}},write:au},CSS_RGB:{read:function(e){var t=e.match(/^rgb\(\s*(\S+)\s*,\s*(\S+)\s*,\s*(\S+)\s*\)/);return null!==t&&{space:"RGB",r:parseFloat(t[1]),g:parseFloat(t[2]),b:parseFloat(t[3])}},write:au},CSS_RGBA:{read:function(e){var t=e.match(/^rgba\(\s*(\S+)\s*,\s*(\S+)\s*,\s*(\S+)\s*,\s*(\S+)\s*\)/);return null!==t&&{space:"RGB",r:parseFloat(t[1]),g:parseFloat(t[2]),b:parseFloat(t[3]),a:parseFloat(t[4])}},write:au}}},{litmus:Pe.isNumber,conversions:{HEX:{read:function(e){return{space:"HEX",hex:e,conversionName:"HEX"}},write:function(e){return e.hex}}}},{litmus:Pe.isArray,conversions:{RGB_ARRAY:{read:function(e){return 3===e.length&&{space:"RGB",r:e[0],g:e[1],b:e[2]}},write:function(e){return[e.r,e.g,e.b]}},RGBA_ARRAY:{read:function(e){return 4===e.length&&{space:"RGB",r:e[0],g:e[1],b:e[2],a:e[3]}},write:function(e){return[e.r,e.g,e.b,e.a]}}}},{litmus:Pe.isObject,conversions:{RGBA_OBJ:{read:function(e){return!!(Pe.isNumber(e.r)&&Pe.isNumber(e.g)&&Pe.isNumber(e.b)&&Pe.isNumber(e.a))&&{space:"RGB",r:e.r,g:e.g,b:e.b,a:e.a}},write:function(e){return{r:e.r,g:e.g,b:e.b,a:e.a}}},RGB_OBJ:{read:function(e){return!!(Pe.isNumber(e.r)&&Pe.isNumber(e.g)&&Pe.isNumber(e.b))&&{space:"RGB",r:e.r,g:e.g,b:e.b}},write:function(e){return{r:e.r,g:e.g,b:e.b}}},HSVA_OBJ:{read:function(e){return!!(Pe.isNumber(e.h)&&Pe.isNumber(e.s)&&Pe.isNumber(e.v)&&Pe.isNumber(e.a))&&{space:"HSV",h:e.h,s:e.s,v:e.v,a:e.a}},write:function(e){return{h:e.h,s:e.s,v:e.v,a:e.a}}},HSV_OBJ:{read:function(e){return!!(Pe.isNumber(e.h)&&Pe.isNumber(e.s)&&Pe.isNumber(e.v))&&{space:"HSV",h:e.h,s:e.s,v:e.v}},write:function(e){return{h:e.h,s:e.s,v:e.v}}}}}],od=void 0,ym=void 0,xm=function(){ym=!1;var e=arguments.length>1?Pe.toArray(arguments):arguments[0];return Pe.each(f8,function(t){if(t.litmus(e))return Pe.each(t.conversions,function(i,r){if(od=i.read(e),!1===ym&&!1!==od)return ym=od,od.conversionName=r,od.conversion=i,Pe.BREAK}),Pe.BREAK}),ym},O1=void 0,ad={hsv_to_rgb:function(e,t,i){var r=Math.floor(e/60)%6,s=e/60-Math.floor(e/60),o=i*(1-t),a=i*(1-s*t),l=i*(1-(1-s)*t),u=[[i,l,o],[a,i,o],[o,i,l],[o,a,i],[l,o,i],[i,o,a]][r];return{r:255*u[0],g:255*u[1],b:255*u[2]}},rgb_to_hsv:function(e,t,i){var r=Math.min(e,t,i),s=Math.max(e,t,i),o=s-r,a=void 0;return 0===s?{h:NaN,s:0,v:0}:(a=e===s?(t-i)/o:t===s?2+(i-e)/o:4+(e-t)/o,(a/=6)<0&&(a+=1),{h:360*a,s:o/s,v:s/255})},rgb_to_hex:function(e,t,i){var r=this.hex_with_component(0,2,e);return r=this.hex_with_component(r,1,t),this.hex_with_component(r,0,i)},component_from_hex:function(e,t){return e>>8*t&255},hex_with_component:function(e,t,i){return i<<(O1=8*t)|e&~(255<<O1)}},p8="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(n){return typeof n}:function(n){return n&&"function"==typeof Symbol&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},As=function(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")},ws=function(){function n(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}}(),sa=function n(e,t,i){null===e&&(e=Function.prototype);var r=Object.getOwnPropertyDescriptor(e,t);if(void 0===r){var s=Object.getPrototypeOf(e);return null===s?void 0:n(s,t,i)}if("value"in r)return r.value;var o=r.get;return void 0===o?void 0:o.call(i)},oa=function(n,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);n.prototype=Object.create(e&&e.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(n,e):n.__proto__=e)},aa=function(n,e){if(!n)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?n:e},Di=function(){function n(){if(As(this,n),this.__state=xm.apply(this,arguments),!1===this.__state)throw new Error("Failed to interpret color arguments");this.__state.a=this.__state.a||1}return ws(n,[{key:"toString",value:function(){return au(this)}},{key:"toHexString",value:function(){return au(this,!0)}},{key:"toOriginal",value:function(){return this.__state.conversion.write(this)}}]),n}();function k0(n,e,t){Object.defineProperty(n,e,{get:function(){return"RGB"===this.__state.space||Di.recalculateRGB(this,e,t),this.__state[e]},set:function(r){"RGB"!==this.__state.space&&(Di.recalculateRGB(this,e,t),this.__state.space="RGB"),this.__state[e]=r}})}function U0(n,e){Object.defineProperty(n,e,{get:function(){return"HSV"===this.__state.space||Di.recalculateHSV(this),this.__state[e]},set:function(i){"HSV"!==this.__state.space&&(Di.recalculateHSV(this),this.__state.space="HSV"),this.__state[e]=i}})}Di.recalculateRGB=function(n,e,t){if("HEX"===n.__state.space)n.__state[e]=ad.component_from_hex(n.__state.hex,t);else{if("HSV"!==n.__state.space)throw new Error("Corrupted color state");Pe.extend(n.__state,ad.hsv_to_rgb(n.__state.h,n.__state.s,n.__state.v))}},Di.recalculateHSV=function(n){var e=ad.rgb_to_hsv(n.r,n.g,n.b);Pe.extend(n.__state,{s:e.s,v:e.v}),Pe.isNaN(e.h)?Pe.isUndefined(n.__state.h)&&(n.__state.h=0):n.__state.h=e.h},Di.COMPONENTS=["r","g","b","h","s","v","hex","a"],k0(Di.prototype,"r",2),k0(Di.prototype,"g",1),k0(Di.prototype,"b",0),U0(Di.prototype,"h"),U0(Di.prototype,"s"),U0(Di.prototype,"v"),Object.defineProperty(Di.prototype,"a",{get:function(){return this.__state.a},set:function(e){this.__state.a=e}}),Object.defineProperty(Di.prototype,"hex",{get:function(){return"HEX"!==this.__state.space&&(this.__state.hex=ad.rgb_to_hex(this.r,this.g,this.b),this.__state.space="HEX"),this.__state.hex},set:function(e){this.__state.space="HEX",this.__state.hex=e}});var la=function(){function n(e,t){As(this,n),this.initialValue=e[t],this.domElement=document.createElement("div"),this.object=e,this.property=t,this.__onChange=void 0,this.__onFinishChange=void 0}return ws(n,[{key:"onChange",value:function(t){return this.__onChange=t,this}},{key:"onFinishChange",value:function(t){return this.__onFinishChange=t,this}},{key:"setValue",value:function(t){return this.object[this.property]=t,this.__onChange&&this.__onChange.call(this,t),this.updateDisplay(),this}},{key:"getValue",value:function(){return this.object[this.property]}},{key:"updateDisplay",value:function(){return this}},{key:"isModified",value:function(){return this.initialValue!==this.getValue()}}]),n}(),V1={};Pe.each({HTMLEvents:["change"],MouseEvents:["click","mousemove","mousedown","mouseup","mouseover"],KeyboardEvents:["keydown"]},function(n,e){Pe.each(n,function(t){V1[t]=e})});var _8=/(\d+(\.\d+)?)px/;function $s(n){if("0"===n||Pe.isUndefined(n))return 0;var e=n.match(_8);return Pe.isNull(e)?0:parseFloat(e[1])}var pe={makeSelectable:function(e,t){void 0===e||void 0===e.style||(e.onselectstart=t?function(){return!1}:function(){},e.style.MozUserSelect=t?"auto":"none",e.style.KhtmlUserSelect=t?"auto":"none",e.unselectable=t?"on":"off")},makeFullscreen:function(e,t,i){var r=i,s=t;Pe.isUndefined(s)&&(s=!0),Pe.isUndefined(r)&&(r=!0),e.style.position="absolute",s&&(e.style.left=0,e.style.right=0),r&&(e.style.top=0,e.style.bottom=0)},fakeEvent:function(e,t,i,r){var s=i||{},o=V1[t];if(!o)throw new Error("Event type "+t+" not supported.");var a=document.createEvent(o);switch(o){case"MouseEvents":a.initMouseEvent(t,s.bubbles||!1,s.cancelable||!0,window,s.clickCount||1,0,0,s.x||s.clientX||0,s.y||s.clientY||0,!1,!1,!1,!1,0,null);break;case"KeyboardEvents":var d=a.initKeyboardEvent||a.initKeyEvent;Pe.defaults(s,{cancelable:!0,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1,keyCode:void 0,charCode:void 0}),d(t,s.bubbles||!1,s.cancelable,window,s.ctrlKey,s.altKey,s.shiftKey,s.metaKey,s.keyCode,s.charCode);break;default:a.initEvent(t,s.bubbles||!1,s.cancelable||!0)}Pe.defaults(a,r),e.dispatchEvent(a)},bind:function(e,t,i,r){return e.addEventListener?e.addEventListener(t,i,r||!1):e.attachEvent&&e.attachEvent("on"+t,i),pe},unbind:function(e,t,i,r){return e.removeEventListener?e.removeEventListener(t,i,r||!1):e.detachEvent&&e.detachEvent("on"+t,i),pe},addClass:function(e,t){if(void 0===e.className)e.className=t;else if(e.className!==t){var i=e.className.split(/ +/);-1===i.indexOf(t)&&(i.push(t),e.className=i.join(" ").replace(/^\s+/,"").replace(/\s+$/,""))}return pe},removeClass:function(e,t){if(t)if(e.className===t)e.removeAttribute("class");else{var i=e.className.split(/ +/),r=i.indexOf(t);-1!==r&&(i.splice(r,1),e.className=i.join(" "))}else e.className=void 0;return pe},hasClass:function(e,t){return new RegExp("(?:^|\\s+)"+t+"(?:\\s+|$)").test(e.className)||!1},getWidth:function(e){var t=getComputedStyle(e);return $s(t["border-left-width"])+$s(t["border-right-width"])+$s(t["padding-left"])+$s(t["padding-right"])+$s(t.width)},getHeight:function(e){var t=getComputedStyle(e);return $s(t["border-top-width"])+$s(t["border-bottom-width"])+$s(t["padding-top"])+$s(t["padding-bottom"])+$s(t.height)},getOffset:function(e){var t=e,i={left:0,top:0};if(t.offsetParent)do{i.left+=t.offsetLeft,i.top+=t.offsetTop,t=t.offsetParent}while(t);return i},isActive:function(e){return e===document.activeElement&&(e.type||e.href)}},z0=function(n){function e(t,i){As(this,e);var r=aa(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,i)),s=r;return r.__prev=r.getValue(),r.__checkbox=document.createElement("input"),r.__checkbox.setAttribute("type","checkbox"),pe.bind(r.__checkbox,"change",function o(){s.setValue(!s.__prev)},!1),r.domElement.appendChild(r.__checkbox),r.updateDisplay(),r}return oa(e,n),ws(e,[{key:"setValue",value:function(i){var r=sa(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"setValue",this).call(this,i);return this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue()),this.__prev=this.getValue(),r}},{key:"updateDisplay",value:function(){return!0===this.getValue()?(this.__checkbox.setAttribute("checked","checked"),this.__checkbox.checked=!0,this.__prev=!0):(this.__checkbox.checked=!1,this.__prev=!1),sa(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"updateDisplay",this).call(this)}}]),e}(la),k1=function(n){function e(t,i,r){As(this,e);var s=aa(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,i)),o=r,a=s;if(s.__select=document.createElement("select"),Pe.isArray(o)){var l={};Pe.each(o,function(u){l[u]=u}),o=l}return Pe.each(o,function(u,d){var f=document.createElement("option");f.innerHTML=d,f.setAttribute("value",u),a.__select.appendChild(f)}),s.updateDisplay(),pe.bind(s.__select,"change",function(){a.setValue(this.options[this.selectedIndex].value)}),s.domElement.appendChild(s.__select),s}return oa(e,n),ws(e,[{key:"setValue",value:function(i){var r=sa(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"setValue",this).call(this,i);return this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue()),r}},{key:"updateDisplay",value:function(){return pe.isActive(this.__select)?this:(this.__select.value=this.getValue(),sa(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"updateDisplay",this).call(this))}}]),e}(la),U1=function(n){function e(t,i){As(this,e);var r=aa(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,i)),s=r;function o(){s.setValue(s.__input.value)}return r.__input=document.createElement("input"),r.__input.setAttribute("type","text"),pe.bind(r.__input,"keyup",o),pe.bind(r.__input,"change",o),pe.bind(r.__input,"blur",function a(){s.__onFinishChange&&s.__onFinishChange.call(s,s.getValue())}),pe.bind(r.__input,"keydown",function(l){13===l.keyCode&&this.blur()}),r.updateDisplay(),r.domElement.appendChild(r.__input),r}return oa(e,n),ws(e,[{key:"updateDisplay",value:function(){return pe.isActive(this.__input)||(this.__input.value=this.getValue()),sa(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"updateDisplay",this).call(this)}}]),e}(la);function z1(n){var e=n.toString();return e.indexOf(".")>-1?e.length-e.indexOf(".")-1:0}var H0=function(n){function e(t,i,r){As(this,e);var s=aa(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,i)),o=r||{};return s.__min=o.min,s.__max=o.max,s.__step=o.step,s.__impliedStep=Pe.isUndefined(s.__step)?0===s.initialValue?1:Math.pow(10,Math.floor(Math.log(Math.abs(s.initialValue))/Math.LN10))/10:s.__step,s.__precision=z1(s.__impliedStep),s}return oa(e,n),ws(e,[{key:"setValue",value:function(i){var r=i;return void 0!==this.__min&&r<this.__min?r=this.__min:void 0!==this.__max&&r>this.__max&&(r=this.__max),void 0!==this.__step&&r%this.__step!=0&&(r=Math.round(r/this.__step)*this.__step),sa(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"setValue",this).call(this,r)}},{key:"min",value:function(i){return this.__min=i,this}},{key:"max",value:function(i){return this.__max=i,this}},{key:"step",value:function(i){return this.__step=i,this.__impliedStep=i,this.__precision=z1(i),this}}]),e}(la),ld=function(n){function e(t,i,r){As(this,e);var s=aa(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,i,r));s.__truncationSuspended=!1;var o=s,a=void 0;function u(){o.__onFinishChange&&o.__onFinishChange.call(o,o.getValue())}function f(y){var w=a-y.clientY;o.setValue(o.getValue()+w*o.__impliedStep),a=y.clientY}function p(){pe.unbind(window,"mousemove",f),pe.unbind(window,"mouseup",p),u()}return s.__input=document.createElement("input"),s.__input.setAttribute("type","text"),pe.bind(s.__input,"change",function l(){var y=parseFloat(o.__input.value);Pe.isNaN(y)||o.setValue(y)}),pe.bind(s.__input,"blur",function d(){u()}),pe.bind(s.__input,"mousedown",function _(y){pe.bind(window,"mousemove",f),pe.bind(window,"mouseup",p),a=y.clientY}),pe.bind(s.__input,"keydown",function(y){13===y.keyCode&&(o.__truncationSuspended=!0,this.blur(),o.__truncationSuspended=!1,u())}),s.updateDisplay(),s.domElement.appendChild(s.__input),s}return oa(e,n),ws(e,[{key:"updateDisplay",value:function(){return this.__input.value=this.__truncationSuspended?this.getValue():function g8(n,e){var t=Math.pow(10,e);return Math.round(n*t)/t}(this.getValue(),this.__precision),sa(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"updateDisplay",this).call(this)}}]),e}(H0);function H1(n,e,t,i,r){return i+(n-e)/(t-e)*(r-i)}var bm=function(n){function e(t,i,r,s,o){As(this,e);var a=aa(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,i,{min:r,max:s,step:o})),l=a;function d(w){w.preventDefault();var A=l.__background.getBoundingClientRect();return l.setValue(H1(w.clientX,A.left,A.right,l.__min,l.__max)),!1}function f(){pe.unbind(window,"mousemove",d),pe.unbind(window,"mouseup",f),l.__onFinishChange&&l.__onFinishChange.call(l,l.getValue())}function _(w){var A=w.touches[0].clientX,b=l.__background.getBoundingClientRect();l.setValue(H1(A,b.left,b.right,l.__min,l.__max))}function y(){pe.unbind(window,"touchmove",_),pe.unbind(window,"touchend",y),l.__onFinishChange&&l.__onFinishChange.call(l,l.getValue())}return a.__background=document.createElement("div"),a.__foreground=document.createElement("div"),pe.bind(a.__background,"mousedown",function u(w){document.activeElement.blur(),pe.bind(window,"mousemove",d),pe.bind(window,"mouseup",f),d(w)}),pe.bind(a.__background,"touchstart",function p(w){1===w.touches.length&&(pe.bind(window,"touchmove",_),pe.bind(window,"touchend",y),_(w))}),pe.addClass(a.__background,"slider"),pe.addClass(a.__foreground,"slider-fg"),a.updateDisplay(),a.__background.appendChild(a.__foreground),a.domElement.appendChild(a.__background),a}return oa(e,n),ws(e,[{key:"updateDisplay",value:function(){var i=(this.getValue()-this.__min)/(this.__max-this.__min);return this.__foreground.style.width=100*i+"%",sa(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"updateDisplay",this).call(this)}}]),e}(H0),G0=function(n){function e(t,i,r){As(this,e);var s=aa(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,i)),o=s;return s.__button=document.createElement("div"),s.__button.innerHTML=void 0===r?"Fire":r,pe.bind(s.__button,"click",function(a){return a.preventDefault(),o.fire(),!1}),pe.addClass(s.__button,"button"),s.domElement.appendChild(s.__button),s}return oa(e,n),ws(e,[{key:"fire",value:function(){this.__onChange&&this.__onChange.call(this),this.getValue().call(this.object),this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue())}}]),e}(la),Am=function(n){function e(t,i){As(this,e);var r=aa(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,i));r.__color=new Di(r.getValue()),r.__temp=new Di(0);var s=r;r.domElement=document.createElement("div"),pe.makeSelectable(r.domElement,!1),r.__selector=document.createElement("div"),r.__selector.className="selector",r.__saturation_field=document.createElement("div"),r.__saturation_field.className="saturation-field",r.__field_knob=document.createElement("div"),r.__field_knob.className="field-knob",r.__field_knob_border="2px solid ",r.__hue_knob=document.createElement("div"),r.__hue_knob.className="hue-knob",r.__hue_field=document.createElement("div"),r.__hue_field.className="hue-field",r.__input=document.createElement("input"),r.__input.type="text",r.__input_textShadow="0 1px 1px ",pe.bind(r.__input,"keydown",function(w){13===w.keyCode&&f.call(this)}),pe.bind(r.__input,"blur",f),pe.bind(r.__selector,"mousedown",function(){pe.addClass(this,"drag").bind(window,"mouseup",function(){pe.removeClass(s.__selector,"drag")})}),pe.bind(r.__selector,"touchstart",function(){pe.addClass(this,"drag").bind(window,"touchend",function(){pe.removeClass(s.__selector,"drag")})});var o=document.createElement("div");function a(w){_(w),pe.bind(window,"mousemove",_),pe.bind(window,"touchmove",_),pe.bind(window,"mouseup",u),pe.bind(window,"touchend",u)}function l(w){y(w),pe.bind(window,"mousemove",y),pe.bind(window,"touchmove",y),pe.bind(window,"mouseup",d),pe.bind(window,"touchend",d)}function u(){pe.unbind(window,"mousemove",_),pe.unbind(window,"touchmove",_),pe.unbind(window,"mouseup",u),pe.unbind(window,"touchend",u),p()}function d(){pe.unbind(window,"mousemove",y),pe.unbind(window,"touchmove",y),pe.unbind(window,"mouseup",d),pe.unbind(window,"touchend",d),p()}function f(){var w=xm(this.value);!1!==w?(s.__color.__state=w,s.setValue(s.__color.toOriginal())):this.value=s.__color.toString()}function p(){s.__onFinishChange&&s.__onFinishChange.call(s,s.__color.toOriginal())}function _(w){-1===w.type.indexOf("touch")&&w.preventDefault();var A=s.__saturation_field.getBoundingClientRect(),b=w.touches&&w.touches[0]||w,I=(b.clientX-A.left)/(A.right-A.left),N=1-(b.clientY-A.top)/(A.bottom-A.top);return N>1?N=1:N<0&&(N=0),I>1?I=1:I<0&&(I=0),s.__color.v=N,s.__color.s=I,s.setValue(s.__color.toOriginal()),!1}function y(w){-1===w.type.indexOf("touch")&&w.preventDefault();var A=s.__hue_field.getBoundingClientRect(),T=1-((w.touches&&w.touches[0]||w).clientY-A.top)/(A.bottom-A.top);return T>1?T=1:T<0&&(T=0),s.__color.h=360*T,s.setValue(s.__color.toOriginal()),!1}return Pe.extend(r.__selector.style,{width:"122px",height:"102px",padding:"3px",backgroundColor:"#222",boxShadow:"0px 1px 3px rgba(0,0,0,0.3)"}),Pe.extend(r.__field_knob.style,{position:"absolute",width:"12px",height:"12px",border:r.__field_knob_border+(r.__color.v<.5?"#fff":"#000"),boxShadow:"0px 1px 3px rgba(0,0,0,0.5)",borderRadius:"12px",zIndex:1}),Pe.extend(r.__hue_knob.style,{position:"absolute",width:"15px",height:"2px",borderRight:"4px solid #fff",zIndex:1}),Pe.extend(r.__saturation_field.style,{width:"100px",height:"100px",border:"1px solid #555",marginRight:"3px",display:"inline-block",cursor:"pointer"}),Pe.extend(o.style,{width:"100%",height:"100%",background:"none"}),G1(o,"top","rgba(0,0,0,0)","#000"),Pe.extend(r.__hue_field.style,{width:"15px",height:"100px",border:"1px solid #555",cursor:"ns-resize",position:"absolute",top:"3px",right:"3px"}),function y8(n){n.style.background="",n.style.cssText+="background: -moz-linear-gradient(top,  #ff0000 0%, #ff00ff 17%, #0000ff 34%, #00ffff 50%, #00ff00 67%, #ffff00 84%, #ff0000 100%);",n.style.cssText+="background: -webkit-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",n.style.cssText+="background: -o-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",n.style.cssText+="background: -ms-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",n.style.cssText+="background: linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);"}(r.__hue_field),Pe.extend(r.__input.style,{outline:"none",textAlign:"center",color:"#fff",border:0,fontWeight:"bold",textShadow:r.__input_textShadow+"rgba(0,0,0,0.7)"}),pe.bind(r.__saturation_field,"mousedown",a),pe.bind(r.__saturation_field,"touchstart",a),pe.bind(r.__field_knob,"mousedown",a),pe.bind(r.__field_knob,"touchstart",a),pe.bind(r.__hue_field,"mousedown",l),pe.bind(r.__hue_field,"touchstart",l),r.__saturation_field.appendChild(o),r.__selector.appendChild(r.__field_knob),r.__selector.appendChild(r.__saturation_field),r.__selector.appendChild(r.__hue_field),r.__hue_field.appendChild(r.__hue_knob),r.domElement.appendChild(r.__input),r.domElement.appendChild(r.__selector),r.updateDisplay(),r}return oa(e,n),ws(e,[{key:"updateDisplay",value:function(){var i=xm(this.getValue());if(!1!==i){var r=!1;Pe.each(Di.COMPONENTS,function(a){if(!Pe.isUndefined(i[a])&&!Pe.isUndefined(this.__color.__state[a])&&i[a]!==this.__color.__state[a])return r=!0,{}},this),r&&Pe.extend(this.__color.__state,i)}Pe.extend(this.__temp.__state,this.__color.__state),this.__temp.a=1;var s=this.__color.v<.5||this.__color.s>.5?255:0,o=255-s;Pe.extend(this.__field_knob.style,{marginLeft:100*this.__color.s-7+"px",marginTop:100*(1-this.__color.v)-7+"px",backgroundColor:this.__temp.toHexString(),border:this.__field_knob_border+"rgb("+s+","+s+","+s+")"}),this.__hue_knob.style.marginTop=100*(1-this.__color.h/360)+"px",this.__temp.s=1,this.__temp.v=1,G1(this.__saturation_field,"left","#fff",this.__temp.toHexString()),this.__input.value=this.__color.toString(),Pe.extend(this.__input.style,{backgroundColor:this.__color.toHexString(),color:"rgb("+s+","+s+","+s+")",textShadow:this.__input_textShadow+"rgba("+o+","+o+","+o+",.7)"})}}]),e}(la),v8=["-moz-","-o-","-webkit-","-ms-",""];function G1(n,e,t,i){n.style.background="",Pe.each(v8,function(r){n.style.cssText+="background: "+r+"linear-gradient("+e+", "+t+" 0%, "+i+" 100%); "})}var A8=function(e,t){var i=e[t];return Pe.isArray(arguments[2])||Pe.isObject(arguments[2])?new k1(e,t,arguments[2]):Pe.isNumber(i)?Pe.isNumber(arguments[2])&&Pe.isNumber(arguments[3])?Pe.isNumber(arguments[4])?new bm(e,t,arguments[2],arguments[3],arguments[4]):new bm(e,t,arguments[2],arguments[3]):Pe.isNumber(arguments[4])?new ld(e,t,{min:arguments[2],max:arguments[3],step:arguments[4]}):new ld(e,t,{min:arguments[2],max:arguments[3]}):Pe.isString(i)?new U1(e,t):Pe.isFunction(i)?new G0(e,t,""):Pe.isBoolean(i)?new z0(e,t):null},M8=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function w8(n){setTimeout(n,1e3/60)},S8=function(){function n(){As(this,n),this.backgroundElement=document.createElement("div"),Pe.extend(this.backgroundElement.style,{backgroundColor:"rgba(0,0,0,0.8)",top:0,left:0,display:"none",zIndex:"1000",opacity:0,WebkitTransition:"opacity 0.2s linear",transition:"opacity 0.2s linear"}),pe.makeFullscreen(this.backgroundElement),this.backgroundElement.style.position="fixed",this.domElement=document.createElement("div"),Pe.extend(this.domElement.style,{position:"fixed",display:"none",zIndex:"1001",opacity:0,WebkitTransition:"-webkit-transform 0.2s ease-out, opacity 0.2s linear",transition:"transform 0.2s ease-out, opacity 0.2s linear"}),document.body.appendChild(this.backgroundElement),document.body.appendChild(this.domElement);var e=this;pe.bind(this.backgroundElement,"click",function(){e.hide()})}return ws(n,[{key:"show",value:function(){var t=this;this.backgroundElement.style.display="block",this.domElement.style.display="block",this.domElement.style.opacity=0,this.domElement.style.webkitTransform="scale(1.1)",this.layout(),Pe.defer(function(){t.backgroundElement.style.opacity=1,t.domElement.style.opacity=1,t.domElement.style.webkitTransform="scale(1)"})}},{key:"hide",value:function(){var t=this,i=function r(){t.domElement.style.display="none",t.backgroundElement.style.display="none",pe.unbind(t.domElement,"webkitTransitionEnd",r),pe.unbind(t.domElement,"transitionend",r),pe.unbind(t.domElement,"oTransitionEnd",r)};pe.bind(this.domElement,"webkitTransitionEnd",i),pe.bind(this.domElement,"transitionend",i),pe.bind(this.domElement,"oTransitionEnd",i),this.backgroundElement.style.opacity=0,this.domElement.style.opacity=0,this.domElement.style.webkitTransform="scale(1.1)"}},{key:"layout",value:function(){this.domElement.style.left=window.innerWidth/2-pe.getWidth(this.domElement)/2+"px",this.domElement.style.top=window.innerHeight/2-pe.getHeight(this.domElement)/2+"px"}}]),n}();!function(e,t){var i=t||document,r=document.createElement("style");r.type="text/css",r.innerHTML=e;var s=i.getElementsByTagName("head")[0];try{s.appendChild(r)}catch{}}(function d8(n){if(n&&!(typeof window>"u")){var e=document.createElement("style");return e.setAttribute("type","text/css"),e.innerHTML=n,document.head.appendChild(e),n}}(".dg ul{list-style:none;margin:0;padding:0;width:100%;clear:both}.dg.ac{position:fixed;top:0;left:0;right:0;height:0;z-index:0}.dg:not(.ac) .main{overflow:hidden}.dg.main{-webkit-transition:opacity .1s linear;-o-transition:opacity .1s linear;-moz-transition:opacity .1s linear;transition:opacity .1s linear}.dg.main.taller-than-window{overflow-y:auto}.dg.main.taller-than-window .close-button{opacity:1;margin-top:-1px;border-top:1px solid #2c2c2c}.dg.main ul.closed .close-button{opacity:1 !important}.dg.main:hover .close-button,.dg.main .close-button.drag{opacity:1}.dg.main .close-button{-webkit-transition:opacity .1s linear;-o-transition:opacity .1s linear;-moz-transition:opacity .1s linear;transition:opacity .1s linear;border:0;line-height:19px;height:20px;cursor:pointer;text-align:center;background-color:#000}.dg.main .close-button.close-top{position:relative}.dg.main .close-button.close-bottom{position:absolute}.dg.main .close-button:hover{background-color:#111}.dg.a{float:right;margin-right:15px;overflow-y:visible}.dg.a.has-save>ul.close-top{margin-top:0}.dg.a.has-save>ul.close-bottom{margin-top:27px}.dg.a.has-save>ul.closed{margin-top:0}.dg.a .save-row{top:0;z-index:1002}.dg.a .save-row.close-top{position:relative}.dg.a .save-row.close-bottom{position:fixed}.dg li{-webkit-transition:height .1s ease-out;-o-transition:height .1s ease-out;-moz-transition:height .1s ease-out;transition:height .1s ease-out;-webkit-transition:overflow .1s linear;-o-transition:overflow .1s linear;-moz-transition:overflow .1s linear;transition:overflow .1s linear}.dg li:not(.folder){cursor:auto;height:27px;line-height:27px;padding:0 4px 0 5px}.dg li.folder{padding:0;border-left:4px solid rgba(0,0,0,0)}.dg li.title{cursor:pointer;margin-left:-4px}.dg .closed li:not(.title),.dg .closed ul li,.dg .closed ul li>*{height:0;overflow:hidden;border:0}.dg .cr{clear:both;padding-left:3px;height:27px;overflow:hidden}.dg .property-name{cursor:default;float:left;clear:left;width:40%;overflow:hidden;text-overflow:ellipsis}.dg .cr.function .property-name{width:100%}.dg .c{float:left;width:60%;position:relative}.dg .c input[type=text]{border:0;margin-top:4px;padding:3px;width:100%;float:right}.dg .has-slider input[type=text]{width:30%;margin-left:0}.dg .slider{float:left;width:66%;margin-left:-5px;margin-right:0;height:19px;margin-top:4px}.dg .slider-fg{height:100%}.dg .c input[type=checkbox]{margin-top:7px}.dg .c select{margin-top:5px}.dg .cr.function,.dg .cr.function .property-name,.dg .cr.function *,.dg .cr.boolean,.dg .cr.boolean *{cursor:pointer}.dg .cr.color{overflow:visible}.dg .selector{display:none;position:absolute;margin-left:-9px;margin-top:23px;z-index:10}.dg .c:hover .selector,.dg .selector.drag{display:block}.dg li.save-row{padding:0}.dg li.save-row .button{display:inline-block;padding:0px 6px}.dg.dialogue{background-color:#222;width:460px;padding:15px;font-size:13px;line-height:15px}#dg-new-constructor{padding:10px;color:#222;font-family:Monaco, monospace;font-size:10px;border:0;resize:none;box-shadow:inset 1px 1px 1px #888;word-wrap:break-word;margin:12px 0;display:block;width:440px;overflow-y:scroll;height:100px;position:relative}#dg-local-explain{display:none;font-size:11px;line-height:17px;border-radius:3px;background-color:#333;padding:8px;margin-top:10px}#dg-local-explain code{font-size:10px}#dat-gui-save-locally{display:none}.dg{color:#eee;font:11px 'Lucida Grande', sans-serif;text-shadow:0 -1px 0 #111}.dg.main::-webkit-scrollbar{width:5px;background:#1a1a1a}.dg.main::-webkit-scrollbar-corner{height:0;display:none}.dg.main::-webkit-scrollbar-thumb{border-radius:5px;background:#676767}.dg li:not(.folder){background:#1a1a1a;border-bottom:1px solid #2c2c2c}.dg li.save-row{line-height:25px;background:#dad5cb;border:0}.dg li.save-row select{margin-left:5px;width:108px}.dg li.save-row .button{margin-left:5px;margin-top:1px;border-radius:2px;font-size:9px;line-height:7px;padding:4px 4px 5px 4px;background:#c5bdad;color:#fff;text-shadow:0 1px 0 #b0a58f;box-shadow:0 -1px 0 #b0a58f;cursor:pointer}.dg li.save-row .button.gears{background:#c5bdad url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAANCAYAAAB/9ZQ7AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAQJJREFUeNpiYKAU/P//PwGIC/ApCABiBSAW+I8AClAcgKxQ4T9hoMAEUrxx2QSGN6+egDX+/vWT4e7N82AMYoPAx/evwWoYoSYbACX2s7KxCxzcsezDh3evFoDEBYTEEqycggWAzA9AuUSQQgeYPa9fPv6/YWm/Acx5IPb7ty/fw+QZblw67vDs8R0YHyQhgObx+yAJkBqmG5dPPDh1aPOGR/eugW0G4vlIoTIfyFcA+QekhhHJhPdQxbiAIguMBTQZrPD7108M6roWYDFQiIAAv6Aow/1bFwXgis+f2LUAynwoIaNcz8XNx3Dl7MEJUDGQpx9gtQ8YCueB+D26OECAAQDadt7e46D42QAAAABJRU5ErkJggg==) 2px 1px no-repeat;height:7px;width:8px}.dg li.save-row .button:hover{background-color:#bab19e;box-shadow:0 -1px 0 #b0a58f}.dg li.folder{border-bottom:0}.dg li.title{padding-left:16px;background:#000 url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlI+hKgFxoCgAOw==) 6px 10px no-repeat;cursor:pointer;border-bottom:1px solid rgba(255,255,255,0.2)}.dg .closed li.title{background-image:url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlGIWqMCbWAEAOw==)}.dg .cr.boolean{border-left:3px solid #806787}.dg .cr.color{border-left:3px solid}.dg .cr.function{border-left:3px solid #e61d5f}.dg .cr.number{border-left:3px solid #2FA1D6}.dg .cr.number input[type=text]{color:#2FA1D6}.dg .cr.string{border-left:3px solid #1ed36f}.dg .cr.string input[type=text]{color:#1ed36f}.dg .cr.function:hover,.dg .cr.boolean:hover{background:#111}.dg .c input[type=text]{background:#303030;outline:none}.dg .c input[type=text]:hover{background:#3c3c3c}.dg .c input[type=text]:focus{background:#494949;color:#fff}.dg .c .slider{background:#303030;cursor:ew-resize}.dg .c .slider-fg{background:#2FA1D6;max-width:100%}.dg .c .slider:hover{background:#3c3c3c}.dg .c .slider:hover .slider-fg{background:#44abda}\n"));var cd="Default",ud=function(){try{return!!window.localStorage}catch{return!1}}(),hd=void 0,$1=!0,lu=void 0,W0=!1,X1=[],Fn=function n(e){var t=this,i=e||{};this.domElement=document.createElement("div"),this.__ul=document.createElement("ul"),this.domElement.appendChild(this.__ul),pe.addClass(this.domElement,"dg"),this.__folders={},this.__controllers=[],this.__rememberedObjects=[],this.__rememberedObjectIndecesToControllers=[],this.__listening=[],i=Pe.defaults(i,{closeOnTop:!1,autoPlace:!0,width:n.DEFAULT_WIDTH}),i=Pe.defaults(i,{resizable:i.autoPlace,hideable:i.autoPlace}),Pe.isUndefined(i.load)?i.load={preset:cd}:i.preset&&(i.load.preset=i.preset),Pe.isUndefined(i.parent)&&i.hideable&&X1.push(this),i.resizable=Pe.isUndefined(i.parent)&&i.resizable,i.autoPlace&&Pe.isUndefined(i.scrollable)&&(i.scrollable=!0);var r=ud&&"true"===localStorage.getItem(cu(0,"isLocal")),s=void 0,o=void 0;if(Object.defineProperties(this,{parent:{get:function(){return i.parent}},scrollable:{get:function(){return i.scrollable}},autoPlace:{get:function(){return i.autoPlace}},closeOnTop:{get:function(){return i.closeOnTop}},preset:{get:function(){return t.parent?t.getRoot().preset:i.load.preset},set:function(p){t.parent?t.getRoot().preset=p:i.load.preset=p,function I8(n){for(var e=0;e<n.__preset_select.length;e++)n.__preset_select[e].value===n.preset&&(n.__preset_select.selectedIndex=e)}(this),t.revert()}},width:{get:function(){return i.width},set:function(p){i.width=p,X0(t,p)}},name:{get:function(){return i.name},set:function(p){i.name=p,o&&(o.innerHTML=i.name)}},closed:{get:function(){return i.closed},set:function(p){i.closed=p,i.closed?pe.addClass(t.__ul,n.CLASS_CLOSED):pe.removeClass(t.__ul,n.CLASS_CLOSED),this.onResize(),t.__closeButton&&(t.__closeButton.innerHTML=p?n.TEXT_OPEN:n.TEXT_CLOSED)}},load:{get:function(){return i.load}},useLocalStorage:{get:function(){return r},set:function(p){ud&&(r=p,p?pe.bind(window,"unload",s):pe.unbind(window,"unload",s),localStorage.setItem(cu(0,"isLocal"),p))}}}),Pe.isUndefined(i.parent)){if(this.closed=i.closed||!1,pe.addClass(this.domElement,n.CLASS_MAIN),pe.makeSelectable(this.domElement,!1),ud&&r){t.useLocalStorage=!0;var a=localStorage.getItem(cu(0,"gui"));a&&(i.load=JSON.parse(a))}this.__closeButton=document.createElement("div"),this.__closeButton.innerHTML=n.TEXT_CLOSED,pe.addClass(this.__closeButton,n.CLASS_CLOSE_BUTTON),i.closeOnTop?(pe.addClass(this.__closeButton,n.CLASS_CLOSE_TOP),this.domElement.insertBefore(this.__closeButton,this.domElement.childNodes[0])):(pe.addClass(this.__closeButton,n.CLASS_CLOSE_BOTTOM),this.domElement.appendChild(this.__closeButton)),pe.bind(this.__closeButton,"click",function(){t.closed=!t.closed})}else{void 0===i.closed&&(i.closed=!0);var l=document.createTextNode(i.name);pe.addClass(l,"controller-name"),o=q0(t,l),pe.addClass(this.__ul,n.CLASS_CLOSED),pe.addClass(o,"title"),pe.bind(o,"click",function(p){return p.preventDefault(),t.closed=!t.closed,!1}),i.closed||(this.closed=!1)}i.autoPlace&&(Pe.isUndefined(i.parent)&&($1&&(lu=document.createElement("div"),pe.addClass(lu,"dg"),pe.addClass(lu,n.CLASS_AUTO_PLACE_CONTAINER),document.body.appendChild(lu),$1=!1),lu.appendChild(this.domElement),pe.addClass(this.domElement,n.CLASS_AUTO_PLACE)),this.parent||X0(t,i.width)),this.__resizeHandler=function(){t.onResizeDebounced()},pe.bind(window,"resize",this.__resizeHandler),pe.bind(this.__ul,"webkitTransitionEnd",this.__resizeHandler),pe.bind(this.__ul,"transitionend",this.__resizeHandler),pe.bind(this.__ul,"oTransitionEnd",this.__resizeHandler),this.onResize(),i.resizable&&function D8(n){var e=void 0;function t(s){return s.preventDefault(),n.width+=e-s.clientX,n.onResize(),e=s.clientX,!1}function i(){pe.removeClass(n.__closeButton,Fn.CLASS_DRAG),pe.unbind(window,"mousemove",t),pe.unbind(window,"mouseup",i)}function r(s){return s.preventDefault(),e=s.clientX,pe.addClass(n.__closeButton,Fn.CLASS_DRAG),pe.bind(window,"mousemove",t),pe.bind(window,"mouseup",i),!1}n.__resize_handle=document.createElement("div"),Pe.extend(n.__resize_handle.style,{width:"6px",marginLeft:"-3px",height:"200px",cursor:"ew-resize",position:"absolute"}),pe.bind(n.__resize_handle,"mousedown",r),pe.bind(n.__closeButton,"mousedown",r),n.domElement.insertBefore(n.__resize_handle,n.domElement.firstElementChild)}(this),this.saveToLocalStorageIfPossible=s=function(){ud&&"true"===localStorage.getItem(cu(0,"isLocal"))&&localStorage.setItem(cu(0,"gui"),JSON.stringify(t.getSaveObject()))},i.parent||function d(){var f=t.getRoot();f.width+=1,Pe.defer(function(){f.width-=1})}()};function q0(n,e,t){var i=document.createElement("li");return e&&i.appendChild(e),t?n.__ul.insertBefore(i,t):n.__ul.appendChild(i),n.onResize(),i}function Y1(n){pe.unbind(window,"resize",n.__resizeHandler),n.saveToLocalStorageIfPossible&&pe.unbind(window,"unload",n.saveToLocalStorageIfPossible)}function j0(n,e){var t=n.__preset_select[n.__preset_select.selectedIndex];t.innerHTML=e?t.value+"*":t.value}function Z1(n,e){var t=n.getRoot(),i=t.__rememberedObjects.indexOf(e.object);if(-1!==i){var r=t.__rememberedObjectIndecesToControllers[i];if(void 0===r&&(t.__rememberedObjectIndecesToControllers[i]=r={}),r[e.property]=e,t.load&&t.load.remembered){var s=t.load.remembered,o=void 0;if(s[n.preset])o=s[n.preset];else{if(!s[cd])return;o=s[cd]}if(o[i]&&void 0!==o[i][e.property]){var a=o[i][e.property];e.initialValue=a,e.setValue(a)}}}}function dd(n,e,t,i){if(void 0===e[t])throw new Error('Object "'+e+'" has no property "'+t+'"');var r=void 0;if(i.color)r=new Am(e,t);else{var s=[e,t].concat(i.factoryArgs);r=A8.apply(n,s)}i.before instanceof la&&(i.before=i.before.__li),Z1(n,r),pe.addClass(r.domElement,"c");var o=document.createElement("span");pe.addClass(o,"property-name"),o.innerHTML=r.property;var a=document.createElement("div");a.appendChild(o),a.appendChild(r.domElement);var l=q0(n,a,i.before);return pe.addClass(l,Fn.CLASS_CONTROLLER_ROW),pe.addClass(l,r instanceof Am?"color":p8(r.getValue())),function T8(n,e,t){if(t.__li=e,t.__gui=n,Pe.extend(t,{options:function(o){if(arguments.length>1){var a=t.__li.nextElementSibling;return t.remove(),dd(n,t.object,t.property,{before:a,factoryArgs:[Pe.toArray(arguments)]})}if(Pe.isArray(o)||Pe.isObject(o)){var l=t.__li.nextElementSibling;return t.remove(),dd(n,t.object,t.property,{before:l,factoryArgs:[o]})}},name:function(o){return t.__li.firstElementChild.firstElementChild.innerHTML=o,t},listen:function(){return t.__gui.listen(t),t},remove:function(){return t.__gui.remove(t),t}}),t instanceof bm){var i=new ld(t.object,t.property,{min:t.__min,max:t.__max,step:t.__step});Pe.each(["updateDisplay","onChange","onFinishChange","step","min","max"],function(s){var o=t[s],a=i[s];t[s]=i[s]=function(){var l=Array.prototype.slice.call(arguments);return a.apply(i,l),o.apply(t,l)}}),pe.addClass(e,"has-slider"),t.domElement.insertBefore(i.domElement,t.domElement.firstElementChild)}else if(t instanceof ld){var r=function(o){if(Pe.isNumber(t.__min)&&Pe.isNumber(t.__max)){var a=t.__li.firstElementChild.firstElementChild.innerHTML,l=t.__gui.__listening.indexOf(t)>-1;t.remove();var u=dd(n,t.object,t.property,{before:t.__li.nextElementSibling,factoryArgs:[t.__min,t.__max,t.__step]});return u.name(a),l&&u.listen(),u}return o};t.min=Pe.compose(r,t.min),t.max=Pe.compose(r,t.max)}else t instanceof z0?(pe.bind(e,"click",function(){pe.fakeEvent(t.__checkbox,"click")}),pe.bind(t.__checkbox,"click",function(s){s.stopPropagation()})):t instanceof G0?(pe.bind(e,"click",function(){pe.fakeEvent(t.__button,"click")}),pe.bind(e,"mouseover",function(){pe.addClass(t.__button,"hover")}),pe.bind(e,"mouseout",function(){pe.removeClass(t.__button,"hover")})):t instanceof Am&&(pe.addClass(e,"color"),t.updateDisplay=Pe.compose(function(s){return e.style.borderLeftColor=t.__color.toString(),s},t.updateDisplay),t.updateDisplay());t.setValue=Pe.compose(function(s){return n.getRoot().__preset_select&&t.isModified()&&j0(n.getRoot(),!0),s},t.setValue)}(n,l,r),n.__controllers.push(r),r}function cu(n,e){return document.location.href+"."+e}function $0(n,e,t){var i=document.createElement("option");i.innerHTML=e,i.value=e,n.__preset_select.appendChild(i),t&&(n.__preset_select.selectedIndex=n.__preset_select.length-1)}function J1(n,e){e.style.display=n.useLocalStorage?"block":"none"}function X0(n,e){n.domElement.style.width=e+"px",n.__save_row&&n.autoPlace&&(n.__save_row.style.width=e+"px"),n.__closeButton&&(n.__closeButton.style.width=e+"px")}function wm(n,e){var t={};return Pe.each(n.__rememberedObjects,function(i,r){var s={};Pe.each(n.__rememberedObjectIndecesToControllers[r],function(a,l){s[l]=e?a.initialValue:a.getValue()}),t[r]=s}),t}function K1(n){0!==n.length&&M8.call(window,function(){K1(n)}),Pe.each(n,function(e){e.updateDisplay()})}Fn.toggleHide=function(){W0=!W0,Pe.each(X1,function(n){n.domElement.style.display=W0?"none":""})},Fn.CLASS_AUTO_PLACE="a",Fn.CLASS_AUTO_PLACE_CONTAINER="ac",Fn.CLASS_MAIN="main",Fn.CLASS_CONTROLLER_ROW="cr",Fn.CLASS_TOO_TALL="taller-than-window",Fn.CLASS_CLOSED="closed",Fn.CLASS_CLOSE_BUTTON="close-button",Fn.CLASS_CLOSE_TOP="close-top",Fn.CLASS_CLOSE_BOTTOM="close-bottom",Fn.CLASS_DRAG="drag",Fn.DEFAULT_WIDTH=245,Fn.TEXT_CLOSED="Close Controls",Fn.TEXT_OPEN="Open Controls",Fn._keydownHandler=function(n){"text"!==document.activeElement.type&&(72===n.which||72===n.keyCode)&&Fn.toggleHide()},pe.bind(window,"keydown",Fn._keydownHandler,!1),Pe.extend(Fn.prototype,{add:function(e,t){return dd(this,e,t,{factoryArgs:Array.prototype.slice.call(arguments,2)})},addColor:function(e,t){return dd(this,e,t,{color:!0})},remove:function(e){this.__ul.removeChild(e.__li),this.__controllers.splice(this.__controllers.indexOf(e),1);var t=this;Pe.defer(function(){t.onResize()})},destroy:function(){if(this.parent)throw new Error("Only the root GUI should be removed with .destroy(). For subfolders, use gui.removeFolder(folder) instead.");this.autoPlace&&lu.removeChild(this.domElement);var e=this;Pe.each(this.__folders,function(t){e.removeFolder(t)}),pe.unbind(window,"keydown",Fn._keydownHandler,!1),Y1(this)},addFolder:function(e){if(void 0!==this.__folders[e])throw new Error('You already have a folder in this GUI by the name "'+e+'"');var t={name:e,parent:this};t.autoPlace=this.autoPlace,this.load&&this.load.folders&&this.load.folders[e]&&(t.closed=this.load.folders[e].closed,t.load=this.load.folders[e]);var i=new Fn(t);this.__folders[e]=i;var r=q0(this,i.domElement);return pe.addClass(r,"folder"),i},removeFolder:function(e){this.__ul.removeChild(e.domElement.parentElement),delete this.__folders[e.name],this.load&&this.load.folders&&this.load.folders[e.name]&&delete this.load.folders[e.name],Y1(e);var t=this;Pe.each(e.__folders,function(i){e.removeFolder(i)}),Pe.defer(function(){t.onResize()})},open:function(){this.closed=!1},close:function(){this.closed=!0},hide:function(){this.domElement.style.display="none"},show:function(){this.domElement.style.display=""},onResize:function(){var e=this.getRoot();if(e.scrollable){var t=pe.getOffset(e.__ul).top,i=0;Pe.each(e.__ul.childNodes,function(r){e.autoPlace&&r===e.__save_row||(i+=pe.getHeight(r))}),window.innerHeight-t-20<i?(pe.addClass(e.domElement,Fn.CLASS_TOO_TALL),e.__ul.style.height=window.innerHeight-t-20+"px"):(pe.removeClass(e.domElement,Fn.CLASS_TOO_TALL),e.__ul.style.height="auto")}e.__resize_handle&&Pe.defer(function(){e.__resize_handle.style.height=e.__ul.offsetHeight+"px"}),e.__closeButton&&(e.__closeButton.style.width=e.width+"px")},onResizeDebounced:Pe.debounce(function(){this.onResize()},50),remember:function(){if(Pe.isUndefined(hd)&&((hd=new S8).domElement.innerHTML='<div id="dg-save" class="dg dialogue">\n\n  Here\'s the new load parameter for your <code>GUI</code>\'s constructor:\n\n  <textarea id="dg-new-constructor"></textarea>\n\n  <div id="dg-save-locally">\n\n    <input id="dg-local-storage" type="checkbox"/> Automatically save\n    values to <code>localStorage</code> on exit.\n\n    <div id="dg-local-explain">The values saved to <code>localStorage</code> will\n      override those passed to <code>dat.GUI</code>\'s constructor. This makes it\n      easier to work incrementally, but <code>localStorage</code> is fragile,\n      and your friends may not see the same values you do.\n\n    </div>\n\n  </div>\n\n</div>'),this.parent)throw new Error("You can only call remember on a top level GUI.");var e=this;Pe.each(Array.prototype.slice.call(arguments),function(t){0===e.__rememberedObjects.length&&function C8(n){var e=n.__save_row=document.createElement("li");pe.addClass(n.domElement,"has-save"),n.__ul.insertBefore(e,n.__ul.firstChild),pe.addClass(e,"save-row");var t=document.createElement("span");t.innerHTML="&nbsp;",pe.addClass(t,"button gears");var i=document.createElement("span");i.innerHTML="Save",pe.addClass(i,"button"),pe.addClass(i,"save");var r=document.createElement("span");r.innerHTML="New",pe.addClass(r,"button"),pe.addClass(r,"save-as");var s=document.createElement("span");s.innerHTML="Revert",pe.addClass(s,"button"),pe.addClass(s,"revert");var o=n.__preset_select=document.createElement("select");if(n.load&&n.load.remembered?Pe.each(n.load.remembered,function(f,p){$0(n,p,p===n.preset)}):$0(n,cd,!1),pe.bind(o,"change",function(){for(var f=0;f<n.__preset_select.length;f++)n.__preset_select[f].innerHTML=n.__preset_select[f].value;n.preset=this.value}),e.appendChild(o),e.appendChild(t),e.appendChild(i),e.appendChild(r),e.appendChild(s),ud){var a=document.getElementById("dg-local-explain"),l=document.getElementById("dg-local-storage");document.getElementById("dg-save-locally").style.display="block","true"===localStorage.getItem(cu(0,"isLocal"))&&l.setAttribute("checked","checked"),J1(n,a),pe.bind(l,"change",function(){n.useLocalStorage=!n.useLocalStorage,J1(n,a)})}var d=document.getElementById("dg-new-constructor");pe.bind(d,"keydown",function(f){f.metaKey&&(67===f.which||67===f.keyCode)&&hd.hide()}),pe.bind(t,"click",function(){d.innerHTML=JSON.stringify(n.getSaveObject(),void 0,2),hd.show(),d.focus(),d.select()}),pe.bind(i,"click",function(){n.save()}),pe.bind(r,"click",function(){var f=prompt("Enter a new preset name.");f&&n.saveAs(f)}),pe.bind(s,"click",function(){n.revert()})}(e),-1===e.__rememberedObjects.indexOf(t)&&e.__rememberedObjects.push(t)}),this.autoPlace&&X0(this,this.width)},getRoot:function(){for(var e=this;e.parent;)e=e.parent;return e},getSaveObject:function(){var e=this.load;return e.closed=this.closed,this.__rememberedObjects.length>0&&(e.preset=this.preset,e.remembered||(e.remembered={}),e.remembered[this.preset]=wm(this)),e.folders={},Pe.each(this.__folders,function(t,i){e.folders[i]=t.getSaveObject()}),e},save:function(){this.load.remembered||(this.load.remembered={}),this.load.remembered[this.preset]=wm(this),j0(this,!1),this.saveToLocalStorageIfPossible()},saveAs:function(e){this.load.remembered||(this.load.remembered={},this.load.remembered[cd]=wm(this,!0)),this.load.remembered[e]=wm(this),this.preset=e,$0(this,e,!0),this.saveToLocalStorageIfPossible()},revert:function(e){Pe.each(this.__controllers,function(t){this.getRoot().load.remembered?Z1(e||this.getRoot(),t):t.setValue(t.initialValue),t.__onFinishChange&&t.__onFinishChange.call(t,t.getValue())},this),Pe.each(this.__folders,function(t){t.revert(t)}),e||j0(this.getRoot(),!1)},listen:function(e){var t=0===this.__listening.length;this.__listening.push(e),t&&K1(this.__listening)},updateDisplay:function(){Pe.each(this.__controllers,function(e){e.updateDisplay()}),Pe.each(this.__folders,function(e){e.updateDisplay()})}});var Q1=Fn;class B8 extends Gn{constructor(e,t,i,r=100){super(),this.sandColor=15913641,this.grassColor=39447,this.mapSize=r,this.material=new Zr({uniforms:{heightMap:{value:i},sandColor:{value:new Qe(this.sandColor)},grassColor:{value:new Qe(this.grassColor)}},vertexShader:F8,fragmentShader:O8}),this.geometry=new Ja(r,r,10*r,10*r).rotateX(-Math.PI/2),this.body=e.createBody(),this.convertSvgPathsToMapWalls(t,r).forEach(s=>this.body.createFixture({shape:s}))}placeMeshes(e,t,i){const r=[...e.getElementsByTagName("circle")].map(l=>({x:Number(l.getAttribute("cx")),y:Number(l.getAttribute("cy")),type:l.dataset.object})),s=r.reduce((l,u)=>(l[u.type]?l[u.type]++:l[u.type]=1,l),{}),o=new Map(Object.entries(s).map(([l,u])=>{const f=i.get(l).scene.children[0],p=new Qy(f.geometry,f.material,u);return p.userData.idx=0,this.add(p),[l,p]})),a=this.convertTextureToImageData(t);for(const l of r){const u=(l.x-.5)*this.mapSize,d=(l.y-.5)*this.mapSize,f=Math.round(l.y*a.height)*a.width+Math.round(l.x*a.width),p=a.data[4*f]/255-.2,_=(new Wt).compose(new q(u,p,d),(new Yi).setFromAxisAngle(new q(0,1,0),Math.random()*Math.PI*2),new q(.75,.75,.75)),y=o.get(l.type);y.setMatrixAt(y.userData.idx++,_)}}convertSvgPathsToMapWalls(e,t=250){return[...e.getElementsByTagName("path")].map(i=>{const r=[],s=i.getTotalLength();for(let a=0;a<t;a++){var o=i.getPointAtLength(a*s/t);r.push(js.Vec2((o.x-.5)*this.mapSize,(.5-o.y)*this.mapSize))}return js.Chain(r,!0)})}convertTextureToImageData(e){const t=document.createElement("canvas");t.width=e.image.width,t.height=e.image.width;const i=t.getContext("2d");return i.drawImage(e.image,0,0),i.getImageData(0,0,e.image.width,e.image.width)}}const F8="\n    uniform sampler2D heightMap;\n\n    varying float vertexHeight;\n\n    void main() {\n        vertexHeight = texture2D(heightMap, uv).r;\n\n        vec3 newPosition = position + normal * vertexHeight - 0.15;\n        gl_Position = projectionMatrix * modelViewMatrix * vec4(newPosition, 1.0);\n    }\n",O8="\n    uniform vec3 sandColor;\n    uniform vec3 grassColor;\n\n    varying float vertexHeight;\n\n    void main() {\n        vec3 sand = (1.0 - smoothstep(0.3, 0.4, vertexHeight)) * sandColor;\n        vec3 grass = smoothstep(0.3, 0.4, vertexHeight) * grassColor;\n\n        gl_FragColor = vec4(sand + grass, 1.0);\n    }\n";class k8 extends Gn{constructor(e,t=100){super(),this.waterColorDeep=5942970,this.waterColorShallow=1298386,this.surfaceNoiseCutoff=.03,this.edgeFoamCutoffMin=.72,this.edgeFoamCutoffMax=.8,this.noiseSpeed=.1,this.noiseSize=50,this.geometry=new Ja(t,t,t,t).rotateX(-Math.PI/2),this.material=new Zr({uniforms:Fy.merge([{time:{value:0},heightMap:{value:e},noiseSpeed:{value:this.noiseSpeed},noiseSize:{value:this.noiseSize},surfaceNoiseCutoff:{value:this.surfaceNoiseCutoff},edgeFoamCutoffMin:{value:this.edgeFoamCutoffMin},edgeFoamCutoffMax:{value:this.edgeFoamCutoffMax},waterColorDeep:{value:new Qe(this.waterColorDeep)},waterColorShallow:{value:new Qe(this.waterColorShallow)}},et.lights]),vertexShader:U8,fragmentShader:z8,lights:!0}),this.receiveShadow=!0}updateTime(e){this.material.uniforms.time.value=e}}const U8="\n    #include <common>\n    #include <shadowmap_pars_vertex>\n\n    uniform sampler2D heightMap;\n\n    varying vec2 vUv;\n    varying float vertexHeight;\n    \n    void main() {\n        #include <begin_vertex>\n        #include <beginnormal_vertex>\n        #include <project_vertex>\n        #include <worldpos_vertex>\n        #include <defaultnormal_vertex> \n        #include <shadowmap_vertex>\n\n        vUv = uv;\n        vertexHeight = texture2D(heightMap, uv).r;\n    }\n",z8="\n    #include <common>\n    #include <packing>\n    #include <lights_pars_begin>\n    #include <shadowmap_pars_fragment>\n    #include <shadowmask_pars_fragment>\n    #include <noise_3d>\n    \n    uniform float time;\n    uniform vec3 waterColorDeep;\n    uniform vec3 waterColorShallow;\n    uniform float surfaceNoiseCutoff;\n    uniform float edgeFoamCutoffMin;\n    uniform float edgeFoamCutoffMax;\n    uniform float noiseSpeed;\n    uniform float noiseSize;\n\n    varying vec2 vUv;\n    varying float vertexHeight;\n\n    void main() {\n        vec3 deep = (1.0 - smoothstep(0.0, 0.3, vertexHeight)) * waterColorDeep;\n        vec3 shallow = smoothstep(0.0, 0.3, vertexHeight) * waterColorShallow;\n\n        float noise = snoise(vec3(vUv.x * noiseSize, vUv.y * noiseSize, time * noiseSpeed));\n        float edgeFoamModifier = smoothstep(edgeFoamCutoffMin, edgeFoamCutoffMax, vertexHeight);\n        bool surfaceNoise = abs(noise) <= (surfaceNoiseCutoff + edgeFoamModifier);\n\n        vec3 finalColor = surfaceNoise ? vec3(1,1,1) : deep + shallow;\n\n        gl_FragColor = vec4( mix(finalColor, vec3(0, 0, 0), (1.0 - getShadowMask() ) * 0.5), 1.0);\n    }\n";function eI(n,e){if(0===e)return console.warn("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Geometry already defined as triangles."),n;if(2===e||1===e){let t=n.getIndex();if(null===t){const o=[],a=n.getAttribute("position");if(void 0===a)return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),n;for(let l=0;l<a.count;l++)o.push(l);n.setIndex(o),t=n.getIndex()}const i=t.count-2,r=[];if(2===e)for(let o=1;o<=i;o++)r.push(t.getX(0)),r.push(t.getX(o)),r.push(t.getX(o+1));else for(let o=0;o<i;o++)o%2==0?(r.push(t.getX(o)),r.push(t.getX(o+1)),r.push(t.getX(o+2))):(r.push(t.getX(o+2)),r.push(t.getX(o+1)),r.push(t.getX(o)));r.length/3!==i&&console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");const s=n.clone();return s.setIndex(r),s.clearGroups(),s}return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unknown draw mode:",e),n}class G8 extends nd{constructor(e){super(e),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register(function(t){return new X8(t)}),this.register(function(t){return new nq(t)}),this.register(function(t){return new iq(t)}),this.register(function(t){return new rq(t)}),this.register(function(t){return new Z8(t)}),this.register(function(t){return new J8(t)}),this.register(function(t){return new K8(t)}),this.register(function(t){return new Q8(t)}),this.register(function(t){return new $8(t)}),this.register(function(t){return new eq(t)}),this.register(function(t){return new Y8(t)}),this.register(function(t){return new tq(t)}),this.register(function(t){return new q8(t)}),this.register(function(t){return new sq(t)}),this.register(function(t){return new oq(t)})}load(e,t,i,r){const s=this;let o;o=""!==this.resourcePath?this.resourcePath:""!==this.path?this.path:rd.extractUrlBase(e),this.manager.itemStart(e);const a=function(u){r?r(u):console.error(u),s.manager.itemError(e),s.manager.itemEnd(e)},l=new bs(this.manager);l.setPath(this.path),l.setResponseType("arraybuffer"),l.setRequestHeader(this.requestHeader),l.setWithCredentials(this.withCredentials),l.load(e,function(u){try{s.parse(u,o,function(d){t(d),s.manager.itemEnd(e)},a)}catch(d){a(d)}},i,a)}setDRACOLoader(e){return this.dracoLoader=e,this}setDDSLoader(){throw new Error('THREE.GLTFLoader: "MSFT_texture_dds" no longer supported. Please update to "KHR_texture_basisu".')}setKTX2Loader(e){return this.ktx2Loader=e,this}setMeshoptDecoder(e){return this.meshoptDecoder=e,this}register(e){return-1===this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.push(e),this}unregister(e){return-1!==this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,t,i,r){let s;const o={},a={},l=new TextDecoder;if("string"==typeof e)s=JSON.parse(e);else if(e instanceof ArrayBuffer)if(l.decode(new Uint8Array(e,0,4))===tI){try{o[vn.KHR_BINARY_GLTF]=new aq(e)}catch(f){return void(r&&r(f))}s=JSON.parse(o[vn.KHR_BINARY_GLTF].content)}else s=JSON.parse(l.decode(e));else s=e;if(void 0===s.asset||s.asset.version[0]<2)return void(r&&r(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported.")));const u=new xq(s,{path:t||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});u.fileLoader.setRequestHeader(this.requestHeader);for(let d=0;d<this.pluginCallbacks.length;d++){const f=this.pluginCallbacks[d](u);a[f.name]=f,o[f.name]=!0}if(s.extensionsUsed)for(let d=0;d<s.extensionsUsed.length;++d){const f=s.extensionsUsed[d],p=s.extensionsRequired||[];switch(f){case vn.KHR_MATERIALS_UNLIT:o[f]=new j8;break;case vn.KHR_DRACO_MESH_COMPRESSION:o[f]=new lq(s,this.dracoLoader);break;case vn.KHR_TEXTURE_TRANSFORM:o[f]=new cq;break;case vn.KHR_MESH_QUANTIZATION:o[f]=new uq;break;default:p.indexOf(f)>=0&&void 0===a[f]&&console.warn('THREE.GLTFLoader: Unknown extension "'+f+'".')}}u.setExtensions(o),u.setPlugins(a),u.parse(i,r)}parseAsync(e,t){const i=this;return new Promise(function(r,s){i.parse(e,t,r,s)})}}function W8(){let n={};return{get:function(e){return n[e]},add:function(e,t){n[e]=t},remove:function(e){delete n[e]},removeAll:function(){n={}}}}const vn={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_IRIDESCENCE:"KHR_materials_iridescence",KHR_MATERIALS_ANISOTROPY:"KHR_materials_anisotropy",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",KHR_MATERIALS_EMISSIVE_STRENGTH:"KHR_materials_emissive_strength",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_TEXTURE_AVIF:"EXT_texture_avif",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression",EXT_MESH_GPU_INSTANCING:"EXT_mesh_gpu_instancing"};class q8{constructor(e){this.parser=e,this.name=vn.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){const e=this.parser,t=this.parser.json.nodes||[];for(let i=0,r=t.length;i<r;i++){const s=t[i];s.extensions&&s.extensions[this.name]&&void 0!==s.extensions[this.name].light&&e._addNodeRef(this.cache,s.extensions[this.name].light)}}_loadLight(e){const t=this.parser,i="light:"+e;let r=t.cache.get(i);if(r)return r;const s=t.json,l=((s.extensions&&s.extensions[this.name]||{}).lights||[])[e];let u;const d=new Qe(16777215);void 0!==l.color&&d.fromArray(l.color);const f=void 0!==l.range?l.range:0;switch(l.type){case"directional":u=new P0(d),u.target.position.set(0,0,-1),u.add(u.target);break;case"point":u=new f1(d),u.distance=f;break;case"spot":u=new h1(d),u.distance=f,l.spot=l.spot||{},l.spot.innerConeAngle=void 0!==l.spot.innerConeAngle?l.spot.innerConeAngle:0,l.spot.outerConeAngle=void 0!==l.spot.outerConeAngle?l.spot.outerConeAngle:Math.PI/4,u.angle=l.spot.outerConeAngle,u.penumbra=1-l.spot.innerConeAngle/l.spot.outerConeAngle,u.target.position.set(0,0,-1),u.add(u.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+l.type)}return u.position.set(0,0,0),u.decay=2,ua(u,l),void 0!==l.intensity&&(u.intensity=l.intensity),u.name=t.createUniqueName(l.name||"light_"+e),r=Promise.resolve(u),t.cache.add(i,r),r}getDependency(e,t){if("light"===e)return this._loadLight(t)}createNodeAttachment(e){const t=this,i=this.parser,s=i.json.nodes[e],a=(s.extensions&&s.extensions[this.name]||{}).light;return void 0===a?null:this._loadLight(a).then(function(l){return i._getNodeRef(t.cache,a,l)})}}class j8{constructor(){this.name=vn.KHR_MATERIALS_UNLIT}getMaterialType(){return Xr}extendParams(e,t,i){const r=[];e.color=new Qe(1,1,1),e.opacity=1;const s=t.pbrMetallicRoughness;if(s){if(Array.isArray(s.baseColorFactor)){const o=s.baseColorFactor;e.color.fromArray(o),e.opacity=o[3]}void 0!==s.baseColorTexture&&r.push(i.assignTexture(e,"map",s.baseColorTexture,jt))}return Promise.all(r)}}class $8{constructor(e){this.parser=e,this.name=vn.KHR_MATERIALS_EMISSIVE_STRENGTH}extendMaterialParams(e,t){const r=this.parser.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const s=r.extensions[this.name].emissiveStrength;return void 0!==s&&(t.emissiveIntensity=s),Promise.resolve()}}class X8{constructor(e){this.parser=e,this.name=vn.KHR_MATERIALS_CLEARCOAT}getMaterialType(e){const i=this.parser.json.materials[e];return i.extensions&&i.extensions[this.name]?Do:null}extendMaterialParams(e,t){const i=this.parser,r=i.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const s=[],o=r.extensions[this.name];if(void 0!==o.clearcoatFactor&&(t.clearcoat=o.clearcoatFactor),void 0!==o.clearcoatTexture&&s.push(i.assignTexture(t,"clearcoatMap",o.clearcoatTexture)),void 0!==o.clearcoatRoughnessFactor&&(t.clearcoatRoughness=o.clearcoatRoughnessFactor),void 0!==o.clearcoatRoughnessTexture&&s.push(i.assignTexture(t,"clearcoatRoughnessMap",o.clearcoatRoughnessTexture)),void 0!==o.clearcoatNormalTexture&&(s.push(i.assignTexture(t,"clearcoatNormalMap",o.clearcoatNormalTexture)),void 0!==o.clearcoatNormalTexture.scale)){const a=o.clearcoatNormalTexture.scale;t.clearcoatNormalScale=new Be(a,a)}return Promise.all(s)}}class Y8{constructor(e){this.parser=e,this.name=vn.KHR_MATERIALS_IRIDESCENCE}getMaterialType(e){const i=this.parser.json.materials[e];return i.extensions&&i.extensions[this.name]?Do:null}extendMaterialParams(e,t){const i=this.parser,r=i.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const s=[],o=r.extensions[this.name];return void 0!==o.iridescenceFactor&&(t.iridescence=o.iridescenceFactor),void 0!==o.iridescenceTexture&&s.push(i.assignTexture(t,"iridescenceMap",o.iridescenceTexture)),void 0!==o.iridescenceIor&&(t.iridescenceIOR=o.iridescenceIor),void 0===t.iridescenceThicknessRange&&(t.iridescenceThicknessRange=[100,400]),void 0!==o.iridescenceThicknessMinimum&&(t.iridescenceThicknessRange[0]=o.iridescenceThicknessMinimum),void 0!==o.iridescenceThicknessMaximum&&(t.iridescenceThicknessRange[1]=o.iridescenceThicknessMaximum),void 0!==o.iridescenceThicknessTexture&&s.push(i.assignTexture(t,"iridescenceThicknessMap",o.iridescenceThicknessTexture)),Promise.all(s)}}class Z8{constructor(e){this.parser=e,this.name=vn.KHR_MATERIALS_SHEEN}getMaterialType(e){const i=this.parser.json.materials[e];return i.extensions&&i.extensions[this.name]?Do:null}extendMaterialParams(e,t){const i=this.parser,r=i.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const s=[];t.sheenColor=new Qe(0,0,0),t.sheenRoughness=0,t.sheen=1;const o=r.extensions[this.name];return void 0!==o.sheenColorFactor&&t.sheenColor.fromArray(o.sheenColorFactor),void 0!==o.sheenRoughnessFactor&&(t.sheenRoughness=o.sheenRoughnessFactor),void 0!==o.sheenColorTexture&&s.push(i.assignTexture(t,"sheenColorMap",o.sheenColorTexture,jt)),void 0!==o.sheenRoughnessTexture&&s.push(i.assignTexture(t,"sheenRoughnessMap",o.sheenRoughnessTexture)),Promise.all(s)}}class J8{constructor(e){this.parser=e,this.name=vn.KHR_MATERIALS_TRANSMISSION}getMaterialType(e){const i=this.parser.json.materials[e];return i.extensions&&i.extensions[this.name]?Do:null}extendMaterialParams(e,t){const i=this.parser,r=i.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const s=[],o=r.extensions[this.name];return void 0!==o.transmissionFactor&&(t.transmission=o.transmissionFactor),void 0!==o.transmissionTexture&&s.push(i.assignTexture(t,"transmissionMap",o.transmissionTexture)),Promise.all(s)}}class K8{constructor(e){this.parser=e,this.name=vn.KHR_MATERIALS_VOLUME}getMaterialType(e){const i=this.parser.json.materials[e];return i.extensions&&i.extensions[this.name]?Do:null}extendMaterialParams(e,t){const i=this.parser,r=i.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const s=[],o=r.extensions[this.name];t.thickness=void 0!==o.thicknessFactor?o.thicknessFactor:0,void 0!==o.thicknessTexture&&s.push(i.assignTexture(t,"thicknessMap",o.thicknessTexture)),t.attenuationDistance=o.attenuationDistance||1/0;const a=o.attenuationColor||[1,1,1];return t.attenuationColor=new Qe(a[0],a[1],a[2]),Promise.all(s)}}class Q8{constructor(e){this.parser=e,this.name=vn.KHR_MATERIALS_IOR}getMaterialType(e){const i=this.parser.json.materials[e];return i.extensions&&i.extensions[this.name]?Do:null}extendMaterialParams(e,t){const r=this.parser.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const s=r.extensions[this.name];return t.ior=void 0!==s.ior?s.ior:1.5,Promise.resolve()}}class eq{constructor(e){this.parser=e,this.name=vn.KHR_MATERIALS_SPECULAR}getMaterialType(e){const i=this.parser.json.materials[e];return i.extensions&&i.extensions[this.name]?Do:null}extendMaterialParams(e,t){const i=this.parser,r=i.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const s=[],o=r.extensions[this.name];t.specularIntensity=void 0!==o.specularFactor?o.specularFactor:1,void 0!==o.specularTexture&&s.push(i.assignTexture(t,"specularIntensityMap",o.specularTexture));const a=o.specularColorFactor||[1,1,1];return t.specularColor=new Qe(a[0],a[1],a[2]),void 0!==o.specularColorTexture&&s.push(i.assignTexture(t,"specularColorMap",o.specularColorTexture,jt)),Promise.all(s)}}class tq{constructor(e){this.parser=e,this.name=vn.KHR_MATERIALS_ANISOTROPY}getMaterialType(e){const i=this.parser.json.materials[e];return i.extensions&&i.extensions[this.name]?Do:null}extendMaterialParams(e,t){const i=this.parser,r=i.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const s=[],o=r.extensions[this.name];return void 0!==o.anisotropyStrength&&(t.anisotropy=o.anisotropyStrength),void 0!==o.anisotropyRotation&&(t.anisotropyRotation=o.anisotropyRotation),void 0!==o.anisotropyTexture&&s.push(i.assignTexture(t,"anisotropyMap",o.anisotropyTexture)),Promise.all(s)}}class nq{constructor(e){this.parser=e,this.name=vn.KHR_TEXTURE_BASISU}loadTexture(e){const t=this.parser,i=t.json,r=i.textures[e];if(!r.extensions||!r.extensions[this.name])return null;const s=r.extensions[this.name],o=t.options.ktx2Loader;if(!o){if(i.extensionsRequired&&i.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return t.loadTextureImage(e,s.source,o)}}class iq{constructor(e){this.parser=e,this.name=vn.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(e){const t=this.name,i=this.parser,r=i.json,s=r.textures[e];if(!s.extensions||!s.extensions[t])return null;const o=s.extensions[t],a=r.images[o.source];let l=i.textureLoader;if(a.uri){const u=i.options.manager.getHandler(a.uri);null!==u&&(l=u)}return this.detectSupport().then(function(u){if(u)return i.loadTextureImage(e,o.source,l);if(r.extensionsRequired&&r.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return i.loadTexture(e)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(e){const t=new Image;t.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",t.onload=t.onerror=function(){e(1===t.height)}})),this.isSupported}}class rq{constructor(e){this.parser=e,this.name=vn.EXT_TEXTURE_AVIF,this.isSupported=null}loadTexture(e){const t=this.name,i=this.parser,r=i.json,s=r.textures[e];if(!s.extensions||!s.extensions[t])return null;const o=s.extensions[t],a=r.images[o.source];let l=i.textureLoader;if(a.uri){const u=i.options.manager.getHandler(a.uri);null!==u&&(l=u)}return this.detectSupport().then(function(u){if(u)return i.loadTextureImage(e,o.source,l);if(r.extensionsRequired&&r.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: AVIF required by asset but unsupported.");return i.loadTexture(e)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(e){const t=new Image;t.src="data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAABcAAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAEAAAABAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQAMAAAAABNjb2xybmNseAACAAIABoAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAAB9tZGF0EgAKCBgABogQEDQgMgkQAAAAB8dSLfI=",t.onload=t.onerror=function(){e(1===t.height)}})),this.isSupported}}class sq{constructor(e){this.name=vn.EXT_MESHOPT_COMPRESSION,this.parser=e}loadBufferView(e){const t=this.parser.json,i=t.bufferViews[e];if(i.extensions&&i.extensions[this.name]){const r=i.extensions[this.name],s=this.parser.getDependency("buffer",r.buffer),o=this.parser.options.meshoptDecoder;if(!o||!o.supported){if(t.extensionsRequired&&t.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return s.then(function(a){const d=r.count,f=r.byteStride,p=new Uint8Array(a,r.byteOffset||0,r.byteLength||0);return o.decodeGltfBufferAsync?o.decodeGltfBufferAsync(d,f,p,r.mode,r.filter).then(function(_){return _.buffer}):o.ready.then(function(){const _=new ArrayBuffer(d*f);return o.decodeGltfBuffer(new Uint8Array(_),d,f,p,r.mode,r.filter),_})})}return null}}class oq{constructor(e){this.name=vn.EXT_MESH_GPU_INSTANCING,this.parser=e}createNodeMesh(e){const t=this.parser.json,i=t.nodes[e];if(!i.extensions||!i.extensions[this.name]||void 0===i.mesh)return null;const r=t.meshes[i.mesh];for(const u of r.primitives)if(u.mode!==Kr.TRIANGLES&&u.mode!==Kr.TRIANGLE_STRIP&&u.mode!==Kr.TRIANGLE_FAN&&void 0!==u.mode)return null;const o=i.extensions[this.name].attributes,a=[],l={};for(const u in o)a.push(this.parser.getDependency("accessor",o[u]).then(d=>(l[u]=d,l[u])));return a.length<1?null:(a.push(this.parser.createNodeMesh(e)),Promise.all(a).then(u=>{const d=u.pop(),f=d.isGroup?d.children:[d],p=u[0].count,_=[];for(const y of f){const w=new Wt,A=new q,b=new Yi,C=new q(1,1,1),T=new Qy(y.geometry,y.material,p);for(let I=0;I<p;I++)l.TRANSLATION&&A.fromBufferAttribute(l.TRANSLATION,I),l.ROTATION&&b.fromBufferAttribute(l.ROTATION,I),l.SCALE&&C.fromBufferAttribute(l.SCALE,I),T.setMatrixAt(I,w.compose(A,b,C));for(const I in l)"TRANSLATION"!==I&&"ROTATION"!==I&&"SCALE"!==I&&y.geometry.setAttribute(I,l[I]);vi.prototype.copy.call(T,y),this.parser.assignFinalMaterial(T),_.push(T)}return d.isGroup?(d.clear(),d.add(..._),d):_[0]}))}}const tI="glTF";class aq{constructor(e){this.name=vn.KHR_BINARY_GLTF,this.content=null,this.body=null;const t=new DataView(e,0,12),i=new TextDecoder;if(this.header={magic:i.decode(new Uint8Array(e.slice(0,4))),version:t.getUint32(4,!0),length:t.getUint32(8,!0)},this.header.magic!==tI)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");const r=this.header.length-12,s=new DataView(e,12);let o=0;for(;o<r;){const a=s.getUint32(o,!0);o+=4;const l=s.getUint32(o,!0);if(o+=4,1313821514===l){const u=new Uint8Array(e,12+o,a);this.content=i.decode(u)}else if(5130562===l){const u=12+o;this.body=e.slice(u,u+a)}o+=a}if(null===this.content)throw new Error("THREE.GLTFLoader: JSON content not found.")}}class lq{constructor(e,t){if(!t)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=vn.KHR_DRACO_MESH_COMPRESSION,this.json=e,this.dracoLoader=t,this.dracoLoader.preload()}decodePrimitive(e,t){const i=this.json,r=this.dracoLoader,s=e.extensions[this.name].bufferView,o=e.extensions[this.name].attributes,a={},l={},u={};for(const d in o){const f=K0[d]||d.toLowerCase();a[f]=o[d]}for(const d in e.attributes){const f=K0[d]||d.toLowerCase();if(void 0!==o[d]){const p=i.accessors[e.attributes[d]];u[f]=uu[p.componentType].name,l[f]=!0===p.normalized}}return t.getDependency("bufferView",s).then(function(d){return new Promise(function(f){r.decodeDracoFile(d,function(p){for(const _ in p.attributes){const w=l[_];void 0!==w&&(p.attributes[_].normalized=w)}f(p)},a,u)})})}}class cq{constructor(){this.name=vn.KHR_TEXTURE_TRANSFORM}extendTexture(e,t){return(void 0===t.texCoord||t.texCoord===e.channel)&&void 0===t.offset&&void 0===t.rotation&&void 0===t.scale||(e=e.clone(),void 0!==t.texCoord&&(e.channel=t.texCoord),void 0!==t.offset&&e.offset.fromArray(t.offset),void 0!==t.rotation&&(e.rotation=t.rotation),void 0!==t.scale&&e.repeat.fromArray(t.scale),e.needsUpdate=!0),e}}class uq{constructor(){this.name=vn.KHR_MESH_QUANTIZATION}}class iI extends Qh{constructor(e,t,i,r){super(e,t,i,r)}copySampleValue_(e){const t=this.resultBuffer,i=this.sampleValues,r=this.valueSize,s=e*r*3+r;for(let o=0;o!==r;o++)t[o]=i[s+o];return t}interpolate_(e,t,i,r){const s=this.resultBuffer,o=this.sampleValues,a=this.valueSize,l=2*a,u=3*a,d=r-t,f=(i-t)/d,p=f*f,_=p*f,y=e*u,w=y-u,A=-2*_+3*p,b=_-p,C=1-A,T=b-p+f;for(let I=0;I!==a;I++)s[I]=C*o[w+I+a]+T*(o[w+I+l]*d)+A*o[y+I+a]+b*(o[y+I]*d);return s}}const hq=new Yi;class dq extends iI{interpolate_(e,t,i,r){const s=super.interpolate_(e,t,i,r);return hq.fromArray(s).normalize().toArray(s),s}}const Kr={FLOAT:5126,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,LINEAR:9729,REPEAT:10497,SAMPLER_2D:35678,POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123},uu={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},rI={9728:ui,9729:ei,9984:1004,9985:1007,9986:1005,9987:_o},sI={33071:$i,33648:1002,10497:Oa},J0={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},K0={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv1",TEXCOORD_2:"uv2",TEXCOORD_3:"uv3",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},ca={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},fq={CUBICSPLINE:void 0,LINEAR:bc,STEP:Ih};function fl(n,e,t){for(const i in t.extensions)void 0===n[i]&&(e.userData.gltfExtensions=e.userData.gltfExtensions||{},e.userData.gltfExtensions[i]=t.extensions[i])}function ua(n,e){void 0!==e.extras&&("object"==typeof e.extras?Object.assign(n.userData,e.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+e.extras))}function _q(n,e){if(n.updateMorphTargets(),void 0!==e.weights)for(let t=0,i=e.weights.length;t<i;t++)n.morphTargetInfluences[t]=e.weights[t];if(e.extras&&Array.isArray(e.extras.targetNames)){const t=e.extras.targetNames;if(n.morphTargetInfluences.length===t.length){n.morphTargetDictionary={};for(let i=0,r=t.length;i<r;i++)n.morphTargetDictionary[t[i]]=i}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function gq(n){let e;const t=n.extensions&&n.extensions[vn.KHR_DRACO_MESH_COMPRESSION];if(e=t?"draco:"+t.bufferView+":"+t.indices+":"+ex(t.attributes):n.indices+":"+ex(n.attributes)+":"+n.mode,void 0!==n.targets)for(let i=0,r=n.targets.length;i<r;i++)e+=":"+ex(n.targets[i]);return e}function ex(n){let e="";const t=Object.keys(n).sort();for(let i=0,r=t.length;i<r;i++)e+=t[i]+":"+n[t[i]]+";";return e}function tx(n){switch(n){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}const yq=new Wt;class xq{constructor(e={},t={}){this.json=e,this.extensions={},this.plugins={},this.options=t,this.cache=new W8,this.associations=new Map,this.primitiveCache={},this.nodeCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.sourceCache={},this.textureCache={},this.nodeNamesUsed={};let i=!1,r=!1,s=-1;typeof navigator<"u"&&(i=!0===/^((?!chrome|android).)*safari/i.test(navigator.userAgent),r=navigator.userAgent.indexOf("Firefox")>-1,s=r?navigator.userAgent.match(/Firefox\/([0-9]+)\./)[1]:-1),this.textureLoader=typeof createImageBitmap>"u"||i||r&&s<98?new l1(this.options.manager):new zW(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new bs(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),"use-credentials"===this.options.crossOrigin&&this.fileLoader.setWithCredentials(!0)}setExtensions(e){this.extensions=e}setPlugins(e){this.plugins=e}parse(e,t){const i=this,r=this.json,s=this.extensions;this.cache.removeAll(),this.nodeCache={},this._invokeAll(function(o){return o._markDefs&&o._markDefs()}),Promise.all(this._invokeAll(function(o){return o.beforeRoot&&o.beforeRoot()})).then(function(){return Promise.all([i.getDependencies("scene"),i.getDependencies("animation"),i.getDependencies("camera")])}).then(function(o){const a={scene:o[0][r.scene||0],scenes:o[0],animations:o[1],cameras:o[2],asset:r.asset,parser:i,userData:{}};fl(s,a,r),ua(a,r),Promise.all(i._invokeAll(function(l){return l.afterRoot&&l.afterRoot(a)})).then(function(){e(a)})}).catch(t)}_markDefs(){const e=this.json.nodes||[],t=this.json.skins||[],i=this.json.meshes||[];for(let r=0,s=t.length;r<s;r++){const o=t[r].joints;for(let a=0,l=o.length;a<l;a++)e[o[a]].isBone=!0}for(let r=0,s=e.length;r<s;r++){const o=e[r];void 0!==o.mesh&&(this._addNodeRef(this.meshCache,o.mesh),void 0!==o.skin&&(i[o.mesh].isSkinnedMesh=!0)),void 0!==o.camera&&this._addNodeRef(this.cameraCache,o.camera)}}_addNodeRef(e,t){void 0!==t&&(void 0===e.refs[t]&&(e.refs[t]=e.uses[t]=0),e.refs[t]++)}_getNodeRef(e,t,i){if(e.refs[t]<=1)return i;const r=i.clone(),s=(o,a)=>{const l=this.associations.get(o);null!=l&&this.associations.set(a,l);for(const[u,d]of o.children.entries())s(d,a.children[u])};return s(i,r),r.name+="_instance_"+e.uses[t]++,r}_invokeOne(e){const t=Object.values(this.plugins);t.push(this);for(let i=0;i<t.length;i++){const r=e(t[i]);if(r)return r}return null}_invokeAll(e){const t=Object.values(this.plugins);t.unshift(this);const i=[];for(let r=0;r<t.length;r++){const s=e(t[r]);s&&i.push(s)}return i}getDependency(e,t){const i=e+":"+t;let r=this.cache.get(i);if(!r){switch(e){case"scene":r=this.loadScene(t);break;case"node":r=this._invokeOne(function(s){return s.loadNode&&s.loadNode(t)});break;case"mesh":r=this._invokeOne(function(s){return s.loadMesh&&s.loadMesh(t)});break;case"accessor":r=this.loadAccessor(t);break;case"bufferView":r=this._invokeOne(function(s){return s.loadBufferView&&s.loadBufferView(t)});break;case"buffer":r=this.loadBuffer(t);break;case"material":r=this._invokeOne(function(s){return s.loadMaterial&&s.loadMaterial(t)});break;case"texture":r=this._invokeOne(function(s){return s.loadTexture&&s.loadTexture(t)});break;case"skin":r=this.loadSkin(t);break;case"animation":r=this._invokeOne(function(s){return s.loadAnimation&&s.loadAnimation(t)});break;case"camera":r=this.loadCamera(t);break;default:if(r=this._invokeOne(function(s){return s!=this&&s.getDependency&&s.getDependency(e,t)}),!r)throw new Error("Unknown type: "+e)}this.cache.add(i,r)}return r}getDependencies(e){let t=this.cache.get(e);if(!t){const i=this;t=Promise.all((this.json[e+("mesh"===e?"es":"s")]||[]).map(function(s,o){return i.getDependency(e,o)})),this.cache.add(e,t)}return t}loadBuffer(e){const t=this.json.buffers[e],i=this.fileLoader;if(t.type&&"arraybuffer"!==t.type)throw new Error("THREE.GLTFLoader: "+t.type+" buffer type is not supported.");if(void 0===t.uri&&0===e)return Promise.resolve(this.extensions[vn.KHR_BINARY_GLTF].body);const r=this.options;return new Promise(function(s,o){i.load(rd.resolveURL(t.uri,r.path),s,void 0,function(){o(new Error('THREE.GLTFLoader: Failed to load buffer "'+t.uri+'".'))})})}loadBufferView(e){const t=this.json.bufferViews[e];return this.getDependency("buffer",t.buffer).then(function(i){const s=t.byteOffset||0;return i.slice(s,s+(t.byteLength||0))})}loadAccessor(e){const t=this,i=this.json,r=this.json.accessors[e];if(void 0===r.bufferView&&void 0===r.sparse){const o=J0[r.type],l=!0===r.normalized,u=new(0,uu[r.componentType])(r.count*o);return Promise.resolve(new ni(u,o,l))}const s=[];return s.push(void 0!==r.bufferView?this.getDependency("bufferView",r.bufferView):null),void 0!==r.sparse&&(s.push(this.getDependency("bufferView",r.sparse.indices.bufferView)),s.push(this.getDependency("bufferView",r.sparse.values.bufferView))),Promise.all(s).then(function(o){const a=o[0],l=J0[r.type],u=uu[r.componentType],d=u.BYTES_PER_ELEMENT,p=r.byteOffset||0,_=void 0!==r.bufferView?i.bufferViews[r.bufferView].byteStride:void 0,y=!0===r.normalized;let w,A;if(_&&_!==d*l){const b=Math.floor(p/_),C="InterleavedBuffer:"+r.bufferView+":"+r.componentType+":"+b+":"+r.count;let T=t.cache.get(C);T||(w=new u(a,b*_,r.count*_/d),T=new Xy(w,_/d),t.cache.add(C,T)),A=new el(T,l,p%_/d,y)}else w=null===a?new u(r.count*l):new u(a,p,r.count*l),A=new ni(w,l,y);if(void 0!==r.sparse){const I=r.sparse.values.byteOffset||0,N=new(0,uu[r.sparse.indices.componentType])(o[1],r.sparse.indices.byteOffset||0,r.sparse.count*J0.SCALAR),k=new u(o[2],I,r.sparse.count*l);null!==a&&(A=new ni(A.array.slice(),A.itemSize,A.normalized));for(let G=0,K=N.length;G<K;G++){const L=N[G];if(A.setX(L,k[G*l]),l>=2&&A.setY(L,k[G*l+1]),l>=3&&A.setZ(L,k[G*l+2]),l>=4&&A.setW(L,k[G*l+3]),l>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return A})}loadTexture(e){const t=this.json,s=t.textures[e].source,o=t.images[s];let a=this.textureLoader;if(o.uri){const l=this.options.manager.getHandler(o.uri);null!==l&&(a=l)}return this.loadTextureImage(e,s,a)}loadTextureImage(e,t,i){const r=this,s=this.json,o=s.textures[e],a=s.images[t],l=(a.uri||a.bufferView)+":"+o.sampler;if(this.textureCache[l])return this.textureCache[l];const u=this.loadImageSource(t,i).then(function(d){d.flipY=!1,d.name=o.name||a.name||"",""===d.name&&"string"==typeof a.uri&&!1===a.uri.startsWith("data:image/")&&(d.name=a.uri);const p=(s.samplers||{})[o.sampler]||{};return d.magFilter=rI[p.magFilter]||ei,d.minFilter=rI[p.minFilter]||_o,d.wrapS=sI[p.wrapS]||Oa,d.wrapT=sI[p.wrapT]||Oa,r.associations.set(d,{textures:e}),d}).catch(function(){return null});return this.textureCache[l]=u,u}loadImageSource(e,t){const r=this.json,s=this.options;if(void 0!==this.sourceCache[e])return this.sourceCache[e].then(f=>f.clone());const o=r.images[e],a=self.URL||self.webkitURL;let l=o.uri||"",u=!1;if(void 0!==o.bufferView)l=this.getDependency("bufferView",o.bufferView).then(function(f){u=!0;const p=new Blob([f],{type:o.mimeType});return l=a.createObjectURL(p),l});else if(void 0===o.uri)throw new Error("THREE.GLTFLoader: Image "+e+" is missing URI and bufferView");const d=Promise.resolve(l).then(function(f){return new Promise(function(p,_){let y=p;!0===t.isImageBitmapLoader&&(y=function(w){const A=new _s(w);A.needsUpdate=!0,p(A)}),t.load(rd.resolveURL(f,s.path),y,void 0,_)})}).then(function(f){return!0===u&&a.revokeObjectURL(l),f.userData.mimeType=o.mimeType||function vq(n){return n.search(/\.jpe?g($|\?)/i)>0||0===n.search(/^data\:image\/jpeg/)?"image/jpeg":n.search(/\.webp($|\?)/i)>0||0===n.search(/^data\:image\/webp/)?"image/webp":"image/png"}(o.uri),f}).catch(function(f){throw console.error("THREE.GLTFLoader: Couldn't load texture",l),f});return this.sourceCache[e]=d,d}assignTexture(e,t,i,r){const s=this;return this.getDependency("texture",i.index).then(function(o){if(!o)return null;if(void 0!==i.texCoord&&i.texCoord>0&&((o=o.clone()).channel=i.texCoord),s.extensions[vn.KHR_TEXTURE_TRANSFORM]){const a=void 0!==i.extensions?i.extensions[vn.KHR_TEXTURE_TRANSFORM]:void 0;if(a){const l=s.associations.get(o);o=s.extensions[vn.KHR_TEXTURE_TRANSFORM].extendTexture(o,a),s.associations.set(o,l)}}return void 0!==r&&(o.colorSpace=r),e[t]=o,o})}assignFinalMaterial(e){const t=e.geometry;let i=e.material;const r=void 0===t.attributes.tangent,s=void 0!==t.attributes.color,o=void 0===t.attributes.normal;if(e.isPoints){const a="PointsMaterial:"+i.uuid;let l=this.cache.get(a);l||(l=new t0,$r.prototype.copy.call(l,i),l.color.copy(i.color),l.map=i.map,l.sizeAttenuation=!1,this.cache.add(a,l)),i=l}else if(e.isLine){const a="LineBasicMaterial:"+i.uuid;let l=this.cache.get(a);l||(l=new rr,$r.prototype.copy.call(l,i),l.color.copy(i.color),l.map=i.map,this.cache.add(a,l)),i=l}if(r||s||o){let a="ClonedMaterial:"+i.uuid+":";r&&(a+="derivative-tangents:"),s&&(a+="vertex-colors:"),o&&(a+="flat-shading:");let l=this.cache.get(a);l||(l=i.clone(),s&&(l.vertexColors=!0),o&&(l.flatShading=!0),r&&(l.normalScale&&(l.normalScale.y*=-1),l.clearcoatNormalScale&&(l.clearcoatNormalScale.y*=-1)),this.cache.add(a,l),this.associations.set(l,this.associations.get(i))),i=l}e.material=i}getMaterialType(){return lm}loadMaterial(e){const t=this,r=this.extensions,s=this.json.materials[e];let o;const a={},u=[];if((s.extensions||{})[vn.KHR_MATERIALS_UNLIT]){const f=r[vn.KHR_MATERIALS_UNLIT];o=f.getMaterialType(),u.push(f.extendParams(a,s,t))}else{const f=s.pbrMetallicRoughness||{};if(a.color=new Qe(1,1,1),a.opacity=1,Array.isArray(f.baseColorFactor)){const p=f.baseColorFactor;a.color.fromArray(p),a.opacity=p[3]}void 0!==f.baseColorTexture&&u.push(t.assignTexture(a,"map",f.baseColorTexture,jt)),a.metalness=void 0!==f.metallicFactor?f.metallicFactor:1,a.roughness=void 0!==f.roughnessFactor?f.roughnessFactor:1,void 0!==f.metallicRoughnessTexture&&(u.push(t.assignTexture(a,"metalnessMap",f.metallicRoughnessTexture)),u.push(t.assignTexture(a,"roughnessMap",f.metallicRoughnessTexture))),o=this._invokeOne(function(p){return p.getMaterialType&&p.getMaterialType(e)}),u.push(Promise.all(this._invokeAll(function(p){return p.extendMaterialParams&&p.extendMaterialParams(e,a)})))}!0===s.doubleSided&&(a.side=2);const d=s.alphaMode||"OPAQUE";if("BLEND"===d?(a.transparent=!0,a.depthWrite=!1):(a.transparent=!1,"MASK"===d&&(a.alphaTest=void 0!==s.alphaCutoff?s.alphaCutoff:.5)),void 0!==s.normalTexture&&o!==Xr&&(u.push(t.assignTexture(a,"normalMap",s.normalTexture)),a.normalScale=new Be(1,1),void 0!==s.normalTexture.scale)){const f=s.normalTexture.scale;a.normalScale.set(f,f)}return void 0!==s.occlusionTexture&&o!==Xr&&(u.push(t.assignTexture(a,"aoMap",s.occlusionTexture)),void 0!==s.occlusionTexture.strength&&(a.aoMapIntensity=s.occlusionTexture.strength)),void 0!==s.emissiveFactor&&o!==Xr&&(a.emissive=(new Qe).fromArray(s.emissiveFactor)),void 0!==s.emissiveTexture&&o!==Xr&&u.push(t.assignTexture(a,"emissiveMap",s.emissiveTexture,jt)),Promise.all(u).then(function(){const f=new o(a);return s.name&&(f.name=s.name),ua(f,s),t.associations.set(f,{materials:e}),s.extensions&&fl(r,f,s),f})}createUniqueName(e){const t=Vn.sanitizeNodeName(e||"");return t in this.nodeNamesUsed?t+"_"+ ++this.nodeNamesUsed[t]:(this.nodeNamesUsed[t]=0,t)}loadGeometries(e){const t=this,i=this.extensions,r=this.primitiveCache;function s(a){return i[vn.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(a,t).then(function(l){return oI(l,a,t)})}const o=[];for(let a=0,l=e.length;a<l;a++){const u=e[a],d=gq(u),f=r[d];if(f)o.push(f.promise);else{let p;p=u.extensions&&u.extensions[vn.KHR_DRACO_MESH_COMPRESSION]?s(u):oI(new hn,u,t),r[d]={primitive:u,promise:p},o.push(p)}}return Promise.all(o)}loadMesh(e){const t=this,r=this.extensions,s=this.json.meshes[e],o=s.primitives,a=[];for(let l=0,u=o.length;l<u;l++){const d=void 0===o[l].material?(void 0===(n=this.cache).DefaultMaterial&&(n.DefaultMaterial=new lm({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:0})),n.DefaultMaterial):this.getDependency("material",o[l].material);a.push(d)}var n;return a.push(t.loadGeometries(o)),Promise.all(a).then(function(l){const u=l.slice(0,l.length-1),d=l[l.length-1],f=[];for(let _=0,y=d.length;_<y;_++){const w=d[_],A=o[_];let b;const C=u[_];if(A.mode===Kr.TRIANGLES||A.mode===Kr.TRIANGLE_STRIP||A.mode===Kr.TRIANGLE_FAN||void 0===A.mode)b=!0===s.isSkinnedMesh?new PD(w,C):new Gn(w,C),!0===b.isSkinnedMesh&&b.normalizeSkinWeights(),A.mode===Kr.TRIANGLE_STRIP?b.geometry=eI(b.geometry,1):A.mode===Kr.TRIANGLE_FAN&&(b.geometry=eI(b.geometry,2));else if(A.mode===Kr.LINES)b=new nl(w,C);else if(A.mode===Kr.LINE_STRIP)b=new tl(w,C);else if(A.mode===Kr.LINE_LOOP)b=new zD(w,C);else{if(A.mode!==Kr.POINTS)throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+A.mode);b=new r0(w,C)}Object.keys(b.geometry.morphAttributes).length>0&&_q(b,s),b.name=t.createUniqueName(s.name||"mesh_"+e),ua(b,s),A.extensions&&fl(r,b,A),t.assignFinalMaterial(b),f.push(b)}for(let _=0,y=f.length;_<y;_++)t.associations.set(f[_],{meshes:e,primitives:_});if(1===f.length)return s.extensions&&fl(r,f[0],s),f[0];const p=new ia;s.extensions&&fl(r,p,s),t.associations.set(p,{meshes:e});for(let _=0,y=f.length;_<y;_++)p.add(f[_]);return p})}loadCamera(e){let t;const i=this.json.cameras[e],r=i[i.type];if(r)return"perspective"===i.type?t=new Fi(yo.radToDeg(r.yfov),r.aspectRatio||1,r.znear||1,r.zfar||2e6):"orthographic"===i.type&&(t=new Op(-r.xmag,r.xmag,r.ymag,-r.ymag,r.znear,r.zfar)),i.name&&(t.name=this.createUniqueName(i.name)),ua(t,i),Promise.resolve(t);console.warn("THREE.GLTFLoader: Missing camera parameters.")}loadSkin(e){const t=this.json.skins[e],i=[];for(let r=0,s=t.joints.length;r<s;r++)i.push(this._loadNodeShallow(t.joints[r]));return i.push(void 0!==t.inverseBindMatrices?this.getDependency("accessor",t.inverseBindMatrices):null),Promise.all(i).then(function(r){const s=r.pop(),o=r,a=[],l=[];for(let u=0,d=o.length;u<d;u++){const f=o[u];if(f){a.push(f);const p=new Wt;null!==s&&p.fromArray(s.array,16*u),l.push(p)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',t.joints[u])}return new qp(a,l)})}loadAnimation(e){const i=this,r=this.json.animations[e],s=r.name?r.name:"animation_"+e,o=[],a=[],l=[],u=[],d=[];for(let f=0,p=r.channels.length;f<p;f++){const _=r.channels[f],y=r.samplers[_.sampler],w=_.target,b=void 0!==r.parameters?r.parameters[y.input]:y.input,C=void 0!==r.parameters?r.parameters[y.output]:y.output;void 0!==w.node&&(o.push(this.getDependency("node",w.node)),a.push(this.getDependency("accessor",b)),l.push(this.getDependency("accessor",C)),u.push(y),d.push(w))}return Promise.all([Promise.all(o),Promise.all(a),Promise.all(l),Promise.all(u),Promise.all(d)]).then(function(f){const p=f[0],_=f[1],y=f[2],w=f[3],A=f[4],b=[];for(let C=0,T=p.length;C<T;C++){const I=p[C],N=_[C],k=y[C],G=w[C],K=A[C];if(void 0===I)continue;I.updateMatrix&&(I.updateMatrix(),I.matrixAutoUpdate=!0);const L=i._createAnimationTracks(I,N,k,G,K);if(L)for(let H=0;H<L.length;H++)b.push(L[H])}return new td(s,void 0,b)})}createNodeMesh(e){const i=this,r=this.json.nodes[e];return void 0===r.mesh?null:i.getDependency("mesh",r.mesh).then(function(s){const o=i._getNodeRef(i.meshCache,r.mesh,s);return void 0!==r.weights&&o.traverse(function(a){if(a.isMesh)for(let l=0,u=r.weights.length;l<u;l++)a.morphTargetInfluences[l]=r.weights[l]}),o})}loadNode(e){const i=this,r=this.json.nodes[e],s=i._loadNodeShallow(e),o=[],a=r.children||[];for(let u=0,d=a.length;u<d;u++)o.push(i.getDependency("node",a[u]));const l=void 0===r.skin?Promise.resolve(null):i.getDependency("skin",r.skin);return Promise.all([s,Promise.all(o),l]).then(function(u){const d=u[0],f=u[1],p=u[2];null!==p&&d.traverse(function(_){_.isSkinnedMesh&&_.bind(p,yq)});for(let _=0,y=f.length;_<y;_++)d.add(f[_]);return d})}_loadNodeShallow(e){const i=this.extensions,r=this;if(void 0!==this.nodeCache[e])return this.nodeCache[e];const s=this.json.nodes[e],o=s.name?r.createUniqueName(s.name):"",a=[],l=r._invokeOne(function(u){return u.createNodeMesh&&u.createNodeMesh(e)});return l&&a.push(l),void 0!==s.camera&&a.push(r.getDependency("camera",s.camera).then(function(u){return r._getNodeRef(r.cameraCache,s.camera,u)})),r._invokeAll(function(u){return u.createNodeAttachment&&u.createNodeAttachment(e)}).forEach(function(u){a.push(u)}),this.nodeCache[e]=Promise.all(a).then(function(u){let d;if(d=!0===s.isBone?new Ky:u.length>1?new ia:1===u.length?u[0]:new vi,d!==u[0])for(let f=0,p=u.length;f<p;f++)d.add(u[f]);if(s.name&&(d.userData.name=s.name,d.name=o),ua(d,s),s.extensions&&fl(i,d,s),void 0!==s.matrix){const f=new Wt;f.fromArray(s.matrix),d.applyMatrix4(f)}else void 0!==s.translation&&d.position.fromArray(s.translation),void 0!==s.rotation&&d.quaternion.fromArray(s.rotation),void 0!==s.scale&&d.scale.fromArray(s.scale);return r.associations.has(d)||r.associations.set(d,{}),r.associations.get(d).nodes=e,d}),this.nodeCache[e]}loadScene(e){const t=this.extensions,i=this.json.scenes[e],r=this,s=new ia;i.name&&(s.name=r.createUniqueName(i.name)),ua(s,i),i.extensions&&fl(t,s,i);const o=i.nodes||[],a=[];for(let l=0,u=o.length;l<u;l++)a.push(r.getDependency("node",o[l]));return Promise.all(a).then(function(l){for(let d=0,f=l.length;d<f;d++)s.add(l[d]);return r.associations=(d=>{const f=new Map;for(const[p,_]of r.associations)(p instanceof $r||p instanceof _s)&&f.set(p,_);return d.traverse(p=>{const _=r.associations.get(p);null!=_&&f.set(p,_)}),f})(s),s})}_createAnimationTracks(e,t,i,r,s){const o=[],a=e.name?e.name:e.uuid,l=[];let u;switch(ca[s.path]===ca.weights?e.traverse(function(p){p.morphTargetInfluences&&l.push(p.name?p.name:p.uuid)}):l.push(a),ca[s.path]){case ca.weights:u=ru;break;case ca.rotation:u=ol;break;default:switch(i.itemSize){case 1:u=ru;break;case 2:case 3:u=ed}}const d=void 0!==r.interpolation?fq[r.interpolation]:bc,f=this._getArrayFromAccessor(i);for(let p=0,_=l.length;p<_;p++){const y=new u(l[p]+"."+ca[s.path],t.array,f,d);"CUBICSPLINE"===d&&this._createCubicSplineTrackInterpolant(y),o.push(y)}return o}_getArrayFromAccessor(e){let t=e.array;if(e.normalized){const i=tx(t.constructor),r=new Float32Array(t.length);for(let s=0,o=t.length;s<o;s++)r[s]=t[s]*i;t=r}return t}_createCubicSplineTrackInterpolant(e){e.createInterpolant=function(i){return new(this instanceof ol?dq:iI)(this.times,this.values,this.getValueSize()/3,i)},e.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0}}function oI(n,e,t){const i=e.attributes,r=[];function s(o,a){return t.getDependency("accessor",o).then(function(l){n.setAttribute(a,l)})}for(const o in i){const a=K0[o]||o.toLowerCase();a in n.attributes||r.push(s(i[o],a))}if(void 0!==e.indices&&!n.index){const o=t.getDependency("accessor",e.indices).then(function(a){n.setIndex(a)});r.push(o)}return ua(n,e),function bq(n,e,t){const i=e.attributes,r=new Hs;if(void 0===i.POSITION)return;{const a=t.json.accessors[i.POSITION],l=a.min,u=a.max;if(void 0===l||void 0===u)return void console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");if(r.set(new q(l[0],l[1],l[2]),new q(u[0],u[1],u[2])),a.normalized){const d=tx(uu[a.componentType]);r.min.multiplyScalar(d),r.max.multiplyScalar(d)}}const s=e.targets;if(void 0!==s){const a=new q,l=new q;for(let u=0,d=s.length;u<d;u++){const f=s[u];if(void 0!==f.POSITION){const p=t.json.accessors[f.POSITION],_=p.min,y=p.max;if(void 0!==_&&void 0!==y){if(l.setX(Math.max(Math.abs(_[0]),Math.abs(y[0]))),l.setY(Math.max(Math.abs(_[1]),Math.abs(y[1]))),l.setZ(Math.max(Math.abs(_[2]),Math.abs(y[2]))),p.normalized){const w=tx(uu[p.componentType]);l.multiplyScalar(w)}a.max(l)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}r.expandByVector(a)}n.boundingBox=r;const o=new gs;r.getCenter(o.center),o.radius=r.min.distanceTo(r.max)/2,n.boundingSphere=o}(n,e,t),Promise.all(r).then(function(){return void 0!==e.targets?function mq(n,e,t){let i=!1,r=!1,s=!1;for(let u=0,d=e.length;u<d;u++){const f=e[u];if(void 0!==f.POSITION&&(i=!0),void 0!==f.NORMAL&&(r=!0),void 0!==f.COLOR_0&&(s=!0),i&&r&&s)break}if(!i&&!r&&!s)return Promise.resolve(n);const o=[],a=[],l=[];for(let u=0,d=e.length;u<d;u++){const f=e[u];if(i){const p=void 0!==f.POSITION?t.getDependency("accessor",f.POSITION):n.attributes.position;o.push(p)}if(r){const p=void 0!==f.NORMAL?t.getDependency("accessor",f.NORMAL):n.attributes.normal;a.push(p)}if(s){const p=void 0!==f.COLOR_0?t.getDependency("accessor",f.COLOR_0):n.attributes.color;l.push(p)}}return Promise.all([Promise.all(o),Promise.all(a),Promise.all(l)]).then(function(u){const f=u[1],p=u[2];return i&&(n.morphAttributes.position=u[0]),r&&(n.morphAttributes.normal=f),s&&(n.morphAttributes.color=p),n.morphTargetsRelative=!0,n})}(n,e.targets,t):n})}let Aq=(()=>{class n{constructor(){this.loaded=!1,this.playing=!1,this.loadingProgress=0,this.backgroundColor=12181758,rn.noise_3d="\n    //\n    // Description : Array and textureless GLSL 2D/3D/4D simplex \n    //               noise functions.\n    //      Author : Ian McEwan, Ashima Arts.\n    //  Maintainer : stegu\n    //     Lastmod : 20201014 (stegu)\n    //     License : Copyright (C) 2011 Ashima Arts. All rights reserved.\n    //               Distributed under the MIT License. See LICENSE file.\n    //               https://github.com/ashima/webgl-noise\n    //               https://github.com/stegu/webgl-noise\n    // \n\n    vec3 mod289(vec3 x) {\n        return x - floor(x * (1.0 / 289.0)) * 289.0;\n    }\n\n    vec4 mod289(vec4 x) {\n        return x - floor(x * (1.0 / 289.0)) * 289.0;\n    }\n\n    vec4 permute(vec4 x) {\n        return mod289(((x*34.0)+10.0)*x);\n    }\n\n    vec4 taylorInvSqrt(vec4 r)\n    {\n        return 1.79284291400159 - 0.85373472095314 * r;\n    }\n\n    float snoise(vec3 v)\n    { \n        const vec2  C = vec2(1.0/6.0, 1.0/3.0) ;\n        const vec4  D = vec4(0.0, 0.5, 1.0, 2.0);\n\n        // First corner\n        vec3 i  = floor(v + dot(v, C.yyy) );\n        vec3 x0 =   v - i + dot(i, C.xxx) ;\n\n        // Other corners\n        vec3 g = step(x0.yzx, x0.xyz);\n        vec3 l = 1.0 - g;\n        vec3 i1 = min( g.xyz, l.zxy );\n        vec3 i2 = max( g.xyz, l.zxy );\n\n        //   x0 = x0 - 0.0 + 0.0 * C.xxx;\n        //   x1 = x0 - i1  + 1.0 * C.xxx;\n        //   x2 = x0 - i2  + 2.0 * C.xxx;\n        //   x3 = x0 - 1.0 + 3.0 * C.xxx;\n        vec3 x1 = x0 - i1 + C.xxx;\n        vec3 x2 = x0 - i2 + C.yyy; // 2.0*C.x = 1/3 = C.y\n        vec3 x3 = x0 - D.yyy;      // -1.0+3.0*C.x = -0.5 = -D.y\n\n        // Permutations\n        i = mod289(i); \n        vec4 p = permute( permute( permute( \n                    i.z + vec4(0.0, i1.z, i2.z, 1.0 ))\n                + i.y + vec4(0.0, i1.y, i2.y, 1.0 )) \n                + i.x + vec4(0.0, i1.x, i2.x, 1.0 ));\n\n        // Gradients: 7x7 points over a square, mapped onto an octahedron.\n        // The ring size 17*17 = 289 is close to a multiple of 49 (49*6 = 294)\n        float n_ = 0.142857142857; // 1.0/7.0\n        vec3  ns = n_ * D.wyz - D.xzx;\n\n        vec4 j = p - 49.0 * floor(p * ns.z * ns.z);  //  mod(p,7*7)\n\n        vec4 x_ = floor(j * ns.z);\n        vec4 y_ = floor(j - 7.0 * x_ );    // mod(j,N)\n\n        vec4 x = x_ *ns.x + ns.yyyy;\n        vec4 y = y_ *ns.x + ns.yyyy;\n        vec4 h = 1.0 - abs(x) - abs(y);\n\n        vec4 b0 = vec4( x.xy, y.xy );\n        vec4 b1 = vec4( x.zw, y.zw );\n\n        //vec4 s0 = vec4(lessThan(b0,0.0))*2.0 - 1.0;\n        //vec4 s1 = vec4(lessThan(b1,0.0))*2.0 - 1.0;\n        vec4 s0 = floor(b0)*2.0 + 1.0;\n        vec4 s1 = floor(b1)*2.0 + 1.0;\n        vec4 sh = -step(h, vec4(0.0));\n\n        vec4 a0 = b0.xzyw + s0.xzyw*sh.xxyy ;\n        vec4 a1 = b1.xzyw + s1.xzyw*sh.zzww ;\n\n        vec3 p0 = vec3(a0.xy,h.x);\n        vec3 p1 = vec3(a0.zw,h.y);\n        vec3 p2 = vec3(a1.xy,h.z);\n        vec3 p3 = vec3(a1.zw,h.w);\n\n        //Normalise gradients\n        vec4 norm = taylorInvSqrt(vec4(dot(p0,p0), dot(p1,p1), dot(p2, p2), dot(p3,p3)));\n        p0 *= norm.x;\n        p1 *= norm.y;\n        p2 *= norm.z;\n        p3 *= norm.w;\n\n        // Mix final noise value\n        vec4 m = max(0.5 - vec4(dot(x0,x0), dot(x1,x1), dot(x2,x2), dot(x3,x3)), 0.0);\n        m = m * m;\n        return 105.0 * dot( m*m, vec4( dot(p0,x0), dot(p1,x1), \n                                        dot(p2,x2), dot(p3,x3) ) );\n    }\n",this.camera=new Fi(75),this.scene=new bD,this.scene.background=new Qe(this.backgroundColor),this.clock=new x1,this.world=new js.World({gravity:new js.Vec2(0,0)}),this.scene.add(new p1(16777215,.4)),this.dirLight=new P0(16777215,.8),this.dirLight.castShadow=!0,this.dirLight.shadow.camera.left=-.5,this.dirLight.shadow.camera.right=.5,this.dirLight.shadow.camera.top=.5,this.dirLight.shadow.camera.bottom=-.5,this.dirLight.shadow.camera.far=2,this.dirLight.shadow.mapSize.width=1024,this.dirLight.shadow.mapSize.height=1024,this.scene.add(this.dirLight),this.airboat=new o8(this.world),this.dirLight.target=this.airboat,this.scene.add(this.airboat),this.keyboardController=new h8,this.sound=new B1.Howl({src:["assets/bg.mp3"],loop:!0,volume:.5}),a1.onProgress=(t,i,r)=>this.loadingProgress=i/r}initialize(t){var i=this;return IT(function*(){if(i.loaded)return;i.renderer=new xD({antialias:!0,canvas:t}),i.renderer.shadowMap.enabled=!0,i.renderer.shadowMap.type=LT;const r=new G8,s=new bs,o=new l1,a=o.loadAsync(dl.waterHeightMapUrl),l=o.loadAsync(dl.terrainHeightMapUrl),u=dl.meshes.map(p=>r.loadAsync(`assets/${p}.glb`)),d=s.setResponseType("document").setMimeType("text/html").loadAsync(dl.mapSvgUrl);i.scenery=new B8(i.world,yield d,yield l);const f=new Map((yield Promise.all(u)).map((p,_)=>[dl.meshes[_],p]));i.scenery.placeMeshes(yield d,yield l,f),i.scene.add(i.scenery),i.water=new k8(yield a),i.scene.add(i.water),dl.DEBUG&&i.initDebugGui(),i.loaded=!0,i.onResize(),i.gameLoop()})()}start(){!this.loaded||this.playing||(this.sound.play(),this.airboat.sound.play(),this.playing=!0,this.gameLoop())}stop(){!this.loaded||!this.playing||(this.sound.stop(),this.airboat.sound.stop(),this.playing=!1)}onResize(){if(!this.loaded)return;const t=this.renderer.domElement.getBoundingClientRect();this.renderer.setSize(t.width,t.height,!1),this.camera.aspect=t.width/t.height,this.camera.updateProjectionMatrix()}reset(){this.airboat.reset()}gameLoop(){this.airboat.calculateForces(this.keyboardController.stepAxisValues()),this.world.step(1/144),this.airboat.syncBodyAndMesh(),this.airboat.updateTime(this.clock.getElapsedTime()),this.airboat.updateCamera(this.camera,this.keyboardController.getCameraDirection()),this.dirLight.position.copy(this.airboat.position.clone().add(new q(0,1,1))),this.water.updateTime(this.clock.getElapsedTime()),this.renderer.render(this.scene,this.camera),this.playing&&requestAnimationFrame(()=>this.gameLoop())}initDebugGui(){const t=new Q1,i=t.addFolder("Airboat");i.add(this.airboat.settings,"velocityTurningTorque",0,.2,.001),i.add(this.airboat.settings,"thrustTurningTorque",0,2),i.add(this.airboat.settings,"turningFriction",0,2),i.add(this.airboat.settings,"sidewaysDrag",0,5),i.add(this.airboat.settings,"frontalDrag",0,2),i.add(this.airboat.settings,"thrust",1,10),i.add(this.airboat.settings,"baseCameraDistance",.1,10),i.add(this.airboat.settings,"cameraDistanceVelocityScale",0,1),i.add(this.airboat.settings,"yPosition",0,.2),i.add(this.airboat.settings,"swayMaxX",0,.2),i.add(this.airboat.settings,"swayMultiplierX",0,.02),i.add(this.airboat.settings,"swayMaxZ",0,.2),i.add(this.airboat.settings,"swayMultiplierZ",0,.02),i.addColor(this.airboat.settings,"mainColor").onChange(o=>this.airboat.mainMaterial.color.set(o)),i.addColor(this.airboat.settings,"accentColor").onChange(o=>this.airboat.accentMaterial.color.set(o)),i.addColor(this.airboat.settings,"lineColor").onChange(o=>this.airboat.lineMaterial.color.set(o)),i.addColor(this.airboat.settings,"foamColor").onChange(o=>this.airboat.foamMaterial.uniforms.color.value.set(o));const r=t.addFolder("Scenery");r.addColor(this.scenery,"sandColor").onChange(o=>this.scenery.material.uniforms.sandColor.value.set(o)),r.addColor(this.scenery,"grassColor").onChange(o=>this.scenery.material.uniforms.grassColor.value.set(o)),r.addColor(this,"backgroundColor").onChange(o=>this.scene.background.set(o));const s=t.addFolder("Water");s.addColor(this.water,"waterColorDeep").onChange(o=>this.water.material.uniforms.waterColorDeep.value.set(o)),s.addColor(this.water,"waterColorShallow").onChange(o=>this.water.material.uniforms.waterColorShallow.value.set(o)),s.add(this.water,"surfaceNoiseCutoff",0,.2).onChange(o=>this.water.material.uniforms.surfaceNoiseCutoff.value=o),s.add(this.water,"edgeFoamCutoffMin",0,1).onChange(o=>this.water.material.uniforms.edgeFoamCutoffMin.value=o),s.add(this.water,"edgeFoamCutoffMax",0,1).onChange(o=>this.water.material.uniforms.edgeFoamCutoffMax.value=o),s.add(this.water,"noiseSpeed",0,.2).onChange(o=>this.water.material.uniforms.noiseSpeed.value=o),s.add(this.water,"noiseSize",1,200).onChange(o=>this.water.material.uniforms.noiseSize.value=o),this.scene.add(new r8(this.dirLight.shadow.camera))}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275prov=de({token:n,factory:n.\u0275fac,providedIn:"root"}),n})(),wq=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275cmp=Qm({type:n,selectors:[["app-hud"]],inputs:{axisValues:"axisValues",velocity:"velocity"},decls:10,vars:9,consts:[["viewBox","0 0 0.1 1.5",1,"throttle"],["width","0.1","fill","green"],["y","1","width","0.1","fill","red"],["height","0.05","width","0.1","fill","black"],[1,"bottom"],["viewBox","0 0 1.02 0.1",1,"yaw"],["width","0.02","height","0.1"]],template:function(t,i){1&t&&(m_(),qo(0,"svg",0),Ia(1,"rect",1)(2,"rect",2)(3,"rect",3),jo(),function rb(){!function bR(){Ht.lFrame.currentNamespace=null}()}(),qo(4,"div",4)(5,"span"),Of(6),tv(7,"number"),jo(),m_(),qo(8,"svg",5),Ia(9,"rect",6),jo()()),2&t&&(cs(1),nc("height",i.axisValues.throttle>0?i.axisValues.throttle:0)("y",1-i.axisValues.throttle),cs(1),nc("height",i.axisValues.throttle<0?-i.axisValues.throttle:0),cs(1),nc("y",.975),cs(3),Vf(function TS(n,e,t,i){const r=n+gn,s=Ne(),o=Bl(s,r);return vh(s,r)?AS(s,Ki(),e,o.transform,t,i,o):o.transform(t,i)}(7,6,i.velocity,"1.2-2")),cs(3),nc("x",.5+i.axisValues.yaw/2))},dependencies:[rT],styles:[".throttle[_ngcontent-%COMP%]{position:absolute;left:0;bottom:0;width:20px}.bottom[_ngcontent-%COMP%]{position:absolute;left:50%;bottom:0;transform:translate(-50%);display:flex;flex-direction:column;align-items:center}.yaw[_ngcontent-%COMP%]{height:20px}.throttle[_ngcontent-%COMP%], .yaw[_ngcontent-%COMP%]{padding:4px;margin:4px;border:1px solid black}"]}),n})();const Mq=["canvas"];function Sq(n,e){if(1&n&&(qo(0,"div",5),Of(1),tv(2,"percent"),jo()),2&n){const t=Nf();cs(1),Vf(ES(2,1,t.sim.loadingProgress))}}function Eq(n,e){1&n&&Ia(0,"div",6)}function Tq(n,e){if(1&n){const t=function Ww(){return Ne()}();qo(0,"div",7)(1,"button",8),Lf("click",function(){return function jx(n){return Ht.lFrame.contextLView=n,n[fi]}(t),function $x(n){return Ht.lFrame.contextLView=null,n}(Nf().sim.start())}),Of(2,"Play"),jo()()}}function Cq(n,e){if(1&n&&Ia(0,"app-hud",9),2&n){const t=Nf();Da("axisValues",t.sim.keyboardController.axisValues)("velocity",t.sim.airboat.speed)}}let Dq=(()=>{class n{constructor(t){this.sim=t}ngOnInit(){this.sim.initialize(this.canvas.nativeElement)}onResize(){this.sim.onResize()}onKey(t){this.sim.playing&&"KeyR"==t.code&&"keydown"==t.type?this.sim.reset():this.sim.playing&&"Escape"==t.code&&"keydown"==t.type?this.sim.stop():this.sim.playing||"Escape"!=t.code||"keydown"!=t.type?this.sim.keyboardController.onKeyEvent(t):this.sim.start()}}return n.\u0275fac=function(t){return new(t||n)(an(Aq))},n.\u0275cmp=Qm({type:n,selectors:[["app-root"]],viewQuery:function(t,i){if(1&t&&kS(Mq,7),2&t){let r;VS(r=function US(){return function fO(n,e){return n[Ds].queries[e].queryList}(Ne(),Kx())}())&&(i.canvas=r.first)}},hostBindings:function(t,i){1&t&&Lf("resize",function(){return i.onResize()},0,bf)("keydown",function(s){return i.onKey(s)},!1,bf)("keyup",function(s){return i.onKey(s)},!1,bf)},decls:6,vars:4,consts:[["canvas",""],["class","spinner",4,"ngIf"],["class","lds-dual-ring spinner",4,"ngIf"],["class","blur-bg",4,"ngIf"],[3,"axisValues","velocity",4,"ngIf"],[1,"spinner"],[1,"lds-dual-ring","spinner"],[1,"blur-bg"],[3,"click"],[3,"axisValues","velocity"]],template:function(t,i){1&t&&(Ia(0,"canvas",null,0),uh(2,Sq,3,3,"div",1),uh(3,Eq,1,0,"div",2),uh(4,Tq,3,0,"div",3),uh(5,Cq,1,2,"app-hud",4)),2&t&&(cs(2),Da("ngIf",!i.sim.loaded),cs(1),Da("ngIf",!i.sim.loaded),cs(1),Da("ngIf",i.sim.loaded&&!i.sim.playing),cs(1),Da("ngIf",i.sim.playing))},dependencies:[eT,wq,sT],styles:['canvas[_ngcontent-%COMP%]{height:100vh;width:100vw;display:block}app-hud[_ngcontent-%COMP%]{position:absolute;inset:0}.blur-bg[_ngcontent-%COMP%]{position:absolute;inset:0;-webkit-backdrop-filter:blur(20px);backdrop-filter:blur(20px);display:grid;place-items:center}.spinner[_ngcontent-%COMP%]{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%)}.lds-dual-ring[_ngcontent-%COMP%]{display:inline-block;width:80px;height:80px}.lds-dual-ring[_ngcontent-%COMP%]:after{content:" ";display:block;width:64px;height:64px;margin:8px;border-radius:50%;border:6px solid #fff;border-color:#fff transparent #fff transparent;animation:_ngcontent-%COMP%_lds-dual-ring 1.2s linear infinite}@keyframes _ngcontent-%COMP%_lds-dual-ring{0%{transform:rotate(0)}to{transform:rotate(360deg)}}']}),n})(),Iq=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=Iu({type:n,bootstrap:[Dq]}),n.\u0275inj=Oe({imports:[zU]}),n})();kU().bootstrapModule(Iq).catch(n=>console.error(n))},755:(_l,Po)=>{var Rn;!function(){"use strict";var Ln=function(){this.init()};Ln.prototype={init:function(){var E=this||Q;return E._counter=1e3,E._html5AudioPool=[],E.html5PoolSize=10,E._codecs={},E._howls=[],E._muted=!1,E._volume=1,E._canPlayEvent="canplaythrough",E._navigator=typeof window<"u"&&window.navigator?window.navigator:null,E.masterGain=null,E.noAudio=!1,E.usingWebAudio=!0,E.autoSuspend=!0,E.ctx=null,E.autoUnlock=!0,E._setup(),E},volume:function(E){var P=this||Q;if(E=parseFloat(E),P.ctx||He(),typeof E<"u"&&E>=0&&E<=1){if(P._volume=E,P._muted)return P;P.usingWebAudio&&P.masterGain.gain.setValueAtTime(E,Q.ctx.currentTime);for(var Y=0;Y<P._howls.length;Y++)if(!P._howls[Y]._webAudio)for(var ae=P._howls[Y]._getSoundIds(),Ae=0;Ae<ae.length;Ae++){var X=P._howls[Y]._soundById(ae[Ae]);X&&X._node&&(X._node.volume=X._volume*E)}return P}return P._volume},mute:function(E){var P=this||Q;P.ctx||He(),P._muted=E,P.usingWebAudio&&P.masterGain.gain.setValueAtTime(E?0:P._volume,Q.ctx.currentTime);for(var Y=0;Y<P._howls.length;Y++)if(!P._howls[Y]._webAudio)for(var ae=P._howls[Y]._getSoundIds(),Ae=0;Ae<ae.length;Ae++){var X=P._howls[Y]._soundById(ae[Ae]);X&&X._node&&(X._node.muted=!!E||X._muted)}return P},stop:function(){for(var E=this||Q,P=0;P<E._howls.length;P++)E._howls[P].stop();return E},unload:function(){for(var E=this||Q,P=E._howls.length-1;P>=0;P--)E._howls[P].unload();return E.usingWebAudio&&E.ctx&&typeof E.ctx.close<"u"&&(E.ctx.close(),E.ctx=null,He()),E},codecs:function(E){return(this||Q)._codecs[E.replace(/^x-/,"")]},_setup:function(){var E=this||Q;if(E.state=E.ctx&&E.ctx.state||"suspended",E._autoSuspend(),!E.usingWebAudio)if(typeof Audio<"u")try{typeof(new Audio).oncanplaythrough>"u"&&(E._canPlayEvent="canplay")}catch{E.noAudio=!0}else E.noAudio=!0;try{(new Audio).muted&&(E.noAudio=!0)}catch{}return E.noAudio||E._setupCodecs(),E},_setupCodecs:function(){var E=this||Q,P=null;try{P=typeof Audio<"u"?new Audio:null}catch{return E}if(!P||"function"!=typeof P.canPlayType)return E;var Y=P.canPlayType("audio/mpeg;").replace(/^no$/,""),ae=E._navigator?E._navigator.userAgent:"",Ae=ae.match(/OPR\/([0-6].)/g),X=Ae&&parseInt(Ae[0].split("/")[1],10)<33,ne=-1!==ae.indexOf("Safari")&&-1===ae.indexOf("Chrome"),mt=ae.match(/Version\/(.*?) /),dn=ne&&mt&&parseInt(mt[1],10)<15;return E._codecs={mp3:!(X||!Y&&!P.canPlayType("audio/mp3;").replace(/^no$/,"")),mpeg:!!Y,opus:!!P.canPlayType('audio/ogg; codecs="opus"').replace(/^no$/,""),ogg:!!P.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),oga:!!P.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),wav:!!(P.canPlayType('audio/wav; codecs="1"')||P.canPlayType("audio/wav")).replace(/^no$/,""),aac:!!P.canPlayType("audio/aac;").replace(/^no$/,""),caf:!!P.canPlayType("audio/x-caf;").replace(/^no$/,""),m4a:!!(P.canPlayType("audio/x-m4a;")||P.canPlayType("audio/m4a;")||P.canPlayType("audio/aac;")).replace(/^no$/,""),m4b:!!(P.canPlayType("audio/x-m4b;")||P.canPlayType("audio/m4b;")||P.canPlayType("audio/aac;")).replace(/^no$/,""),mp4:!!(P.canPlayType("audio/x-mp4;")||P.canPlayType("audio/mp4;")||P.canPlayType("audio/aac;")).replace(/^no$/,""),weba:!(dn||!P.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,"")),webm:!(dn||!P.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,"")),dolby:!!P.canPlayType('audio/mp4; codecs="ec-3"').replace(/^no$/,""),flac:!!(P.canPlayType("audio/x-flac;")||P.canPlayType("audio/flac;")).replace(/^no$/,"")},E},_unlockAudio:function(){var E=this||Q;if(!E._audioUnlocked&&E.ctx){E._audioUnlocked=!1,E.autoUnlock=!1,!E._mobileUnloaded&&44100!==E.ctx.sampleRate&&(E._mobileUnloaded=!0,E.unload()),E._scratchBuffer=E.ctx.createBuffer(1,1,22050);var P=function(Y){for(;E._html5AudioPool.length<E.html5PoolSize;)try{var ae=new Audio;ae._unlocked=!0,E._releaseHtml5Audio(ae)}catch{E.noAudio=!0;break}for(var Ae=0;Ae<E._howls.length;Ae++)if(!E._howls[Ae]._webAudio)for(var X=E._howls[Ae]._getSoundIds(),ne=0;ne<X.length;ne++){var mt=E._howls[Ae]._soundById(X[ne]);mt&&mt._node&&!mt._node._unlocked&&(mt._node._unlocked=!0,mt._node.load())}E._autoResume();var dn=E.ctx.createBufferSource();dn.buffer=E._scratchBuffer,dn.connect(E.ctx.destination),typeof dn.start>"u"?dn.noteOn(0):dn.start(0),"function"==typeof E.ctx.resume&&E.ctx.resume(),dn.onended=function(){dn.disconnect(0),E._audioUnlocked=!0,document.removeEventListener("touchstart",P,!0),document.removeEventListener("touchend",P,!0),document.removeEventListener("click",P,!0),document.removeEventListener("keydown",P,!0);for(var Wn=0;Wn<E._howls.length;Wn++)E._howls[Wn]._emit("unlock")}};return document.addEventListener("touchstart",P,!0),document.addEventListener("touchend",P,!0),document.addEventListener("click",P,!0),document.addEventListener("keydown",P,!0),E}},_obtainHtml5Audio:function(){var E=this||Q;if(E._html5AudioPool.length)return E._html5AudioPool.pop();var P=(new Audio).play();return P&&typeof Promise<"u"&&(P instanceof Promise||"function"==typeof P.then)&&P.catch(function(){console.warn("HTML5 Audio pool exhausted, returning potentially locked audio object.")}),new Audio},_releaseHtml5Audio:function(E){var P=this||Q;return E._unlocked&&P._html5AudioPool.push(E),P},_autoSuspend:function(){var E=this;if(E.autoSuspend&&E.ctx&&!(typeof E.ctx.suspend>"u")&&Q.usingWebAudio){for(var P=0;P<E._howls.length;P++)if(E._howls[P]._webAudio)for(var Y=0;Y<E._howls[P]._sounds.length;Y++)if(!E._howls[P]._sounds[Y]._paused)return E;return E._suspendTimer&&clearTimeout(E._suspendTimer),E._suspendTimer=setTimeout(function(){if(E.autoSuspend){E._suspendTimer=null,E.state="suspending";var ae=function(){E.state="suspended",E._resumeAfterSuspend&&(delete E._resumeAfterSuspend,E._autoResume())};E.ctx.suspend().then(ae,ae)}},3e4),E}},_autoResume:function(){var E=this;if(E.ctx&&!(typeof E.ctx.resume>"u")&&Q.usingWebAudio)return"running"===E.state&&"interrupted"!==E.ctx.state&&E._suspendTimer?(clearTimeout(E._suspendTimer),E._suspendTimer=null):"suspended"===E.state||"running"===E.state&&"interrupted"===E.ctx.state?(E.ctx.resume().then(function(){E.state="running";for(var P=0;P<E._howls.length;P++)E._howls[P]._emit("resume")}),E._suspendTimer&&(clearTimeout(E._suspendTimer),E._suspendTimer=null)):"suspending"===E.state&&(E._resumeAfterSuspend=!0),E}};var Q=new Ln,ge=function(E){E.src&&0!==E.src.length?this.init(E):console.error("An array of source files must be passed with any new Howl.")};ge.prototype={init:function(E){var P=this;return Q.ctx||He(),P._autoplay=E.autoplay||!1,P._format="string"!=typeof E.format?E.format:[E.format],P._html5=E.html5||!1,P._muted=E.mute||!1,P._loop=E.loop||!1,P._pool=E.pool||5,P._preload="boolean"!=typeof E.preload&&"metadata"!==E.preload||E.preload,P._rate=E.rate||1,P._sprite=E.sprite||{},P._src="string"!=typeof E.src?E.src:[E.src],P._volume=void 0!==E.volume?E.volume:1,P._xhr={method:E.xhr&&E.xhr.method?E.xhr.method:"GET",headers:E.xhr&&E.xhr.headers?E.xhr.headers:null,withCredentials:!(!E.xhr||!E.xhr.withCredentials)&&E.xhr.withCredentials},P._duration=0,P._state="unloaded",P._sounds=[],P._endTimers={},P._queue=[],P._playLock=!1,P._onend=E.onend?[{fn:E.onend}]:[],P._onfade=E.onfade?[{fn:E.onfade}]:[],P._onload=E.onload?[{fn:E.onload}]:[],P._onloaderror=E.onloaderror?[{fn:E.onloaderror}]:[],P._onplayerror=E.onplayerror?[{fn:E.onplayerror}]:[],P._onpause=E.onpause?[{fn:E.onpause}]:[],P._onplay=E.onplay?[{fn:E.onplay}]:[],P._onstop=E.onstop?[{fn:E.onstop}]:[],P._onmute=E.onmute?[{fn:E.onmute}]:[],P._onvolume=E.onvolume?[{fn:E.onvolume}]:[],P._onrate=E.onrate?[{fn:E.onrate}]:[],P._onseek=E.onseek?[{fn:E.onseek}]:[],P._onunlock=E.onunlock?[{fn:E.onunlock}]:[],P._onresume=[],P._webAudio=Q.usingWebAudio&&!P._html5,typeof Q.ctx<"u"&&Q.ctx&&Q.autoUnlock&&Q._unlockAudio(),Q._howls.push(P),P._autoplay&&P._queue.push({event:"play",action:function(){P.play()}}),P._preload&&"none"!==P._preload&&P.load(),P},load:function(){var E=this,P=null;if(Q.noAudio)E._emit("loaderror",null,"No audio support.");else{"string"==typeof E._src&&(E._src=[E._src]);for(var Y=0;Y<E._src.length;Y++){var ae,Ae;if(E._format&&E._format[Y])ae=E._format[Y];else{if("string"!=typeof(Ae=E._src[Y])){E._emit("loaderror",null,"Non-string found in selected audio sources - ignoring.");continue}(ae=/^data:audio\/([^;,]+);/i.exec(Ae))||(ae=/\.([^.]+)$/.exec(Ae.split("?",1)[0])),ae&&(ae=ae[1].toLowerCase())}if(ae||console.warn('No file extension was found. Consider using the "format" property or specify an extension.'),ae&&Q.codecs(ae)){P=E._src[Y];break}}if(P)return E._src=P,E._state="loading","https:"===window.location.protocol&&"http:"===P.slice(0,5)&&(E._html5=!0,E._webAudio=!1),new ve(E),E._webAudio&&Mt(E),E;E._emit("loaderror",null,"No codec support for selected audio sources.")}},play:function(E,P){var Y=this,ae=null;if("number"==typeof E)ae=E,E=null;else{if("string"==typeof E&&"loaded"===Y._state&&!Y._sprite[E])return null;if(typeof E>"u"&&(E="__default",!Y._playLock)){for(var Ae=0,X=0;X<Y._sounds.length;X++)Y._sounds[X]._paused&&!Y._sounds[X]._ended&&(Ae++,ae=Y._sounds[X]._id);1===Ae?E=null:ae=null}}var ne=ae?Y._soundById(ae):Y._inactiveSound();if(!ne)return null;if(ae&&!E&&(E=ne._sprite||"__default"),"loaded"!==Y._state){ne._sprite=E,ne._ended=!1;var mt=ne._id;return Y._queue.push({event:"play",action:function(){Y.play(mt)}}),mt}if(ae&&!ne._paused)return P||Y._loadQueue("play"),ne._id;Y._webAudio&&Q._autoResume();var dn=Math.max(0,ne._seek>0?ne._seek:Y._sprite[E][0]/1e3),Wn=Math.max(0,(Y._sprite[E][0]+Y._sprite[E][1])/1e3-dn),ai=1e3*Wn/Math.abs(ne._rate),Ss=Y._sprite[E][0]/1e3,yr=(Y._sprite[E][0]+Y._sprite[E][1])/1e3;ne._sprite=E,ne._ended=!1;var xr=function(){ne._paused=!1,ne._seek=dn,ne._start=Ss,ne._stop=yr,ne._loop=!(!ne._loop&&!Y._sprite[E][2])};if(!(dn>=yr)){var Mn=ne._node;if(Y._webAudio){var Zs=function(){Y._playLock=!1,xr(),Y._refreshBuffer(ne),Mn.gain.setValueAtTime(ne._muted||Y._muted?0:ne._volume,Q.ctx.currentTime),ne._playStart=Q.ctx.currentTime,typeof Mn.bufferSource.start>"u"?Mn.bufferSource.noteGrainOn(0,dn,ne._loop?86400:Wn):Mn.bufferSource.start(0,dn,ne._loop?86400:Wn),ai!==1/0&&(Y._endTimers[ne._id]=setTimeout(Y._ended.bind(Y,ne),ai)),P||setTimeout(function(){Y._emit("play",ne._id),Y._loadQueue()},0)};"running"===Q.state&&"interrupted"!==Q.ctx.state?Zs():(Y._playLock=!0,Y.once("resume",Zs),Y._clearTimer(ne._id))}else{var zi=function(){Mn.currentTime=dn,Mn.muted=ne._muted||Y._muted||Q._muted||Mn.muted,Mn.volume=ne._volume*Q.volume(),Mn.playbackRate=ne._rate;try{var sn=Mn.play();if(sn&&typeof Promise<"u"&&(sn instanceof Promise||"function"==typeof sn.then)?(Y._playLock=!0,xr(),sn.then(function(){Y._playLock=!1,Mn._unlocked=!0,P?Y._loadQueue():Y._emit("play",ne._id)}).catch(function(){Y._playLock=!1,Y._emit("playerror",ne._id,"Playback was unable to start. This is most commonly an issue on mobile devices and Chrome where playback was not within a user interaction."),ne._ended=!0,ne._paused=!0})):P||(Y._playLock=!1,xr(),Y._emit("play",ne._id)),Mn.playbackRate=ne._rate,Mn.paused)return void Y._emit("playerror",ne._id,"Playback was unable to start. This is most commonly an issue on mobile devices and Chrome where playback was not within a user interaction.");"__default"!==E||ne._loop?Y._endTimers[ne._id]=setTimeout(Y._ended.bind(Y,ne),ai):(Y._endTimers[ne._id]=function(){Y._ended(ne),Mn.removeEventListener("ended",Y._endTimers[ne._id],!1)},Mn.addEventListener("ended",Y._endTimers[ne._id],!1))}catch(bi){Y._emit("playerror",ne._id,bi)}};"data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAAABkYXRhAgAAAAEA"===Mn.src&&(Mn.src=Y._src,Mn.load());var ha=window&&window.ejecta||!Mn.readyState&&Q._navigator.isCocoonJS;if(Mn.readyState>=3||ha)zi();else{Y._playLock=!0,Y._state="loading";var Lo=function(){Y._state="loaded",zi(),Mn.removeEventListener(Q._canPlayEvent,Lo,!1)};Mn.addEventListener(Q._canPlayEvent,Lo,!1),Y._clearTimer(ne._id)}}return ne._id}Y._ended(ne)},pause:function(E){var P=this;if("loaded"!==P._state||P._playLock)return P._queue.push({event:"pause",action:function(){P.pause(E)}}),P;for(var Y=P._getSoundIds(E),ae=0;ae<Y.length;ae++){P._clearTimer(Y[ae]);var Ae=P._soundById(Y[ae]);if(Ae&&!Ae._paused&&(Ae._seek=P.seek(Y[ae]),Ae._rateSeek=0,Ae._paused=!0,P._stopFade(Y[ae]),Ae._node))if(P._webAudio){if(!Ae._node.bufferSource)continue;typeof Ae._node.bufferSource.stop>"u"?Ae._node.bufferSource.noteOff(0):Ae._node.bufferSource.stop(0),P._cleanBuffer(Ae._node)}else(!isNaN(Ae._node.duration)||Ae._node.duration===1/0)&&Ae._node.pause();arguments[1]||P._emit("pause",Ae?Ae._id:null)}return P},stop:function(E,P){var Y=this;if("loaded"!==Y._state||Y._playLock)return Y._queue.push({event:"stop",action:function(){Y.stop(E)}}),Y;for(var ae=Y._getSoundIds(E),Ae=0;Ae<ae.length;Ae++){Y._clearTimer(ae[Ae]);var X=Y._soundById(ae[Ae]);X&&(X._seek=X._start||0,X._rateSeek=0,X._paused=!0,X._ended=!0,Y._stopFade(ae[Ae]),X._node&&(Y._webAudio?X._node.bufferSource&&(typeof X._node.bufferSource.stop>"u"?X._node.bufferSource.noteOff(0):X._node.bufferSource.stop(0),Y._cleanBuffer(X._node)):(!isNaN(X._node.duration)||X._node.duration===1/0)&&(X._node.currentTime=X._start||0,X._node.pause(),X._node.duration===1/0&&Y._clearSound(X._node))),P||Y._emit("stop",X._id))}return Y},mute:function(E,P){var Y=this;if("loaded"!==Y._state||Y._playLock)return Y._queue.push({event:"mute",action:function(){Y.mute(E,P)}}),Y;if(typeof P>"u"){if("boolean"!=typeof E)return Y._muted;Y._muted=E}for(var ae=Y._getSoundIds(P),Ae=0;Ae<ae.length;Ae++){var X=Y._soundById(ae[Ae]);X&&(X._muted=E,X._interval&&Y._stopFade(X._id),Y._webAudio&&X._node?X._node.gain.setValueAtTime(E?0:X._volume,Q.ctx.currentTime):X._node&&(X._node.muted=!!Q._muted||E),Y._emit("mute",X._id))}return Y},volume:function(){var Y,ae,ne,E=this,P=arguments;if(0===P.length)return E._volume;if(1===P.length||2===P.length&&typeof P[1]>"u"?E._getSoundIds().indexOf(P[0])>=0?ae=parseInt(P[0],10):Y=parseFloat(P[0]):P.length>=2&&(Y=parseFloat(P[0]),ae=parseInt(P[1],10)),!(typeof Y<"u"&&Y>=0&&Y<=1))return(ne=ae?E._soundById(ae):E._sounds[0])?ne._volume:0;if("loaded"!==E._state||E._playLock)return E._queue.push({event:"volume",action:function(){E.volume.apply(E,P)}}),E;typeof ae>"u"&&(E._volume=Y),ae=E._getSoundIds(ae);for(var mt=0;mt<ae.length;mt++)(ne=E._soundById(ae[mt]))&&(ne._volume=Y,P[2]||E._stopFade(ae[mt]),E._webAudio&&ne._node&&!ne._muted?ne._node.gain.setValueAtTime(Y,Q.ctx.currentTime):ne._node&&!ne._muted&&(ne._node.volume=Y*Q.volume()),E._emit("volume",ne._id));return E},fade:function(E,P,Y,ae){var Ae=this;if("loaded"!==Ae._state||Ae._playLock)return Ae._queue.push({event:"fade",action:function(){Ae.fade(E,P,Y,ae)}}),Ae;E=Math.min(Math.max(0,parseFloat(E)),1),P=Math.min(Math.max(0,parseFloat(P)),1),Y=parseFloat(Y),Ae.volume(E,ae);for(var X=Ae._getSoundIds(ae),ne=0;ne<X.length;ne++){var mt=Ae._soundById(X[ne]);if(mt){if(ae||Ae._stopFade(X[ne]),Ae._webAudio&&!mt._muted){var dn=Q.ctx.currentTime,Wn=dn+Y/1e3;mt._volume=E,mt._node.gain.setValueAtTime(E,dn),mt._node.gain.linearRampToValueAtTime(P,Wn)}Ae._startFadeInterval(mt,E,P,Y,X[ne],typeof ae>"u")}}return Ae},_startFadeInterval:function(E,P,Y,ae,Ae,X){var ne=this,mt=P,dn=Y-P,Wn=Math.abs(dn/.01),ai=Math.max(4,Wn>0?ae/Wn:ae),Ss=Date.now();E._fadeTo=Y,E._interval=setInterval(function(){var yr=(Date.now()-Ss)/ae;Ss=Date.now(),mt+=dn*yr,mt=Math.round(100*mt)/100,mt=dn<0?Math.max(Y,mt):Math.min(Y,mt),ne._webAudio?E._volume=mt:ne.volume(mt,E._id,!0),X&&(ne._volume=mt),(Y<P&&mt<=Y||Y>P&&mt>=Y)&&(clearInterval(E._interval),E._interval=null,E._fadeTo=null,ne.volume(Y,E._id),ne._emit("fade",E._id))},ai)},_stopFade:function(E){var P=this,Y=P._soundById(E);return Y&&Y._interval&&(P._webAudio&&Y._node.gain.cancelScheduledValues(Q.ctx.currentTime),clearInterval(Y._interval),Y._interval=null,P.volume(Y._fadeTo,E),Y._fadeTo=null,P._emit("fade",E)),P},loop:function(){var Y,ae,Ae,E=this,P=arguments;if(0===P.length)return E._loop;if(1===P.length){if("boolean"!=typeof P[0])return!!(Ae=E._soundById(parseInt(P[0],10)))&&Ae._loop;E._loop=Y=P[0]}else 2===P.length&&(Y=P[0],ae=parseInt(P[1],10));for(var X=E._getSoundIds(ae),ne=0;ne<X.length;ne++)(Ae=E._soundById(X[ne]))&&(Ae._loop=Y,E._webAudio&&Ae._node&&Ae._node.bufferSource&&(Ae._node.bufferSource.loop=Y,Y&&(Ae._node.bufferSource.loopStart=Ae._start||0,Ae._node.bufferSource.loopEnd=Ae._stop,E.playing(X[ne])&&(E.pause(X[ne],!0),E.play(X[ne],!0)))));return E},rate:function(){var Y,ae,ne,E=this,P=arguments;if(0===P.length?ae=E._sounds[0]._id:1===P.length?E._getSoundIds().indexOf(P[0])>=0?ae=parseInt(P[0],10):Y=parseFloat(P[0]):2===P.length&&(Y=parseFloat(P[0]),ae=parseInt(P[1],10)),"number"!=typeof Y)return(ne=E._soundById(ae))?ne._rate:E._rate;if("loaded"!==E._state||E._playLock)return E._queue.push({event:"rate",action:function(){E.rate.apply(E,P)}}),E;typeof ae>"u"&&(E._rate=Y),ae=E._getSoundIds(ae);for(var mt=0;mt<ae.length;mt++)if(ne=E._soundById(ae[mt])){E.playing(ae[mt])&&(ne._rateSeek=E.seek(ae[mt]),ne._playStart=E._webAudio?Q.ctx.currentTime:ne._playStart),ne._rate=Y,E._webAudio&&ne._node&&ne._node.bufferSource?ne._node.bufferSource.playbackRate.setValueAtTime(Y,Q.ctx.currentTime):ne._node&&(ne._node.playbackRate=Y);var dn=E.seek(ae[mt]),ai=1e3*((E._sprite[ne._sprite][0]+E._sprite[ne._sprite][1])/1e3-dn)/Math.abs(ne._rate);(E._endTimers[ae[mt]]||!ne._paused)&&(E._clearTimer(ae[mt]),E._endTimers[ae[mt]]=setTimeout(E._ended.bind(E,ne),ai)),E._emit("rate",ne._id)}return E},seek:function(){var Y,ae,E=this,P=arguments;if(0===P.length?E._sounds.length&&(ae=E._sounds[0]._id):1===P.length?E._getSoundIds().indexOf(P[0])>=0?ae=parseInt(P[0],10):E._sounds.length&&(ae=E._sounds[0]._id,Y=parseFloat(P[0])):2===P.length&&(Y=parseFloat(P[0]),ae=parseInt(P[1],10)),typeof ae>"u")return 0;if("number"==typeof Y&&("loaded"!==E._state||E._playLock))return E._queue.push({event:"seek",action:function(){E.seek.apply(E,P)}}),E;var ne=E._soundById(ae);if(ne){if(!("number"==typeof Y&&Y>=0)){if(E._webAudio){var ai=E.playing(ae)?Q.ctx.currentTime-ne._playStart:0;return ne._seek+((ne._rateSeek?ne._rateSeek-ne._seek:0)+ai*Math.abs(ne._rate))}return ne._node.currentTime}var mt=E.playing(ae);mt&&E.pause(ae,!0),ne._seek=Y,ne._ended=!1,E._clearTimer(ae),!E._webAudio&&ne._node&&!isNaN(ne._node.duration)&&(ne._node.currentTime=Y);var dn=function(){mt&&E.play(ae,!0),E._emit("seek",ae)};if(mt&&!E._webAudio){var Wn=function(){E._playLock?setTimeout(Wn,0):dn()};setTimeout(Wn,0)}else dn()}return E},playing:function(E){var P=this;if("number"==typeof E){var Y=P._soundById(E);return!!Y&&!Y._paused}for(var ae=0;ae<P._sounds.length;ae++)if(!P._sounds[ae]._paused)return!0;return!1},duration:function(E){var P=this,Y=P._duration,ae=P._soundById(E);return ae&&(Y=P._sprite[ae._sprite][1]/1e3),Y},state:function(){return this._state},unload:function(){for(var E=this,P=E._sounds,Y=0;Y<P.length;Y++)P[Y]._paused||E.stop(P[Y]._id),E._webAudio||(E._clearSound(P[Y]._node),P[Y]._node.removeEventListener("error",P[Y]._errorFn,!1),P[Y]._node.removeEventListener(Q._canPlayEvent,P[Y]._loadFn,!1),P[Y]._node.removeEventListener("ended",P[Y]._endFn,!1),Q._releaseHtml5Audio(P[Y]._node)),delete P[Y]._node,E._clearTimer(P[Y]._id);var ae=Q._howls.indexOf(E);ae>=0&&Q._howls.splice(ae,1);var Ae=!0;for(Y=0;Y<Q._howls.length;Y++)if(Q._howls[Y]._src===E._src||E._src.indexOf(Q._howls[Y]._src)>=0){Ae=!1;break}return Dt&&Ae&&delete Dt[E._src],Q.noAudio=!1,E._state="unloaded",E._sounds=[],E=null,null},on:function(E,P,Y,ae){return"function"==typeof P&&this["_on"+E].push(ae?{id:Y,fn:P,once:ae}:{id:Y,fn:P}),this},off:function(E,P,Y){var ae=this,Ae=ae["_on"+E],X=0;if("number"==typeof P&&(Y=P,P=null),P||Y)for(X=0;X<Ae.length;X++){var ne=Y===Ae[X].id;if(P===Ae[X].fn&&ne||!P&&ne){Ae.splice(X,1);break}}else if(E)ae["_on"+E]=[];else{var mt=Object.keys(ae);for(X=0;X<mt.length;X++)0===mt[X].indexOf("_on")&&Array.isArray(ae[mt[X]])&&(ae[mt[X]]=[])}return ae},once:function(E,P,Y){return this.on(E,P,Y,1),this},_emit:function(E,P,Y){for(var ae=this,Ae=ae["_on"+E],X=Ae.length-1;X>=0;X--)(!Ae[X].id||Ae[X].id===P||"load"===E)&&(setTimeout(function(ne){ne.call(this,P,Y)}.bind(ae,Ae[X].fn),0),Ae[X].once&&ae.off(E,Ae[X].fn,Ae[X].id));return ae._loadQueue(E),ae},_loadQueue:function(E){var P=this;if(P._queue.length>0){var Y=P._queue[0];Y.event===E&&(P._queue.shift(),P._loadQueue()),E||Y.action()}return P},_ended:function(E){var P=this,Y=E._sprite;if(!P._webAudio&&E._node&&!E._node.paused&&!E._node.ended&&E._node.currentTime<E._stop)return setTimeout(P._ended.bind(P,E),100),P;var ae=!(!E._loop&&!P._sprite[Y][2]);if(P._emit("end",E._id),!P._webAudio&&ae&&P.stop(E._id,!0).play(E._id),P._webAudio&&ae){P._emit("play",E._id),E._seek=E._start||0,E._rateSeek=0,E._playStart=Q.ctx.currentTime;var Ae=1e3*(E._stop-E._start)/Math.abs(E._rate);P._endTimers[E._id]=setTimeout(P._ended.bind(P,E),Ae)}return P._webAudio&&!ae&&(E._paused=!0,E._ended=!0,E._seek=E._start||0,E._rateSeek=0,P._clearTimer(E._id),P._cleanBuffer(E._node),Q._autoSuspend()),!P._webAudio&&!ae&&P.stop(E._id,!0),P},_clearTimer:function(E){var P=this;if(P._endTimers[E]){if("function"!=typeof P._endTimers[E])clearTimeout(P._endTimers[E]);else{var Y=P._soundById(E);Y&&Y._node&&Y._node.removeEventListener("ended",P._endTimers[E],!1)}delete P._endTimers[E]}return P},_soundById:function(E){for(var P=this,Y=0;Y<P._sounds.length;Y++)if(E===P._sounds[Y]._id)return P._sounds[Y];return null},_inactiveSound:function(){var E=this;E._drain();for(var P=0;P<E._sounds.length;P++)if(E._sounds[P]._ended)return E._sounds[P].reset();return new ve(E)},_drain:function(){var E=this,P=E._pool,Y=0,ae=0;if(!(E._sounds.length<P)){for(ae=0;ae<E._sounds.length;ae++)E._sounds[ae]._ended&&Y++;for(ae=E._sounds.length-1;ae>=0;ae--){if(Y<=P)return;E._sounds[ae]._ended&&(E._webAudio&&E._sounds[ae]._node&&E._sounds[ae]._node.disconnect(0),E._sounds.splice(ae,1),Y--)}}},_getSoundIds:function(E){if(typeof E>"u"){for(var Y=[],ae=0;ae<this._sounds.length;ae++)Y.push(this._sounds[ae]._id);return Y}return[E]},_refreshBuffer:function(E){return E._node.bufferSource=Q.ctx.createBufferSource(),E._node.bufferSource.buffer=Dt[this._src],E._node.bufferSource.connect(E._panner?E._panner:E._node),E._node.bufferSource.loop=E._loop,E._loop&&(E._node.bufferSource.loopStart=E._start||0,E._node.bufferSource.loopEnd=E._stop||0),E._node.bufferSource.playbackRate.setValueAtTime(E._rate,Q.ctx.currentTime),this},_cleanBuffer:function(E){var Y=Q._navigator&&Q._navigator.vendor.indexOf("Apple")>=0;if(Q._scratchBuffer&&E.bufferSource&&(E.bufferSource.onended=null,E.bufferSource.disconnect(0),Y))try{E.bufferSource.buffer=Q._scratchBuffer}catch{}return E.bufferSource=null,this},_clearSound:function(E){/MSIE |Trident\//.test(Q._navigator&&Q._navigator.userAgent)||(E.src="data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAAABkYXRhAgAAAAEA")}};var ve=function(E){this._parent=E,this.init()};ve.prototype={init:function(){var E=this,P=E._parent;return E._muted=P._muted,E._loop=P._loop,E._volume=P._volume,E._rate=P._rate,E._seek=0,E._paused=!0,E._ended=!0,E._sprite="__default",E._id=++Q._counter,P._sounds.push(E),E.create(),E},create:function(){var E=this,P=E._parent,Y=Q._muted||E._muted||E._parent._muted?0:E._volume;return P._webAudio?(E._node=typeof Q.ctx.createGain>"u"?Q.ctx.createGainNode():Q.ctx.createGain(),E._node.gain.setValueAtTime(Y,Q.ctx.currentTime),E._node.paused=!0,E._node.connect(Q.masterGain)):Q.noAudio||(E._node=Q._obtainHtml5Audio(),E._errorFn=E._errorListener.bind(E),E._node.addEventListener("error",E._errorFn,!1),E._loadFn=E._loadListener.bind(E),E._node.addEventListener(Q._canPlayEvent,E._loadFn,!1),E._endFn=E._endListener.bind(E),E._node.addEventListener("ended",E._endFn,!1),E._node.src=P._src,E._node.preload=!0===P._preload?"auto":P._preload,E._node.volume=Y*Q.volume(),E._node.load()),E},reset:function(){var E=this,P=E._parent;return E._muted=P._muted,E._loop=P._loop,E._volume=P._volume,E._rate=P._rate,E._seek=0,E._rateSeek=0,E._paused=!0,E._ended=!0,E._sprite="__default",E._id=++Q._counter,E},_errorListener:function(){var E=this;E._parent._emit("loaderror",E._id,E._node.error?E._node.error.code:0),E._node.removeEventListener("error",E._errorFn,!1)},_loadListener:function(){var E=this,P=E._parent;P._duration=Math.ceil(10*E._node.duration)/10,0===Object.keys(P._sprite).length&&(P._sprite={__default:[0,1e3*P._duration]}),"loaded"!==P._state&&(P._state="loaded",P._emit("load"),P._loadQueue()),E._node.removeEventListener(Q._canPlayEvent,E._loadFn,!1)},_endListener:function(){var E=this,P=E._parent;P._duration===1/0&&(P._duration=Math.ceil(10*E._node.duration)/10,P._sprite.__default[1]===1/0&&(P._sprite.__default[1]=1e3*P._duration),P._ended(E)),E._node.removeEventListener("ended",E._endFn,!1)}};var Dt={},Mt=function(E){var P=E._src;if(Dt[P])return E._duration=Dt[P].duration,void Ke(E);if(/^data:[^;]+;base64,/.test(P)){for(var Y=atob(P.split(",")[1]),ae=new Uint8Array(Y.length),Ae=0;Ae<Y.length;++Ae)ae[Ae]=Y.charCodeAt(Ae);v(ae.buffer,E)}else{var X=new XMLHttpRequest;X.open(E._xhr.method,P,!0),X.withCredentials=E._xhr.withCredentials,X.responseType="arraybuffer",E._xhr.headers&&Object.keys(E._xhr.headers).forEach(function(ne){X.setRequestHeader(ne,E._xhr.headers[ne])}),X.onload=function(){var ne=(X.status+"")[0];"0"===ne||"2"===ne||"3"===ne?v(X.response,E):E._emit("loaderror",null,"Failed loading audio file with status: "+X.status+".")},X.onerror=function(){E._webAudio&&(E._html5=!0,E._webAudio=!1,E._sounds=[],delete Dt[P],E.load())},oe(X)}},oe=function(E){try{E.send()}catch{E.onerror()}},v=function(E,P){var Y=function(){P._emit("loaderror",null,"Decoding audio data failed.")},ae=function(Ae){Ae&&P._sounds.length>0?(Dt[P._src]=Ae,Ke(P,Ae)):Y()};typeof Promise<"u"&&1===Q.ctx.decodeAudioData.length?Q.ctx.decodeAudioData(E).then(ae).catch(Y):Q.ctx.decodeAudioData(E,ae,Y)},Ke=function(E,P){P&&!E._duration&&(E._duration=P.duration),0===Object.keys(E._sprite).length&&(E._sprite={__default:[0,1e3*E._duration]}),"loaded"!==E._state&&(E._state="loaded",E._emit("load"),E._loadQueue())},He=function(){if(Q.usingWebAudio){try{typeof AudioContext<"u"?Q.ctx=new AudioContext:typeof webkitAudioContext<"u"?Q.ctx=new webkitAudioContext:Q.usingWebAudio=!1}catch{Q.usingWebAudio=!1}Q.ctx||(Q.usingWebAudio=!1);var E=/iP(hone|od|ad)/.test(Q._navigator&&Q._navigator.platform),P=Q._navigator&&Q._navigator.appVersion.match(/OS (\d+)_(\d+)_?(\d+)?/),Y=P?parseInt(P[1],10):null;if(E&&Y&&Y<9){var ae=/safari/.test(Q._navigator&&Q._navigator.userAgent.toLowerCase());Q._navigator&&!ae&&(Q.usingWebAudio=!1)}Q.usingWebAudio&&(Q.masterGain=typeof Q.ctx.createGain>"u"?Q.ctx.createGainNode():Q.ctx.createGain(),Q.masterGain.gain.setValueAtTime(Q._muted?0:Q._volume,Q.ctx.currentTime),Q.masterGain.connect(Q.ctx.destination)),Q._setup()}};void 0!==(Rn=function(){return{Howler:Q,Howl:ge}}.apply(Po,[]))&&(_l.exports=Rn),Po.Howler=Q,Po.Howl=ge,typeof global<"u"?(global.HowlerGlobal=Ln,global.Howler=Q,global.Howl=ge,global.Sound=ve):typeof window<"u"&&(window.HowlerGlobal=Ln,window.Howler=Q,window.Howl=ge,window.Sound=ve)}(),function(){"use strict";var Q;HowlerGlobal.prototype._pos=[0,0,0],HowlerGlobal.prototype._orientation=[0,0,-1,0,1,0],HowlerGlobal.prototype.stereo=function(Q){var ge=this;if(!ge.ctx||!ge.ctx.listener)return ge;for(var ve=ge._howls.length-1;ve>=0;ve--)ge._howls[ve].stereo(Q);return ge},HowlerGlobal.prototype.pos=function(Q,ge,ve){var Dt=this;return Dt.ctx&&Dt.ctx.listener?"number"!=typeof Q?Dt._pos:(Dt._pos=[Q,ge="number"!=typeof ge?Dt._pos[1]:ge,ve="number"!=typeof ve?Dt._pos[2]:ve],typeof Dt.ctx.listener.positionX<"u"?(Dt.ctx.listener.positionX.setTargetAtTime(Dt._pos[0],Howler.ctx.currentTime,.1),Dt.ctx.listener.positionY.setTargetAtTime(Dt._pos[1],Howler.ctx.currentTime,.1),Dt.ctx.listener.positionZ.setTargetAtTime(Dt._pos[2],Howler.ctx.currentTime,.1)):Dt.ctx.listener.setPosition(Dt._pos[0],Dt._pos[1],Dt._pos[2]),Dt):Dt},HowlerGlobal.prototype.orientation=function(Q,ge,ve,Dt,Mt,oe){var v=this;if(!v.ctx||!v.ctx.listener)return v;var Ke=v._orientation;return"number"!=typeof Q?Ke:(v._orientation=[Q,ge="number"!=typeof ge?Ke[1]:ge,ve="number"!=typeof ve?Ke[2]:ve,Dt="number"!=typeof Dt?Ke[3]:Dt,Mt="number"!=typeof Mt?Ke[4]:Mt,oe="number"!=typeof oe?Ke[5]:oe],typeof v.ctx.listener.forwardX<"u"?(v.ctx.listener.forwardX.setTargetAtTime(Q,Howler.ctx.currentTime,.1),v.ctx.listener.forwardY.setTargetAtTime(ge,Howler.ctx.currentTime,.1),v.ctx.listener.forwardZ.setTargetAtTime(ve,Howler.ctx.currentTime,.1),v.ctx.listener.upX.setTargetAtTime(Dt,Howler.ctx.currentTime,.1),v.ctx.listener.upY.setTargetAtTime(Mt,Howler.ctx.currentTime,.1),v.ctx.listener.upZ.setTargetAtTime(oe,Howler.ctx.currentTime,.1)):v.ctx.listener.setOrientation(Q,ge,ve,Dt,Mt,oe),v)},Howl.prototype.init=(Q=Howl.prototype.init,function(ge){var ve=this;return ve._orientation=ge.orientation||[1,0,0],ve._stereo=ge.stereo||null,ve._pos=ge.pos||null,ve._pannerAttr={coneInnerAngle:typeof ge.coneInnerAngle<"u"?ge.coneInnerAngle:360,coneOuterAngle:typeof ge.coneOuterAngle<"u"?ge.coneOuterAngle:360,coneOuterGain:typeof ge.coneOuterGain<"u"?ge.coneOuterGain:0,distanceModel:typeof ge.distanceModel<"u"?ge.distanceModel:"inverse",maxDistance:typeof ge.maxDistance<"u"?ge.maxDistance:1e4,panningModel:typeof ge.panningModel<"u"?ge.panningModel:"HRTF",refDistance:typeof ge.refDistance<"u"?ge.refDistance:1,rolloffFactor:typeof ge.rolloffFactor<"u"?ge.rolloffFactor:1},ve._onstereo=ge.onstereo?[{fn:ge.onstereo}]:[],ve._onpos=ge.onpos?[{fn:ge.onpos}]:[],ve._onorientation=ge.onorientation?[{fn:ge.onorientation}]:[],Q.call(this,ge)}),Howl.prototype.stereo=function(Q,ge){var ve=this;if(!ve._webAudio)return ve;if("loaded"!==ve._state)return ve._queue.push({event:"stereo",action:function(){ve.stereo(Q,ge)}}),ve;var Dt=typeof Howler.ctx.createStereoPanner>"u"?"spatial":"stereo";if(typeof ge>"u"){if("number"!=typeof Q)return ve._stereo;ve._stereo=Q,ve._pos=[Q,0,0]}for(var Mt=ve._getSoundIds(ge),oe=0;oe<Mt.length;oe++){var v=ve._soundById(Mt[oe]);if(v){if("number"!=typeof Q)return v._stereo;v._stereo=Q,v._pos=[Q,0,0],v._node&&(v._pannerAttr.panningModel="equalpower",(!v._panner||!v._panner.pan)&&Ln(v,Dt),"spatial"===Dt?typeof v._panner.positionX<"u"?(v._panner.positionX.setValueAtTime(Q,Howler.ctx.currentTime),v._panner.positionY.setValueAtTime(0,Howler.ctx.currentTime),v._panner.positionZ.setValueAtTime(0,Howler.ctx.currentTime)):v._panner.setPosition(Q,0,0):v._panner.pan.setValueAtTime(Q,Howler.ctx.currentTime)),ve._emit("stereo",v._id)}}return ve},Howl.prototype.pos=function(Q,ge,ve,Dt){var Mt=this;if(!Mt._webAudio)return Mt;if("loaded"!==Mt._state)return Mt._queue.push({event:"pos",action:function(){Mt.pos(Q,ge,ve,Dt)}}),Mt;if(ge="number"!=typeof ge?0:ge,ve="number"!=typeof ve?-.5:ve,typeof Dt>"u"){if("number"!=typeof Q)return Mt._pos;Mt._pos=[Q,ge,ve]}for(var oe=Mt._getSoundIds(Dt),v=0;v<oe.length;v++){var Ke=Mt._soundById(oe[v]);if(Ke){if("number"!=typeof Q)return Ke._pos;Ke._pos=[Q,ge,ve],Ke._node&&((!Ke._panner||Ke._panner.pan)&&Ln(Ke,"spatial"),typeof Ke._panner.positionX<"u"?(Ke._panner.positionX.setValueAtTime(Q,Howler.ctx.currentTime),Ke._panner.positionY.setValueAtTime(ge,Howler.ctx.currentTime),Ke._panner.positionZ.setValueAtTime(ve,Howler.ctx.currentTime)):Ke._panner.setPosition(Q,ge,ve)),Mt._emit("pos",Ke._id)}}return Mt},Howl.prototype.orientation=function(Q,ge,ve,Dt){var Mt=this;if(!Mt._webAudio)return Mt;if("loaded"!==Mt._state)return Mt._queue.push({event:"orientation",action:function(){Mt.orientation(Q,ge,ve,Dt)}}),Mt;if(ge="number"!=typeof ge?Mt._orientation[1]:ge,ve="number"!=typeof ve?Mt._orientation[2]:ve,typeof Dt>"u"){if("number"!=typeof Q)return Mt._orientation;Mt._orientation=[Q,ge,ve]}for(var oe=Mt._getSoundIds(Dt),v=0;v<oe.length;v++){var Ke=Mt._soundById(oe[v]);if(Ke){if("number"!=typeof Q)return Ke._orientation;Ke._orientation=[Q,ge,ve],Ke._node&&(Ke._panner||(Ke._pos||(Ke._pos=Mt._pos||[0,0,-.5]),Ln(Ke,"spatial")),typeof Ke._panner.orientationX<"u"?(Ke._panner.orientationX.setValueAtTime(Q,Howler.ctx.currentTime),Ke._panner.orientationY.setValueAtTime(ge,Howler.ctx.currentTime),Ke._panner.orientationZ.setValueAtTime(ve,Howler.ctx.currentTime)):Ke._panner.setOrientation(Q,ge,ve)),Mt._emit("orientation",Ke._id)}}return Mt},Howl.prototype.pannerAttr=function(){var ve,Dt,Mt,Q=this,ge=arguments;if(!Q._webAudio)return Q;if(0===ge.length)return Q._pannerAttr;if(1===ge.length){if("object"!=typeof ge[0])return(Mt=Q._soundById(parseInt(ge[0],10)))?Mt._pannerAttr:Q._pannerAttr;ve=ge[0],typeof Dt>"u"&&(ve.pannerAttr||(ve.pannerAttr={coneInnerAngle:ve.coneInnerAngle,coneOuterAngle:ve.coneOuterAngle,coneOuterGain:ve.coneOuterGain,distanceModel:ve.distanceModel,maxDistance:ve.maxDistance,refDistance:ve.refDistance,rolloffFactor:ve.rolloffFactor,panningModel:ve.panningModel}),Q._pannerAttr={coneInnerAngle:typeof ve.pannerAttr.coneInnerAngle<"u"?ve.pannerAttr.coneInnerAngle:Q._coneInnerAngle,coneOuterAngle:typeof ve.pannerAttr.coneOuterAngle<"u"?ve.pannerAttr.coneOuterAngle:Q._coneOuterAngle,coneOuterGain:typeof ve.pannerAttr.coneOuterGain<"u"?ve.pannerAttr.coneOuterGain:Q._coneOuterGain,distanceModel:typeof ve.pannerAttr.distanceModel<"u"?ve.pannerAttr.distanceModel:Q._distanceModel,maxDistance:typeof ve.pannerAttr.maxDistance<"u"?ve.pannerAttr.maxDistance:Q._maxDistance,refDistance:typeof ve.pannerAttr.refDistance<"u"?ve.pannerAttr.refDistance:Q._refDistance,rolloffFactor:typeof ve.pannerAttr.rolloffFactor<"u"?ve.pannerAttr.rolloffFactor:Q._rolloffFactor,panningModel:typeof ve.pannerAttr.panningModel<"u"?ve.pannerAttr.panningModel:Q._panningModel})}else 2===ge.length&&(ve=ge[0],Dt=parseInt(ge[1],10));for(var oe=Q._getSoundIds(Dt),v=0;v<oe.length;v++)if(Mt=Q._soundById(oe[v])){var Ke=Mt._pannerAttr;Ke={coneInnerAngle:typeof ve.coneInnerAngle<"u"?ve.coneInnerAngle:Ke.coneInnerAngle,coneOuterAngle:typeof ve.coneOuterAngle<"u"?ve.coneOuterAngle:Ke.coneOuterAngle,coneOuterGain:typeof ve.coneOuterGain<"u"?ve.coneOuterGain:Ke.coneOuterGain,distanceModel:typeof ve.distanceModel<"u"?ve.distanceModel:Ke.distanceModel,maxDistance:typeof ve.maxDistance<"u"?ve.maxDistance:Ke.maxDistance,refDistance:typeof ve.refDistance<"u"?ve.refDistance:Ke.refDistance,rolloffFactor:typeof ve.rolloffFactor<"u"?ve.rolloffFactor:Ke.rolloffFactor,panningModel:typeof ve.panningModel<"u"?ve.panningModel:Ke.panningModel};var He=Mt._panner;He?(He.coneInnerAngle=Ke.coneInnerAngle,He.coneOuterAngle=Ke.coneOuterAngle,He.coneOuterGain=Ke.coneOuterGain,He.distanceModel=Ke.distanceModel,He.maxDistance=Ke.maxDistance,He.refDistance=Ke.refDistance,He.rolloffFactor=Ke.rolloffFactor,He.panningModel=Ke.panningModel):(Mt._pos||(Mt._pos=Q._pos||[0,0,-.5]),Ln(Mt,"spatial"))}return Q},Sound.prototype.init=function(Q){return function(){var ge=this,ve=ge._parent;ge._orientation=ve._orientation,ge._stereo=ve._stereo,ge._pos=ve._pos,ge._pannerAttr=ve._pannerAttr,Q.call(this),ge._stereo?ve.stereo(ge._stereo):ge._pos&&ve.pos(ge._pos[0],ge._pos[1],ge._pos[2],ge._id)}}(Sound.prototype.init),Sound.prototype.reset=function(Q){return function(){var ge=this,ve=ge._parent;return ge._orientation=ve._orientation,ge._stereo=ve._stereo,ge._pos=ve._pos,ge._pannerAttr=ve._pannerAttr,ge._stereo?ve.stereo(ge._stereo):ge._pos?ve.pos(ge._pos[0],ge._pos[1],ge._pos[2],ge._id):ge._panner&&(ge._panner.disconnect(0),ge._panner=void 0,ve._refreshBuffer(ge)),Q.call(this)}}(Sound.prototype.reset);var Ln=function(Q,ge){"spatial"===(ge=ge||"spatial")?(Q._panner=Howler.ctx.createPanner(),Q._panner.coneInnerAngle=Q._pannerAttr.coneInnerAngle,Q._panner.coneOuterAngle=Q._pannerAttr.coneOuterAngle,Q._panner.coneOuterGain=Q._pannerAttr.coneOuterGain,Q._panner.distanceModel=Q._pannerAttr.distanceModel,Q._panner.maxDistance=Q._pannerAttr.maxDistance,Q._panner.refDistance=Q._pannerAttr.refDistance,Q._panner.rolloffFactor=Q._pannerAttr.rolloffFactor,Q._panner.panningModel=Q._pannerAttr.panningModel,typeof Q._panner.positionX<"u"?(Q._panner.positionX.setValueAtTime(Q._pos[0],Howler.ctx.currentTime),Q._panner.positionY.setValueAtTime(Q._pos[1],Howler.ctx.currentTime),Q._panner.positionZ.setValueAtTime(Q._pos[2],Howler.ctx.currentTime)):Q._panner.setPosition(Q._pos[0],Q._pos[1],Q._pos[2]),typeof Q._panner.orientationX<"u"?(Q._panner.orientationX.setValueAtTime(Q._orientation[0],Howler.ctx.currentTime),Q._panner.orientationY.setValueAtTime(Q._orientation[1],Howler.ctx.currentTime),Q._panner.orientationZ.setValueAtTime(Q._orientation[2],Howler.ctx.currentTime)):Q._panner.setOrientation(Q._orientation[0],Q._orientation[1],Q._orientation[2])):(Q._panner=Howler.ctx.createStereoPanner(),Q._panner.pan.setValueAtTime(Q._stereo,Howler.ctx.currentTime)),Q._panner.connect(Q._node),Q._paused||Q._parent.pause(Q._id,!0).play(Q._id,!0)}}()},700:function(_l,Po){!function(Pt){"use strict";var Rn=function(g,c){return(Rn=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(h,m){h.__proto__=m}||function(h,m){for(var x in m)Object.prototype.hasOwnProperty.call(m,x)&&(h[x]=m[x])})(g,c)};function Ln(g,c){if("function"!=typeof c&&null!==c)throw new TypeError("Class extends value "+String(c)+" is not a constructor or null");function h(){this.constructor=g}Rn(g,c),g.prototype=null===c?Object.create(c):(h.prototype=c.prototype,new h)}var Q=function(){return Q=Object.assign||function(c){for(var h,m=1,x=arguments.length;m<x;m++)for(var S in h=arguments[m])Object.prototype.hasOwnProperty.call(h,S)&&(c[S]=h[S]);return c},Q.apply(this,arguments)};function ge(g,c){(null===g||typeof g>"u")&&(g={});var h=Q({},g);for(var m in c)c.hasOwnProperty(m)&&typeof g[m]>"u"&&(h[m]=c[m]);if("function"==typeof Object.getOwnPropertySymbols)for(var x=Object.getOwnPropertySymbols(c),S=0;S<x.length;S++){var M=x[S];c.propertyIsEnumerable(M)&&typeof g[M]>"u"&&(h[M]=c[M])}return h}var Mt_debug=function(){for(var g=[],c=0;c<arguments.length;c++)g[c]=arguments[c]},oe=Object.create(Math);oe.EPSILON=1e-9,oe.isFinite=function(g){return"number"==typeof g&&isFinite(g)&&!isNaN(g)},oe.assert=function(g){},oe.invSqrt=function(g){return 1/Math.sqrt(g)},oe.nextPowerOfTwo=function(g){return g|=g>>1,g|=g>>2,g|=g>>4,1+((g|=g>>8)|g>>16)},oe.isPowerOfTwo=function(g){return g>0&&0==(g&g-1)},oe.mod=function(g,c,h){return typeof c>"u"?(h=1,c=0):typeof h>"u"&&(h=c,c=0),h>c?(g=(g-c)%(h-c))+(g<0?h:c):(g=(g-h)%(c-h))+(g<=0?c:h)},oe.clamp=function(g,c,h){return g<c?c:g>h?h:g},oe.random=function(g,c){return typeof g>"u"?(c=1,g=0):typeof c>"u"&&(c=g,g=0),g===c?g:Math.random()*(c-g)+g};var v=function(){function g(c,h){if(!(this instanceof g))return new g(c,h);typeof c>"u"?(this.x=0,this.y=0):"object"==typeof c?(this.x=c.x,this.y=c.y):(this.x=c,this.y=h)}return g.prototype._serialize=function(){return{x:this.x,y:this.y}},g._deserialize=function(c){var h=Object.create(g.prototype);return h.x=c.x,h.y=c.y,h},g.zero=function(){var c=Object.create(g.prototype);return c.x=0,c.y=0,c},g.neo=function(c,h){var m=Object.create(g.prototype);return m.x=c,m.y=h,m},g.clone=function(c){return g.neo(c.x,c.y)},g.prototype.toString=function(){return JSON.stringify(this)},g.isValid=function(c){return!(null===c||typeof c>"u")&&oe.isFinite(c.x)&&oe.isFinite(c.y)},g.assert=function(c){},g.prototype.clone=function(){return g.clone(this)},g.prototype.setZero=function(){return this.x=0,this.y=0,this},g.prototype.set=function(c,h){return"object"==typeof c?(this.x=c.x,this.y=c.y):(this.x=c,this.y=h),this},g.prototype.setNum=function(c,h){return this.x=c,this.y=h,this},g.prototype.setVec2=function(c){return this.x=c.x,this.y=c.y,this},g.prototype.wSet=function(c,h,m,x){return typeof m<"u"||typeof x<"u"?this.setCombine(c,h,m,x):this.setMul(c,h)},g.prototype.setCombine=function(c,h,m,x){var M=c*h.y+m*x.y;return this.x=c*h.x+m*x.x,this.y=M,this},g.prototype.setMul=function(c,h){var x=c*h.y;return this.x=c*h.x,this.y=x,this},g.prototype.add=function(c){return this.x+=c.x,this.y+=c.y,this},g.prototype.wAdd=function(c,h,m,x){return typeof m<"u"||typeof x<"u"?this.addCombine(c,h,m,x):this.addMul(c,h)},g.prototype.addCombine=function(c,h,m,x){var M=c*h.y+m*x.y;return this.x+=c*h.x+m*x.x,this.y+=M,this},g.prototype.addMul=function(c,h){var x=c*h.y;return this.x+=c*h.x,this.y+=x,this},g.prototype.wSub=function(c,h,m,x){return typeof m<"u"||typeof x<"u"?this.subCombine(c,h,m,x):this.subMul(c,h)},g.prototype.subCombine=function(c,h,m,x){var M=c*h.y+m*x.y;return this.x-=c*h.x+m*x.x,this.y-=M,this},g.prototype.subMul=function(c,h){var x=c*h.y;return this.x-=c*h.x,this.y-=x,this},g.prototype.sub=function(c){return this.x-=c.x,this.y-=c.y,this},g.prototype.mul=function(c){return this.x*=c,this.y*=c,this},g.prototype.length=function(){return g.lengthOf(this)},g.prototype.lengthSquared=function(){return g.lengthSquared(this)},g.prototype.normalize=function(){var c=this.length();if(c<oe.EPSILON)return 0;var h=1/c;return this.x*=h,this.y*=h,c},g.lengthOf=function(c){return oe.sqrt(c.x*c.x+c.y*c.y)},g.lengthSquared=function(c){return c.x*c.x+c.y*c.y},g.distance=function(c,h){var m=c.x-h.x,x=c.y-h.y;return oe.sqrt(m*m+x*x)},g.distanceSquared=function(c,h){var m=c.x-h.x,x=c.y-h.y;return m*m+x*x},g.areEqual=function(c,h){return c===h||"object"==typeof h&&null!==h&&c.x===h.x&&c.y===h.y},g.skew=function(c){return g.neo(-c.y,c.x)},g.dot=function(c,h){return c.x*h.x+c.y*h.y},g.cross=function(c,h){return"number"==typeof h?g.neo(h*c.y,-h*c.x):"number"==typeof c?g.neo(-c*h.y,c*h.x):c.x*h.y-c.y*h.x},g.crossVec2Vec2=function(c,h){return c.x*h.y-c.y*h.x},g.crossVec2Num=function(c,h){return g.neo(h*c.y,-h*c.x)},g.crossNumVec2=function(c,h){return g.neo(-c*h.y,c*h.x)},g.addCross=function(c,h,m){return"number"==typeof m?g.neo(m*h.y+c.x,-m*h.x+c.y):"number"==typeof h?g.neo(-h*m.y+c.x,h*m.x+c.y):void 0},g.addCrossVec2Num=function(c,h,m){return g.neo(m*h.y+c.x,-m*h.x+c.y)},g.addCrossNumVec2=function(c,h,m){return g.neo(-h*m.y+c.x,h*m.x+c.y)},g.add=function(c,h){return g.neo(c.x+h.x,c.y+h.y)},g.wAdd=function(c,h,m,x){return typeof m<"u"||typeof x<"u"?g.combine(c,h,m,x):g.mulNumVec2(c,h)},g.combine=function(c,h,m,x){return g.zero().setCombine(c,h,m,x)},g.sub=function(c,h){return g.neo(c.x-h.x,c.y-h.y)},g.mul=function(c,h){return"object"==typeof c?g.neo(c.x*h,c.y*h):"object"==typeof h?g.neo(c*h.x,c*h.y):void 0},g.mulVec2Num=function(c,h){return g.neo(c.x*h,c.y*h)},g.mulNumVec2=function(c,h){return g.neo(c*h.x,c*h.y)},g.prototype.neg=function(){return this.x=-this.x,this.y=-this.y,this},g.neg=function(c){return g.neo(-c.x,-c.y)},g.abs=function(c){return g.neo(oe.abs(c.x),oe.abs(c.y))},g.mid=function(c,h){return g.neo(.5*(c.x+h.x),.5*(c.y+h.y))},g.upper=function(c,h){return g.neo(oe.max(c.x,h.x),oe.max(c.y,h.y))},g.lower=function(c,h){return g.neo(oe.min(c.x,h.x),oe.min(c.y,h.y))},g.prototype.clamp=function(c){var h=this.x*this.x+this.y*this.y;if(h>c*c){var m=oe.invSqrt(h);this.x*=m*c,this.y*=m*c}return this},g.clamp=function(c,h){return(c=g.neo(c.x,c.y)).clamp(h),c},g.scaleFn=function(c,h){return function(m){return g.neo(m.x*c,m.y*h)}},g.translateFn=function(c,h){return function(m){return g.neo(m.x+c,m.y+h)}},g}(),Ke=function(){function g(c,h){if(!(this instanceof g))return new g(c,h);this.lowerBound=v.zero(),this.upperBound=v.zero(),"object"==typeof c&&this.lowerBound.setVec2(c),"object"==typeof h?this.upperBound.setVec2(h):"object"==typeof c&&this.upperBound.setVec2(c)}return g.prototype.isValid=function(){return g.isValid(this)},g.isValid=function(c){return!(null===c||typeof c>"u")&&v.isValid(c.lowerBound)&&v.isValid(c.upperBound)&&v.sub(c.upperBound,c.lowerBound).lengthSquared()>=0},g.assert=function(c){},g.prototype.getCenter=function(){return v.neo(.5*(this.lowerBound.x+this.upperBound.x),.5*(this.lowerBound.y+this.upperBound.y))},g.prototype.getExtents=function(){return v.neo(.5*(this.upperBound.x-this.lowerBound.x),.5*(this.upperBound.y-this.lowerBound.y))},g.prototype.getPerimeter=function(){return 2*(this.upperBound.x-this.lowerBound.x+this.upperBound.y-this.lowerBound.y)},g.prototype.combine=function(c,h){var m=c.lowerBound,x=c.upperBound,S=(h=h||this).lowerBound,M=h.upperBound,D=oe.min(m.x,S.x),R=oe.min(m.y,S.y),U=oe.max(M.x,x.x),O=oe.max(M.y,x.y);this.lowerBound.setNum(D,R),this.upperBound.setNum(U,O)},g.prototype.combinePoints=function(c,h){this.lowerBound.setNum(oe.min(c.x,h.x),oe.min(c.y,h.y)),this.upperBound.setNum(oe.max(c.x,h.x),oe.max(c.y,h.y))},g.prototype.set=function(c){this.lowerBound.setNum(c.lowerBound.x,c.lowerBound.y),this.upperBound.setNum(c.upperBound.x,c.upperBound.y)},g.prototype.contains=function(c){var h=!0;return(h=(h=(h=h&&this.lowerBound.x<=c.lowerBound.x)&&this.lowerBound.y<=c.lowerBound.y)&&c.upperBound.x<=this.upperBound.x)&&c.upperBound.y<=this.upperBound.y},g.prototype.extend=function(c){return g.extend(this,c),this},g.extend=function(c,h){c.lowerBound.x-=h,c.lowerBound.y-=h,c.upperBound.x+=h,c.upperBound.y+=h},g.testOverlap=function(c,h){return!(h.lowerBound.x-c.upperBound.x>0||h.lowerBound.y-c.upperBound.y>0||c.lowerBound.x-h.upperBound.x>0||c.lowerBound.y-h.upperBound.y>0)},g.areEqual=function(c,h){return v.areEqual(c.lowerBound,h.lowerBound)&&v.areEqual(c.upperBound,h.upperBound)},g.diff=function(c,h){var m=oe.max(0,oe.min(c.upperBound.x,h.upperBound.x)-oe.max(h.lowerBound.x,c.lowerBound.x)),x=oe.max(0,oe.min(c.upperBound.y,h.upperBound.y)-oe.max(h.lowerBound.y,c.lowerBound.y));return(c.upperBound.x-c.lowerBound.x)*(c.upperBound.y-c.lowerBound.y)+(h.upperBound.x-h.lowerBound.x)*(h.upperBound.y-h.lowerBound.y)-m*x},g.prototype.rayCast=function(c,h){for(var m=-1/0,x=1/0,S=h.p1,M=v.sub(h.p2,h.p1),D=v.abs(M),R=v.zero(),U="x";null!==U;U="x"===U?"y":null)if(D.x<oe.EPSILON){if(S[U]<this.lowerBound[U]||this.upperBound[U]<S[U])return!1}else{var O=1/M[U],W=(this.lowerBound[U]-S[U])*O,V=(this.upperBound[U]-S[U])*O,B=-1;if(W>V){var F=W;W=V,V=F,B=1}if(W>m&&(R.setZero(),R[U]=B,m=W),m>(x=oe.min(x,V)))return!1}return!(m<0||h.maxFraction<m||(c.fraction=m,c.normal=R,0))},g.prototype.toString=function(){return JSON.stringify(this)},g}(),He=function(){function g(){}return Object.defineProperty(g,"linearSlopSquared",{get:function(){return g.linearSlop*g.linearSlop},enumerable:!1,configurable:!0}),Object.defineProperty(g,"polygonRadius",{get:function(){return 2*g.linearSlop},enumerable:!1,configurable:!0}),Object.defineProperty(g,"maxTranslationSquared",{get:function(){return g.maxTranslation*g.maxTranslation},enumerable:!1,configurable:!0}),Object.defineProperty(g,"maxRotationSquared",{get:function(){return g.maxRotation*g.maxRotation},enumerable:!1,configurable:!0}),Object.defineProperty(g,"linearSleepToleranceSqr",{get:function(){return Math.pow(g.linearSleepTolerance,2)},enumerable:!1,configurable:!0}),Object.defineProperty(g,"angularSleepToleranceSqr",{get:function(){return Math.pow(g.angularSleepTolerance,2)},enumerable:!1,configurable:!0}),g.maxManifoldPoints=2,g.maxPolygonVertices=12,g.aabbExtension=.1,g.aabbMultiplier=2,g.linearSlop=.005,g.angularSlop=2/180*Math.PI,g.maxSubSteps=8,g.maxTOIContacts=32,g.maxTOIIterations=20,g.maxDistnceIterations=20,g.velocityThreshold=1,g.maxLinearCorrection=.2,g.maxAngularCorrection=8/180*Math.PI,g.maxTranslation=2,g.maxRotation=.5*Math.PI,g.baumgarte=.2,g.toiBaugarte=.75,g.timeToSleep=.5,g.linearSleepTolerance=.01,g.angularSleepTolerance=2/180*Math.PI,g}(),E=function(){function g(c){this._list=[],this._max=1/0,this._createCount=0,this._outCount=0,this._inCount=0,this._discardCount=0,this._list=[],this._max=c.max||this._max,this._createFn=c.create,this._outFn=c.allocate,this._inFn=c.release,this._discardFn=c.discard}return g.prototype.max=function(c){return"number"==typeof c?(this._max=c,this):this._max},g.prototype.size=function(){return this._list.length},g.prototype.allocate=function(){var c;return this._list.length>0?c=this._list.shift():(this._createCount++,c="function"==typeof this._createFn?this._createFn():{}),this._outCount++,"function"==typeof this._outFn&&this._outFn(c),c},g.prototype.release=function(c){this._list.length<this._max?(this._inCount++,"function"==typeof this._inFn&&this._inFn(c),this._list.push(c)):(this._discardCount++,"function"==typeof this._discardFn&&(c=this._discardFn(c)))},g.prototype.toString=function(){return" +"+this._createCount+" >"+this._outCount+" <"+this._inCount+" -"+this._discardCount+" ="+this._list.length+"/"+this._max},g}(),P=function(){function g(c){this.aabb=new Ke,this.userData=null,this.parent=null,this.child1=null,this.child2=null,this.height=-1,this.id=c}return g.prototype.toString=function(){return this.id+": "+this.userData},g.prototype.isLeaf=function(){return null==this.child1},g}(),Y=function(){function g(){this.inputPool=new E({create:function(){return{}},release:function(c){}}),this.stackPool=new E({create:function(){return[]},release:function(c){c.length=0}}),this.iteratorPool=new E({create:function(){return new ae},release:function(c){c.close()}}),this.m_root=null,this.m_nodes={},this.m_lastProxyId=0,this.m_pool=new E({create:function(){return new P}})}return g.prototype.getUserData=function(c){return this.m_nodes[c].userData},g.prototype.getFatAABB=function(c){return this.m_nodes[c].aabb},g.prototype.allocateNode=function(){var c=this.m_pool.allocate();return c.id=++this.m_lastProxyId,c.userData=null,c.parent=null,c.child1=null,c.child2=null,c.height=-1,this.m_nodes[c.id]=c,c},g.prototype.freeNode=function(c){this.m_pool.release(c),c.height=-1,delete this.m_nodes[c.id]},g.prototype.createProxy=function(c,h){var m=this.allocateNode();return m.aabb.set(c),Ke.extend(m.aabb,He.aabbExtension),m.userData=h,m.height=0,this.insertLeaf(m),m.id},g.prototype.destroyProxy=function(c){var h=this.m_nodes[c];this.removeLeaf(h),this.freeNode(h)},g.prototype.moveProxy=function(c,h,m){var x=this.m_nodes[c];return!x.aabb.contains(h)&&(this.removeLeaf(x),x.aabb.set(h),Ke.extend(h=x.aabb,He.aabbExtension),m.x<0?h.lowerBound.x+=m.x*He.aabbMultiplier:h.upperBound.x+=m.x*He.aabbMultiplier,m.y<0?h.lowerBound.y+=m.y*He.aabbMultiplier:h.upperBound.y+=m.y*He.aabbMultiplier,this.insertLeaf(x),!0)},g.prototype.insertLeaf=function(c){if(null==this.m_root)return this.m_root=c,void(this.m_root.parent=null);for(var h=c.aabb,m=this.m_root;!m.isLeaf();){var x=m.child1,S=m.child2,M=m.aabb.getPerimeter(),D=new Ke;D.combine(m.aabb,h);var R=D.getPerimeter(),U=2*R,O=2*(R-M),W=void 0;if(x.isLeaf())(V=new Ke).combine(h,x.aabb),W=V.getPerimeter()+O;else{(V=new Ke).combine(h,x.aabb);var B=x.aabb.getPerimeter();W=V.getPerimeter()-B+O}var V,j=void 0;if(S.isLeaf()?((V=new Ke).combine(h,S.aabb),j=V.getPerimeter()+O):((V=new Ke).combine(h,S.aabb),B=S.aabb.getPerimeter(),j=V.getPerimeter()-B+O),U<W&&U<j)break;m=W<j?x:S}var ee=m,Z=ee.parent,re=this.allocateNode();for(re.parent=Z,re.userData=null,re.aabb.combine(h,ee.aabb),re.height=ee.height+1,null!=Z?(Z.child1===ee?Z.child1=re:Z.child2=re,re.child1=ee,re.child2=c,ee.parent=re,c.parent=re):(re.child1=ee,re.child2=c,ee.parent=re,c.parent=re,this.m_root=re),m=c.parent;null!=m;)(m=this.balance(m)).height=1+oe.max((x=m.child1).height,(S=m.child2).height),m.aabb.combine(x.aabb,S.aabb),m=m.parent},g.prototype.removeLeaf=function(c){if(c!==this.m_root){var x,h=c.parent,m=h.parent;if(x=h.child1===c?h.child2:h.child1,null!=m){m.child1===h?m.child1=x:m.child2=x,x.parent=m,this.freeNode(h);for(var S=m;null!=S;){var M=(S=this.balance(S)).child1,D=S.child2;S.aabb.combine(M.aabb,D.aabb),S.height=1+oe.max(M.height,D.height),S=S.parent}}else this.m_root=x,x.parent=null,this.freeNode(h)}else this.m_root=null},g.prototype.balance=function(c){var h=c;if(h.isLeaf()||h.height<2)return c;var m=h.child1,x=h.child2,S=x.height-m.height;if(S>1){var M=x.child1,D=x.child2;return x.child1=h,x.parent=h.parent,h.parent=x,null!=x.parent?x.parent.child1===c?x.parent.child1=x:x.parent.child2=x:this.m_root=x,M.height>D.height?(x.child2=M,h.child2=D,D.parent=h,h.aabb.combine(m.aabb,D.aabb),x.aabb.combine(h.aabb,M.aabb),h.height=1+oe.max(m.height,D.height),x.height=1+oe.max(h.height,M.height)):(x.child2=D,h.child2=M,M.parent=h,h.aabb.combine(m.aabb,M.aabb),x.aabb.combine(h.aabb,D.aabb),h.height=1+oe.max(m.height,M.height),x.height=1+oe.max(h.height,D.height)),x}if(S<-1){var R=m.child1,U=m.child2;return m.child1=h,m.parent=h.parent,h.parent=m,null!=m.parent?m.parent.child1===h?m.parent.child1=m:m.parent.child2=m:this.m_root=m,R.height>U.height?(m.child2=R,h.child1=U,U.parent=h,h.aabb.combine(x.aabb,U.aabb),m.aabb.combine(h.aabb,R.aabb),h.height=1+oe.max(x.height,U.height),m.height=1+oe.max(h.height,R.height)):(m.child2=U,h.child1=R,R.parent=h,h.aabb.combine(x.aabb,R.aabb),m.aabb.combine(h.aabb,U.aabb),h.height=1+oe.max(x.height,R.height),m.height=1+oe.max(h.height,U.height)),m}return h},g.prototype.getHeight=function(){return null==this.m_root?0:this.m_root.height},g.prototype.getAreaRatio=function(){if(null==this.m_root)return 0;for(var x,h=this.m_root.aabb.getPerimeter(),m=0,S=this.iteratorPool.allocate().preorder(this.m_root);x=S.next();)x.height<0||(m+=x.aabb.getPerimeter());return this.iteratorPool.release(S),m/h},g.prototype.computeHeight=function(c){var h;if((h=typeof c<"u"?this.m_nodes[c]:this.m_root).isLeaf())return 0;var m=this.computeHeight(h.child1.id),x=this.computeHeight(h.child2.id);return 1+oe.max(m,x)},g.prototype.validateStructure=function(c){if(null!=c){var h=c.child1,m=c.child2;c.isLeaf()||(this.validateStructure(h),this.validateStructure(m))}},g.prototype.validateMetrics=function(c){if(null!=c){var h=c.child1,m=c.child2;c.isLeaf()||(oe.max(h.height,m.height),(new Ke).combine(h.aabb,m.aabb),this.validateMetrics(h),this.validateMetrics(m))}},g.prototype.validate=function(){this.validateStructure(this.m_root),this.validateMetrics(this.m_root)},g.prototype.getMaxBalance=function(){for(var h,c=0,m=this.iteratorPool.allocate().preorder(this.m_root);h=m.next();)if(!(h.height<=1)){var x=oe.abs(h.child2.height-h.child1.height);c=oe.max(c,x)}return this.iteratorPool.release(m),c},g.prototype.rebuildBottomUp=function(){for(var m,c=[],h=0,x=this.iteratorPool.allocate().preorder(this.m_root);m=x.next();)m.height<0||(m.isLeaf()?(m.parent=null,c[h]=m,++h):this.freeNode(m));for(this.iteratorPool.release(x);h>1;){for(var S=1/0,M=-1,D=-1,R=0;R<h;++R)for(var U=c[R].aabb,O=R+1;O<h;++O){var W=c[O].aabb,V=new Ke;V.combine(U,W);var B=V.getPerimeter();B<S&&(M=R,D=O,S=B)}var F=c[M],j=c[D],ee=this.allocateNode();ee.child1=F,ee.child2=j,ee.height=1+oe.max(F.height,j.height),ee.aabb.combine(F.aabb,j.aabb),ee.parent=null,F.parent=ee,j.parent=ee,c[D]=c[h-1],c[M]=ee,--h}this.m_root=c[0],this.validate()},g.prototype.shiftOrigin=function(c){for(var h,m=this.iteratorPool.allocate().preorder(this.m_root);h=m.next();){var x=h.aabb;x.lowerBound.x-=c.x,x.lowerBound.y-=c.y,x.upperBound.x-=c.x,x.upperBound.y-=c.y}this.iteratorPool.release(m)},g.prototype.query=function(c,h){var m=this.stackPool.allocate();for(m.push(this.m_root);m.length>0;){var x=m.pop();if(null!=x&&Ke.testOverlap(x.aabb,c))if(x.isLeaf()){if(!1===h(x.id))return}else m.push(x.child1),m.push(x.child2)}this.stackPool.release(m)},g.prototype.rayCast=function(c,h){var m=c.p1,x=c.p2,S=v.sub(x,m);S.normalize();var M=v.crossNumVec2(1,S),D=v.abs(M),R=c.maxFraction,U=new Ke,O=v.combine(1-R,m,R,x);U.combinePoints(m,O);var W=this.stackPool.allocate(),V=this.inputPool.allocate();for(W.push(this.m_root);W.length>0;){var B=W.pop();if(null!=B&&!1!==Ke.testOverlap(B.aabb,U)){var F=B.aabb.getCenter(),j=B.aabb.getExtents();if(!(oe.abs(v.dot(M,v.sub(m,F)))-v.dot(D,j)>0))if(B.isLeaf()){V.p1=v.clone(c.p1),V.p2=v.clone(c.p2),V.maxFraction=R;var Z=h(V,B.id);if(0===Z)return;Z>0&&(O=v.combine(1-(R=Z),m,R,x),U.combinePoints(m,O))}else W.push(B.child1),W.push(B.child2)}}this.stackPool.release(W),this.inputPool.release(V)},g}(),ae=function(){function g(){this.parents=[],this.states=[]}return g.prototype.preorder=function(c){return this.parents.length=0,this.parents.push(c),this.states.length=0,this.states.push(0),this},g.prototype.next=function(){for(;this.parents.length>0;){var c=this.parents.length-1,h=this.parents[c];if(0===this.states[c])return this.states[c]=1,h;if(1===this.states[c]&&(this.states[c]=2,h.child1))return this.parents.push(h.child1),this.states.push(1),h.child1;if(2===this.states[c]&&(this.states[c]=3,h.child2))return this.parents.push(h.child2),this.states.push(1),h.child2;this.parents.pop(),this.states.pop()}},g.prototype.close=function(){this.parents.length=0},g}(),Ae=function(){function g(){var c=this;this.m_tree=new Y,this.m_proxyCount=0,this.m_moveBuffer=[],this.query=function(h,m){c.m_tree.query(h,m)},this.queryCallback=function(h){if(h===c.m_queryProxyId)return!0;var m=oe.min(h,c.m_queryProxyId),x=oe.max(h,c.m_queryProxyId),S=c.m_tree.getUserData(m),M=c.m_tree.getUserData(x);return c.m_callback(S,M),!0}}return g.prototype.getUserData=function(c){return this.m_tree.getUserData(c)},g.prototype.testOverlap=function(c,h){var m=this.m_tree.getFatAABB(c),x=this.m_tree.getFatAABB(h);return Ke.testOverlap(m,x)},g.prototype.getFatAABB=function(c){return this.m_tree.getFatAABB(c)},g.prototype.getProxyCount=function(){return this.m_proxyCount},g.prototype.getTreeHeight=function(){return this.m_tree.getHeight()},g.prototype.getTreeBalance=function(){return this.m_tree.getMaxBalance()},g.prototype.getTreeQuality=function(){return this.m_tree.getAreaRatio()},g.prototype.rayCast=function(c,h){this.m_tree.rayCast(c,h)},g.prototype.shiftOrigin=function(c){this.m_tree.shiftOrigin(c)},g.prototype.createProxy=function(c,h){var m=this.m_tree.createProxy(c,h);return this.m_proxyCount++,this.bufferMove(m),m},g.prototype.destroyProxy=function(c){this.unbufferMove(c),this.m_proxyCount--,this.m_tree.destroyProxy(c)},g.prototype.moveProxy=function(c,h,m){this.m_tree.moveProxy(c,h,m)&&this.bufferMove(c)},g.prototype.touchProxy=function(c){this.bufferMove(c)},g.prototype.bufferMove=function(c){this.m_moveBuffer.push(c)},g.prototype.unbufferMove=function(c){for(var h=0;h<this.m_moveBuffer.length;++h)this.m_moveBuffer[h]===c&&(this.m_moveBuffer[h]=null)},g.prototype.updatePairs=function(c){for(this.m_callback=c;this.m_moveBuffer.length>0;)if(this.m_queryProxyId=this.m_moveBuffer.pop(),null!==this.m_queryProxyId){var h=this.m_tree.getFatAABB(this.m_queryProxyId);this.m_tree.query(h,this.queryCallback)}},g}(),X=function(){function g(c){if(!(this instanceof g))return new g(c);"number"==typeof c?this.setAngle(c):"object"==typeof c?this.setRot(c):this.setIdentity()}return g.neo=function(c){var h=Object.create(g.prototype);return h.setAngle(c),h},g.clone=function(c){var h=Object.create(g.prototype);return h.s=c.s,h.c=c.c,h},g.identity=function(){var c=Object.create(g.prototype);return c.s=0,c.c=1,c},g.isValid=function(c){return!(null===c||typeof c>"u")&&oe.isFinite(c.s)&&oe.isFinite(c.c)},g.assert=function(c){},g.prototype.setIdentity=function(){this.s=0,this.c=1},g.prototype.set=function(c){"object"==typeof c?(this.s=c.s,this.c=c.c):(this.s=oe.sin(c),this.c=oe.cos(c))},g.prototype.setRot=function(c){this.s=c.s,this.c=c.c},g.prototype.setAngle=function(c){this.s=oe.sin(c),this.c=oe.cos(c)},g.prototype.getAngle=function(){return oe.atan2(this.s,this.c)},g.prototype.getXAxis=function(){return v.neo(this.c,this.s)},g.prototype.getYAxis=function(){return v.neo(-this.s,this.c)},g.mul=function(c,h){if("c"in h&&"s"in h){var m=g.identity();return m.s=c.s*h.c+c.c*h.s,m.c=c.c*h.c-c.s*h.s,m}if("x"in h&&"y"in h)return v.neo(c.c*h.x-c.s*h.y,c.s*h.x+c.c*h.y)},g.mulRot=function(c,h){var m=g.identity();return m.s=c.s*h.c+c.c*h.s,m.c=c.c*h.c-c.s*h.s,m},g.mulVec2=function(c,h){return v.neo(c.c*h.x-c.s*h.y,c.s*h.x+c.c*h.y)},g.mulSub=function(c,h,m){return v.neo(c.c*(h.x-m.x)-c.s*(h.y-m.y),c.s*(h.x-m.x)+c.c*(h.y-m.y))},g.mulT=function(c,h){if("c"in h&&"s"in h){var m=g.identity();return m.s=c.c*h.s-c.s*h.c,m.c=c.c*h.c+c.s*h.s,m}if("x"in h&&"y"in h)return v.neo(c.c*h.x+c.s*h.y,-c.s*h.x+c.c*h.y)},g.mulTRot=function(c,h){var m=g.identity();return m.s=c.c*h.s-c.s*h.c,m.c=c.c*h.c+c.s*h.s,m},g.mulTVec2=function(c,h){return v.neo(c.c*h.x+c.s*h.y,-c.s*h.x+c.c*h.y)},g}(),ne=function(){function g(c,h){if(!(this instanceof g))return new g(c,h);this.p=v.zero(),this.q=X.identity(),typeof c<"u"&&this.p.setVec2(c),typeof h<"u"&&this.q.setAngle(h)}return g.clone=function(c){var h=Object.create(g.prototype);return h.p=v.clone(c.p),h.q=X.clone(c.q),h},g.neo=function(c,h){var m=Object.create(g.prototype);return m.p=v.clone(c),m.q=X.clone(h),m},g.identity=function(){var c=Object.create(g.prototype);return c.p=v.zero(),c.q=X.identity(),c},g.prototype.setIdentity=function(){this.p.setZero(),this.q.setIdentity()},g.prototype.set=function(c,h){typeof h>"u"?(this.p.set(c.p),this.q.set(c.q)):(this.p.set(c),this.q.set(h))},g.prototype.setNum=function(c,h){this.p.setVec2(c),this.q.setAngle(h)},g.prototype.setTransform=function(c){this.p.setVec2(c.p),this.q.setRot(c.q)},g.isValid=function(c){return!(null===c||typeof c>"u")&&v.isValid(c.p)&&X.isValid(c.q)},g.assert=function(c){},g.mul=function(c,h){if(Array.isArray(h)){for(var m=[],x=0;x<h.length;x++)m[x]=g.mul(c,h[x]);return m}return"x"in h&&"y"in h?g.mulVec2(c,h):"p"in h&&"q"in h?g.mulXf(c,h):void 0},g.mulAll=function(c,h){for(var m=[],x=0;x<h.length;x++)m[x]=g.mul(c,h[x]);return m},g.mulFn=function(c){return function(h){return g.mul(c,h)}},g.mulVec2=function(c,h){return v.neo(c.q.c*h.x-c.q.s*h.y+c.p.x,c.q.s*h.x+c.q.c*h.y+c.p.y)},g.mulXf=function(c,h){var m=g.identity();return m.q=X.mulRot(c.q,h.q),m.p=v.add(X.mulVec2(c.q,h.p),c.p),m},g.mulT=function(c,h){return"x"in h&&"y"in h?g.mulTVec2(c,h):"p"in h&&"q"in h?g.mulTXf(c,h):void 0},g.mulTVec2=function(c,h){var m=h.x-c.p.x,x=h.y-c.p.y;return v.neo(c.q.c*m+c.q.s*x,-c.q.s*m+c.q.c*x)},g.mulTXf=function(c,h){var m=g.identity();return m.q.setRot(X.mulTRot(c.q,h.q)),m.p.setVec2(X.mulTVec2(c.q,v.sub(h.p,c.p))),m},g}(),mt=function(){function g(c,h){this.localCenter=v.zero(),this.c=v.zero(),this.a=0,this.alpha0=0,this.c0=v.zero(),this.a0=0}return g.prototype.setTransform=function(c){var h=ne.mulVec2(c,this.localCenter);this.c.setVec2(h),this.c0.setVec2(h),this.a=c.q.getAngle(),this.a0=c.q.getAngle()},g.prototype.setLocalCenter=function(c,h){this.localCenter.setVec2(c);var m=ne.mulVec2(h,this.localCenter);this.c.setVec2(m),this.c0.setVec2(m)},g.prototype.getTransform=function(c,h){void 0===h&&(h=0),c.q.setAngle((1-h)*this.a0+h*this.a),c.p.setCombine(1-h,this.c0,h,this.c),c.p.sub(X.mulVec2(c.q,this.localCenter))},g.prototype.advance=function(c){var h=(c-this.alpha0)/(1-this.alpha0);this.c0.setCombine(h,this.c,1-h,this.c0),this.a0=h*this.a+(1-h)*this.a0,this.alpha0=c},g.prototype.forward=function(){this.a0=this.a,this.c0.setVec2(this.c)},g.prototype.normalize=function(){var c=oe.mod(this.a0,-oe.PI,+oe.PI);this.a-=this.a0-c,this.a0=c},g.prototype.clone=function(){var c=new g;return c.localCenter.setVec2(this.localCenter),c.alpha0=this.alpha0,c.a0=this.a0,c.a=this.a,c.c0.setVec2(this.c0),c.c.setVec2(this.c),c},g.prototype.set=function(c){this.localCenter.setVec2(c.localCenter),this.alpha0=c.alpha0,this.a0=c.a0,this.a=c.a,this.c0.setVec2(c.c0),this.c.setVec2(c.c)},g}(),dn=function g(){this.v=v.zero(),this.w=0},Wn=function(){function g(){this.c=v.zero(),this.a=0}return g.prototype.getTransform=function(c,h){return c.q.setAngle(this.a),c.p.setVec2(v.sub(this.c,X.mulVec2(c.q,h))),c},g}(),ai=function(){function g(){}return g.prototype._reset=function(){},g.isValid=function(c){return!(null===c||typeof c>"u")&&"string"==typeof c.m_type&&"number"==typeof c.m_radius},g.prototype.getRadius=function(){return this.m_radius},g.prototype.getType=function(){return this.m_type},g}(),Ss={userData:null,friction:.2,restitution:0,density:0,isSensor:!1,filterGroupIndex:0,filterCategoryBits:1,filterMaskBits:65535},yr=function g(c,h){this.aabb=new Ke,this.fixture=c,this.childIndex=h},xr=function(){function g(c,h,m){h.shape?(m=h,h=h.shape):"number"==typeof m&&(m={density:m}),m=ge(m,Ss),this.m_body=c,this.m_friction=m.friction,this.m_restitution=m.restitution,this.m_density=m.density,this.m_isSensor=m.isSensor,this.m_filterGroupIndex=m.filterGroupIndex,this.m_filterCategoryBits=m.filterCategoryBits,this.m_filterMaskBits=m.filterMaskBits,this.m_shape=h,this.m_next=null,this.m_proxies=[],this.m_proxyCount=0;for(var x=this.m_shape.getChildCount(),S=0;S<x;++S)this.m_proxies[S]=new yr(this,S);this.m_userData=m.userData}return g.prototype._reset=function(){var c=this.getBody(),h=c.m_world.m_broadPhase;this.destroyProxies(h),this.m_shape._reset&&this.m_shape._reset();for(var m=this.m_shape.getChildCount(),x=0;x<m;++x)this.m_proxies[x]=new yr(this,x);this.createProxies(h,c.m_xf),c.resetMassData()},g.prototype._serialize=function(){return{friction:this.m_friction,restitution:this.m_restitution,density:this.m_density,isSensor:this.m_isSensor,filterGroupIndex:this.m_filterGroupIndex,filterCategoryBits:this.m_filterCategoryBits,filterMaskBits:this.m_filterMaskBits,shape:this.m_shape}},g._deserialize=function(c,h,m){var x=m(ai,c.shape);return x&&new g(h,x,c)},g.prototype.getType=function(){return this.m_shape.getType()},g.prototype.getShape=function(){return this.m_shape},g.prototype.isSensor=function(){return this.m_isSensor},g.prototype.setSensor=function(c){c!=this.m_isSensor&&(this.m_body.setAwake(!0),this.m_isSensor=c)},g.prototype.getUserData=function(){return this.m_userData},g.prototype.setUserData=function(c){this.m_userData=c},g.prototype.getBody=function(){return this.m_body},g.prototype.getNext=function(){return this.m_next},g.prototype.getDensity=function(){return this.m_density},g.prototype.setDensity=function(c){this.m_density=c},g.prototype.getFriction=function(){return this.m_friction},g.prototype.setFriction=function(c){this.m_friction=c},g.prototype.getRestitution=function(){return this.m_restitution},g.prototype.setRestitution=function(c){this.m_restitution=c},g.prototype.testPoint=function(c){return this.m_shape.testPoint(this.m_body.getTransform(),c)},g.prototype.rayCast=function(c,h,m){return this.m_shape.rayCast(c,h,this.m_body.getTransform(),m)},g.prototype.getMassData=function(c){this.m_shape.computeMass(c,this.m_density)},g.prototype.getAABB=function(c){return this.m_proxies[c].aabb},g.prototype.createProxies=function(c,h){this.m_proxyCount=this.m_shape.getChildCount();for(var m=0;m<this.m_proxyCount;++m){var x=this.m_proxies[m];this.m_shape.computeAABB(x.aabb,h,m),x.proxyId=c.createProxy(x.aabb,x)}},g.prototype.destroyProxies=function(c){for(var h=0;h<this.m_proxyCount;++h){var m=this.m_proxies[h];c.destroyProxy(m.proxyId),m.proxyId=null}this.m_proxyCount=0},g.prototype.synchronize=function(c,h,m){for(var x=0;x<this.m_proxyCount;++x){var S=this.m_proxies[x],M=new Ke,D=new Ke;this.m_shape.computeAABB(M,h,S.childIndex),this.m_shape.computeAABB(D,m,S.childIndex),S.aabb.combine(M,D);var R=v.sub(m.p,h.p);c.moveProxy(S.proxyId,S.aabb,R)}},g.prototype.setFilterData=function(c){this.m_filterGroupIndex=c.groupIndex,this.m_filterCategoryBits=c.categoryBits,this.m_filterMaskBits=c.maskBits,this.refilter()},g.prototype.getFilterGroupIndex=function(){return this.m_filterGroupIndex},g.prototype.setFilterGroupIndex=function(c){this.m_filterGroupIndex=c},g.prototype.getFilterCategoryBits=function(){return this.m_filterCategoryBits},g.prototype.setFilterCategoryBits=function(c){this.m_filterCategoryBits=c},g.prototype.getFilterMaskBits=function(){return this.m_filterMaskBits},g.prototype.setFilterMaskBits=function(c){this.m_filterMaskBits=c},g.prototype.refilter=function(){if(null!=this.m_body){for(var c=this.m_body.getContactList();c;){var h=c.contact,m=h.getFixtureA(),x=h.getFixtureB();(m==this||x==this)&&h.flagForFiltering(),c=c.next}var S=this.m_body.getWorld();if(null!=S)for(var M=S.m_broadPhase,D=0;D<this.m_proxyCount;++D)M.touchProxy(this.m_proxies[D].proxyId)}},g.prototype.shouldCollide=function(c){return c.m_filterGroupIndex===this.m_filterGroupIndex&&0!==c.m_filterGroupIndex?c.m_filterGroupIndex>0:0!=(c.m_filterMaskBits&this.m_filterCategoryBits)&&0!=(c.m_filterCategoryBits&this.m_filterMaskBits)},g}(),Mn="static",Zs="kinematic",zi="dynamic",ha={type:Mn,position:v.zero(),angle:0,linearVelocity:v.zero(),angularVelocity:0,linearDamping:0,angularDamping:0,fixedRotation:!1,bullet:!1,gravityScale:1,allowSleep:!0,awake:!0,active:!0,userData:null},Lo=function g(){this.mass=0,this.center=v.zero(),this.I=0},sn=function(){function g(c,h){h=ge(h,ha),this.m_world=c,this.m_awakeFlag=h.awake,this.m_autoSleepFlag=h.allowSleep,this.m_bulletFlag=h.bullet,this.m_fixedRotationFlag=h.fixedRotation,this.m_activeFlag=h.active,this.m_islandFlag=!1,this.m_toiFlag=!1,this.m_userData=h.userData,this.m_type=h.type,this.m_type==zi?(this.m_mass=1,this.m_invMass=1):(this.m_mass=0,this.m_invMass=0),this.m_I=0,this.m_invI=0,this.m_xf=ne.identity(),this.m_xf.p=v.clone(h.position),this.m_xf.q.setAngle(h.angle),this.m_sweep=new mt,this.m_sweep.setTransform(this.m_xf),this.c_velocity=new dn,this.c_position=new Wn,this.m_force=v.zero(),this.m_torque=0,this.m_linearVelocity=v.clone(h.linearVelocity),this.m_angularVelocity=h.angularVelocity,this.m_linearDamping=h.linearDamping,this.m_angularDamping=h.angularDamping,this.m_gravityScale=h.gravityScale,this.m_sleepTime=0,this.m_jointList=null,this.m_contactList=null,this.m_fixtureList=null,this.m_prev=null,this.m_next=null,this.m_destroyed=!1}return g.prototype._serialize=function(){for(var c=[],h=this.m_fixtureList;h;h=h.m_next)c.push(h);return{type:this.m_type,bullet:this.m_bulletFlag,position:this.m_xf.p,angle:this.m_xf.q.getAngle(),linearVelocity:this.m_linearVelocity,angularVelocity:this.m_angularVelocity,fixtures:c}},g._deserialize=function(c,h,m){var x=new g(h,c);if(c.fixtures)for(var S=c.fixtures.length-1;S>=0;S--){var M=m(xr,c.fixtures[S],x);x._addFixture(M)}return x},g.prototype.isWorldLocked=function(){return!(!this.m_world||!this.m_world.isLocked())},g.prototype.getWorld=function(){return this.m_world},g.prototype.getNext=function(){return this.m_next},g.prototype.setUserData=function(c){this.m_userData=c},g.prototype.getUserData=function(){return this.m_userData},g.prototype.getFixtureList=function(){return this.m_fixtureList},g.prototype.getJointList=function(){return this.m_jointList},g.prototype.getContactList=function(){return this.m_contactList},g.prototype.isStatic=function(){return this.m_type==Mn},g.prototype.isDynamic=function(){return this.m_type==zi},g.prototype.isKinematic=function(){return this.m_type==Zs},g.prototype.setStatic=function(){return this.setType(Mn),this},g.prototype.setDynamic=function(){return this.setType(zi),this},g.prototype.setKinematic=function(){return this.setType(Zs),this},g.prototype.getType=function(){return this.m_type},g.prototype.setType=function(c){if(1!=this.isWorldLocked()&&this.m_type!=c){this.m_type=c,this.resetMassData(),this.m_type==Mn&&(this.m_linearVelocity.setZero(),this.m_angularVelocity=0,this.m_sweep.forward(),this.synchronizeFixtures()),this.setAwake(!0),this.m_force.setZero(),this.m_torque=0;for(var h=this.m_contactList;h;){var m=h;h=h.next,this.m_world.destroyContact(m.contact)}this.m_contactList=null;for(var x=this.m_world.m_broadPhase,S=this.m_fixtureList;S;S=S.m_next)for(var M=S.m_proxyCount,D=0;D<M;++D)x.touchProxy(S.m_proxies[D].proxyId)}},g.prototype.isBullet=function(){return this.m_bulletFlag},g.prototype.setBullet=function(c){this.m_bulletFlag=!!c},g.prototype.isSleepingAllowed=function(){return this.m_autoSleepFlag},g.prototype.setSleepingAllowed=function(c){this.m_autoSleepFlag=!!c,0==this.m_autoSleepFlag&&this.setAwake(!0)},g.prototype.isAwake=function(){return this.m_awakeFlag},g.prototype.setAwake=function(c){c?0==this.m_awakeFlag&&(this.m_awakeFlag=!0,this.m_sleepTime=0):(this.m_awakeFlag=!1,this.m_sleepTime=0,this.m_linearVelocity.setZero(),this.m_angularVelocity=0,this.m_force.setZero(),this.m_torque=0)},g.prototype.isActive=function(){return this.m_activeFlag},g.prototype.setActive=function(c){if(c!=this.m_activeFlag)if(this.m_activeFlag=!!c,this.m_activeFlag)for(var h=this.m_world.m_broadPhase,m=this.m_fixtureList;m;m=m.m_next)m.createProxies(h,this.m_xf);else{for(h=this.m_world.m_broadPhase,m=this.m_fixtureList;m;m=m.m_next)m.destroyProxies(h);for(var x=this.m_contactList;x;){var S=x;x=x.next,this.m_world.destroyContact(S.contact)}this.m_contactList=null}},g.prototype.isFixedRotation=function(){return this.m_fixedRotationFlag},g.prototype.setFixedRotation=function(c){this.m_fixedRotationFlag!=c&&(this.m_fixedRotationFlag=!!c,this.m_angularVelocity=0,this.resetMassData())},g.prototype.getTransform=function(){return this.m_xf},g.prototype.setTransform=function(c,h){if(1!=this.isWorldLocked()){this.m_xf.setNum(c,h),this.m_sweep.setTransform(this.m_xf);for(var m=this.m_world.m_broadPhase,x=this.m_fixtureList;x;x=x.m_next)x.synchronize(m,this.m_xf,this.m_xf)}},g.prototype.synchronizeTransform=function(){this.m_sweep.getTransform(this.m_xf,1)},g.prototype.synchronizeFixtures=function(){var c=ne.identity();this.m_sweep.getTransform(c,0);for(var h=this.m_world.m_broadPhase,m=this.m_fixtureList;m;m=m.m_next)m.synchronize(h,c,this.m_xf)},g.prototype.advance=function(c){this.m_sweep.advance(c),this.m_sweep.c.setVec2(this.m_sweep.c0),this.m_sweep.a=this.m_sweep.a0,this.m_sweep.getTransform(this.m_xf,1)},g.prototype.getPosition=function(){return this.m_xf.p},g.prototype.setPosition=function(c){this.setTransform(c,this.m_sweep.a)},g.prototype.getAngle=function(){return this.m_sweep.a},g.prototype.setAngle=function(c){this.setTransform(this.m_xf.p,c)},g.prototype.getWorldCenter=function(){return this.m_sweep.c},g.prototype.getLocalCenter=function(){return this.m_sweep.localCenter},g.prototype.getLinearVelocity=function(){return this.m_linearVelocity},g.prototype.getLinearVelocityFromWorldPoint=function(c){var h=v.sub(c,this.m_sweep.c);return v.add(this.m_linearVelocity,v.crossNumVec2(this.m_angularVelocity,h))},g.prototype.getLinearVelocityFromLocalPoint=function(c){return this.getLinearVelocityFromWorldPoint(this.getWorldPoint(c))},g.prototype.setLinearVelocity=function(c){this.m_type!=Mn&&(v.dot(c,c)>0&&this.setAwake(!0),this.m_linearVelocity.setVec2(c))},g.prototype.getAngularVelocity=function(){return this.m_angularVelocity},g.prototype.setAngularVelocity=function(c){this.m_type!=Mn&&(c*c>0&&this.setAwake(!0),this.m_angularVelocity=c)},g.prototype.getLinearDamping=function(){return this.m_linearDamping},g.prototype.setLinearDamping=function(c){this.m_linearDamping=c},g.prototype.getAngularDamping=function(){return this.m_angularDamping},g.prototype.setAngularDamping=function(c){this.m_angularDamping=c},g.prototype.getGravityScale=function(){return this.m_gravityScale},g.prototype.setGravityScale=function(c){this.m_gravityScale=c},g.prototype.getMass=function(){return this.m_mass},g.prototype.getInertia=function(){return this.m_I+this.m_mass*v.dot(this.m_sweep.localCenter,this.m_sweep.localCenter)},g.prototype.getMassData=function(c){c.mass=this.m_mass,c.I=this.getInertia(),c.center.setVec2(this.m_sweep.localCenter)},g.prototype.resetMassData=function(){if(this.m_mass=0,this.m_invMass=0,this.m_I=0,this.m_invI=0,this.m_sweep.localCenter.setZero(),this.isStatic()||this.isKinematic())return this.m_sweep.c0.setVec2(this.m_xf.p),this.m_sweep.c.setVec2(this.m_xf.p),void(this.m_sweep.a0=this.m_sweep.a);for(var c=v.zero(),h=this.m_fixtureList;h;h=h.m_next)if(0!=h.m_density){var m=new Lo;h.getMassData(m),this.m_mass+=m.mass,c.addMul(m.mass,m.center),this.m_I+=m.I}this.m_mass>0?(this.m_invMass=1/this.m_mass,c.mul(this.m_invMass)):(this.m_mass=1,this.m_invMass=1),this.m_I>0&&0==this.m_fixedRotationFlag?(this.m_I-=this.m_mass*v.dot(c,c),this.m_invI=1/this.m_I):(this.m_I=0,this.m_invI=0);var x=v.clone(this.m_sweep.c);this.m_sweep.setLocalCenter(c,this.m_xf),this.m_linearVelocity.add(v.crossNumVec2(this.m_angularVelocity,v.sub(this.m_sweep.c,x)))},g.prototype.setMassData=function(c){if(1!=this.isWorldLocked()&&this.m_type==zi){this.m_invMass=0,this.m_I=0,this.m_invI=0,this.m_mass=c.mass,this.m_mass<=0&&(this.m_mass=1),this.m_invMass=1/this.m_mass,c.I>0&&0==this.m_fixedRotationFlag&&(this.m_I=c.I-this.m_mass*v.dot(c.center,c.center),this.m_invI=1/this.m_I);var h=v.clone(this.m_sweep.c);this.m_sweep.setLocalCenter(c.center,this.m_xf),this.m_linearVelocity.add(v.crossNumVec2(this.m_angularVelocity,v.sub(this.m_sweep.c,h)))}},g.prototype.applyForce=function(c,h,m){void 0===m&&(m=!0),this.m_type==zi&&(m&&0==this.m_awakeFlag&&this.setAwake(!0),this.m_awakeFlag&&(this.m_force.add(c),this.m_torque+=v.crossVec2Vec2(v.sub(h,this.m_sweep.c),c)))},g.prototype.applyForceToCenter=function(c,h){void 0===h&&(h=!0),this.m_type==zi&&(h&&0==this.m_awakeFlag&&this.setAwake(!0),this.m_awakeFlag&&this.m_force.add(c))},g.prototype.applyTorque=function(c,h){void 0===h&&(h=!0),this.m_type==zi&&(h&&0==this.m_awakeFlag&&this.setAwake(!0),this.m_awakeFlag&&(this.m_torque+=c))},g.prototype.applyLinearImpulse=function(c,h,m){void 0===m&&(m=!0),this.m_type==zi&&(m&&0==this.m_awakeFlag&&this.setAwake(!0),this.m_awakeFlag&&(this.m_linearVelocity.addMul(this.m_invMass,c),this.m_angularVelocity+=this.m_invI*v.crossVec2Vec2(v.sub(h,this.m_sweep.c),c)))},g.prototype.applyAngularImpulse=function(c,h){void 0===h&&(h=!0),this.m_type==zi&&(h&&0==this.m_awakeFlag&&this.setAwake(!0),this.m_awakeFlag&&(this.m_angularVelocity+=this.m_invI*c))},g.prototype.shouldCollide=function(c){if(this.m_type!=zi&&c.m_type!=zi)return!1;for(var h=this.m_jointList;h;h=h.next)if(h.other==c&&0==h.joint.m_collideConnected)return!1;return!0},g.prototype._addFixture=function(c){return 1==this.isWorldLocked()?null:(this.m_activeFlag&&c.createProxies(this.m_world.m_broadPhase,this.m_xf),c.m_next=this.m_fixtureList,this.m_fixtureList=c,c.m_density>0&&this.resetMassData(),this.m_world.m_newFixture=!0,c)},g.prototype.createFixture=function(c,h){if(1==this.isWorldLocked())return null;var m=new xr(this,c,h);return this._addFixture(m),m},g.prototype.destroyFixture=function(c){if(1!=this.isWorldLocked()){if(this.m_fixtureList===c)this.m_fixtureList=c.m_next;else for(var h=this.m_fixtureList;null!=h;){if(h.m_next===c){h.m_next=c.m_next;break}h=h.m_next}for(var m=this.m_contactList;m;){var x=m.contact;m=m.next;var S=x.getFixtureA(),M=x.getFixtureB();(c==S||c==M)&&this.m_world.destroyContact(x)}this.m_activeFlag&&c.destroyProxies(this.m_world.m_broadPhase),c.m_body=null,c.m_next=null,this.m_world.publish("remove-fixture",c),this.resetMassData()}},g.prototype.getWorldPoint=function(c){return ne.mulVec2(this.m_xf,c)},g.prototype.getWorldVector=function(c){return X.mulVec2(this.m_xf.q,c)},g.prototype.getLocalPoint=function(c){return ne.mulTVec2(this.m_xf,c)},g.prototype.getLocalVector=function(c){return X.mulTVec2(this.m_xf.q,c)},g.STATIC="static",g.KINEMATIC="kinematic",g.DYNAMIC="dynamic",g}(),bi=function(){function g(c,h,m,x){"object"==typeof c&&null!==c?(this.ex=v.clone(c),this.ey=v.clone(h)):"number"==typeof c?(this.ex=v.neo(c,m),this.ey=v.neo(h,x)):(this.ex=v.zero(),this.ey=v.zero())}return g.prototype.toString=function(){return JSON.stringify(this)},g.isValid=function(c){return!(null===c||typeof c>"u")&&v.isValid(c.ex)&&v.isValid(c.ey)},g.assert=function(c){},g.prototype.set=function(c,h,m,x){"number"==typeof c&&"number"==typeof h&&"number"==typeof m&&"number"==typeof x?(this.ex.setNum(c,m),this.ey.setNum(h,x)):"object"==typeof c&&"object"==typeof h?(this.ex.setVec2(c),this.ey.setVec2(h)):"object"==typeof c&&(this.ex.setVec2(c.ex),this.ey.setVec2(c.ey))},g.prototype.setIdentity=function(){this.ex.x=1,this.ey.x=0,this.ex.y=0,this.ey.y=1},g.prototype.setZero=function(){this.ex.x=0,this.ey.x=0,this.ex.y=0,this.ey.y=0},g.prototype.getInverse=function(){var c=this.ex.x,h=this.ey.x,m=this.ex.y,x=this.ey.y,S=c*x-h*m;0!==S&&(S=1/S);var M=new g;return M.ex.x=S*x,M.ey.x=-S*h,M.ex.y=-S*m,M.ey.y=S*c,M},g.prototype.solve=function(c){var h=this.ex.x,m=this.ey.x,x=this.ex.y,S=this.ey.y,M=h*S-m*x;0!==M&&(M=1/M);var D=v.zero();return D.x=M*(S*c.x-m*c.y),D.y=M*(h*c.y-x*c.x),D},g.mul=function(c,h){return h&&"x"in h&&"y"in h?v.neo(c.ex.x*h.x+c.ey.x*h.y,c.ex.y*h.x+c.ey.y*h.y):h&&"ex"in h&&"ey"in h?new g(c.ex.x*h.ex.x+c.ey.x*h.ex.y,c.ex.x*h.ey.x+c.ey.x*h.ey.y,c.ex.y*h.ex.x+c.ey.y*h.ex.y,c.ex.y*h.ey.x+c.ey.y*h.ey.y):void 0},g.mulVec2=function(c,h){return v.neo(c.ex.x*h.x+c.ey.x*h.y,c.ex.y*h.x+c.ey.y*h.y)},g.mulMat22=function(c,h){return new g(c.ex.x*h.ex.x+c.ey.x*h.ex.y,c.ex.x*h.ey.x+c.ey.x*h.ey.y,c.ex.y*h.ex.x+c.ey.y*h.ex.y,c.ex.y*h.ey.x+c.ey.y*h.ey.y)},g.mulT=function(c,h){return h&&"x"in h&&"y"in h?v.neo(v.dot(h,c.ex),v.dot(h,c.ey)):h&&"ex"in h&&"ey"in h?new g(v.neo(v.dot(c.ex,h.ex),v.dot(c.ey,h.ex)),v.neo(v.dot(c.ex,h.ey),v.dot(c.ey,h.ey))):void 0},g.mulTVec2=function(c,h){return v.neo(v.dot(h,c.ex),v.dot(h,c.ey))},g.mulTMat22=function(c,h){return new g(v.neo(v.dot(c.ex,h.ex),v.dot(c.ey,h.ex)),v.neo(v.dot(c.ex,h.ey),v.dot(c.ey,h.ey)))},g.abs=function(c){return new g(v.abs(c.ex),v.abs(c.ey))},g.add=function(c,h){return new g(v.add(c.ex,h.ex),v.add(c.ey,h.ey))},g}(),en=(()=>((en=en||{})[en.e_circles=0]="e_circles",en[en.e_faceA=1]="e_faceA",en[en.e_faceB=2]="e_faceB",en))(),on=(()=>((on=on||{})[on.e_vertex=0]="e_vertex",on[on.e_face=1]="e_face",on))(),Ii=(()=>((Ii=Ii||{})[Ii.nullState=0]="nullState",Ii[Ii.addState=1]="addState",Ii[Ii.persistState=2]="persistState",Ii[Ii.removeState=3]="removeState",Ii))(),Ji=function(){function g(){this.v=v.zero(),this.id=new hu}return g.prototype.set=function(c){this.v.setVec2(c.v),this.id.set(c.id)},g}(),gl=function(){function g(){this.localNormal=v.zero(),this.localPoint=v.zero(),this.points=[new da,new da],this.pointCount=0}return g.prototype.getWorldManifold=function(c,h,m,x,S){if(0!=this.pointCount){var M=(c=c||new Tm).normal,D=c.points,R=c.separations;switch(this.type){case en.e_circles:M=v.neo(1,0);var U=ne.mulVec2(h,this.localPoint),O=ne.mulVec2(x,this.points[0].localPoint),W=v.sub(O,U);v.lengthSquared(W)>oe.EPSILON*oe.EPSILON&&(M.setVec2(W),M.normalize());var V=U.clone().addMul(m,M),B=O.clone().addMul(-S,M);D[0]=v.mid(V,B),R[0]=v.dot(v.sub(B,V),M),D.length=1,R.length=1;break;case en.e_faceA:M=X.mulVec2(h.q,this.localNormal);for(var F=ne.mulVec2(h,this.localPoint),j=0;j<this.pointCount;++j){var ee=ne.mulVec2(x,this.points[j].localPoint);V=v.clone(ee).addMul(m-v.dot(v.sub(ee,F),M),M),B=v.clone(ee).subMul(S,M),D[j]=v.mid(V,B),R[j]=v.dot(v.sub(B,V),M)}D.length=this.pointCount,R.length=this.pointCount;break;case en.e_faceB:for(M=X.mulVec2(x.q,this.localNormal),F=ne.mulVec2(x,this.localPoint),j=0;j<this.pointCount;++j)ee=ne.mulVec2(h,this.points[j].localPoint),B=v.combine(1,ee,S-v.dot(v.sub(ee,F),M),M),V=v.combine(1,ee,-m,M),D[j]=v.mid(V,B),R[j]=v.dot(v.sub(V,B),M);D.length=this.pointCount,R.length=this.pointCount,M.mul(-1)}return c.normal=M,c.points=D,c.separations=R,c}},g.clipSegmentToLine=br,g.ClipVertex=Ji,g.getPointStates=Js,g.PointState=Ii,g}(),da=function g(){this.localPoint=v.zero(),this.normalImpulse=0,this.tangentImpulse=0,this.id=new hu},hu=function(){function g(){this.cf=new Em}return Object.defineProperty(g.prototype,"key",{get:function(){return this.cf.indexA+4*this.cf.indexB+16*this.cf.typeA+64*this.cf.typeB},enumerable:!1,configurable:!0}),g.prototype.set=function(c){this.cf.set(c.cf)},g}(),Em=function(){function g(){}return g.prototype.set=function(c){this.indexA=c.indexA,this.indexB=c.indexB,this.typeA=c.typeA,this.typeB=c.typeB},g}(),Tm=function g(){this.points=[],this.separations=[]};function Js(g,c,h,m){for(var x=0;x<h.pointCount;++x){var S=h.points[x].id;g[x]=Ii.removeState;for(var M=0;M<m.pointCount;++M)if(m.points[M].id.key==S.key){g[x]=Ii.persistState;break}}for(x=0;x<m.pointCount;++x)for(S=m.points[x].id,c[x]=Ii.addState,M=0;M<h.pointCount;++M)if(h.points[M].id.key==S.key){c[x]=Ii.persistState;break}}function br(g,c,h,m,x){var S=0,M=v.dot(h,c[0].v)-m,D=v.dot(h,c[1].v)-m;if(M<=0&&g[S++].set(c[0]),D<=0&&g[S++].set(c[1]),M*D<0){var R=M/(M-D);g[S].v.setCombine(1-R,c[0].v,R,c[1].v),g[S].id.cf.indexA=x,g[S].id.cf.indexB=c[0].id.cf.indexB,g[S].id.cf.typeA=on.e_vertex,g[S].id.cf.typeB=on.e_face,++S}return S}var Bn={gjkCalls:0,gjkIters:0,gjkMaxIters:0,toiTime:0,toiMaxTime:0,toiCalls:0,toiIters:0,toiMaxIters:0,toiRootIters:0,toiMaxRootIters:0,toString:function(g){g="string"==typeof g?g:"\n";var c="";for(var h in this)"function"!=typeof this[h]&&"object"!=typeof this[h]&&(c+=h+": "+this[h]+g);return c}},du=function g(){this.proxyA=new Ks,this.proxyB=new Ks,this.transformA=null,this.transformB=null,this.useRadii=!1},fa=function g(){this.pointA=v.zero(),this.pointB=v.zero()},fu=function g(){this.metric=0,this.indexA=[],this.indexB=[],this.count=0};function Ar(g,c,h){++Bn.gjkCalls;var m=h.proxyA,x=h.proxyB,S=h.transformA,M=h.transformB,D=new Cm;D.readCache(c,m,S,x,M);for(var R=D.m_v,U=He.maxDistnceIterations,O=[],W=[],V=0,B=0;B<U;){V=D.m_count;for(var F=0;F<V;++F)O[F]=R[F].indexA,W[F]=R[F].indexB;if(D.solve(),3===D.m_count)break;(j=D.getClosestPoint()).lengthSquared();var ee=D.getSearchDirection();if(ee.lengthSquared()<oe.EPSILON*oe.EPSILON)break;var Z=R[D.m_count];Z.indexA=m.getSupport(X.mulTVec2(S.q,v.neg(ee))),Z.wA=ne.mulVec2(S,m.getVertex(Z.indexA)),Z.indexB=x.getSupport(X.mulTVec2(M.q,ee)),Z.wB=ne.mulVec2(M,x.getVertex(Z.indexB)),Z.w=v.sub(Z.wB,Z.wA),++B,++Bn.gjkIters;var re=!1;for(F=0;F<V;++F)if(Z.indexA===O[F]&&Z.indexB===W[F]){re=!0;break}if(re)break;++D.m_count}if(Bn.gjkMaxIters=oe.max(Bn.gjkMaxIters,B),D.getWitnessPoints(g.pointA,g.pointB),g.distance=v.distance(g.pointA,g.pointB),g.iterations=B,D.writeCache(c),h.useRadii){var se=m.m_radius,xe=x.m_radius;if(g.distance>se+xe&&g.distance>oe.EPSILON){g.distance-=se+xe;var de=v.sub(g.pointB,g.pointA);de.normalize(),g.pointA.addMul(se,de),g.pointB.subMul(xe,de)}else{var j=v.mid(g.pointA,g.pointB);g.pointA.setVec2(j),g.pointB.setVec2(j),g.distance=0}}}var Ks=function(){function g(){this.m_buffer=[],this.m_vertices=[],this.m_count=0,this.m_radius=0}return g.prototype.getVertexCount=function(){return this.m_count},g.prototype.getVertex=function(c){return this.m_vertices[c]},g.prototype.getSupport=function(c){for(var h=0,m=v.dot(this.m_vertices[0],c),x=0;x<this.m_count;++x){var S=v.dot(this.m_vertices[x],c);S>m&&(h=x,m=S)}return h},g.prototype.getSupportVertex=function(c){return this.m_vertices[this.getSupport(c)]},g.prototype.set=function(c,h){c.computeDistanceProxy(this,h)},g}(),pu=function(){function g(){this.wA=v.zero(),this.wB=v.zero(),this.w=v.zero()}return g.prototype.set=function(c){this.indexA=c.indexA,this.indexB=c.indexB,this.wA=v.clone(c.wA),this.wB=v.clone(c.wB),this.w=v.clone(c.w),this.a=c.a},g}(),Cm=function(){function g(){this.m_v1=new pu,this.m_v2=new pu,this.m_v3=new pu,this.m_v=[this.m_v1,this.m_v2,this.m_v3]}return g.prototype.toString=function(){return 3===this.m_count?["+"+this.m_count,this.m_v1.a,this.m_v1.wA.x,this.m_v1.wA.y,this.m_v1.wB.x,this.m_v1.wB.y,this.m_v2.a,this.m_v2.wA.x,this.m_v2.wA.y,this.m_v2.wB.x,this.m_v2.wB.y,this.m_v3.a,this.m_v3.wA.x,this.m_v3.wA.y,this.m_v3.wB.x,this.m_v3.wB.y].toString():2===this.m_count?["+"+this.m_count,this.m_v1.a,this.m_v1.wA.x,this.m_v1.wA.y,this.m_v1.wB.x,this.m_v1.wB.y,this.m_v2.a,this.m_v2.wA.x,this.m_v2.wA.y,this.m_v2.wB.x,this.m_v2.wB.y].toString():1===this.m_count?["+"+this.m_count,this.m_v1.a,this.m_v1.wA.x,this.m_v1.wA.y,this.m_v1.wB.x,this.m_v1.wB.y].toString():"+"+this.m_count},g.prototype.readCache=function(c,h,m,x,S){this.m_count=c.count;for(var M=0;M<this.m_count;++M){(D=this.m_v[M]).indexA=c.indexA[M],D.indexB=c.indexB[M];var R=h.getVertex(D.indexA),U=x.getVertex(D.indexB);D.wA=ne.mulVec2(m,R),D.wB=ne.mulVec2(S,U),D.w=v.sub(D.wB,D.wA),D.a=0}if(this.m_count>1){var O=c.metric,W=this.getMetric();(W<.5*O||2*O<W||W<oe.EPSILON)&&(this.m_count=0)}var D;0===this.m_count&&((D=this.m_v[0]).indexA=0,D.indexB=0,R=h.getVertex(0),U=x.getVertex(0),D.wA=ne.mulVec2(m,R),D.wB=ne.mulVec2(S,U),D.w=v.sub(D.wB,D.wA),D.a=1,this.m_count=1)},g.prototype.writeCache=function(c){c.metric=this.getMetric(),c.count=this.m_count;for(var h=0;h<this.m_count;++h)c.indexA[h]=this.m_v[h].indexA,c.indexB[h]=this.m_v[h].indexB},g.prototype.getSearchDirection=function(){switch(this.m_count){case 1:return v.neg(this.m_v1.w);case 2:var c=v.sub(this.m_v2.w,this.m_v1.w);return v.crossVec2Vec2(c,v.neg(this.m_v1.w))>0?v.crossNumVec2(1,c):v.crossVec2Num(c,1);default:return v.zero()}},g.prototype.getClosestPoint=function(){switch(this.m_count){case 0:case 3:default:return v.zero();case 1:return v.clone(this.m_v1.w);case 2:return v.combine(this.m_v1.a,this.m_v1.w,this.m_v2.a,this.m_v2.w)}},g.prototype.getWitnessPoints=function(c,h){switch(this.m_count){case 0:break;case 1:c.setVec2(this.m_v1.wA),h.setVec2(this.m_v1.wB);break;case 2:c.setCombine(this.m_v1.a,this.m_v1.wA,this.m_v2.a,this.m_v2.wA),h.setCombine(this.m_v1.a,this.m_v1.wB,this.m_v2.a,this.m_v2.wB);break;case 3:c.setCombine(this.m_v1.a,this.m_v1.wA,this.m_v2.a,this.m_v2.wA),c.addMul(this.m_v3.a,this.m_v3.wA),h.setVec2(c)}},g.prototype.getMetric=function(){switch(this.m_count){case 0:case 1:default:return 0;case 2:return v.distance(this.m_v1.w,this.m_v2.w);case 3:return v.crossVec2Vec2(v.sub(this.m_v2.w,this.m_v1.w),v.sub(this.m_v3.w,this.m_v1.w))}},g.prototype.solve=function(){switch(this.m_count){case 1:break;case 2:this.solve2();break;case 3:this.solve3()}},g.prototype.solve2=function(){var c=this.m_v1.w,h=this.m_v2.w,m=v.sub(h,c),x=-v.dot(c,m);if(x<=0)return this.m_v1.a=1,void(this.m_count=1);var S=v.dot(h,m);if(S<=0)return this.m_v2.a=1,this.m_count=1,void this.m_v1.set(this.m_v2);var M=1/(S+x);this.m_v1.a=S*M,this.m_v2.a=x*M,this.m_count=2},g.prototype.solve3=function(){var c=this.m_v1.w,h=this.m_v2.w,m=this.m_v3.w,x=v.sub(h,c),S=v.dot(c,x),D=v.dot(h,x),R=-S,U=v.sub(m,c),O=v.dot(c,U),V=v.dot(m,U),B=-O,F=v.sub(m,h),j=v.dot(h,F),Z=v.dot(m,F),re=-j,se=v.crossVec2Vec2(x,U),xe=se*v.crossVec2Vec2(h,m),de=se*v.crossVec2Vec2(m,c),Ie=se*v.crossVec2Vec2(c,h);if(R<=0&&B<=0)return this.m_v1.a=1,void(this.m_count=1);if(D>0&&R>0&&Ie<=0){var Oe=1/(D+R);return this.m_v1.a=D*Oe,this.m_v2.a=R*Oe,void(this.m_count=2)}if(V>0&&B>0&&de<=0){var ze=1/(V+B);return this.m_v1.a=V*ze,this.m_v3.a=B*ze,this.m_count=2,void this.m_v2.set(this.m_v3)}if(D<=0&&re<=0)return this.m_v2.a=1,this.m_count=1,void this.m_v1.set(this.m_v2);if(V<=0&&Z<=0)return this.m_v3.a=1,this.m_count=1,void this.m_v1.set(this.m_v3);if(Z>0&&re>0&&xe<=0){var nt=1/(Z+re);return this.m_v2.a=Z*nt,this.m_v3.a=re*nt,this.m_count=2,void this.m_v1.set(this.m_v3)}var pt=1/(xe+de+Ie);this.m_v1.a=xe*pt,this.m_v2.a=de*pt,this.m_v3.a=Ie*pt,this.m_count=3},g}();function Dm(g,c,h,m,x,S){var M=new du;M.proxyA.set(g,c),M.proxyB.set(h,m),M.transformA=x,M.transformB=S,M.useRadii=!0;var D=new fu,R=new fa;return Ar(R,D,M),R.distance<10*oe.EPSILON}var Im=function g(c){this.contact=c};function Rm(g,c){return oe.sqrt(g*c)}function Pm(g,c){return g>c?g:c}var Qs=[],md=function g(){this.rA=v.zero(),this.rB=v.zero(),this.normalImpulse=0,this.tangentImpulse=0,this.normalMass=0,this.tangentMass=0,this.velocityBias=0},Fr=function(){function g(c,h,m,x,S){this.m_manifold=new gl,this.m_prev=null,this.m_next=null,this.m_toi=1,this.m_toiCount=0,this.m_toiFlag=!1,this.m_tangentSpeed=0,this.m_enabledFlag=!0,this.m_islandFlag=!1,this.m_touchingFlag=!1,this.m_filterFlag=!1,this.m_bulletHitFlag=!1,this.m_impulse=new Lm(this),this.v_points=[],this.v_normal=v.zero(),this.v_normalMass=new bi,this.v_K=new bi,this.p_localPoints=[],this.p_localNormal=v.zero(),this.p_localPoint=v.zero(),this.p_localCenterA=v.zero(),this.p_localCenterB=v.zero(),this.m_nodeA=new Im(this),this.m_nodeB=new Im(this),this.m_fixtureA=c,this.m_fixtureB=m,this.m_indexA=h,this.m_indexB=x,this.m_evaluateFcn=S,this.m_friction=Rm(this.m_fixtureA.m_friction,this.m_fixtureB.m_friction),this.m_restitution=Pm(this.m_fixtureA.m_restitution,this.m_fixtureB.m_restitution)}return g.prototype.initConstraint=function(c){var h=this.m_fixtureA,m=this.m_fixtureB,x=h.getShape(),S=m.getShape(),M=h.getBody(),D=m.getBody(),R=this.getManifold(),U=R.pointCount;this.v_invMassA=M.m_invMass,this.v_invMassB=D.m_invMass,this.v_invIA=M.m_invI,this.v_invIB=D.m_invI,this.v_friction=this.m_friction,this.v_restitution=this.m_restitution,this.v_tangentSpeed=this.m_tangentSpeed,this.v_pointCount=U,this.v_K.setZero(),this.v_normalMass.setZero(),this.p_invMassA=M.m_invMass,this.p_invMassB=D.m_invMass,this.p_invIA=M.m_invI,this.p_invIB=D.m_invI,this.p_localCenterA=v.clone(M.m_sweep.localCenter),this.p_localCenterB=v.clone(D.m_sweep.localCenter),this.p_radiusA=x.m_radius,this.p_radiusB=S.m_radius,this.p_type=R.type,this.p_localNormal=v.clone(R.localNormal),this.p_localPoint=v.clone(R.localPoint),this.p_pointCount=U;for(var O=0;O<U;++O){var W=R.points[O],V=this.v_points[O]=new md;c.warmStarting?(V.normalImpulse=c.dtRatio*W.normalImpulse,V.tangentImpulse=c.dtRatio*W.tangentImpulse):(V.normalImpulse=0,V.tangentImpulse=0),V.rA.setZero(),V.rB.setZero(),V.normalMass=0,V.tangentMass=0,V.velocityBias=0,this.p_localPoints[O]=v.clone(W.localPoint)}},g.prototype.getManifold=function(){return this.m_manifold},g.prototype.getWorldManifold=function(c){var h=this.m_fixtureA.getBody(),m=this.m_fixtureB.getBody(),x=this.m_fixtureA.getShape(),S=this.m_fixtureB.getShape();return this.m_manifold.getWorldManifold(c,h.getTransform(),x.m_radius,m.getTransform(),S.m_radius)},g.prototype.setEnabled=function(c){this.m_enabledFlag=!!c},g.prototype.isEnabled=function(){return this.m_enabledFlag},g.prototype.isTouching=function(){return this.m_touchingFlag},g.prototype.getNext=function(){return this.m_next},g.prototype.getFixtureA=function(){return this.m_fixtureA},g.prototype.getFixtureB=function(){return this.m_fixtureB},g.prototype.getChildIndexA=function(){return this.m_indexA},g.prototype.getChildIndexB=function(){return this.m_indexB},g.prototype.flagForFiltering=function(){this.m_filterFlag=!0},g.prototype.setFriction=function(c){this.m_friction=c},g.prototype.getFriction=function(){return this.m_friction},g.prototype.resetFriction=function(){this.m_friction=Rm(this.m_fixtureA.m_friction,this.m_fixtureB.m_friction)},g.prototype.setRestitution=function(c){this.m_restitution=c},g.prototype.getRestitution=function(){return this.m_restitution},g.prototype.resetRestitution=function(){this.m_restitution=Pm(this.m_fixtureA.m_restitution,this.m_fixtureB.m_restitution)},g.prototype.setTangentSpeed=function(c){this.m_tangentSpeed=c},g.prototype.getTangentSpeed=function(){return this.m_tangentSpeed},g.prototype.evaluate=function(c,h,m){this.m_evaluateFcn(c,h,this.m_fixtureA,this.m_indexA,m,this.m_fixtureB,this.m_indexB)},g.prototype.update=function(c){this.m_enabledFlag=!0;var W,h=!1,m=this.m_touchingFlag,x=this.m_fixtureA.isSensor(),S=this.m_fixtureB.isSensor(),M=x||S,D=this.m_fixtureA.getBody(),R=this.m_fixtureB.getBody(),U=D.getTransform(),O=R.getTransform();if(M){var V=this.m_fixtureA.getShape(),B=this.m_fixtureB.getShape();h=Dm(V,this.m_indexA,B,this.m_indexB,U,O),this.m_manifold.pointCount=0}else{W=this.m_manifold,this.m_manifold=new gl,this.evaluate(this.m_manifold,U,O),h=this.m_manifold.pointCount>0;for(var F=0;F<this.m_manifold.pointCount;++F){var j=this.m_manifold.points[F];j.normalImpulse=0,j.tangentImpulse=0;for(var ee=0;ee<W.pointCount;++ee){var Z=W.points[ee];if(Z.id.key==j.id.key){j.normalImpulse=Z.normalImpulse,j.tangentImpulse=Z.tangentImpulse;break}}}h!=m&&(D.setAwake(!0),R.setAwake(!0))}this.m_touchingFlag=h,!m&&h&&c&&c.beginContact(this),m&&!h&&c&&c.endContact(this),!M&&h&&c&&c.preSolve(this,W)},g.prototype.solvePositionConstraint=function(c){return this._solvePositionConstraint(c)},g.prototype.solvePositionConstraintTOI=function(c,h,m){return this._solvePositionConstraint(c,h,m)},g.prototype._solvePositionConstraint=function(c,h,m){var x=!!h&&!!m,M=this.m_fixtureB,D=this.m_fixtureA.getBody(),R=M.getBody(),U=D.c_position,O=R.c_position,W=v.clone(this.p_localCenterA),V=v.clone(this.p_localCenterB),B=0,F=0;(!x||D==h||D==m)&&(B=this.p_invMassA,F=this.p_invIA);var j=0,ee=0;(!x||R==h||R==m)&&(j=this.p_invMassB,ee=this.p_invIB);for(var Z=v.clone(U.c),re=U.a,se=v.clone(O.c),xe=O.a,de=0,Ie=0;Ie<this.p_pointCount;++Ie){var Oe=ne.identity(),ze=ne.identity();Oe.q.setAngle(re),ze.q.setAngle(xe),Oe.p=v.sub(Z,X.mulVec2(Oe.q,W)),ze.p=v.sub(se,X.mulVec2(ze.q,V));var nt=void 0,pt=void 0,$e=void 0;switch(this.p_type){case en.e_circles:var Ue=ne.mulVec2(Oe,this.p_localPoint),Rt=ne.mulVec2(ze,this.p_localPoints[0]);(nt=v.sub(Rt,Ue)).normalize(),pt=v.combine(.5,Ue,.5,Rt),$e=v.dot(v.sub(Rt,Ue),nt)-this.p_radiusA-this.p_radiusB;break;case en.e_faceA:nt=X.mulVec2(Oe.q,this.p_localNormal);var Tt=ne.mulVec2(Oe,this.p_localPoint),Gt=ne.mulVec2(ze,this.p_localPoints[Ie]);$e=v.dot(v.sub(Gt,Tt),nt)-this.p_radiusA-this.p_radiusB,pt=Gt;break;case en.e_faceB:nt=X.mulVec2(ze.q,this.p_localNormal),Tt=ne.mulVec2(ze,this.p_localPoint),Gt=ne.mulVec2(Oe,this.p_localPoints[Ie]),$e=v.dot(v.sub(Gt,Tt),nt)-this.p_radiusA-this.p_radiusB,pt=Gt,nt.mul(-1)}var En=v.sub(pt,Z),rt=v.sub(pt,se);de=oe.min(de,$e);var Ut=oe.clamp((x?He.toiBaugarte:He.baumgarte)*($e+He.linearSlop),-He.maxLinearCorrection,0),At=v.crossVec2Vec2(En,nt),zt=v.crossVec2Vec2(rt,nt),lr=B+j+F*At*At+ee*zt*zt,Pi=v.mulNumVec2(lr>0?-Ut/lr:0,nt);Z.subMul(B,Pi),re-=F*v.crossVec2Vec2(En,Pi),se.addMul(j,Pi),xe+=ee*v.crossVec2Vec2(rt,Pi)}return U.c.setVec2(Z),U.a=re,O.c.setVec2(se),O.a=xe,de},g.prototype.initVelocityConstraint=function(c){var m=this.m_fixtureB,x=this.m_fixtureA.getBody(),S=m.getBody(),M=x.c_velocity,D=S.c_velocity,R=x.c_position,U=S.c_position,O=this.p_radiusA,W=this.p_radiusB,V=this.getManifold(),B=this.v_invMassA,F=this.v_invMassB,j=this.v_invIA,ee=this.v_invIB,Z=v.clone(this.p_localCenterA),re=v.clone(this.p_localCenterB),se=v.clone(R.c),xe=R.a,de=v.clone(M.v),Ie=M.w,Oe=v.clone(U.c),ze=U.a,nt=v.clone(D.v),pt=D.w,$e=ne.identity(),Ue=ne.identity();$e.q.setAngle(xe),Ue.q.setAngle(ze),$e.p.setCombine(1,se,-1,X.mulVec2($e.q,Z)),Ue.p.setCombine(1,Oe,-1,X.mulVec2(Ue.q,re));var Rt=V.getWorldManifold(null,$e,O,Ue,W);this.v_normal.setVec2(Rt.normal);for(var Tt=0;Tt<this.v_pointCount;++Tt){var Gt=this.v_points[Tt];Gt.rA.setVec2(v.sub(Rt.points[Tt],se)),Gt.rB.setVec2(v.sub(Rt.points[Tt],Oe));var En=v.crossVec2Vec2(Gt.rA,this.v_normal),rt=v.crossVec2Vec2(Gt.rB,this.v_normal),_n=B+F+j*En*En+ee*rt*rt;Gt.normalMass=_n>0?1/_n:0;var bt=v.crossVec2Num(this.v_normal,1),dt=v.crossVec2Vec2(Gt.rA,bt),Ut=v.crossVec2Vec2(Gt.rB,bt),At=B+F+j*dt*dt+ee*Ut*Ut;Gt.tangentMass=At>0?1/At:0,Gt.velocityBias=0;var zt=v.dot(this.v_normal,nt)+v.dot(this.v_normal,v.crossNumVec2(pt,Gt.rB))-v.dot(this.v_normal,de)-v.dot(this.v_normal,v.crossNumVec2(Ie,Gt.rA));zt<-He.velocityThreshold&&(Gt.velocityBias=-this.v_restitution*zt)}if(2==this.v_pointCount&&c.blockSolve){var lr=this.v_points[0],kr=this.v_points[1],Pi=v.crossVec2Vec2(lr.rA,this.v_normal),cr=v.crossVec2Vec2(lr.rB,this.v_normal),Es=v.crossVec2Vec2(kr.rA,this.v_normal),Li=v.crossVec2Vec2(kr.rB,this.v_normal),ss=B+F+j*Pi*Pi+ee*cr*cr,Vo=B+F+j*Es*Es+ee*Li*Li,ko=B+F+j*Pi*Es+ee*cr*Li;ss*ss<1e3*(ss*Vo-ko*ko)?(this.v_K.ex.setNum(ss,ko),this.v_K.ey.setNum(ko,Vo),this.v_normalMass.set(this.v_K.getInverse())):this.v_pointCount=1}R.c.setVec2(se),R.a=xe,M.v.setVec2(de),M.w=Ie,U.c.setVec2(Oe),U.a=ze,D.v.setVec2(nt),D.w=pt},g.prototype.warmStartConstraint=function(c){for(var m=this.m_fixtureB,x=this.m_fixtureA.getBody(),S=m.getBody(),M=x.c_velocity,D=S.c_velocity,R=this.v_invMassA,U=this.v_invIA,O=this.v_invMassB,W=this.v_invIB,V=v.clone(M.v),B=M.w,F=v.clone(D.v),j=D.w,ee=this.v_normal,Z=v.crossVec2Num(ee,1),re=0;re<this.v_pointCount;++re){var se=this.v_points[re],xe=v.combine(se.normalImpulse,ee,se.tangentImpulse,Z);B-=U*v.crossVec2Vec2(se.rA,xe),V.subMul(R,xe),j+=W*v.crossVec2Vec2(se.rB,xe),F.addMul(O,xe)}M.v.setVec2(V),M.w=B,D.v.setVec2(F),D.w=j},g.prototype.storeConstraintImpulses=function(c){for(var h=this.m_manifold,m=0;m<this.v_pointCount;++m)h.points[m].normalImpulse=this.v_points[m].normalImpulse,h.points[m].tangentImpulse=this.v_points[m].tangentImpulse},g.prototype.solveVelocityConstraint=function(c){for(var x=this.m_fixtureA.m_body.c_velocity,S=this.m_fixtureB.m_body.c_velocity,M=this.v_invMassA,D=this.v_invIA,R=this.v_invMassB,U=this.v_invIB,O=v.clone(x.v),W=x.w,V=v.clone(S.v),B=S.w,F=this.v_normal,j=v.crossVec2Num(F,1),ee=this.v_friction,Z=0;Z<this.v_pointCount;++Z){var re=this.v_points[Z];(se=v.zero()).addCombine(1,V,1,v.crossNumVec2(B,re.rB)),se.subCombine(1,O,1,v.crossNumVec2(W,re.rA));var xe=v.dot(se,j)-this.v_tangentSpeed,Ie=ee*re.normalImpulse;de=(Oe=oe.clamp(re.tangentImpulse+(de=re.tangentMass*-xe),-Ie,Ie))-re.tangentImpulse,re.tangentImpulse=Oe;var ze=v.mulNumVec2(de,j);O.subMul(M,ze),W-=D*v.crossVec2Vec2(re.rA,ze),V.addMul(R,ze),B+=U*v.crossVec2Vec2(re.rB,ze)}if(1==this.v_pointCount||0==c.blockSolve)for(var nt=0;nt<this.v_pointCount;++nt){var se;re=this.v_points[nt],(se=v.zero()).addCombine(1,V,1,v.crossNumVec2(B,re.rB)),se.subCombine(1,O,1,v.crossNumVec2(W,re.rA));var de,Oe,pt=v.dot(se,F);de=(Oe=oe.max(re.normalImpulse+(de=-re.normalMass*(pt-re.velocityBias)),0))-re.normalImpulse,re.normalImpulse=Oe,ze=v.mulNumVec2(de,F),O.subMul(M,ze),W-=D*v.crossVec2Vec2(re.rA,ze),V.addMul(R,ze),B+=U*v.crossVec2Vec2(re.rB,ze)}else{var $e=this.v_points[0],Ue=this.v_points[1],Rt=v.neo($e.normalImpulse,Ue.normalImpulse),Tt=v.zero().add(V).add(v.crossNumVec2(B,$e.rB)).sub(O).sub(v.crossNumVec2(W,$e.rA)),Gt=v.zero().add(V).add(v.crossNumVec2(B,Ue.rB)).sub(O).sub(v.crossNumVec2(W,Ue.rA)),En=v.dot(Tt,F),rt=v.dot(Gt,F),_n=v.neo(En-$e.velocityBias,rt-Ue.velocityBias);for(_n.sub(bi.mulVec2(this.v_K,Rt));;){var bt=bi.mulVec2(this.v_normalMass,_n).neg();if(bt.x>=0&&bt.y>=0){var dt=v.sub(bt,Rt),Ut=v.mulNumVec2(dt.x,F),At=v.mulNumVec2(dt.y,F);O.subCombine(M,Ut,M,At),W-=D*(v.crossVec2Vec2($e.rA,Ut)+v.crossVec2Vec2(Ue.rA,At)),V.addCombine(R,Ut,R,At),B+=U*(v.crossVec2Vec2($e.rB,Ut)+v.crossVec2Vec2(Ue.rB,At)),$e.normalImpulse=bt.x,Ue.normalImpulse=bt.y;break}if(bt.x=-$e.normalMass*_n.x,bt.y=0,En=0,rt=this.v_K.ex.y*bt.x+_n.y,bt.x>=0&&rt>=0){dt=v.sub(bt,Rt),Ut=v.mulNumVec2(dt.x,F),At=v.mulNumVec2(dt.y,F),O.subCombine(M,Ut,M,At),W-=D*(v.crossVec2Vec2($e.rA,Ut)+v.crossVec2Vec2(Ue.rA,At)),V.addCombine(R,Ut,R,At),B+=U*(v.crossVec2Vec2($e.rB,Ut)+v.crossVec2Vec2(Ue.rB,At)),$e.normalImpulse=bt.x,Ue.normalImpulse=bt.y;break}if(bt.x=0,bt.y=-Ue.normalMass*_n.y,En=this.v_K.ey.x*bt.y+_n.x,rt=0,bt.y>=0&&En>=0){dt=v.sub(bt,Rt),Ut=v.mulNumVec2(dt.x,F),At=v.mulNumVec2(dt.y,F),O.subCombine(M,Ut,M,At),W-=D*(v.crossVec2Vec2($e.rA,Ut)+v.crossVec2Vec2(Ue.rA,At)),V.addCombine(R,Ut,R,At),B+=U*(v.crossVec2Vec2($e.rB,Ut)+v.crossVec2Vec2(Ue.rB,At)),$e.normalImpulse=bt.x,Ue.normalImpulse=bt.y;break}if(bt.x=0,bt.y=0,rt=_n.y,(En=_n.x)>=0&&rt>=0){dt=v.sub(bt,Rt),Ut=v.mulNumVec2(dt.x,F),At=v.mulNumVec2(dt.y,F),O.subCombine(M,Ut,M,At),W-=D*(v.crossVec2Vec2($e.rA,Ut)+v.crossVec2Vec2(Ue.rA,At)),V.addCombine(R,Ut,R,At),B+=U*(v.crossVec2Vec2($e.rB,Ut)+v.crossVec2Vec2(Ue.rB,At)),$e.normalImpulse=bt.x,Ue.normalImpulse=bt.y;break}break}}x.v.setVec2(O),x.w=W,S.v.setVec2(V),S.w=B},g.addType=function(c,h,m){Qs[c]=Qs[c]||{},Qs[c][h]=m},g.create=function(c,h,m,x){var D,R,S=c.getType(),M=m.getType();if(R=Qs[S]&&Qs[S][M])D=new g(c,h,m,x,R);else{if(!(R=Qs[M]&&Qs[M][S]))return null;D=new g(m,x,c,h,R)}c=D.getFixtureA(),m=D.getFixtureB(),h=D.getChildIndexA(),x=D.getChildIndexB();var U=c.getBody(),O=m.getBody();return D.m_nodeA.contact=D,D.m_nodeA.other=O,D.m_nodeA.prev=null,D.m_nodeA.next=U.m_contactList,null!=U.m_contactList&&(U.m_contactList.prev=D.m_nodeA),U.m_contactList=D.m_nodeA,D.m_nodeB.contact=D,D.m_nodeB.other=U,D.m_nodeB.prev=null,D.m_nodeB.next=O.m_contactList,null!=O.m_contactList&&(O.m_contactList.prev=D.m_nodeB),O.m_contactList=D.m_nodeB,0==c.isSensor()&&0==m.isSensor()&&(U.setAwake(!0),O.setAwake(!0)),D},g.destroy=function(c,h){var m=c.m_fixtureA,x=c.m_fixtureB,S=m.getBody(),M=x.getBody();c.isTouching()&&h.endContact(c),c.m_nodeA.prev&&(c.m_nodeA.prev.next=c.m_nodeA.next),c.m_nodeA.next&&(c.m_nodeA.next.prev=c.m_nodeA.prev),c.m_nodeA==S.m_contactList&&(S.m_contactList=c.m_nodeA.next),c.m_nodeB.prev&&(c.m_nodeB.prev.next=c.m_nodeB.next),c.m_nodeB.next&&(c.m_nodeB.next.prev=c.m_nodeB.prev),c.m_nodeB==M.m_contactList&&(M.m_contactList=c.m_nodeB.next),c.m_manifold.pointCount>0&&0==m.isSensor()&&0==x.isSensor()&&(S.setAwake(!0),M.setAwake(!0)),m.getType(),x.getType()},g}(),vl=function g(){this.other=null,this.joint=null,this.prev=null,this.next=null},Ri=function(){function g(c,h,m){this.m_type="unknown-joint",this.m_prev=null,this.m_next=null,this.m_edgeA=new vl,this.m_edgeB=new vl,this.m_islandFlag=!1,m="bodyB"in c?c.bodyB:m,this.m_bodyA=h="bodyA"in c?c.bodyA:h,this.m_bodyB=m,this.m_collideConnected=!!c.collideConnected,this.m_userData=c.userData}return g.prototype.isActive=function(){return this.m_bodyA.isActive()&&this.m_bodyB.isActive()},g.prototype.getType=function(){return this.m_type},g.prototype.getBodyA=function(){return this.m_bodyA},g.prototype.getBodyB=function(){return this.m_bodyB},g.prototype.getNext=function(){return this.m_next},g.prototype.getUserData=function(){return this.m_userData},g.prototype.setUserData=function(c){this.m_userData=c},g.prototype.getCollideConnected=function(){return this.m_collideConnected},g.prototype.shiftOrigin=function(c){},g}(),gd_now=function(){return Date.now()},gd_diff=function(g){return Date.now()-g},vd=function g(){this.proxyA=new Ks,this.proxyB=new Ks,this.sweepA=new mt,this.sweepB=new mt},qn=(()=>((qn=qn||{})[qn.e_unknown=0]="e_unknown",qn[qn.e_failed=1]="e_failed",qn[qn.e_overlapped=2]="e_overlapped",qn[qn.e_touching=3]="e_touching",qn[qn.e_separated=4]="e_separated",qn))(),Qr=function g(){};function No(g,c){var h=gd_now();++Bn.toiCalls,g.state=qn.e_unknown,g.t=c.tMax;var m=c.proxyA,x=c.proxyB,S=c.sweepA,M=c.sweepB;S.normalize(),M.normalize();var D=c.tMax,U=oe.max(He.linearSlop,m.m_radius+x.m_radius-3*He.linearSlop),O=.25*He.linearSlop,W=0,V=He.maxTOIIterations,B=0,F=new fu,j=new du;for(j.proxyA=c.proxyA,j.proxyB=c.proxyB,j.useRadii=!1;;){var ee=ne.identity(),Z=ne.identity();S.getTransform(ee,W),M.getTransform(Z,W),j.transformA=ee,j.transformB=Z;var re=new fa;if(Ar(re,F,j),re.distance<=0){g.state=qn.e_overlapped,g.t=0;break}if(re.distance<U+O){g.state=qn.e_touching,g.t=W;break}var se=new yd;se.initialize(F,m,S,x,M,W);for(var xe=!1,de=D,Ie=0;;){var Oe=se.findMinSeparation(de);if(Oe>U+O){g.state=qn.e_separated,g.t=D,xe=!0;break}if(Oe>U-O){W=de;break}var ze=se.evaluate(W);if(ze<U-O){g.state=qn.e_failed,g.t=W,xe=!0;break}if(ze<=U+O){g.state=qn.e_touching,g.t=W,xe=!0;break}for(var nt=0,pt=W,$e=de;;){var Ue;Ue=1&nt?pt+(U-ze)*($e-pt)/(Oe-ze):.5*(pt+$e),++nt,++Bn.toiRootIters;var Rt=se.evaluate(Ue);if(oe.abs(Rt-U)<O){de=Ue;break}if(Rt>U?(pt=Ue,ze=Rt):($e=Ue,Oe=Rt),50===nt)break}if(Bn.toiMaxRootIters=oe.max(Bn.toiMaxRootIters,nt),++Ie===He.maxPolygonVertices)break}if(++B,++Bn.toiIters,xe)break;if(B===V){g.state=qn.e_failed,g.t=W;break}}Bn.toiMaxIters=oe.max(Bn.toiMaxIters,B);var Tt=gd_diff(h);Bn.toiMaxTime=oe.max(Bn.toiMaxTime,Tt),Bn.toiTime+=Tt}Bn.toiTime=0,Bn.toiMaxTime=0,Bn.toiCalls=0,Bn.toiIters=0,Bn.toiMaxIters=0,Bn.toiRootIters=0,Bn.toiMaxRootIters=0;var ki=(()=>((ki=ki||{})[ki.e_points=1]="e_points",ki[ki.e_faceA=2]="e_faceA",ki[ki.e_faceB=3]="e_faceB",ki))(),yd=function(){function g(){this.m_proxyA=new Ks,this.m_proxyB=new Ks,this.m_localPoint=v.zero(),this.m_axis=v.zero()}return g.prototype.initialize=function(c,h,m,x,S,M){this.m_proxyA=h,this.m_proxyB=x;var D=c.count;this.m_sweepA=m,this.m_sweepB=S;var R=ne.identity(),U=ne.identity();if(this.m_sweepA.getTransform(R,M),this.m_sweepB.getTransform(U,M),1===D){this.m_type=ki.e_points;var O=this.m_proxyA.getVertex(c.indexA[0]),W=this.m_proxyB.getVertex(c.indexB[0]),V=ne.mulVec2(R,O),B=ne.mulVec2(U,W);return this.m_axis.setCombine(1,B,-1,V),this.m_axis.normalize()}if(c.indexA[0]===c.indexA[1]){this.m_type=ki.e_faceB;var j=x.getVertex(c.indexB[0]),ee=x.getVertex(c.indexB[1]);this.m_axis=v.crossVec2Num(v.sub(ee,j),1),this.m_axis.normalize();var Z=X.mulVec2(U.q,this.m_axis);return this.m_localPoint=v.mid(j,ee),B=ne.mulVec2(U,this.m_localPoint),O=h.getVertex(c.indexA[0]),V=ne.mulVec2(R,O),(F=v.dot(V,Z)-v.dot(B,Z))<0&&(this.m_axis=v.neg(this.m_axis),F=-F),F}this.m_type=ki.e_faceA;var F,re=this.m_proxyA.getVertex(c.indexA[0]),se=this.m_proxyA.getVertex(c.indexA[1]);return this.m_axis=v.crossVec2Num(v.sub(se,re),1),this.m_axis.normalize(),Z=X.mulVec2(R.q,this.m_axis),this.m_localPoint=v.mid(re,se),V=ne.mulVec2(R,this.m_localPoint),W=this.m_proxyB.getVertex(c.indexB[0]),B=ne.mulVec2(U,W),(F=v.dot(B,Z)-v.dot(V,Z))<0&&(this.m_axis=v.neg(this.m_axis),F=-F),F},g.prototype.compute=function(c,h){var m=ne.identity(),x=ne.identity();switch(this.m_sweepA.getTransform(m,h),this.m_sweepB.getTransform(x,h),this.m_type){case ki.e_points:if(c){var S=X.mulTVec2(m.q,this.m_axis),M=X.mulTVec2(x.q,v.neg(this.m_axis));this.indexA=this.m_proxyA.getSupport(S),this.indexB=this.m_proxyB.getSupport(M)}var D=this.m_proxyA.getVertex(this.indexA),R=this.m_proxyB.getVertex(this.indexB),U=ne.mulVec2(m,D),O=ne.mulVec2(x,R);return v.dot(O,this.m_axis)-v.dot(U,this.m_axis);case ki.e_faceA:var V=X.mulVec2(m.q,this.m_axis);return U=ne.mulVec2(m,this.m_localPoint),c&&(M=X.mulTVec2(x.q,v.neg(V)),this.indexA=-1,this.indexB=this.m_proxyB.getSupport(M)),R=this.m_proxyB.getVertex(this.indexB),O=ne.mulVec2(x,R),v.dot(O,V)-v.dot(U,V);case ki.e_faceB:return V=X.mulVec2(x.q,this.m_axis),O=ne.mulVec2(x,this.m_localPoint),c&&(S=X.mulTVec2(m.q,v.neg(V)),this.indexB=-1,this.indexA=this.m_proxyA.getSupport(S)),D=this.m_proxyA.getVertex(this.indexA),U=ne.mulVec2(m,D),v.dot(U,V)-v.dot(O,V);default:return c&&(this.indexA=-1,this.indexB=-1),0}},g.prototype.findMinSeparation=function(c){return this.compute(!0,c)},g.prototype.evaluate=function(c){return this.compute(!1,c)},g}(),_u=function(){function g(){this.dt=0,this.inv_dt=0,this.velocityIterations=0,this.positionIterations=0,this.warmStarting=!1,this.blockSolve=!0,this.inv_dt0=0,this.dtRatio=1}return g.prototype.reset=function(c){this.dt>0&&(this.inv_dt0=this.inv_dt),this.dt=c,this.inv_dt=0==c?0:1/c,this.dtRatio=c*this.inv_dt0},g}(),Bo=new _u,Lm=function(){function g(c){this.contact=c,this.normals=[],this.tangents=[]}return Object.defineProperty(g.prototype,"normalImpulses",{get:function(){var c=this.contact,h=this.normals;h.length=0;for(var m=0;m<c.v_points.length;++m)h.push(c.v_points[m].normalImpulse);return h},enumerable:!1,configurable:!0}),Object.defineProperty(g.prototype,"tangentImpulses",{get:function(){var c=this.contact,h=this.tangents;h.length=0;for(var m=0;m<c.v_points.length;++m)h.push(c.v_points[m].tangentImpulse);return h},enumerable:!1,configurable:!0}),g}(),xd=function(){function g(c){this.m_world=c,this.m_stack=[],this.m_bodies=[],this.m_contacts=[],this.m_joints=[]}return g.prototype.clear=function(){this.m_stack.length=0,this.m_bodies.length=0,this.m_contacts.length=0,this.m_joints.length=0},g.prototype.addBody=function(c){this.m_bodies.push(c)},g.prototype.addContact=function(c){this.m_contacts.push(c)},g.prototype.addJoint=function(c){this.m_joints.push(c)},g.prototype.solveWorld=function(c){for(var h=this.m_world,m=h.m_bodyList;m;m=m.m_next)m.m_islandFlag=!1;for(var x=h.m_contactList;x;x=x.m_next)x.m_islandFlag=!1;for(var S=h.m_jointList;S;S=S.m_next)S.m_islandFlag=!1;for(var M=this.m_stack,D=h.m_bodyList;D;D=D.m_next)if(!D.m_islandFlag&&0!=D.isAwake()&&0!=D.isActive()&&!D.isStatic()){for(this.clear(),M.push(D),D.m_islandFlag=!0;M.length>0;)if(m=M.pop(),this.addBody(m),m.setAwake(!0),!m.isStatic()){for(var R=m.m_contactList;R;R=R.next){var U=R.contact;U.m_islandFlag||0==U.isEnabled()||0==U.isTouching()||U.m_fixtureA.m_isSensor||U.m_fixtureB.m_isSensor||(this.addContact(U),U.m_islandFlag=!0,(V=R.other).m_islandFlag||(M.push(V),V.m_islandFlag=!0))}for(var B=m.m_jointList;B;B=B.next)if(1!=B.joint.m_islandFlag){var V;0!=(V=B.other).isActive()&&(this.addJoint(B.joint),B.joint.m_islandFlag=!0,!V.m_islandFlag&&(M.push(V),V.m_islandFlag=!0))}}this.solveIsland(c);for(var F=0;F<this.m_bodies.length;++F)(m=this.m_bodies[F]).isStatic()&&(m.m_islandFlag=!1)}},g.prototype.solveIsland=function(c){for(var h=this.m_world,m=h.m_gravity,x=h.m_allowSleep,S=c.dt,M=0;M<this.m_bodies.length;++M){var R=v.clone((D=this.m_bodies[M]).m_sweep.c),U=D.m_sweep.a,O=v.clone(D.m_linearVelocity),W=D.m_angularVelocity;D.m_sweep.c0.setVec2(D.m_sweep.c),D.m_sweep.a0=D.m_sweep.a,D.isDynamic()&&(O.addMul(S*D.m_gravityScale,m),O.addMul(S*D.m_invMass,D.m_force),W+=S*D.m_invI*D.m_torque,O.mul(1/(1+S*D.m_linearDamping)),W*=1/(1+S*D.m_angularDamping)),D.c_position.c=R,D.c_position.a=U,D.c_velocity.v=O,D.c_velocity.w=W}for(M=0;M<this.m_contacts.length;++M)this.m_contacts[M].initConstraint(c);for(M=0;M<this.m_contacts.length;++M)this.m_contacts[M].initVelocityConstraint(c);if(c.warmStarting)for(M=0;M<this.m_contacts.length;++M)this.m_contacts[M].warmStartConstraint(c);for(M=0;M<this.m_joints.length;++M)this.m_joints[M].initVelocityConstraints(c);for(M=0;M<c.velocityIterations;++M){for(var F=0;F<this.m_joints.length;++F)this.m_joints[F].solveVelocityConstraints(c);for(F=0;F<this.m_contacts.length;++F)this.m_contacts[F].solveVelocityConstraint(c)}for(M=0;M<this.m_contacts.length;++M)this.m_contacts[M].storeConstraintImpulses(c);for(M=0;M<this.m_bodies.length;++M){R=v.clone((D=this.m_bodies[M]).c_position.c),U=D.c_position.a,O=v.clone(D.c_velocity.v),W=D.c_velocity.w;var j=v.mulNumVec2(S,O);if(v.lengthSquared(j)>He.maxTranslationSquared){var ee=He.maxTranslation/j.length();O.mul(ee)}var Z=S*W;Z*Z>He.maxRotationSquared&&(W*=ee=He.maxRotation/oe.abs(Z)),R.addMul(S,O),U+=S*W,D.c_position.c.setVec2(R),D.c_position.a=U,D.c_velocity.v.setVec2(O),D.c_velocity.w=W}var re=!1;for(M=0;M<c.positionIterations;++M){var se=0;for(F=0;F<this.m_contacts.length;++F){var xe=this.m_contacts[F].solvePositionConstraint(c);se=oe.min(se,xe)}var de=se>=-3*He.linearSlop,Ie=!0;for(F=0;F<this.m_joints.length;++F){var Oe=this.m_joints[F].solvePositionConstraints(c);Ie=Ie&&Oe}if(de&&Ie){re=!0;break}}for(M=0;M<this.m_bodies.length;++M)(D=this.m_bodies[M]).m_sweep.c.setVec2(D.c_position.c),D.m_sweep.a=D.c_position.a,D.m_linearVelocity.setVec2(D.c_velocity.v),D.m_angularVelocity=D.c_velocity.w,D.synchronizeTransform();if(this.postSolveIsland(),x){var ze=1/0,nt=He.linearSleepToleranceSqr,pt=He.angularSleepToleranceSqr;for(M=0;M<this.m_bodies.length;++M)(D=this.m_bodies[M]).isStatic()||(0==D.m_autoSleepFlag||D.m_angularVelocity*D.m_angularVelocity>pt||v.lengthSquared(D.m_linearVelocity)>nt?(D.m_sleepTime=0,ze=0):(D.m_sleepTime+=S,ze=oe.min(ze,D.m_sleepTime)));if(ze>=He.timeToSleep&&re)for(M=0;M<this.m_bodies.length;++M){var D;(D=this.m_bodies[M]).setAwake(!1)}}},g.prototype.printBodies=function(c){for(var h=0;h<this.m_bodies.length;++h){var m=this.m_bodies[h];Mt_debug(c,m.c_position.a,m.c_position.c.x,m.c_position.c.y,m.c_velocity.w,m.c_velocity.v.x,m.c_velocity.v.y)}},g.prototype.solveWorldTOI=function(c){var h=this.m_world;if(h.m_stepComplete){for(var bt=h.m_bodyList;bt;bt=bt.m_next)bt.m_islandFlag=!1,bt.m_sweep.alpha0=0;for(var dt=h.m_contactList;dt;dt=dt.m_next)dt.m_toiFlag=!1,dt.m_islandFlag=!1,dt.m_toiCount=0,dt.m_toi=1}for(;;){var m=null,x=1;for(dt=h.m_contactList;dt;dt=dt.m_next)if(0!=dt.isEnabled()&&!(dt.m_toiCount>He.maxSubSteps)){var S=1;if(dt.m_toiFlag)S=dt.m_toi;else{var M=dt.getFixtureA(),D=dt.getFixtureB();if(M.isSensor()||D.isSensor())continue;var R=M.getBody(),U=D.getBody(),O=R.isAwake()&&!R.isStatic(),W=U.isAwake()&&!U.isStatic();if(0==O&&0==W)continue;var V=R.isBullet()||!R.isDynamic(),B=U.isBullet()||!U.isDynamic();if(0==V&&0==B)continue;var F=R.m_sweep.alpha0;R.m_sweep.alpha0<U.m_sweep.alpha0?R.m_sweep.advance(F=U.m_sweep.alpha0):U.m_sweep.alpha0<R.m_sweep.alpha0&&U.m_sweep.advance(F=R.m_sweep.alpha0);var j=dt.getChildIndexA(),ee=dt.getChildIndexB(),Z=new vd;Z.proxyA.set(M.getShape(),j),Z.proxyB.set(D.getShape(),ee),Z.sweepA.set(R.m_sweep),Z.sweepB.set(U.m_sweep),Z.tMax=1;var re=new Qr;No(re,Z),S=re.state==qn.e_touching?oe.min(F+(1-F)*re.t,1):1,dt.m_toi=S,dt.m_toiFlag=!0}S<x&&(m=dt,x=S)}if(null==m||1-10*oe.EPSILON<x){h.m_stepComplete=!0;break}var xe=m.getFixtureA(),de=m.getFixtureB(),Ie=xe.getBody(),Oe=de.getBody(),ze=Ie.m_sweep.clone(),nt=Oe.m_sweep.clone();if(Ie.advance(x),Oe.advance(x),m.update(h),m.m_toiFlag=!1,++m.m_toiCount,0!=m.isEnabled()&&0!=m.isTouching()){Ie.setAwake(!0),Oe.setAwake(!0),this.clear(),this.addBody(Ie),this.addBody(Oe),this.addContact(m),Ie.m_islandFlag=!0,Oe.m_islandFlag=!0,m.m_islandFlag=!0;for(var pt=[Ie,Oe],$e=0;$e<pt.length;++$e)if((Ue=pt[$e]).isDynamic())for(var Rt=Ue.m_contactList;Rt;Rt=Rt.next){var Tt=Rt.contact;if(!Tt.m_islandFlag){var Gt=Rt.other;if((!Gt.isDynamic()||Ue.isBullet()||Gt.isBullet())&&!Tt.m_fixtureA.m_isSensor&&!Tt.m_fixtureB.m_isSensor){var _n=Gt.m_sweep.clone();if(0==Gt.m_islandFlag&&Gt.advance(x),Tt.update(h),0==Tt.isEnabled()||0==Tt.isTouching()){Gt.m_sweep.set(_n),Gt.synchronizeTransform();continue}Tt.m_islandFlag=!0,this.addContact(Tt),!Gt.m_islandFlag&&(Gt.m_islandFlag=!0,Gt.isStatic()||Gt.setAwake(!0),this.addBody(Gt))}}}for(Bo.reset((1-x)*c.dt),Bo.dtRatio=1,Bo.positionIterations=20,Bo.velocityIterations=c.velocityIterations,Bo.warmStarting=!1,this.solveIslandTOI(Bo,Ie,Oe),$e=0;$e<this.m_bodies.length;++$e){var Ue;if((Ue=this.m_bodies[$e]).m_islandFlag=!1,Ue.isDynamic())for(Ue.synchronizeFixtures(),Rt=Ue.m_contactList;Rt;Rt=Rt.next)Rt.contact.m_toiFlag=!1,Rt.contact.m_islandFlag=!1}if(h.findNewContacts(),h.m_subStepping){h.m_stepComplete=!1;break}}else m.setEnabled(!1),Ie.m_sweep.set(ze),Oe.m_sweep.set(nt),Ie.synchronizeTransform(),Oe.synchronizeTransform()}},g.prototype.solveIslandTOI=function(c,h,m){for(var O=0;O<this.m_bodies.length;++O)(x=this.m_bodies[O]).c_position.c.setVec2(x.m_sweep.c),x.c_position.a=x.m_sweep.a,x.c_velocity.v.setVec2(x.m_linearVelocity),x.c_velocity.w=x.m_angularVelocity;for(O=0;O<this.m_contacts.length;++O)this.m_contacts[O].initConstraint(c);for(O=0;O<c.positionIterations;++O){for(var M=0,D=0;D<this.m_contacts.length;++D){var R=this.m_contacts[D].solvePositionConstraintTOI(c,h,m);M=oe.min(M,R)}if(M>=-1.5*He.linearSlop)break}for(h.m_sweep.c0.setVec2(h.c_position.c),h.m_sweep.a0=h.c_position.a,m.m_sweep.c0.setVec2(m.c_position.c),m.m_sweep.a0=m.c_position.a,O=0;O<this.m_contacts.length;++O)this.m_contacts[O].initVelocityConstraint(c);for(O=0;O<c.velocityIterations;++O)for(D=0;D<this.m_contacts.length;++D)this.m_contacts[D].solveVelocityConstraint(c);var V=c.dt;for(O=0;O<this.m_bodies.length;++O){var x,W=v.clone((x=this.m_bodies[O]).c_position.c),B=x.c_position.a,F=v.clone(x.c_velocity.v),j=x.c_velocity.w,ee=v.mulNumVec2(V,F);if(v.dot(ee,ee)>He.maxTranslationSquared){var Z=He.maxTranslation/ee.length();F.mul(Z)}var re=V*j;re*re>He.maxRotationSquared&&(j*=Z=He.maxRotation/oe.abs(re)),W.addMul(V,F),B+=V*j,x.c_position.c=W,x.c_position.a=B,x.c_velocity.v=F,x.c_velocity.w=j,x.m_sweep.c=W,x.m_sweep.a=B,x.m_linearVelocity=F,x.m_angularVelocity=j,x.synchronizeTransform()}this.postSolveIsland()},g.prototype.postSolveIsland=function(){for(var c=0;c<this.m_contacts.length;++c){var h=this.m_contacts[c];this.m_world.postSolve(h,h.m_impulse)}},g}(),Nm={gravity:v.zero(),allowSleep:!0,warmStarting:!0,continuousPhysics:!0,subStepping:!1,blockSolve:!0,velocityIterations:8,positionIterations:3},gu=function(){function g(c){var h=this;if(this.s_step=new _u,this.createContact=function(m,x){var S=m.fixture,M=x.fixture,D=m.childIndex,R=x.childIndex,U=S.getBody(),O=M.getBody();if(U!=O){for(var W=O.getContactList();W;){if(W.other==U){var V=W.contact.getFixtureA(),B=W.contact.getFixtureB(),F=W.contact.getChildIndexA(),j=W.contact.getChildIndexB();if(V==S&&B==M&&F==D&&j==R||V==M&&B==S&&F==R&&j==D)return}W=W.next}if(0!=O.shouldCollide(U)&&0!=M.shouldCollide(S)){var ee=Fr.create(S,D,M,R);null!=ee&&(ee.m_prev=null,null!=h.m_contactList&&(ee.m_next=h.m_contactList,h.m_contactList.m_prev=ee),h.m_contactList=ee,++h.m_contactCount)}}},!(this instanceof g))return new g(c);c&&v.isValid(c)&&(c={gravity:c}),c=ge(c,Nm),this.m_solver=new xd(this),this.m_broadPhase=new Ae,this.m_contactList=null,this.m_contactCount=0,this.m_bodyList=null,this.m_bodyCount=0,this.m_jointList=null,this.m_jointCount=0,this.m_stepComplete=!0,this.m_allowSleep=c.allowSleep,this.m_gravity=v.clone(c.gravity),this.m_clearForces=!0,this.m_newFixture=!1,this.m_locked=!1,this.m_warmStarting=c.warmStarting,this.m_continuousPhysics=c.continuousPhysics,this.m_subStepping=c.subStepping,this.m_blockSolve=c.blockSolve,this.m_velocityIterations=c.velocityIterations,this.m_positionIterations=c.positionIterations,this.m_t=0}return g.prototype._serialize=function(){for(var c=[],h=[],m=this.getBodyList();m;m=m.getNext())c.push(m);for(var x=this.getJointList();x;x=x.getNext())"function"==typeof x._serialize&&h.push(x);return{gravity:this.m_gravity,bodies:c,joints:h}},g._deserialize=function(c,h,m){if(!c)return new g;var x=new g(c.gravity);if(c.bodies)for(var S=c.bodies.length-1;S>=0;S-=1)x._addBody(m(sn,c.bodies[S],x));if(c.joints)for(S=c.joints.length-1;S>=0;S--)x.createJoint(m(Ri,c.joints[S],x));return x},g.prototype.getBodyList=function(){return this.m_bodyList},g.prototype.getJointList=function(){return this.m_jointList},g.prototype.getContactList=function(){return this.m_contactList},g.prototype.getBodyCount=function(){return this.m_bodyCount},g.prototype.getJointCount=function(){return this.m_jointCount},g.prototype.getContactCount=function(){return this.m_contactCount},g.prototype.setGravity=function(c){this.m_gravity=c},g.prototype.getGravity=function(){return this.m_gravity},g.prototype.isLocked=function(){return this.m_locked},g.prototype.setAllowSleeping=function(c){if(c!=this.m_allowSleep&&(this.m_allowSleep=c,0==this.m_allowSleep))for(var h=this.m_bodyList;h;h=h.m_next)h.setAwake(!0)},g.prototype.getAllowSleeping=function(){return this.m_allowSleep},g.prototype.setWarmStarting=function(c){this.m_warmStarting=c},g.prototype.getWarmStarting=function(){return this.m_warmStarting},g.prototype.setContinuousPhysics=function(c){this.m_continuousPhysics=c},g.prototype.getContinuousPhysics=function(){return this.m_continuousPhysics},g.prototype.setSubStepping=function(c){this.m_subStepping=c},g.prototype.getSubStepping=function(){return this.m_subStepping},g.prototype.setAutoClearForces=function(c){this.m_clearForces=c},g.prototype.getAutoClearForces=function(){return this.m_clearForces},g.prototype.clearForces=function(){for(var c=this.m_bodyList;c;c=c.getNext())c.m_force.setZero(),c.m_torque=0},g.prototype.queryAABB=function(c,h){var m=this.m_broadPhase;this.m_broadPhase.query(c,function(x){var S=m.getUserData(x);return h(S.fixture)})},g.prototype.rayCast=function(c,h,m){var x=this.m_broadPhase;this.m_broadPhase.rayCast({maxFraction:1,p1:c,p2:h},function(S,M){var D=x.getUserData(M),R=D.fixture,O={};if(R.rayCast(O,S,D.childIndex)){var V=O.fraction,B=v.add(v.mulNumVec2(1-V,S.p1),v.mulNumVec2(V,S.p2));return m(R,B,O.normal,V)}return S.maxFraction})},g.prototype.getProxyCount=function(){return this.m_broadPhase.getProxyCount()},g.prototype.getTreeHeight=function(){return this.m_broadPhase.getTreeHeight()},g.prototype.getTreeBalance=function(){return this.m_broadPhase.getTreeBalance()},g.prototype.getTreeQuality=function(){return this.m_broadPhase.getTreeQuality()},g.prototype.shiftOrigin=function(c){if(!this.m_locked){for(var h=this.m_bodyList;h;h=h.m_next)h.m_xf.p.sub(c),h.m_sweep.c0.sub(c),h.m_sweep.c.sub(c);for(var m=this.m_jointList;m;m=m.m_next)m.shiftOrigin(c);this.m_broadPhase.shiftOrigin(c)}},g.prototype._addBody=function(c){this.isLocked()||(c.m_prev=null,c.m_next=this.m_bodyList,this.m_bodyList&&(this.m_bodyList.m_prev=c),this.m_bodyList=c,++this.m_bodyCount)},g.prototype.createBody=function(c,h){if(this.isLocked())return null;var m={};c&&(v.isValid(c)?m={position:c,angle:h}:"object"==typeof c&&(m=c));var x=new sn(this,m);return this._addBody(x),x},g.prototype.createDynamicBody=function(c,h){var m={};return c&&(v.isValid(c)?m={position:c,angle:h}:"object"==typeof c&&(m=c)),m.type="dynamic",this.createBody(m)},g.prototype.createKinematicBody=function(c,h){var m={};return c&&(v.isValid(c)?m={position:c,angle:h}:"object"==typeof c&&(m=c)),m.type="kinematic",this.createBody(m)},g.prototype.destroyBody=function(c){if(!this.isLocked()){if(c.m_destroyed)return!1;for(var h=c.m_jointList;h;){var m=h;h=h.next,this.publish("remove-joint",m.joint),this.destroyJoint(m.joint),c.m_jointList=h}c.m_jointList=null;for(var x=c.m_contactList;x;){var S=x;x=x.next,this.destroyContact(S.contact),c.m_contactList=x}c.m_contactList=null;for(var M=c.m_fixtureList;M;){var D=M;M=M.m_next,this.publish("remove-fixture",D),D.destroyProxies(this.m_broadPhase),c.m_fixtureList=M}return c.m_fixtureList=null,c.m_prev&&(c.m_prev.m_next=c.m_next),c.m_next&&(c.m_next.m_prev=c.m_prev),c==this.m_bodyList&&(this.m_bodyList=c.m_next),c.m_destroyed=!0,--this.m_bodyCount,this.publish("remove-body",c),!0}},g.prototype.createJoint=function(c){if(this.isLocked())return null;if(c.m_prev=null,c.m_next=this.m_jointList,this.m_jointList&&(this.m_jointList.m_prev=c),this.m_jointList=c,++this.m_jointCount,c.m_edgeA.joint=c,c.m_edgeA.other=c.m_bodyB,c.m_edgeA.prev=null,c.m_edgeA.next=c.m_bodyA.m_jointList,c.m_bodyA.m_jointList&&(c.m_bodyA.m_jointList.prev=c.m_edgeA),c.m_bodyA.m_jointList=c.m_edgeA,c.m_edgeB.joint=c,c.m_edgeB.other=c.m_bodyA,c.m_edgeB.prev=null,c.m_edgeB.next=c.m_bodyB.m_jointList,c.m_bodyB.m_jointList&&(c.m_bodyB.m_jointList.prev=c.m_edgeB),c.m_bodyB.m_jointList=c.m_edgeB,0==c.m_collideConnected)for(var h=c.m_bodyB.getContactList();h;h=h.next)h.other==c.m_bodyA&&h.contact.flagForFiltering();return c},g.prototype.destroyJoint=function(c){if(!this.isLocked()){c.m_prev&&(c.m_prev.m_next=c.m_next),c.m_next&&(c.m_next.m_prev=c.m_prev),c==this.m_jointList&&(this.m_jointList=c.m_next);var h=c.m_bodyA,m=c.m_bodyB;if(h.setAwake(!0),m.setAwake(!0),c.m_edgeA.prev&&(c.m_edgeA.prev.next=c.m_edgeA.next),c.m_edgeA.next&&(c.m_edgeA.next.prev=c.m_edgeA.prev),c.m_edgeA==h.m_jointList&&(h.m_jointList=c.m_edgeA.next),c.m_edgeA.prev=null,c.m_edgeA.next=null,c.m_edgeB.prev&&(c.m_edgeB.prev.next=c.m_edgeB.next),c.m_edgeB.next&&(c.m_edgeB.next.prev=c.m_edgeB.prev),c.m_edgeB==m.m_jointList&&(m.m_jointList=c.m_edgeB.next),c.m_edgeB.prev=null,c.m_edgeB.next=null,--this.m_jointCount,0==c.m_collideConnected)for(var x=m.getContactList();x;)x.other==h&&x.contact.flagForFiltering(),x=x.next;this.publish("remove-joint",c)}},g.prototype.step=function(c,h,m){if(this.publish("pre-step",c),(0|h)!==h&&(h=0),h=h||this.m_velocityIterations,m=m||this.m_positionIterations,this.m_newFixture&&(this.findNewContacts(),this.m_newFixture=!1),this.m_locked=!0,this.s_step.reset(c),this.s_step.velocityIterations=h,this.s_step.positionIterations=m,this.s_step.warmStarting=this.m_warmStarting,this.s_step.blockSolve=this.m_blockSolve,this.updateContacts(),this.m_stepComplete&&c>0){this.m_solver.solveWorld(this.s_step);for(var x=this.m_bodyList;x;x=x.getNext())0!=x.m_islandFlag&&(x.isStatic()||x.synchronizeFixtures());this.findNewContacts()}this.m_continuousPhysics&&c>0&&this.m_solver.solveWorldTOI(this.s_step),this.m_clearForces&&this.clearForces(),this.m_locked=!1,this.publish("post-step",c)},g.prototype.findNewContacts=function(){this.m_broadPhase.updatePairs(this.createContact)},g.prototype.updateContacts=function(){for(var c,h=this.m_contactList;c=h;){h=c.getNext();var m=c.getFixtureA(),x=c.getFixtureB(),S=c.getChildIndexA(),M=c.getChildIndexB(),D=m.getBody(),R=x.getBody();if(c.m_filterFlag){if(0==R.shouldCollide(D)){this.destroyContact(c);continue}if(0==x.shouldCollide(m)){this.destroyContact(c);continue}c.m_filterFlag=!1}var U=D.isAwake()&&!D.isStatic(),O=R.isAwake()&&!R.isStatic();if(0!=U||0!=O){if(0==this.m_broadPhase.testOverlap(m.m_proxies[S].proxyId,x.m_proxies[M].proxyId)){this.destroyContact(c);continue}c.update(this)}}},g.prototype.destroyContact=function(c){Fr.destroy(c,this),c.m_prev&&(c.m_prev.m_next=c.m_next),c.m_next&&(c.m_next.m_prev=c.m_prev),c==this.m_contactList&&(this.m_contactList=c.m_next),--this.m_contactCount},g.prototype.on=function(c,h){return"string"!=typeof c||"function"!=typeof h||(this._listeners||(this._listeners={}),this._listeners[c]||(this._listeners[c]=[]),this._listeners[c].push(h)),this},g.prototype.off=function(c,h){if("string"!=typeof c||"function"!=typeof h)return this;var m=this._listeners&&this._listeners[c];if(!m||!m.length)return this;var x=m.indexOf(h);return x>=0&&m.splice(x,1),this},g.prototype.publish=function(c,h,m,x){var S=this._listeners&&this._listeners[c];if(!S||!S.length)return 0;for(var M=0;M<S.length;M++)S[M].call(this,h,m,x);return S.length},g.prototype.beginContact=function(c){this.publish("begin-contact",c)},g.prototype.endContact=function(c){this.publish("end-contact",c)},g.prototype.preSolve=function(c,h){this.publish("pre-solve",c,h)},g.prototype.postSolve=function(c,h){this.publish("post-solve",c,h)},g}(),qt=function(){function g(c,h,m){if(!(this instanceof g))return new g(c,h,m);typeof c>"u"?(this.x=0,this.y=0,this.z=0):"object"==typeof c?(this.x=c.x,this.y=c.y,this.z=c.z):(this.x=c,this.y=h,this.z=m)}return g.prototype._serialize=function(){return{x:this.x,y:this.y,z:this.z}},g._deserialize=function(c){var h=Object.create(g.prototype);return h.x=c.x,h.y=c.y,h.z=c.z,h},g.neo=function(c,h,m){var x=Object.create(g.prototype);return x.x=c,x.y=h,x.z=m,x},g.zero=function(){var c=Object.create(g.prototype);return c.x=0,c.y=0,c.z=0,c},g.clone=function(c){return g.neo(c.x,c.y,c.z)},g.prototype.toString=function(){return JSON.stringify(this)},g.isValid=function(c){return!(null===c||typeof c>"u")&&oe.isFinite(c.x)&&oe.isFinite(c.y)&&oe.isFinite(c.z)},g.assert=function(c){},g.prototype.setZero=function(){return this.x=0,this.y=0,this.z=0,this},g.prototype.set=function(c,h,m){return this.x=c,this.y=h,this.z=m,this},g.prototype.add=function(c){return this.x+=c.x,this.y+=c.y,this.z+=c.z,this},g.prototype.sub=function(c){return this.x-=c.x,this.y-=c.y,this.z-=c.z,this},g.prototype.mul=function(c){return this.x*=c,this.y*=c,this.z*=c,this},g.areEqual=function(c,h){return c===h||"object"==typeof c&&null!==c&&"object"==typeof h&&null!==h&&c.x===h.x&&c.y===h.y&&c.z===h.z},g.dot=function(c,h){return c.x*h.x+c.y*h.y+c.z*h.z},g.cross=function(c,h){return new g(c.y*h.z-c.z*h.y,c.z*h.x-c.x*h.z,c.x*h.y-c.y*h.x)},g.add=function(c,h){return new g(c.x+h.x,c.y+h.y,c.z+h.z)},g.sub=function(c,h){return new g(c.x-h.x,c.y-h.y,c.z-h.z)},g.mul=function(c,h){return new g(h*c.x,h*c.y,h*c.z)},g.prototype.neg=function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},g.neg=function(c){return new g(-c.x,-c.y,-c.z)},g}(),es=function(g){function c(h,m){var x=this;return x instanceof c?((x=g.call(this)||this).m_type=c.TYPE,x.m_radius=He.polygonRadius,x.m_vertex1=h?v.clone(h):v.zero(),x.m_vertex2=m?v.clone(m):v.zero(),x.m_vertex0=v.zero(),x.m_vertex3=v.zero(),x.m_hasVertex0=!1,x.m_hasVertex3=!1,x):new c(h,m)}return Ln(c,g),c.prototype._serialize=function(){return{type:this.m_type,vertex1:this.m_vertex1,vertex2:this.m_vertex2,vertex0:this.m_vertex0,vertex3:this.m_vertex3,hasVertex0:this.m_hasVertex0,hasVertex3:this.m_hasVertex3}},c._deserialize=function(h){var m=new c(h.vertex1,h.vertex2);return m.m_hasVertex0&&m.setPrevVertex(h.vertex0),m.m_hasVertex3&&m.setNextVertex(h.vertex3),m},c.prototype.setNext=function(h){return this.setNextVertex(h)},c.prototype.setNextVertex=function(h){return h?(this.m_vertex3.setVec2(h),this.m_hasVertex3=!0):(this.m_vertex3.setZero(),this.m_hasVertex3=!1),this},c.prototype.getNextVertex=function(){return this.m_vertex3},c.prototype.setPrev=function(h){return this.setPrevVertex(h)},c.prototype.setPrevVertex=function(h){return h?(this.m_vertex0.setVec2(h),this.m_hasVertex0=!0):(this.m_vertex0.setZero(),this.m_hasVertex0=!1),this},c.prototype.getPrevVertex=function(){return this.m_vertex0},c.prototype._set=function(h,m){return this.m_vertex1.setVec2(h),this.m_vertex2.setVec2(m),this.m_hasVertex0=!1,this.m_hasVertex3=!1,this},c.prototype._clone=function(){var h=new c;return h.m_type=this.m_type,h.m_radius=this.m_radius,h.m_vertex1.setVec2(this.m_vertex1),h.m_vertex2.setVec2(this.m_vertex2),h.m_vertex0.setVec2(this.m_vertex0),h.m_vertex3.setVec2(this.m_vertex3),h.m_hasVertex0=this.m_hasVertex0,h.m_hasVertex3=this.m_hasVertex3,h},c.prototype.getChildCount=function(){return 1},c.prototype.testPoint=function(h,m){return!1},c.prototype.rayCast=function(h,m,x,S){var M=X.mulTVec2(x.q,v.sub(m.p1,x.p)),D=X.mulTVec2(x.q,v.sub(m.p2,x.p)),R=v.sub(D,M),U=this.m_vertex1,O=this.m_vertex2,W=v.sub(O,U),V=v.neo(W.y,-W.x);V.normalize();var B=v.dot(V,v.sub(U,M)),F=v.dot(V,R);if(0==F)return!1;var j=B/F;if(j<0||m.maxFraction<j)return!1;var ee=v.add(M,v.mulNumVec2(j,R)),Z=v.sub(O,U),re=v.dot(Z,Z);if(0==re)return!1;var se=v.dot(v.sub(ee,U),Z)/re;return!(se<0||1<se||(h.fraction=j,h.normal=B>0?X.mulVec2(x.q,V).neg():X.mulVec2(x.q,V),0))},c.prototype.computeAABB=function(h,m,x){var S=ne.mulVec2(m,this.m_vertex1),M=ne.mulVec2(m,this.m_vertex2);h.combinePoints(S,M),h.extend(this.m_radius)},c.prototype.computeMass=function(h,m){h.mass=0,h.center.setCombine(.5,this.m_vertex1,.5,this.m_vertex2),h.I=0},c.prototype.computeDistanceProxy=function(h){h.m_vertices.push(this.m_vertex1),h.m_vertices.push(this.m_vertex2),h.m_count=2,h.m_radius=this.m_radius},c.TYPE="edge",c}(ai),pa=function(g){function c(h,m){var x=this;return x instanceof c?((x=g.call(this)||this).m_type=c.TYPE,x.m_radius=He.polygonRadius,x.m_vertices=[],x.m_count=0,x.m_prevVertex=null,x.m_nextVertex=null,x.m_hasPrevVertex=!1,x.m_hasNextVertex=!1,x.m_isLoop=!!m,h&&h.length&&(m?x._createLoop(h):x._createChain(h)),x):new c(h,m)}return Ln(c,g),c.prototype._serialize=function(){var h={type:this.m_type,vertices:this.m_vertices,isLoop:this.m_isLoop,hasPrevVertex:this.m_hasPrevVertex,hasNextVertex:this.m_hasNextVertex,prevVertex:null,nextVertex:null};return this.m_prevVertex&&(h.prevVertex=this.m_prevVertex),this.m_nextVertex&&(h.nextVertex=this.m_nextVertex),h},c._deserialize=function(h,m,x){var S=[];if(h.vertices)for(var M=0;M<h.vertices.length;M++)S.push(x(v,h.vertices[M]));var D=new c(S,h.isLoop);return h.prevVertex&&D.setPrevVertex(h.prevVertex),h.nextVertex&&D.setNextVertex(h.nextVertex),D},c.prototype._createLoop=function(h){for(var m=1;m<h.length;++m);for(this.m_vertices=[],this.m_count=h.length+1,m=0;m<h.length;++m)this.m_vertices[m]=v.clone(h[m]);return this.m_vertices[h.length]=v.clone(h[0]),this.m_prevVertex=this.m_vertices[this.m_count-2],this.m_nextVertex=this.m_vertices[1],this.m_hasPrevVertex=!0,this.m_hasNextVertex=!0,this},c.prototype._createChain=function(h){for(var m=1;m<h.length;++m);for(this.m_count=h.length,m=0;m<h.length;++m)this.m_vertices[m]=v.clone(h[m]);return this.m_hasPrevVertex=!1,this.m_hasNextVertex=!1,this.m_prevVertex=null,this.m_nextVertex=null,this},c.prototype._reset=function(){this.m_isLoop?this._createLoop(this.m_vertices):this._createChain(this.m_vertices)},c.prototype.setPrevVertex=function(h){this.m_prevVertex=h,this.m_hasPrevVertex=!0},c.prototype.getPrevVertex=function(){return this.m_prevVertex},c.prototype.setNextVertex=function(h){this.m_nextVertex=h,this.m_hasNextVertex=!0},c.prototype.getNextVertex=function(){return this.m_nextVertex},c.prototype._clone=function(){var h=new c;return h._createChain(this.m_vertices),h.m_type=this.m_type,h.m_radius=this.m_radius,h.m_prevVertex=this.m_prevVertex,h.m_nextVertex=this.m_nextVertex,h.m_hasPrevVertex=this.m_hasPrevVertex,h.m_hasNextVertex=this.m_hasNextVertex,h},c.prototype.getChildCount=function(){return this.m_count-1},c.prototype.getChildEdge=function(h,m){h.m_type=es.TYPE,h.m_radius=this.m_radius,h.m_vertex1=this.m_vertices[m],h.m_vertex2=this.m_vertices[m+1],m>0?(h.m_vertex0=this.m_vertices[m-1],h.m_hasVertex0=!0):(h.m_vertex0=this.m_prevVertex,h.m_hasVertex0=this.m_hasPrevVertex),m<this.m_count-2?(h.m_vertex3=this.m_vertices[m+2],h.m_hasVertex3=!0):(h.m_vertex3=this.m_nextVertex,h.m_hasVertex3=this.m_hasNextVertex)},c.prototype.getVertex=function(h){return h<this.m_count?this.m_vertices[h]:this.m_vertices[0]},c.prototype.isLoop=function(){return this.m_isLoop},c.prototype.testPoint=function(h,m){return!1},c.prototype.rayCast=function(h,m,x,S){return new es(this.getVertex(S),this.getVertex(S+1)).rayCast(h,m,x,0)},c.prototype.computeAABB=function(h,m,x){var S=ne.mulVec2(m,this.getVertex(x)),M=ne.mulVec2(m,this.getVertex(x+1));h.combinePoints(S,M)},c.prototype.computeMass=function(h,m){h.mass=0,h.center=v.zero(),h.I=0},c.prototype.computeDistanceProxy=function(h,m){h.m_buffer[0]=this.getVertex(m),h.m_buffer[1]=this.getVertex(m+1),h.m_vertices=h.m_buffer,h.m_count=2,h.m_radius=this.m_radius},c.TYPE="chain",c}(ai),ts=function(g){function c(h){var m=this;return m instanceof c?((m=g.call(this)||this).m_type=c.TYPE,m.m_radius=He.polygonRadius,m.m_centroid=v.zero(),m.m_vertices=[],m.m_normals=[],m.m_count=0,h&&h.length&&m._set(h),m):new c(h)}return Ln(c,g),c.prototype._serialize=function(){return{type:this.m_type,vertices:this.m_vertices}},c._deserialize=function(h,m,x){var S=[];if(h.vertices)for(var M=0;M<h.vertices.length;M++)S.push(x(v,h.vertices[M]));return new c(S)},c.prototype.getVertex=function(h){return this.m_vertices[h]},c.prototype._clone=function(){var h=new c;h.m_type=this.m_type,h.m_radius=this.m_radius,h.m_count=this.m_count,h.m_centroid.setVec2(this.m_centroid);for(var m=0;m<this.m_count;m++)h.m_vertices.push(this.m_vertices[m].clone());for(m=0;m<this.m_normals.length;m++)h.m_normals.push(this.m_normals[m].clone());return h},c.prototype.getChildCount=function(){return 1},c.prototype._reset=function(){this._set(this.m_vertices)},c.prototype._set=function(h){if(h.length<3)this._setAsBox(1,1);else{for(var m=oe.min(h.length,He.maxPolygonVertices),x=[],S=0;S<m;++S){for(var M=h[S],D=!0,R=0;R<x.length;++R)if(v.distanceSquared(M,x[R])<.25*He.linearSlopSquared){D=!1;break}D&&x.push(M)}if((m=x.length)<3)this._setAsBox(1,1);else{var U=0,O=x[0].x;for(S=1;S<m;++S){var W=x[S].x;(W>O||W===O&&x[S].y<x[U].y)&&(U=S,O=W)}for(var V=[],B=0,F=U;;){V[B]=F;var j=0;for(R=1;R<m;++R)if(j!==F){var ee=v.sub(x[j],x[V[B]]),Z=(M=v.sub(x[R],x[V[B]]),v.crossVec2Vec2(ee,M));Z<0&&(j=R),0===Z&&M.lengthSquared()>ee.lengthSquared()&&(j=R)}else j=R;if(++B,F=j,j===U)break}if(B<3)this._setAsBox(1,1);else{for(this.m_count=B,this.m_vertices=[],S=0;S<B;++S)this.m_vertices[S]=x[V[S]];for(S=0;S<B;++S){var xe=v.sub(this.m_vertices[S+1<B?S+1:0],this.m_vertices[S]);this.m_normals[S]=v.crossVec2Num(xe,1),this.m_normals[S].normalize()}this.m_centroid=function ox(g,c){for(var h=v.zero(),m=0,x=v.zero(),M=1/3,S=0;S<c;++S){var D=x,R=g[S],U=S+1<c?g[S+1]:g[0],O=v.sub(R,D),W=v.sub(U,D),B=.5*v.crossVec2Vec2(O,W);m+=B,h.addMul(B*M,D),h.addMul(B*M,R),h.addMul(B*M,U)}return h.mul(1/m),h}(this.m_vertices,B)}}}},c.prototype._setAsBox=function(h,m,x,S){if(this.m_vertices[0]=v.neo(h,-m),this.m_vertices[1]=v.neo(h,m),this.m_vertices[2]=v.neo(-h,m),this.m_vertices[3]=v.neo(-h,-m),this.m_normals[0]=v.neo(1,0),this.m_normals[1]=v.neo(0,1),this.m_normals[2]=v.neo(-1,0),this.m_normals[3]=v.neo(0,-1),this.m_count=4,v.isValid(x)){S=S||0,this.m_centroid.setVec2(x);var M=ne.identity();M.p.setVec2(x),M.q.setAngle(S);for(var D=0;D<this.m_count;++D)this.m_vertices[D]=ne.mulVec2(M,this.m_vertices[D]),this.m_normals[D]=X.mulVec2(M.q,this.m_normals[D])}},c.prototype.testPoint=function(h,m){for(var x=X.mulTVec2(h.q,v.sub(m,h.p)),S=0;S<this.m_count;++S)if(v.dot(this.m_normals[S],v.sub(x,this.m_vertices[S]))>0)return!1;return!0},c.prototype.rayCast=function(h,m,x,S){for(var M=X.mulTVec2(x.q,v.sub(m.p1,x.p)),D=X.mulTVec2(x.q,v.sub(m.p2,x.p)),R=v.sub(D,M),U=0,O=m.maxFraction,W=-1,V=0;V<this.m_count;++V){var B=v.dot(this.m_normals[V],v.sub(this.m_vertices[V],M)),F=v.dot(this.m_normals[V],R);if(0==F){if(B<0)return!1}else F<0&&B<U*F?(U=B/F,W=V):F>0&&B<O*F&&(O=B/F);if(O<U)return!1}return W>=0&&(h.fraction=U,h.normal=X.mulVec2(x.q,this.m_normals[W]),!0)},c.prototype.computeAABB=function(h,m,x){for(var S=1/0,M=1/0,D=-1/0,R=-1/0,U=0;U<this.m_count;++U){var O=ne.mulVec2(m,this.m_vertices[U]);S=oe.min(S,O.x),D=oe.max(D,O.x),M=oe.min(M,O.y),R=oe.max(R,O.y)}h.lowerBound.setNum(S,M),h.upperBound.setNum(D,R),h.extend(this.m_radius)},c.prototype.computeMass=function(h,m){for(var x=v.zero(),S=0,M=0,D=v.zero(),R=0;R<this.m_count;++R)D.add(this.m_vertices[R]);D.mul(1/this.m_count);var U=1/3;for(R=0;R<this.m_count;++R){var O=v.sub(this.m_vertices[R],D),W=v.sub(R+1<this.m_count?this.m_vertices[R+1]:this.m_vertices[0],D),V=v.crossVec2Vec2(O,W),B=.5*V;S+=B,x.addCombine(B*U,O,B*U,W);var F=O.x,j=O.y,ee=W.x,Z=W.y;M+=.25*U*V*(F*F+ee*F+ee*ee+(j*j+Z*j+Z*Z))}h.mass=m*S,x.mul(1/S),h.center.setCombine(1,x,1,D),h.I=m*M,h.I+=h.mass*(v.dot(h.center,h.center)-v.dot(x,x))},c.prototype.validate=function(){for(var h=0;h<this.m_count;++h)for(var m=h,x=h<this.m_count-1?m+1:0,S=this.m_vertices[m],M=v.sub(this.m_vertices[x],S),D=0;D<this.m_count;++D)if(D!=m&&D!=x){var R=v.sub(this.m_vertices[D],S);if(v.crossVec2Vec2(M,R)<0)return!1}return!0},c.prototype.computeDistanceProxy=function(h){h.m_vertices=this.m_vertices,h.m_count=this.m_count,h.m_radius=this.m_radius},c.TYPE="polygon",c}(ai);var yl=function(g){function c(h,m,x,S){var M=this;return M instanceof c?((M=g.call(this)||this)._setAsBox(h,m,x,S),M):new c(h,m,x,S)}return Ln(c,g),c.TYPE="polygon",c}(ts),ns=function(g){function c(h,m){var x=this;return x instanceof c?((x=g.call(this)||this).m_type=c.TYPE,x.m_p=v.zero(),x.m_radius=1,"object"==typeof h&&v.isValid(h)?(x.m_p.setVec2(h),"number"==typeof m&&(x.m_radius=m)):"number"==typeof h&&(x.m_radius=h),x):new c(h,m)}return Ln(c,g),c.prototype._serialize=function(){return{type:this.m_type,p:this.m_p,radius:this.m_radius}},c._deserialize=function(h){return new c(h.p,h.radius)},c.prototype.getRadius=function(){return this.m_radius},c.prototype.getCenter=function(){return this.m_p},c.prototype.getVertex=function(h){return this.m_p},c.prototype._clone=function(){var h=new c;return h.m_type=this.m_type,h.m_radius=this.m_radius,h.m_p=this.m_p.clone(),h},c.prototype.getChildCount=function(){return 1},c.prototype.testPoint=function(h,m){var x=v.add(h.p,X.mulVec2(h.q,this.m_p)),S=v.sub(m,x);return v.dot(S,S)<=this.m_radius*this.m_radius},c.prototype.rayCast=function(h,m,x,S){var M=v.add(x.p,X.mulVec2(x.q,this.m_p)),D=v.sub(m.p1,M),R=v.dot(D,D)-this.m_radius*this.m_radius,U=v.sub(m.p2,m.p1),O=v.dot(D,U),W=v.dot(U,U),V=O*O-W*R;if(V<0||W<oe.EPSILON)return!1;var B=-(O+oe.sqrt(V));return 0<=B&&B<=m.maxFraction*W&&(h.fraction=B/=W,h.normal=v.add(D,v.mulNumVec2(B,U)),h.normal.normalize(),!0)},c.prototype.computeAABB=function(h,m,x){var S=v.add(m.p,X.mulVec2(m.q,this.m_p));h.lowerBound.setNum(S.x-this.m_radius,S.y-this.m_radius),h.upperBound.setNum(S.x+this.m_radius,S.y+this.m_radius)},c.prototype.computeMass=function(h,m){h.mass=m*oe.PI*this.m_radius*this.m_radius,h.center=this.m_p,h.I=h.mass*(.5*this.m_radius*this.m_radius+v.dot(this.m_p,this.m_p))},c.prototype.computeDistanceProxy=function(h){h.m_vertices.push(this.m_p),h.m_count=1,h.m_radius=this.m_radius},c.TYPE="circle",c}(ai),bd={frequencyHz:0,dampingRatio:0},xl=function(g){function c(h,m,x,S,M){var D=this;if(!(D instanceof c))return new c(h,m,x,S,M);if(x&&S&&"m_type"in S&&"x"in x&&"y"in x){var R=x;x=S,S=R}return h=ge(h,bd),m=(D=g.call(this,h,m,x)||this).m_bodyA,x=D.m_bodyB,D.m_type=c.TYPE,D.m_localAnchorA=v.clone(S?m.getLocalPoint(S):h.localAnchorA||v.zero()),D.m_localAnchorB=v.clone(M?x.getLocalPoint(M):h.localAnchorB||v.zero()),D.m_length=oe.isFinite(h.length)?h.length:v.distance(m.getWorldPoint(D.m_localAnchorA),x.getWorldPoint(D.m_localAnchorB)),D.m_frequencyHz=h.frequencyHz,D.m_dampingRatio=h.dampingRatio,D.m_impulse=0,D.m_gamma=0,D.m_bias=0,D}return Ln(c,g),c.prototype._serialize=function(){return{type:this.m_type,bodyA:this.m_bodyA,bodyB:this.m_bodyB,collideConnected:this.m_collideConnected,frequencyHz:this.m_frequencyHz,dampingRatio:this.m_dampingRatio,localAnchorA:this.m_localAnchorA,localAnchorB:this.m_localAnchorB,length:this.m_length,impulse:this.m_impulse,gamma:this.m_gamma,bias:this.m_bias}},c._deserialize=function(h,m,x){return(h=Q({},h)).bodyA=x(sn,h.bodyA,m),h.bodyB=x(sn,h.bodyB,m),new c(h)},c.prototype._setAnchors=function(h){h.anchorA?this.m_localAnchorA.setVec2(this.m_bodyA.getLocalPoint(h.anchorA)):h.localAnchorA&&this.m_localAnchorA.setVec2(h.localAnchorA),h.anchorB?this.m_localAnchorB.setVec2(this.m_bodyB.getLocalPoint(h.anchorB)):h.localAnchorB&&this.m_localAnchorB.setVec2(h.localAnchorB),h.length>0?this.m_length=+h.length:h.length<0||(h.anchorA||h.anchorA||h.anchorA||h.anchorA)&&(this.m_length=v.distance(this.m_bodyA.getWorldPoint(this.m_localAnchorA),this.m_bodyB.getWorldPoint(this.m_localAnchorB)))},c.prototype.getLocalAnchorA=function(){return this.m_localAnchorA},c.prototype.getLocalAnchorB=function(){return this.m_localAnchorB},c.prototype.setLength=function(h){this.m_length=h},c.prototype.getLength=function(){return this.m_length},c.prototype.setFrequency=function(h){this.m_frequencyHz=h},c.prototype.getFrequency=function(){return this.m_frequencyHz},c.prototype.setDampingRatio=function(h){this.m_dampingRatio=h},c.prototype.getDampingRatio=function(){return this.m_dampingRatio},c.prototype.getAnchorA=function(){return this.m_bodyA.getWorldPoint(this.m_localAnchorA)},c.prototype.getAnchorB=function(){return this.m_bodyB.getWorldPoint(this.m_localAnchorB)},c.prototype.getReactionForce=function(h){return v.mulNumVec2(this.m_impulse,this.m_u).mul(h)},c.prototype.getReactionTorque=function(h){return 0},c.prototype.initVelocityConstraints=function(h){this.m_localCenterA=this.m_bodyA.m_sweep.localCenter,this.m_localCenterB=this.m_bodyB.m_sweep.localCenter,this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var m=this.m_bodyA.c_position.c,S=this.m_bodyA.c_velocity.v,M=this.m_bodyA.c_velocity.w,D=this.m_bodyB.c_position.c,R=this.m_bodyB.c_position.a,U=this.m_bodyB.c_velocity.v,O=this.m_bodyB.c_velocity.w,W=X.neo(this.m_bodyA.c_position.a),V=X.neo(R);this.m_rA=X.mulVec2(W,v.sub(this.m_localAnchorA,this.m_localCenterA)),this.m_rB=X.mulVec2(V,v.sub(this.m_localAnchorB,this.m_localCenterB)),this.m_u=v.sub(v.add(D,this.m_rB),v.add(m,this.m_rA));var B=this.m_u.length();B>He.linearSlop?this.m_u.mul(1/B):this.m_u.setNum(0,0);var F=v.crossVec2Vec2(this.m_rA,this.m_u),j=v.crossVec2Vec2(this.m_rB,this.m_u),ee=this.m_invMassA+this.m_invIA*F*F+this.m_invMassB+this.m_invIB*j*j;if(this.m_mass=0!=ee?1/ee:0,this.m_frequencyHz>0){var Z=B-this.m_length,re=2*oe.PI*this.m_frequencyHz,xe=this.m_mass*re*re,de=h.dt;this.m_gamma=de*(2*this.m_mass*this.m_dampingRatio*re+de*xe),this.m_gamma=0!=this.m_gamma?1/this.m_gamma:0,this.m_bias=Z*de*xe*this.m_gamma,this.m_mass=0!=(ee+=this.m_gamma)?1/ee:0}else this.m_gamma=0,this.m_bias=0;if(h.warmStarting){this.m_impulse*=h.dtRatio;var Ie=v.mulNumVec2(this.m_impulse,this.m_u);S.subMul(this.m_invMassA,Ie),M-=this.m_invIA*v.crossVec2Vec2(this.m_rA,Ie),U.addMul(this.m_invMassB,Ie),O+=this.m_invIB*v.crossVec2Vec2(this.m_rB,Ie)}else this.m_impulse=0;this.m_bodyA.c_velocity.v.setVec2(S),this.m_bodyA.c_velocity.w=M,this.m_bodyB.c_velocity.v.setVec2(U),this.m_bodyB.c_velocity.w=O},c.prototype.solveVelocityConstraints=function(h){var m=this.m_bodyA.c_velocity.v,x=this.m_bodyA.c_velocity.w,S=this.m_bodyB.c_velocity.v,M=this.m_bodyB.c_velocity.w,D=v.add(m,v.crossNumVec2(x,this.m_rA)),R=v.add(S,v.crossNumVec2(M,this.m_rB)),U=v.dot(this.m_u,R)-v.dot(this.m_u,D),O=-this.m_mass*(U+this.m_bias+this.m_gamma*this.m_impulse);this.m_impulse+=O;var W=v.mulNumVec2(O,this.m_u);m.subMul(this.m_invMassA,W),x-=this.m_invIA*v.crossVec2Vec2(this.m_rA,W),S.addMul(this.m_invMassB,W),M+=this.m_invIB*v.crossVec2Vec2(this.m_rB,W),this.m_bodyA.c_velocity.v.setVec2(m),this.m_bodyA.c_velocity.w=x,this.m_bodyB.c_velocity.v.setVec2(S),this.m_bodyB.c_velocity.w=M},c.prototype.solvePositionConstraints=function(h){if(this.m_frequencyHz>0)return!0;var m=this.m_bodyA.c_position.c,x=this.m_bodyA.c_position.a,S=this.m_bodyB.c_position.c,M=this.m_bodyB.c_position.a,D=X.neo(x),R=X.neo(M),U=X.mulSub(D,this.m_localAnchorA,this.m_localCenterA),O=X.mulSub(R,this.m_localAnchorB,this.m_localCenterB),W=v.sub(v.add(S,O),v.add(m,U)),B=W.normalize()-this.m_length;B=oe.clamp(B,-He.maxLinearCorrection,He.maxLinearCorrection);var j=v.mulNumVec2(-this.m_mass*B,W);return m.subMul(this.m_invMassA,j),x-=this.m_invIA*v.crossVec2Vec2(U,j),S.addMul(this.m_invMassB,j),M+=this.m_invIB*v.crossVec2Vec2(O,j),this.m_bodyA.c_position.c.setVec2(m),this.m_bodyA.c_position.a=x,this.m_bodyB.c_position.c.setVec2(S),this.m_bodyB.c_position.a=M,oe.abs(B)<He.linearSlop},c.TYPE="distance-joint",c}(Ri),Ad={maxForce:0,maxTorque:0},vu=function(g){function c(h,m,x,S){var M=this;return M instanceof c?(h=ge(h,Ad),m=(M=g.call(this,h,m,x)||this).m_bodyA,x=M.m_bodyB,M.m_type=c.TYPE,M.m_localAnchorA=v.clone(S?m.getLocalPoint(S):h.localAnchorA||v.zero()),M.m_localAnchorB=v.clone(S?x.getLocalPoint(S):h.localAnchorB||v.zero()),M.m_linearImpulse=v.zero(),M.m_angularImpulse=0,M.m_maxForce=h.maxForce,M.m_maxTorque=h.maxTorque,M):new c(h,m,x,S)}return Ln(c,g),c.prototype._serialize=function(){return{type:this.m_type,bodyA:this.m_bodyA,bodyB:this.m_bodyB,collideConnected:this.m_collideConnected,maxForce:this.m_maxForce,maxTorque:this.m_maxTorque,localAnchorA:this.m_localAnchorA,localAnchorB:this.m_localAnchorB}},c._deserialize=function(h,m,x){return(h=Q({},h)).bodyA=x(sn,h.bodyA,m),h.bodyB=x(sn,h.bodyB,m),new c(h)},c.prototype._setAnchors=function(h){h.anchorA?this.m_localAnchorA.setVec2(this.m_bodyA.getLocalPoint(h.anchorA)):h.localAnchorA&&this.m_localAnchorA.setVec2(h.localAnchorA),h.anchorB?this.m_localAnchorB.setVec2(this.m_bodyB.getLocalPoint(h.anchorB)):h.localAnchorB&&this.m_localAnchorB.setVec2(h.localAnchorB)},c.prototype.getLocalAnchorA=function(){return this.m_localAnchorA},c.prototype.getLocalAnchorB=function(){return this.m_localAnchorB},c.prototype.setMaxForce=function(h){this.m_maxForce=h},c.prototype.getMaxForce=function(){return this.m_maxForce},c.prototype.setMaxTorque=function(h){this.m_maxTorque=h},c.prototype.getMaxTorque=function(){return this.m_maxTorque},c.prototype.getAnchorA=function(){return this.m_bodyA.getWorldPoint(this.m_localAnchorA)},c.prototype.getAnchorB=function(){return this.m_bodyB.getWorldPoint(this.m_localAnchorB)},c.prototype.getReactionForce=function(h){return v.mulNumVec2(h,this.m_linearImpulse)},c.prototype.getReactionTorque=function(h){return h*this.m_angularImpulse},c.prototype.initVelocityConstraints=function(h){this.m_localCenterA=this.m_bodyA.m_sweep.localCenter,this.m_localCenterB=this.m_bodyB.m_sweep.localCenter,this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var x=this.m_bodyA.c_velocity.v,S=this.m_bodyA.c_velocity.w,M=this.m_bodyB.c_position.a,D=this.m_bodyB.c_velocity.v,R=this.m_bodyB.c_velocity.w,U=X.neo(this.m_bodyA.c_position.a),O=X.neo(M);this.m_rA=X.mulVec2(U,v.sub(this.m_localAnchorA,this.m_localCenterA)),this.m_rB=X.mulVec2(O,v.sub(this.m_localAnchorB,this.m_localCenterB));var W=this.m_invMassA,V=this.m_invMassB,B=this.m_invIA,F=this.m_invIB,j=new bi;if(j.ex.x=W+V+B*this.m_rA.y*this.m_rA.y+F*this.m_rB.y*this.m_rB.y,j.ex.y=-B*this.m_rA.x*this.m_rA.y-F*this.m_rB.x*this.m_rB.y,j.ey.x=j.ex.y,j.ey.y=W+V+B*this.m_rA.x*this.m_rA.x+F*this.m_rB.x*this.m_rB.x,this.m_linearMass=j.getInverse(),this.m_angularMass=B+F,this.m_angularMass>0&&(this.m_angularMass=1/this.m_angularMass),h.warmStarting){this.m_linearImpulse.mul(h.dtRatio),this.m_angularImpulse*=h.dtRatio;var ee=v.neo(this.m_linearImpulse.x,this.m_linearImpulse.y);x.subMul(W,ee),S-=B*(v.crossVec2Vec2(this.m_rA,ee)+this.m_angularImpulse),D.addMul(V,ee),R+=F*(v.crossVec2Vec2(this.m_rB,ee)+this.m_angularImpulse)}else this.m_linearImpulse.setZero(),this.m_angularImpulse=0;this.m_bodyA.c_velocity.v=x,this.m_bodyA.c_velocity.w=S,this.m_bodyB.c_velocity.v=D,this.m_bodyB.c_velocity.w=R},c.prototype.solveVelocityConstraints=function(h){var m=this.m_bodyA.c_velocity.v,x=this.m_bodyA.c_velocity.w,S=this.m_bodyB.c_velocity.v,M=this.m_bodyB.c_velocity.w,D=this.m_invMassA,R=this.m_invMassB,U=this.m_invIA,O=this.m_invIB,W=h.dt,F=this.m_angularImpulse;this.m_angularImpulse=oe.clamp(this.m_angularImpulse+(B=-this.m_angularMass*(M-x)),-(j=W*this.m_maxTorque),j),x-=U*(B=this.m_angularImpulse-F);var V=v.sub(v.add(S,v.crossNumVec2(M+=O*B,this.m_rB)),v.add(m,v.crossNumVec2(x,this.m_rA))),B=v.neg(bi.mulVec2(this.m_linearMass,V));F=this.m_linearImpulse,this.m_linearImpulse.add(B);var j=W*this.m_maxForce;this.m_linearImpulse.lengthSquared()>j*j&&(this.m_linearImpulse.normalize(),this.m_linearImpulse.mul(j)),B=v.sub(this.m_linearImpulse,F),m.subMul(D,B),x-=U*v.crossVec2Vec2(this.m_rA,B),S.addMul(R,B),M+=O*v.crossVec2Vec2(this.m_rB,B),this.m_bodyA.c_velocity.v=m,this.m_bodyA.c_velocity.w=x,this.m_bodyB.c_velocity.v=S,this.m_bodyB.c_velocity.w=M},c.prototype.solvePositionConstraints=function(h){return!0},c.TYPE="friction-joint",c}(Ri),Or=function(){function g(c,h,m){"object"==typeof c&&null!==c?(this.ex=qt.clone(c),this.ey=qt.clone(h),this.ez=qt.clone(m)):(this.ex=qt.zero(),this.ey=qt.zero(),this.ez=qt.zero())}return g.prototype.toString=function(){return JSON.stringify(this)},g.isValid=function(c){return!(null===c||typeof c>"u")&&qt.isValid(c.ex)&&qt.isValid(c.ey)&&qt.isValid(c.ez)},g.assert=function(c){},g.prototype.setZero=function(){return this.ex.setZero(),this.ey.setZero(),this.ez.setZero(),this},g.prototype.solve33=function(c){var h=qt.dot(this.ex,qt.cross(this.ey,this.ez));0!==h&&(h=1/h);var m=new qt;return m.x=h*qt.dot(c,qt.cross(this.ey,this.ez)),m.y=h*qt.dot(this.ex,qt.cross(c,this.ez)),m.z=h*qt.dot(this.ex,qt.cross(this.ey,c)),m},g.prototype.solve22=function(c){var h=this.ex.x,m=this.ey.x,x=this.ex.y,S=this.ey.y,M=h*S-m*x;0!==M&&(M=1/M);var D=v.zero();return D.x=M*(S*c.x-m*c.y),D.y=M*(h*c.y-x*c.x),D},g.prototype.getInverse22=function(c){var h=this.ex.x,m=this.ey.x,x=this.ex.y,S=this.ey.y,M=h*S-m*x;0!==M&&(M=1/M),c.ex.x=M*S,c.ey.x=-M*m,c.ex.z=0,c.ex.y=-M*x,c.ey.y=M*h,c.ey.z=0,c.ez.x=0,c.ez.y=0,c.ez.z=0},g.prototype.getSymInverse33=function(c){var h=qt.dot(this.ex,qt.cross(this.ey,this.ez));0!==h&&(h=1/h);var m=this.ex.x,x=this.ey.x,S=this.ez.x,M=this.ey.y,D=this.ez.y,R=this.ez.z;c.ex.x=h*(M*R-D*D),c.ex.y=h*(S*D-x*R),c.ex.z=h*(x*D-S*M),c.ey.x=c.ex.y,c.ey.y=h*(m*R-S*S),c.ey.z=h*(S*x-m*D),c.ez.x=c.ex.z,c.ez.y=c.ey.z,c.ez.z=h*(m*M-x*x)},g.mul=function(c,h){return h&&"z"in h&&"y"in h&&"x"in h?new qt(c.ex.x*h.x+c.ey.x*h.y+c.ez.x*h.z,c.ex.y*h.x+c.ey.y*h.y+c.ez.y*h.z,c.ex.z*h.x+c.ey.z*h.y+c.ez.z*h.z):h&&"y"in h&&"x"in h?v.neo(c.ex.x*h.x+c.ey.x*h.y,c.ex.y*h.x+c.ey.y*h.y):void 0},g.mulVec3=function(c,h){return new qt(c.ex.x*h.x+c.ey.x*h.y+c.ez.x*h.z,c.ex.y*h.x+c.ey.y*h.y+c.ez.y*h.z,c.ex.z*h.x+c.ey.z*h.y+c.ez.z*h.z)},g.mulVec2=function(c,h){return v.neo(c.ex.x*h.x+c.ey.x*h.y,c.ex.y*h.x+c.ey.y*h.y)},g.add=function(c,h){return new g(qt.add(c.ex,h.ex),qt.add(c.ey,h.ey),qt.add(c.ez,h.ez))},g}(),Bm={lowerAngle:0,upperAngle:0,maxMotorTorque:0,motorSpeed:0,enableLimit:!1,enableMotor:!1},is=function(g){function c(h,m,x,S){var M=this;return M instanceof c?(h=ge(h,Bm),(M=g.call(this,h,m,x)||this).m_mass=new Or,M.m_limitState=0,m=M.m_bodyA,x=M.m_bodyB,M.m_type=c.TYPE,M.m_localAnchorA=v.clone(S?m.getLocalPoint(S):h.localAnchorA||v.zero()),M.m_localAnchorB=v.clone(S?x.getLocalPoint(S):h.localAnchorB||v.zero()),M.m_referenceAngle=oe.isFinite(h.referenceAngle)?h.referenceAngle:x.getAngle()-m.getAngle(),M.m_impulse=new qt,M.m_motorImpulse=0,M.m_lowerAngle=h.lowerAngle,M.m_upperAngle=h.upperAngle,M.m_maxMotorTorque=h.maxMotorTorque,M.m_motorSpeed=h.motorSpeed,M.m_enableLimit=h.enableLimit,M.m_enableMotor=h.enableMotor,M):new c(h,m,x,S)}return Ln(c,g),c.prototype._serialize=function(){return{type:this.m_type,bodyA:this.m_bodyA,bodyB:this.m_bodyB,collideConnected:this.m_collideConnected,lowerAngle:this.m_lowerAngle,upperAngle:this.m_upperAngle,maxMotorTorque:this.m_maxMotorTorque,motorSpeed:this.m_motorSpeed,enableLimit:this.m_enableLimit,enableMotor:this.m_enableMotor,localAnchorA:this.m_localAnchorA,localAnchorB:this.m_localAnchorB,referenceAngle:this.m_referenceAngle}},c._deserialize=function(h,m,x){return(h=Q({},h)).bodyA=x(sn,h.bodyA,m),h.bodyB=x(sn,h.bodyB,m),new c(h)},c.prototype._setAnchors=function(h){h.anchorA?this.m_localAnchorA.setVec2(this.m_bodyA.getLocalPoint(h.anchorA)):h.localAnchorA&&this.m_localAnchorA.setVec2(h.localAnchorA),h.anchorB?this.m_localAnchorB.setVec2(this.m_bodyB.getLocalPoint(h.anchorB)):h.localAnchorB&&this.m_localAnchorB.setVec2(h.localAnchorB)},c.prototype.getLocalAnchorA=function(){return this.m_localAnchorA},c.prototype.getLocalAnchorB=function(){return this.m_localAnchorB},c.prototype.getReferenceAngle=function(){return this.m_referenceAngle},c.prototype.getJointAngle=function(){return this.m_bodyB.m_sweep.a-this.m_bodyA.m_sweep.a-this.m_referenceAngle},c.prototype.getJointSpeed=function(){return this.m_bodyB.m_angularVelocity-this.m_bodyA.m_angularVelocity},c.prototype.isMotorEnabled=function(){return this.m_enableMotor},c.prototype.enableMotor=function(h){this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_enableMotor=h},c.prototype.getMotorTorque=function(h){return h*this.m_motorImpulse},c.prototype.setMotorSpeed=function(h){this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_motorSpeed=h},c.prototype.getMotorSpeed=function(){return this.m_motorSpeed},c.prototype.setMaxMotorTorque=function(h){this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_maxMotorTorque=h},c.prototype.getMaxMotorTorque=function(){return this.m_maxMotorTorque},c.prototype.isLimitEnabled=function(){return this.m_enableLimit},c.prototype.enableLimit=function(h){h!=this.m_enableLimit&&(this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_enableLimit=h,this.m_impulse.z=0)},c.prototype.getLowerLimit=function(){return this.m_lowerAngle},c.prototype.getUpperLimit=function(){return this.m_upperAngle},c.prototype.setLimits=function(h,m){(h!=this.m_lowerAngle||m!=this.m_upperAngle)&&(this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_impulse.z=0,this.m_lowerAngle=h,this.m_upperAngle=m)},c.prototype.getAnchorA=function(){return this.m_bodyA.getWorldPoint(this.m_localAnchorA)},c.prototype.getAnchorB=function(){return this.m_bodyB.getWorldPoint(this.m_localAnchorB)},c.prototype.getReactionForce=function(h){return v.neo(this.m_impulse.x,this.m_impulse.y).mul(h)},c.prototype.getReactionTorque=function(h){return h*this.m_impulse.z},c.prototype.initVelocityConstraints=function(h){this.m_localCenterA=this.m_bodyA.m_sweep.localCenter,this.m_localCenterB=this.m_bodyB.m_sweep.localCenter,this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var m=this.m_bodyA.c_position.a,x=this.m_bodyA.c_velocity.v,S=this.m_bodyA.c_velocity.w,M=this.m_bodyB.c_position.a,D=this.m_bodyB.c_velocity.v,R=this.m_bodyB.c_velocity.w,U=X.neo(m),O=X.neo(M);this.m_rA=X.mulVec2(U,v.sub(this.m_localAnchorA,this.m_localCenterA)),this.m_rB=X.mulVec2(O,v.sub(this.m_localAnchorB,this.m_localCenterB));var W=this.m_invMassA,V=this.m_invMassB,B=this.m_invIA,F=this.m_invIB,j=B+F===0;if(this.m_mass.ex.x=W+V+this.m_rA.y*this.m_rA.y*B+this.m_rB.y*this.m_rB.y*F,this.m_mass.ey.x=-this.m_rA.y*this.m_rA.x*B-this.m_rB.y*this.m_rB.x*F,this.m_mass.ez.x=-this.m_rA.y*B-this.m_rB.y*F,this.m_mass.ex.y=this.m_mass.ey.x,this.m_mass.ey.y=W+V+this.m_rA.x*this.m_rA.x*B+this.m_rB.x*this.m_rB.x*F,this.m_mass.ez.y=this.m_rA.x*B+this.m_rB.x*F,this.m_mass.ex.z=this.m_mass.ez.x,this.m_mass.ey.z=this.m_mass.ez.y,this.m_mass.ez.z=B+F,this.m_motorMass=B+F,this.m_motorMass>0&&(this.m_motorMass=1/this.m_motorMass),(0==this.m_enableMotor||j)&&(this.m_motorImpulse=0),this.m_enableLimit&&0==j){var ee=M-m-this.m_referenceAngle;oe.abs(this.m_upperAngle-this.m_lowerAngle)<2*He.angularSlop?this.m_limitState=3:ee<=this.m_lowerAngle?(1!=this.m_limitState&&(this.m_impulse.z=0),this.m_limitState=1):ee>=this.m_upperAngle?(2!=this.m_limitState&&(this.m_impulse.z=0),this.m_limitState=2):(this.m_limitState=0,this.m_impulse.z=0)}else this.m_limitState=0;if(h.warmStarting){this.m_impulse.mul(h.dtRatio),this.m_motorImpulse*=h.dtRatio;var Z=v.neo(this.m_impulse.x,this.m_impulse.y);x.subMul(W,Z),S-=B*(v.crossVec2Vec2(this.m_rA,Z)+this.m_motorImpulse+this.m_impulse.z),D.addMul(V,Z),R+=F*(v.crossVec2Vec2(this.m_rB,Z)+this.m_motorImpulse+this.m_impulse.z)}else this.m_impulse.setZero(),this.m_motorImpulse=0;this.m_bodyA.c_velocity.v=x,this.m_bodyA.c_velocity.w=S,this.m_bodyB.c_velocity.v=D,this.m_bodyB.c_velocity.w=R},c.prototype.solveVelocityConstraints=function(h){var m=this.m_bodyA.c_velocity.v,x=this.m_bodyA.c_velocity.w,S=this.m_bodyB.c_velocity.v,M=this.m_bodyB.c_velocity.w,D=this.m_invMassA,R=this.m_invMassB,U=this.m_invIA,O=this.m_invIB,W=U+O===0;if(this.m_enableMotor&&3!=this.m_limitState&&0==W){var F=this.m_motorImpulse,j=h.dt*this.m_maxMotorTorque;this.m_motorImpulse=oe.clamp(this.m_motorImpulse+(B=-this.m_motorMass*(V=M-x-this.m_motorSpeed)),-j,j),x-=U*(B=this.m_motorImpulse-F),M+=O*B}if(this.m_enableLimit&&0!=this.m_limitState&&0==W){var ee=v.zero();ee.addCombine(1,S,1,v.crossNumVec2(M,this.m_rB)),ee.subCombine(1,m,1,v.crossNumVec2(x,this.m_rA));var V=new qt(ee.x,ee.y,M-x),B=qt.neg(this.m_mass.solve33(V));if(3==this.m_limitState)this.m_impulse.add(B);else if(1==this.m_limitState)if(this.m_impulse.z+B.z<0){var se=v.combine(-1,ee,this.m_impulse.z,v.neo(this.m_mass.ez.x,this.m_mass.ez.y)),xe=this.m_mass.solve22(se);B.x=xe.x,B.y=xe.y,B.z=-this.m_impulse.z,this.m_impulse.x+=xe.x,this.m_impulse.y+=xe.y,this.m_impulse.z=0}else this.m_impulse.add(B);else 2==this.m_limitState&&(this.m_impulse.z+B.z>0?(se=v.combine(-1,ee,this.m_impulse.z,v.neo(this.m_mass.ez.x,this.m_mass.ez.y)),xe=this.m_mass.solve22(se),B.x=xe.x,B.y=xe.y,B.z=-this.m_impulse.z,this.m_impulse.x+=xe.x,this.m_impulse.y+=xe.y,this.m_impulse.z=0):this.m_impulse.add(B));var de=v.neo(B.x,B.y);m.subMul(D,de),x-=U*(v.crossVec2Vec2(this.m_rA,de)+B.z),S.addMul(R,de),M+=O*(v.crossVec2Vec2(this.m_rB,de)+B.z)}else(V=v.zero()).addCombine(1,S,1,v.crossNumVec2(M,this.m_rB)),V.subCombine(1,m,1,v.crossNumVec2(x,this.m_rA)),B=this.m_mass.solve22(v.neg(V)),this.m_impulse.x+=B.x,this.m_impulse.y+=B.y,m.subMul(D,B),x-=U*v.crossVec2Vec2(this.m_rA,B),S.addMul(R,B),M+=O*v.crossVec2Vec2(this.m_rB,B);this.m_bodyA.c_velocity.v=m,this.m_bodyA.c_velocity.w=x,this.m_bodyB.c_velocity.v=S,this.m_bodyB.c_velocity.w=M},c.prototype.solvePositionConstraints=function(h){var O,m=this.m_bodyA.c_position.c,x=this.m_bodyA.c_position.a,S=this.m_bodyB.c_position.c,M=this.m_bodyB.c_position.a,D=X.neo(x),R=X.neo(M),U=0;if(this.m_enableLimit&&0!=this.m_limitState&&0==(this.m_invIA+this.m_invIB==0)){var V=M-x-this.m_referenceAngle,B=0;if(3==this.m_limitState){var F=oe.clamp(V-this.m_lowerAngle,-He.maxAngularCorrection,He.maxAngularCorrection);B=-this.m_motorMass*F,U=oe.abs(F)}else 1==this.m_limitState?(U=-(F=V-this.m_lowerAngle),F=oe.clamp(F+He.angularSlop,-He.maxAngularCorrection,0),B=-this.m_motorMass*F):2==this.m_limitState&&(U=F=V-this.m_upperAngle,F=oe.clamp(F-He.angularSlop,0,He.maxAngularCorrection),B=-this.m_motorMass*F);x-=this.m_invIA*B,M+=this.m_invIB*B}D.setAngle(x),R.setAngle(M);var j=X.mulVec2(D,v.sub(this.m_localAnchorA,this.m_localCenterA)),ee=X.mulVec2(R,v.sub(this.m_localAnchorB,this.m_localCenterB));(F=v.zero()).addCombine(1,S,1,ee),F.subCombine(1,m,1,j),O=F.length();var Z=this.m_invMassA,re=this.m_invMassB,se=this.m_invIA,xe=this.m_invIB,de=new bi;de.ex.x=Z+re+se*j.y*j.y+xe*ee.y*ee.y,de.ex.y=-se*j.x*j.y-xe*ee.x*ee.y,de.ey.x=de.ex.y,de.ey.y=Z+re+se*j.x*j.x+xe*ee.x*ee.x;var Ie=v.neg(de.solve(F));return m.subMul(Z,Ie),x-=se*v.crossVec2Vec2(j,Ie),S.addMul(re,Ie),M+=xe*v.crossVec2Vec2(ee,Ie),this.m_bodyA.c_position.c.setVec2(m),this.m_bodyA.c_position.a=x,this.m_bodyB.c_position.c.setVec2(S),this.m_bodyB.c_position.a=M,O<=He.linearSlop&&U<=He.angularSlop},c.TYPE="revolute-joint",c}(Ri),Fm={enableLimit:!1,lowerTranslation:0,upperTranslation:0,enableMotor:!1,maxMotorForce:0,motorSpeed:0},Vr=function(g){function c(h,m,x,S,M){var D=this;return D instanceof c?(h=ge(h,Fm),m=(D=g.call(this,h,m,x)||this).m_bodyA,x=D.m_bodyB,D.m_type=c.TYPE,D.m_localAnchorA=v.clone(S?m.getLocalPoint(S):h.localAnchorA||v.zero()),D.m_localAnchorB=v.clone(S?x.getLocalPoint(S):h.localAnchorB||v.zero()),D.m_localXAxisA=v.clone(M?m.getLocalVector(M):h.localAxisA||v.neo(1,0)),D.m_localXAxisA.normalize(),D.m_localYAxisA=v.crossNumVec2(1,D.m_localXAxisA),D.m_referenceAngle=oe.isFinite(h.referenceAngle)?h.referenceAngle:x.getAngle()-m.getAngle(),D.m_impulse=new qt,D.m_motorMass=0,D.m_motorImpulse=0,D.m_lowerTranslation=h.lowerTranslation,D.m_upperTranslation=h.upperTranslation,D.m_maxMotorForce=h.maxMotorForce,D.m_motorSpeed=h.motorSpeed,D.m_enableLimit=h.enableLimit,D.m_enableMotor=h.enableMotor,D.m_limitState=0,D.m_axis=v.zero(),D.m_perp=v.zero(),D.m_K=new Or,D):new c(h,m,x,S,M)}return Ln(c,g),c.prototype._serialize=function(){return{type:this.m_type,bodyA:this.m_bodyA,bodyB:this.m_bodyB,collideConnected:this.m_collideConnected,lowerTranslation:this.m_lowerTranslation,upperTranslation:this.m_upperTranslation,maxMotorForce:this.m_maxMotorForce,motorSpeed:this.m_motorSpeed,enableLimit:this.m_enableLimit,enableMotor:this.m_enableMotor,localAnchorA:this.m_localAnchorA,localAnchorB:this.m_localAnchorB,localAxisA:this.m_localXAxisA,referenceAngle:this.m_referenceAngle}},c._deserialize=function(h,m,x){return(h=Q({},h)).bodyA=x(sn,h.bodyA,m),h.bodyB=x(sn,h.bodyB,m),h.localAxisA=v.clone(h.localAxisA),new c(h)},c.prototype._setAnchors=function(h){h.anchorA?this.m_localAnchorA.setVec2(this.m_bodyA.getLocalPoint(h.anchorA)):h.localAnchorA&&this.m_localAnchorA.setVec2(h.localAnchorA),h.anchorB?this.m_localAnchorB.setVec2(this.m_bodyB.getLocalPoint(h.anchorB)):h.localAnchorB&&this.m_localAnchorB.setVec2(h.localAnchorB),h.localAxisA&&(this.m_localXAxisA.setVec2(h.localAxisA),this.m_localYAxisA.setVec2(v.crossNumVec2(1,h.localAxisA)))},c.prototype.getLocalAnchorA=function(){return this.m_localAnchorA},c.prototype.getLocalAnchorB=function(){return this.m_localAnchorB},c.prototype.getLocalAxisA=function(){return this.m_localXAxisA},c.prototype.getReferenceAngle=function(){return this.m_referenceAngle},c.prototype.getJointTranslation=function(){var h=this.m_bodyA.getWorldPoint(this.m_localAnchorA),m=this.m_bodyB.getWorldPoint(this.m_localAnchorB),x=v.sub(m,h),S=this.m_bodyA.getWorldVector(this.m_localXAxisA);return v.dot(x,S)},c.prototype.getJointSpeed=function(){var h=this.m_bodyA,m=this.m_bodyB,x=X.mulVec2(h.m_xf.q,v.sub(this.m_localAnchorA,h.m_sweep.localCenter)),S=X.mulVec2(m.m_xf.q,v.sub(this.m_localAnchorB,m.m_sweep.localCenter)),M=v.add(h.m_sweep.c,x),D=v.add(m.m_sweep.c,S),R=v.sub(D,M),U=X.mulVec2(h.m_xf.q,this.m_localXAxisA),O=h.m_linearVelocity,W=m.m_linearVelocity,V=h.m_angularVelocity,B=m.m_angularVelocity;return v.dot(R,v.crossNumVec2(V,U))+v.dot(U,v.sub(v.addCrossNumVec2(W,B,S),v.addCrossNumVec2(O,V,x)))},c.prototype.isLimitEnabled=function(){return this.m_enableLimit},c.prototype.enableLimit=function(h){h!=this.m_enableLimit&&(this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_enableLimit=h,this.m_impulse.z=0)},c.prototype.getLowerLimit=function(){return this.m_lowerTranslation},c.prototype.getUpperLimit=function(){return this.m_upperTranslation},c.prototype.setLimits=function(h,m){(h!=this.m_lowerTranslation||m!=this.m_upperTranslation)&&(this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_lowerTranslation=h,this.m_upperTranslation=m,this.m_impulse.z=0)},c.prototype.isMotorEnabled=function(){return this.m_enableMotor},c.prototype.enableMotor=function(h){this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_enableMotor=h},c.prototype.setMotorSpeed=function(h){this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_motorSpeed=h},c.prototype.setMaxMotorForce=function(h){this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_maxMotorForce=h},c.prototype.getMaxMotorForce=function(){return this.m_maxMotorForce},c.prototype.getMotorSpeed=function(){return this.m_motorSpeed},c.prototype.getMotorForce=function(h){return h*this.m_motorImpulse},c.prototype.getAnchorA=function(){return this.m_bodyA.getWorldPoint(this.m_localAnchorA)},c.prototype.getAnchorB=function(){return this.m_bodyB.getWorldPoint(this.m_localAnchorB)},c.prototype.getReactionForce=function(h){return v.combine(this.m_impulse.x,this.m_perp,this.m_motorImpulse+this.m_impulse.z,this.m_axis).mul(h)},c.prototype.getReactionTorque=function(h){return h*this.m_impulse.y},c.prototype.initVelocityConstraints=function(h){this.m_localCenterA=this.m_bodyA.m_sweep.localCenter,this.m_localCenterB=this.m_bodyB.m_sweep.localCenter,this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var m=this.m_bodyA.c_position.c,S=this.m_bodyA.c_velocity.v,M=this.m_bodyA.c_velocity.w,D=this.m_bodyB.c_position.c,R=this.m_bodyB.c_position.a,U=this.m_bodyB.c_velocity.v,O=this.m_bodyB.c_velocity.w,W=X.neo(this.m_bodyA.c_position.a),V=X.neo(R),B=X.mulVec2(W,v.sub(this.m_localAnchorA,this.m_localCenterA)),F=X.mulVec2(V,v.sub(this.m_localAnchorB,this.m_localCenterB)),j=v.zero();j.addCombine(1,D,1,F),j.subCombine(1,m,1,B);var ee=this.m_invMassA,Z=this.m_invMassB,re=this.m_invIA,se=this.m_invIB;this.m_axis=X.mulVec2(W,this.m_localXAxisA),this.m_a1=v.crossVec2Vec2(v.add(j,B),this.m_axis),this.m_a2=v.crossVec2Vec2(F,this.m_axis),this.m_motorMass=ee+Z+re*this.m_a1*this.m_a1+se*this.m_a2*this.m_a2,this.m_motorMass>0&&(this.m_motorMass=1/this.m_motorMass),this.m_perp=X.mulVec2(W,this.m_localYAxisA),this.m_s1=v.crossVec2Vec2(v.add(j,B),this.m_perp),this.m_s2=v.crossVec2Vec2(F,this.m_perp),v.crossVec2Vec2(B,this.m_perp);var de=re*this.m_s1+se*this.m_s2,Ie=re*this.m_s1*this.m_a1+se*this.m_s2*this.m_a2,Oe=re+se;0==Oe&&(Oe=1);var ze=re*this.m_a1+se*this.m_a2,nt=ee+Z+re*this.m_a1*this.m_a1+se*this.m_a2*this.m_a2;if(this.m_K.ex.set(ee+Z+re*this.m_s1*this.m_s1+se*this.m_s2*this.m_s2,de,Ie),this.m_K.ey.set(de,Oe,ze),this.m_K.ez.set(Ie,ze,nt),this.m_enableLimit){var pt=v.dot(this.m_axis,j);oe.abs(this.m_upperTranslation-this.m_lowerTranslation)<2*He.linearSlop?this.m_limitState=3:pt<=this.m_lowerTranslation?1!=this.m_limitState&&(this.m_limitState=1,this.m_impulse.z=0):pt>=this.m_upperTranslation?2!=this.m_limitState&&(this.m_limitState=2,this.m_impulse.z=0):(this.m_limitState=0,this.m_impulse.z=0)}else this.m_limitState=0,this.m_impulse.z=0;if(0==this.m_enableMotor&&(this.m_motorImpulse=0),h.warmStarting){this.m_impulse.mul(h.dtRatio),this.m_motorImpulse*=h.dtRatio;var $e=v.combine(this.m_impulse.x,this.m_perp,this.m_motorImpulse+this.m_impulse.z,this.m_axis),Ue=this.m_impulse.x*this.m_s1+this.m_impulse.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_a1,Rt=this.m_impulse.x*this.m_s2+this.m_impulse.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_a2;S.subMul(ee,$e),M-=re*Ue,U.addMul(Z,$e),O+=se*Rt}else this.m_impulse.setZero(),this.m_motorImpulse=0;this.m_bodyA.c_velocity.v.setVec2(S),this.m_bodyA.c_velocity.w=M,this.m_bodyB.c_velocity.v.setVec2(U),this.m_bodyB.c_velocity.w=O},c.prototype.solveVelocityConstraints=function(h){var m=this.m_bodyA.c_velocity.v,x=this.m_bodyA.c_velocity.w,S=this.m_bodyB.c_velocity.v,M=this.m_bodyB.c_velocity.w,D=this.m_invMassA,R=this.m_invMassB,U=this.m_invIA,O=this.m_invIB;if(this.m_enableMotor&&3!=this.m_limitState){var W=v.dot(this.m_axis,v.sub(S,m))+this.m_a2*M-this.m_a1*x,V=this.m_motorMass*(this.m_motorSpeed-W),B=this.m_motorImpulse,F=h.dt*this.m_maxMotorForce;this.m_motorImpulse=oe.clamp(this.m_motorImpulse+V,-F,F);var j=v.mulNumVec2(V=this.m_motorImpulse-B,this.m_axis),ee=V*this.m_a1,Z=V*this.m_a2;m.subMul(D,j),x-=U*ee,S.addMul(R,j),M+=O*Z}var re=v.zero();if(re.x+=v.dot(this.m_perp,S)+this.m_s2*M,re.x-=v.dot(this.m_perp,m)+this.m_s1*x,re.y=M-x,this.m_enableLimit&&0!=this.m_limitState){var se=0;se+=v.dot(this.m_axis,S)+this.m_a2*M,se-=v.dot(this.m_axis,m)+this.m_a1*x,W=new qt(re.x,re.y,se);var xe=qt.clone(this.m_impulse),de=this.m_K.solve33(qt.neg(W));this.m_impulse.add(de),1==this.m_limitState?this.m_impulse.z=oe.max(this.m_impulse.z,0):2==this.m_limitState&&(this.m_impulse.z=oe.min(this.m_impulse.z,0));var Ie=v.combine(-1,re,-(this.m_impulse.z-xe.z),v.neo(this.m_K.ez.x,this.m_K.ez.y)),Oe=v.add(this.m_K.solve22(Ie),v.neo(xe.x,xe.y));this.m_impulse.x=Oe.x,this.m_impulse.y=Oe.y,de=qt.sub(this.m_impulse,xe),j=v.combine(de.x,this.m_perp,de.z,this.m_axis),ee=de.x*this.m_s1+de.y+de.z*this.m_a1,Z=de.x*this.m_s2+de.y+de.z*this.m_a2,m.subMul(D,j),x-=U*ee,S.addMul(R,j),M+=O*Z}else de=this.m_K.solve22(v.neg(re)),this.m_impulse.x+=de.x,this.m_impulse.y+=de.y,j=v.mulNumVec2(de.x,this.m_perp),ee=de.x*this.m_s1+de.y,Z=de.x*this.m_s2+de.y,m.subMul(D,j),x-=U*ee,S.addMul(R,j),M+=O*Z;this.m_bodyA.c_velocity.v=m,this.m_bodyA.c_velocity.w=x,this.m_bodyB.c_velocity.v=S,this.m_bodyB.c_velocity.w=M},c.prototype.solvePositionConstraints=function(h){var m=this.m_bodyA.c_position.c,x=this.m_bodyA.c_position.a,S=this.m_bodyB.c_position.c,M=this.m_bodyB.c_position.a,D=X.neo(x),R=X.neo(M),U=this.m_invMassA,O=this.m_invMassB,W=this.m_invIA,V=this.m_invIB,B=X.mulVec2(D,v.sub(this.m_localAnchorA,this.m_localCenterA)),F=X.mulVec2(R,v.sub(this.m_localAnchorB,this.m_localCenterB)),j=v.sub(v.add(S,F),v.add(m,B)),ee=X.mulVec2(D,this.m_localXAxisA),Z=v.crossVec2Vec2(v.add(j,B),ee),re=v.crossVec2Vec2(F,ee),se=X.mulVec2(D,this.m_localYAxisA),xe=v.crossVec2Vec2(v.add(j,B),se),de=v.crossVec2Vec2(F,se),Ie=new qt,Oe=v.zero();Oe.x=v.dot(se,j),Oe.y=M-x-this.m_referenceAngle;var ze=oe.abs(Oe.x),nt=oe.abs(Oe.y),pt=He.linearSlop,$e=He.maxLinearCorrection,Ue=!1,Rt=0;if(this.m_enableLimit){var Tt=v.dot(ee,j);oe.abs(this.m_upperTranslation-this.m_lowerTranslation)<2*pt?(Rt=oe.clamp(Tt,-$e,$e),ze=oe.max(ze,oe.abs(Tt)),Ue=!0):Tt<=this.m_lowerTranslation?(Rt=oe.clamp(Tt-this.m_lowerTranslation+pt,-$e,0),ze=oe.max(ze,this.m_lowerTranslation-Tt),Ue=!0):Tt>=this.m_upperTranslation&&(Rt=oe.clamp(Tt-this.m_upperTranslation-pt,0,$e),ze=oe.max(ze,Tt-this.m_upperTranslation),Ue=!0)}if(Ue){var Gt=U+O+W*xe*xe+V*de*de,En=W*xe+V*de,rt=W*xe*Z+V*de*re;0==(_n=W+V)&&(_n=1);var bt=W*Z+V*re,dt=U+O+W*Z*Z+V*re*re;(Ut=new Or).ex.set(Gt,En,rt),Ut.ey.set(En,_n,bt),Ut.ez.set(rt,bt,dt);var At=new qt;At.x=Oe.x,At.y=Oe.y,At.z=Rt,Ie=Ut.solve33(qt.neg(At))}else{var _n,Ut;Gt=U+O+W*xe*xe+V*de*de,En=W*xe+V*de,0==(_n=W+V)&&(_n=1),(Ut=new bi).ex.setNum(Gt,En),Ut.ey.setNum(En,_n);var zt=Ut.solve(v.neg(Oe));Ie.x=zt.x,Ie.y=zt.y,Ie.z=0}var lr=v.combine(Ie.x,se,Ie.z,ee),kr=Ie.x*xe+Ie.y+Ie.z*Z,Pi=Ie.x*de+Ie.y+Ie.z*re;return m.subMul(U,lr),x-=W*kr,S.addMul(O,lr),M+=V*Pi,this.m_bodyA.c_position.c=m,this.m_bodyA.c_position.a=x,this.m_bodyB.c_position.c=S,this.m_bodyB.c_position.a=M,ze<=He.linearSlop&&nt<=He.angularSlop},c.TYPE="prismatic-joint",c}(Ri),Om={ratio:1},wl=function(g){function c(h,m,x,S,M,D){var U,O,R=this;if(!(R instanceof c))return new c(h,m,x,S,M,D);h=ge(h,Om),m=(R=g.call(this,h,m,x)||this).m_bodyA,x=R.m_bodyB,R.m_type=c.TYPE,R.m_joint1=S||h.joint1,R.m_joint2=M||h.joint2,R.m_ratio=oe.isFinite(D)?D:h.ratio,R.m_type1=R.m_joint1.getType(),R.m_type2=R.m_joint2.getType(),R.m_bodyC=R.m_joint1.getBodyA(),R.m_bodyA=R.m_joint1.getBodyB();var W=R.m_bodyA.m_xf,V=R.m_bodyA.m_sweep.a,B=R.m_bodyC.m_xf,F=R.m_bodyC.m_sweep.a;if(R.m_type1===is.TYPE)R.m_localAnchorC=(j=R.m_joint1).m_localAnchorA,R.m_localAnchorA=j.m_localAnchorB,R.m_referenceAngleA=j.m_referenceAngle,R.m_localAxisC=v.zero(),U=V-F-R.m_referenceAngleA;else{R.m_localAnchorC=(ee=R.m_joint1).m_localAnchorA,R.m_localAnchorA=ee.m_localAnchorB,R.m_referenceAngleA=ee.m_referenceAngle,R.m_localAxisC=ee.m_localXAxisA;var Z=R.m_localAnchorC,re=X.mulTVec2(B.q,v.add(X.mulVec2(W.q,R.m_localAnchorA),v.sub(W.p,B.p)));U=v.dot(re,R.m_localAxisC)-v.dot(Z,R.m_localAxisC)}R.m_bodyD=R.m_joint2.getBodyA(),R.m_bodyB=R.m_joint2.getBodyB();var se=R.m_bodyB.m_xf,xe=R.m_bodyB.m_sweep.a,de=R.m_bodyD.m_xf,Ie=R.m_bodyD.m_sweep.a;if(R.m_type2===is.TYPE){var j;R.m_localAnchorD=(j=R.m_joint2).m_localAnchorA,R.m_localAnchorB=j.m_localAnchorB,R.m_referenceAngleB=j.m_referenceAngle,R.m_localAxisD=v.zero(),O=xe-Ie-R.m_referenceAngleB}else{var ee;R.m_localAnchorD=(ee=R.m_joint2).m_localAnchorA,R.m_localAnchorB=ee.m_localAnchorB,R.m_referenceAngleB=ee.m_referenceAngle,R.m_localAxisD=ee.m_localXAxisA;var Oe=R.m_localAnchorD,ze=X.mulTVec2(de.q,v.add(X.mulVec2(se.q,R.m_localAnchorB),v.sub(se.p,de.p)));O=v.dot(ze,R.m_localAxisD)-v.dot(Oe,R.m_localAxisD)}return R.m_constant=U+R.m_ratio*O,R.m_impulse=0,R}return Ln(c,g),c.prototype._serialize=function(){return{type:this.m_type,bodyA:this.m_bodyA,bodyB:this.m_bodyB,collideConnected:this.m_collideConnected,joint1:this.m_joint1,joint2:this.m_joint2,ratio:this.m_ratio}},c._deserialize=function(h,m,x){return(h=Q({},h)).bodyA=x(sn,h.bodyA,m),h.bodyB=x(sn,h.bodyB,m),h.joint1=x(Ri,h.joint1,m),h.joint2=x(Ri,h.joint2,m),new c(h)},c.prototype.getJoint1=function(){return this.m_joint1},c.prototype.getJoint2=function(){return this.m_joint2},c.prototype.setRatio=function(h){this.m_ratio=h},c.prototype.getRatio=function(){return this.m_ratio},c.prototype.getAnchorA=function(){return this.m_bodyA.getWorldPoint(this.m_localAnchorA)},c.prototype.getAnchorB=function(){return this.m_bodyB.getWorldPoint(this.m_localAnchorB)},c.prototype.getReactionForce=function(h){return v.mulNumVec2(this.m_impulse,this.m_JvAC).mul(h)},c.prototype.getReactionTorque=function(h){return h*(this.m_impulse*this.m_JwA)},c.prototype.initVelocityConstraints=function(h){this.m_lcA=this.m_bodyA.m_sweep.localCenter,this.m_lcB=this.m_bodyB.m_sweep.localCenter,this.m_lcC=this.m_bodyC.m_sweep.localCenter,this.m_lcD=this.m_bodyD.m_sweep.localCenter,this.m_mA=this.m_bodyA.m_invMass,this.m_mB=this.m_bodyB.m_invMass,this.m_mC=this.m_bodyC.m_invMass,this.m_mD=this.m_bodyD.m_invMass,this.m_iA=this.m_bodyA.m_invI,this.m_iB=this.m_bodyB.m_invI,this.m_iC=this.m_bodyC.m_invI,this.m_iD=this.m_bodyD.m_invI;var x=this.m_bodyA.c_velocity.v,S=this.m_bodyA.c_velocity.w,M=this.m_bodyB.c_position.a,D=this.m_bodyB.c_velocity.v,R=this.m_bodyB.c_velocity.w,U=this.m_bodyC.c_position.a,O=this.m_bodyC.c_velocity.v,W=this.m_bodyC.c_velocity.w,V=this.m_bodyD.c_position.a,B=this.m_bodyD.c_velocity.v,F=this.m_bodyD.c_velocity.w,j=X.neo(this.m_bodyA.c_position.a),ee=X.neo(M),Z=X.neo(U),re=X.neo(V);if(this.m_mass=0,this.m_type1==is.TYPE)this.m_JvAC=v.zero(),this.m_JwA=1,this.m_JwC=1,this.m_mass+=this.m_iA+this.m_iC;else{var se=X.mulVec2(Z,this.m_localAxisC),xe=X.mulSub(Z,this.m_localAnchorC,this.m_lcC),de=X.mulSub(j,this.m_localAnchorA,this.m_lcA);this.m_JvAC=se,this.m_JwC=v.crossVec2Vec2(xe,se),this.m_JwA=v.crossVec2Vec2(de,se),this.m_mass+=this.m_mC+this.m_mA+this.m_iC*this.m_JwC*this.m_JwC+this.m_iA*this.m_JwA*this.m_JwA}if(this.m_type2==is.TYPE)this.m_JvBD=v.zero(),this.m_JwB=this.m_ratio,this.m_JwD=this.m_ratio,this.m_mass+=this.m_ratio*this.m_ratio*(this.m_iB+this.m_iD);else{se=X.mulVec2(re,this.m_localAxisD);var Ie=X.mulSub(re,this.m_localAnchorD,this.m_lcD),Oe=X.mulSub(ee,this.m_localAnchorB,this.m_lcB);this.m_JvBD=v.mulNumVec2(this.m_ratio,se),this.m_JwD=this.m_ratio*v.crossVec2Vec2(Ie,se),this.m_JwB=this.m_ratio*v.crossVec2Vec2(Oe,se),this.m_mass+=this.m_ratio*this.m_ratio*(this.m_mD+this.m_mB)+this.m_iD*this.m_JwD*this.m_JwD+this.m_iB*this.m_JwB*this.m_JwB}this.m_mass=this.m_mass>0?1/this.m_mass:0,h.warmStarting?(x.addMul(this.m_mA*this.m_impulse,this.m_JvAC),S+=this.m_iA*this.m_impulse*this.m_JwA,D.addMul(this.m_mB*this.m_impulse,this.m_JvBD),R+=this.m_iB*this.m_impulse*this.m_JwB,O.subMul(this.m_mC*this.m_impulse,this.m_JvAC),W-=this.m_iC*this.m_impulse*this.m_JwC,B.subMul(this.m_mD*this.m_impulse,this.m_JvBD),F-=this.m_iD*this.m_impulse*this.m_JwD):this.m_impulse=0,this.m_bodyA.c_velocity.v.setVec2(x),this.m_bodyA.c_velocity.w=S,this.m_bodyB.c_velocity.v.setVec2(D),this.m_bodyB.c_velocity.w=R,this.m_bodyC.c_velocity.v.setVec2(O),this.m_bodyC.c_velocity.w=W,this.m_bodyD.c_velocity.v.setVec2(B),this.m_bodyD.c_velocity.w=F},c.prototype.solveVelocityConstraints=function(h){var m=this.m_bodyA.c_velocity.v,x=this.m_bodyA.c_velocity.w,S=this.m_bodyB.c_velocity.v,M=this.m_bodyB.c_velocity.w,D=this.m_bodyC.c_velocity.v,R=this.m_bodyC.c_velocity.w,U=this.m_bodyD.c_velocity.v,O=this.m_bodyD.c_velocity.w,W=v.dot(this.m_JvAC,m)-v.dot(this.m_JvAC,D)+v.dot(this.m_JvBD,S)-v.dot(this.m_JvBD,U),V=-this.m_mass*(W+=this.m_JwA*x-this.m_JwC*R+(this.m_JwB*M-this.m_JwD*O));this.m_impulse+=V,m.addMul(this.m_mA*V,this.m_JvAC),x+=this.m_iA*V*this.m_JwA,S.addMul(this.m_mB*V,this.m_JvBD),M+=this.m_iB*V*this.m_JwB,D.subMul(this.m_mC*V,this.m_JvAC),R-=this.m_iC*V*this.m_JwC,U.subMul(this.m_mD*V,this.m_JvBD),O-=this.m_iD*V*this.m_JwD,this.m_bodyA.c_velocity.v.setVec2(m),this.m_bodyA.c_velocity.w=x,this.m_bodyB.c_velocity.v.setVec2(S),this.m_bodyB.c_velocity.w=M,this.m_bodyC.c_velocity.v.setVec2(D),this.m_bodyC.c_velocity.w=R,this.m_bodyD.c_velocity.v.setVec2(U),this.m_bodyD.c_velocity.w=O},c.prototype.solvePositionConstraints=function(h){var ee,Z,re,se,xe,de,Ie,Oe,m=this.m_bodyA.c_position.c,x=this.m_bodyA.c_position.a,S=this.m_bodyB.c_position.c,M=this.m_bodyB.c_position.a,D=this.m_bodyC.c_position.c,R=this.m_bodyC.c_position.a,U=this.m_bodyD.c_position.c,O=this.m_bodyD.c_position.a,W=X.neo(x),V=X.neo(M),B=X.neo(R),F=X.neo(O),ze=0;if(this.m_type1==is.TYPE)re=v.zero(),xe=1,Ie=1,ze+=this.m_iA+this.m_iC,ee=x-R-this.m_referenceAngleA;else{var nt=X.mulVec2(B,this.m_localAxisC),pt=X.mulSub(B,this.m_localAnchorC,this.m_lcC),$e=X.mulSub(W,this.m_localAnchorA,this.m_lcA);re=nt,Ie=v.crossVec2Vec2(pt,nt),xe=v.crossVec2Vec2($e,nt),ze+=this.m_mC+this.m_mA+this.m_iC*Ie*Ie+this.m_iA*xe*xe;var Ue=v.sub(this.m_localAnchorC,this.m_lcC),Rt=X.mulTVec2(B,v.add($e,v.sub(m,D)));ee=v.dot(v.sub(Rt,Ue),this.m_localAxisC)}if(this.m_type2==is.TYPE)se=v.zero(),de=this.m_ratio,Oe=this.m_ratio,ze+=this.m_ratio*this.m_ratio*(this.m_iB+this.m_iD),Z=M-O-this.m_referenceAngleB;else{nt=X.mulVec2(F,this.m_localAxisD);var Tt=X.mulSub(F,this.m_localAnchorD,this.m_lcD),Gt=X.mulSub(V,this.m_localAnchorB,this.m_lcB);se=v.mulNumVec2(this.m_ratio,nt),Oe=this.m_ratio*v.crossVec2Vec2(Tt,nt),de=this.m_ratio*v.crossVec2Vec2(Gt,nt),ze+=this.m_ratio*this.m_ratio*(this.m_mD+this.m_mB)+this.m_iD*Oe*Oe+this.m_iB*de*de;var En=v.sub(this.m_localAnchorD,this.m_lcD),rt=X.mulTVec2(F,v.add(Gt,v.sub(S,U)));Z=v.dot(rt,this.m_localAxisD)-v.dot(En,this.m_localAxisD)}var bt=0;return ze>0&&(bt=-(ee+this.m_ratio*Z-this.m_constant)/ze),m.addMul(this.m_mA*bt,re),x+=this.m_iA*bt*xe,S.addMul(this.m_mB*bt,se),M+=this.m_iB*bt*de,D.subMul(this.m_mC*bt,re),R-=this.m_iC*bt*Ie,U.subMul(this.m_mD*bt,se),O-=this.m_iD*bt*Oe,this.m_bodyA.c_position.c.setVec2(m),this.m_bodyA.c_position.a=x,this.m_bodyB.c_position.c.setVec2(S),this.m_bodyB.c_position.a=M,this.m_bodyC.c_position.c.setVec2(D),this.m_bodyC.c_position.a=R,this.m_bodyD.c_position.c.setVec2(U),this.m_bodyD.c_position.a=O,0<He.linearSlop},c.TYPE="gear-joint",c}(Ri),Vm={maxForce:1,maxTorque:1,correctionFactor:.3},Ml=function(g){function c(h,m,x){var S=this;return S instanceof c?(h=ge(h,Vm),m=(S=g.call(this,h,m,x)||this).m_bodyA,x=S.m_bodyB,S.m_type=c.TYPE,S.m_linearOffset=oe.isFinite(h.linearOffset)?h.linearOffset:m.getLocalPoint(x.getPosition()),S.m_angularOffset=oe.isFinite(h.angularOffset)?h.angularOffset:x.getAngle()-m.getAngle(),S.m_linearImpulse=v.zero(),S.m_angularImpulse=0,S.m_maxForce=h.maxForce,S.m_maxTorque=h.maxTorque,S.m_correctionFactor=h.correctionFactor,S):new c(h,m,x)}return Ln(c,g),c.prototype._serialize=function(){return{type:this.m_type,bodyA:this.m_bodyA,bodyB:this.m_bodyB,collideConnected:this.m_collideConnected,maxForce:this.m_maxForce,maxTorque:this.m_maxTorque,correctionFactor:this.m_correctionFactor,linearOffset:this.m_linearOffset,angularOffset:this.m_angularOffset}},c._deserialize=function(h,m,x){return(h=Q({},h)).bodyA=x(sn,h.bodyA,m),h.bodyB=x(sn,h.bodyB,m),new c(h)},c.prototype._setAnchors=function(h){},c.prototype.setMaxForce=function(h){this.m_maxForce=h},c.prototype.getMaxForce=function(){return this.m_maxForce},c.prototype.setMaxTorque=function(h){this.m_maxTorque=h},c.prototype.getMaxTorque=function(){return this.m_maxTorque},c.prototype.setCorrectionFactor=function(h){this.m_correctionFactor=h},c.prototype.getCorrectionFactor=function(){return this.m_correctionFactor},c.prototype.setLinearOffset=function(h){(h.x!=this.m_linearOffset.x||h.y!=this.m_linearOffset.y)&&(this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_linearOffset=h)},c.prototype.getLinearOffset=function(){return this.m_linearOffset},c.prototype.setAngularOffset=function(h){h!=this.m_angularOffset&&(this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_angularOffset=h)},c.prototype.getAngularOffset=function(){return this.m_angularOffset},c.prototype.getAnchorA=function(){return this.m_bodyA.getPosition()},c.prototype.getAnchorB=function(){return this.m_bodyB.getPosition()},c.prototype.getReactionForce=function(h){return v.mulNumVec2(h,this.m_linearImpulse)},c.prototype.getReactionTorque=function(h){return h*this.m_angularImpulse},c.prototype.initVelocityConstraints=function(h){this.m_localCenterA=this.m_bodyA.m_sweep.localCenter,this.m_localCenterB=this.m_bodyB.m_sweep.localCenter,this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var m=this.m_bodyA.c_position.c,x=this.m_bodyA.c_position.a,S=this.m_bodyA.c_velocity.v,M=this.m_bodyA.c_velocity.w,D=this.m_bodyB.c_position.c,R=this.m_bodyB.c_position.a,U=this.m_bodyB.c_velocity.v,O=this.m_bodyB.c_velocity.w,W=X.neo(x),V=X.neo(R);this.m_rA=X.mulVec2(W,v.neg(this.m_localCenterA)),this.m_rB=X.mulVec2(V,v.neg(this.m_localCenterB));var B=this.m_invMassA,F=this.m_invMassB,j=this.m_invIA,ee=this.m_invIB,Z=new bi;if(Z.ex.x=B+F+j*this.m_rA.y*this.m_rA.y+ee*this.m_rB.y*this.m_rB.y,Z.ex.y=-j*this.m_rA.x*this.m_rA.y-ee*this.m_rB.x*this.m_rB.y,Z.ey.x=Z.ex.y,Z.ey.y=B+F+j*this.m_rA.x*this.m_rA.x+ee*this.m_rB.x*this.m_rB.x,this.m_linearMass=Z.getInverse(),this.m_angularMass=j+ee,this.m_angularMass>0&&(this.m_angularMass=1/this.m_angularMass),this.m_linearError=v.zero(),this.m_linearError.addCombine(1,D,1,this.m_rB),this.m_linearError.subCombine(1,m,1,this.m_rA),this.m_linearError.sub(X.mulVec2(W,this.m_linearOffset)),this.m_angularError=R-x-this.m_angularOffset,h.warmStarting){this.m_linearImpulse.mul(h.dtRatio),this.m_angularImpulse*=h.dtRatio;var re=v.neo(this.m_linearImpulse.x,this.m_linearImpulse.y);S.subMul(B,re),M-=j*(v.crossVec2Vec2(this.m_rA,re)+this.m_angularImpulse),U.addMul(F,re),O+=ee*(v.crossVec2Vec2(this.m_rB,re)+this.m_angularImpulse)}else this.m_linearImpulse.setZero(),this.m_angularImpulse=0;this.m_bodyA.c_velocity.v=S,this.m_bodyA.c_velocity.w=M,this.m_bodyB.c_velocity.v=U,this.m_bodyB.c_velocity.w=O},c.prototype.solveVelocityConstraints=function(h){var B,m=this.m_bodyA.c_velocity.v,x=this.m_bodyA.c_velocity.w,S=this.m_bodyB.c_velocity.v,M=this.m_bodyB.c_velocity.w,D=this.m_invMassA,R=this.m_invMassB,U=this.m_invIA,O=this.m_invIB,W=h.dt,V=h.inv_dt,j=this.m_angularImpulse;this.m_angularImpulse=oe.clamp(this.m_angularImpulse+(F=-this.m_angularMass*(B=M-x+V*this.m_correctionFactor*this.m_angularError)),-(ee=W*this.m_maxTorque),ee),x-=U*(F=this.m_angularImpulse-j),M+=O*F,(B=v.zero()).addCombine(1,S,1,v.crossNumVec2(M,this.m_rB)),B.subCombine(1,m,1,v.crossNumVec2(x,this.m_rA)),B.addMul(V*this.m_correctionFactor,this.m_linearError);var ee,F=v.neg(bi.mulVec2(this.m_linearMass,B));j=v.clone(this.m_linearImpulse),this.m_linearImpulse.add(F),this.m_linearImpulse.clamp(ee=W*this.m_maxForce),F=v.sub(this.m_linearImpulse,j),m.subMul(D,F),x-=U*v.crossVec2Vec2(this.m_rA,F),S.addMul(R,F),M+=O*v.crossVec2Vec2(this.m_rB,F),this.m_bodyA.c_velocity.v=m,this.m_bodyA.c_velocity.w=x,this.m_bodyB.c_velocity.v=S,this.m_bodyB.c_velocity.w=M},c.prototype.solvePositionConstraints=function(h){return!0},c.TYPE="motor-joint",c}(Ri),ax={maxForce:0,frequencyHz:5,dampingRatio:.7},xu=function(g){function c(h,m,x,S){var M=this;return M instanceof c?(h=ge(h,ax),m=(M=g.call(this,h,m,x)||this).m_bodyA,x=M.m_bodyB,M.m_type=c.TYPE,M.m_targetA=S?v.clone(S):h.target||v.zero(),M.m_localAnchorB=ne.mulTVec2(x.getTransform(),M.m_targetA),M.m_maxForce=h.maxForce,M.m_impulse=v.zero(),M.m_frequencyHz=h.frequencyHz,M.m_dampingRatio=h.dampingRatio,M.m_beta=0,M.m_gamma=0,M.m_rB=v.zero(),M.m_localCenterB=v.zero(),M.m_invMassB=0,M.m_invIB=0,M.m_mass=new bi,M.m_C=v.zero(),M):new c(h,m,x,S)}return Ln(c,g),c.prototype._serialize=function(){return{type:this.m_type,bodyA:this.m_bodyA,bodyB:this.m_bodyB,collideConnected:this.m_collideConnected,target:this.m_targetA,maxForce:this.m_maxForce,frequencyHz:this.m_frequencyHz,dampingRatio:this.m_dampingRatio,_localAnchorB:this.m_localAnchorB}},c._deserialize=function(h,m,x){(h=Q({},h)).bodyA=x(sn,h.bodyA,m),h.bodyB=x(sn,h.bodyB,m),h.target=v.clone(h.target);var S=new c(h);return h._localAnchorB&&(S.m_localAnchorB=h._localAnchorB),S},c.prototype.setTarget=function(h){0==this.m_bodyB.isAwake()&&this.m_bodyB.setAwake(!0),this.m_targetA=v.clone(h)},c.prototype.getTarget=function(){return this.m_targetA},c.prototype.setMaxForce=function(h){this.m_maxForce=h},c.prototype.getMaxForce=function(){return this.m_maxForce},c.prototype.setFrequency=function(h){this.m_frequencyHz=h},c.prototype.getFrequency=function(){return this.m_frequencyHz},c.prototype.setDampingRatio=function(h){this.m_dampingRatio=h},c.prototype.getDampingRatio=function(){return this.m_dampingRatio},c.prototype.getAnchorA=function(){return v.clone(this.m_targetA)},c.prototype.getAnchorB=function(){return this.m_bodyB.getWorldPoint(this.m_localAnchorB)},c.prototype.getReactionForce=function(h){return v.mulNumVec2(h,this.m_impulse)},c.prototype.getReactionTorque=function(h){return 0*h},c.prototype.shiftOrigin=function(h){this.m_targetA.sub(h)},c.prototype.initVelocityConstraints=function(h){this.m_localCenterB=this.m_bodyB.m_sweep.localCenter,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIB=this.m_bodyB.m_invI;var m=this.m_bodyB.c_position,x=this.m_bodyB.c_velocity,S=m.c,D=x.v,R=x.w,U=X.neo(m.a),O=this.m_bodyB.getMass(),W=2*oe.PI*this.m_frequencyHz,B=O*(W*W),F=h.dt;this.m_gamma=F*(2*O*this.m_dampingRatio*W+F*B),0!=this.m_gamma&&(this.m_gamma=1/this.m_gamma),this.m_beta=F*B*this.m_gamma,this.m_rB=X.mulVec2(U,v.sub(this.m_localAnchorB,this.m_localCenterB));var j=new bi;j.ex.x=this.m_invMassB+this.m_invIB*this.m_rB.y*this.m_rB.y+this.m_gamma,j.ex.y=-this.m_invIB*this.m_rB.x*this.m_rB.y,j.ey.x=j.ex.y,j.ey.y=this.m_invMassB+this.m_invIB*this.m_rB.x*this.m_rB.x+this.m_gamma,this.m_mass=j.getInverse(),this.m_C.setVec2(S),this.m_C.addCombine(1,this.m_rB,-1,this.m_targetA),this.m_C.mul(this.m_beta),R*=.98,h.warmStarting?(this.m_impulse.mul(h.dtRatio),D.addMul(this.m_invMassB,this.m_impulse),R+=this.m_invIB*v.crossVec2Vec2(this.m_rB,this.m_impulse)):this.m_impulse.setZero(),x.v.setVec2(D),x.w=R},c.prototype.solveVelocityConstraints=function(h){var m=this.m_bodyB.c_velocity,x=v.clone(m.v),S=m.w,M=v.crossNumVec2(S,this.m_rB);M.add(x),M.addCombine(1,this.m_C,this.m_gamma,this.m_impulse),M.neg();var D=bi.mulVec2(this.m_mass,M),R=v.clone(this.m_impulse);this.m_impulse.add(D),this.m_impulse.clamp(h.dt*this.m_maxForce),D=v.sub(this.m_impulse,R),x.addMul(this.m_invMassB,D),S+=this.m_invIB*v.crossVec2Vec2(this.m_rB,D),m.v.setVec2(x),m.w=S},c.prototype.solvePositionConstraints=function(h){return!0},c.TYPE="mouse-joint",c}(Ri),km={collideConnected:!0},ga=function(g){function c(h,m,x,S,M,D,R,U){var O=this;return O instanceof c?(h=ge(h,km),m=(O=g.call(this,h,m,x)||this).m_bodyA,x=O.m_bodyB,O.m_type=c.TYPE,O.m_groundAnchorA=S||h.groundAnchorA||v.neo(-1,1),O.m_groundAnchorB=M||h.groundAnchorB||v.neo(1,1),O.m_localAnchorA=D?m.getLocalPoint(D):h.localAnchorA||v.neo(-1,0),O.m_localAnchorB=R?x.getLocalPoint(R):h.localAnchorB||v.neo(1,0),O.m_lengthA=oe.isFinite(h.lengthA)?h.lengthA:v.distance(D,S),O.m_lengthB=oe.isFinite(h.lengthB)?h.lengthB:v.distance(R,M),O.m_ratio=oe.isFinite(U)?U:h.ratio,O.m_constant=O.m_lengthA+O.m_ratio*O.m_lengthB,O.m_impulse=0,O):new c(h,m,x,S,M,D,R,U)}return Ln(c,g),c.prototype._serialize=function(){return{type:this.m_type,bodyA:this.m_bodyA,bodyB:this.m_bodyB,collideConnected:this.m_collideConnected,groundAnchorA:this.m_groundAnchorA,groundAnchorB:this.m_groundAnchorB,localAnchorA:this.m_localAnchorA,localAnchorB:this.m_localAnchorB,lengthA:this.m_lengthA,lengthB:this.m_lengthB,ratio:this.m_ratio}},c._deserialize=function(h,m,x){return(h=Q({},h)).bodyA=x(sn,h.bodyA,m),h.bodyB=x(sn,h.bodyB,m),new c(h)},c.prototype.getGroundAnchorA=function(){return this.m_groundAnchorA},c.prototype.getGroundAnchorB=function(){return this.m_groundAnchorB},c.prototype.getLengthA=function(){return this.m_lengthA},c.prototype.getLengthB=function(){return this.m_lengthB},c.prototype.getRatio=function(){return this.m_ratio},c.prototype.getCurrentLengthA=function(){var h=this.m_bodyA.getWorldPoint(this.m_localAnchorA);return v.distance(h,this.m_groundAnchorA)},c.prototype.getCurrentLengthB=function(){var h=this.m_bodyB.getWorldPoint(this.m_localAnchorB);return v.distance(h,this.m_groundAnchorB)},c.prototype.shiftOrigin=function(h){this.m_groundAnchorA.sub(h),this.m_groundAnchorB.sub(h)},c.prototype.getAnchorA=function(){return this.m_bodyA.getWorldPoint(this.m_localAnchorA)},c.prototype.getAnchorB=function(){return this.m_bodyB.getWorldPoint(this.m_localAnchorB)},c.prototype.getReactionForce=function(h){return v.mulNumVec2(this.m_impulse,this.m_uB).mul(h)},c.prototype.getReactionTorque=function(h){return 0},c.prototype.initVelocityConstraints=function(h){this.m_localCenterA=this.m_bodyA.m_sweep.localCenter,this.m_localCenterB=this.m_bodyB.m_sweep.localCenter,this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var m=this.m_bodyA.c_position.c,S=this.m_bodyA.c_velocity.v,M=this.m_bodyA.c_velocity.w,D=this.m_bodyB.c_position.c,R=this.m_bodyB.c_position.a,U=this.m_bodyB.c_velocity.v,O=this.m_bodyB.c_velocity.w,W=X.neo(this.m_bodyA.c_position.a),V=X.neo(R);this.m_rA=X.mulVec2(W,v.sub(this.m_localAnchorA,this.m_localCenterA)),this.m_rB=X.mulVec2(V,v.sub(this.m_localAnchorB,this.m_localCenterB)),this.m_uA=v.sub(v.add(m,this.m_rA),this.m_groundAnchorA),this.m_uB=v.sub(v.add(D,this.m_rB),this.m_groundAnchorB);var B=this.m_uA.length(),F=this.m_uB.length();B>10*He.linearSlop?this.m_uA.mul(1/B):this.m_uA.setZero(),F>10*He.linearSlop?this.m_uB.mul(1/F):this.m_uB.setZero();var j=v.crossVec2Vec2(this.m_rA,this.m_uA),ee=v.crossVec2Vec2(this.m_rB,this.m_uB);if(this.m_mass=this.m_invMassA+this.m_invIA*j*j+this.m_ratio*this.m_ratio*(this.m_invMassB+this.m_invIB*ee*ee),this.m_mass>0&&(this.m_mass=1/this.m_mass),h.warmStarting){this.m_impulse*=h.dtRatio;var se=v.mulNumVec2(-this.m_impulse,this.m_uA),xe=v.mulNumVec2(-this.m_ratio*this.m_impulse,this.m_uB);S.addMul(this.m_invMassA,se),M+=this.m_invIA*v.crossVec2Vec2(this.m_rA,se),U.addMul(this.m_invMassB,xe),O+=this.m_invIB*v.crossVec2Vec2(this.m_rB,xe)}else this.m_impulse=0;this.m_bodyA.c_velocity.v=S,this.m_bodyA.c_velocity.w=M,this.m_bodyB.c_velocity.v=U,this.m_bodyB.c_velocity.w=O},c.prototype.solveVelocityConstraints=function(h){var m=this.m_bodyA.c_velocity.v,x=this.m_bodyA.c_velocity.w,S=this.m_bodyB.c_velocity.v,M=this.m_bodyB.c_velocity.w,D=v.add(m,v.crossNumVec2(x,this.m_rA)),R=v.add(S,v.crossNumVec2(M,this.m_rB)),U=-v.dot(this.m_uA,D)-this.m_ratio*v.dot(this.m_uB,R),O=-this.m_mass*U;this.m_impulse+=O;var W=v.mulNumVec2(-O,this.m_uA),V=v.mulNumVec2(-this.m_ratio*O,this.m_uB);m.addMul(this.m_invMassA,W),x+=this.m_invIA*v.crossVec2Vec2(this.m_rA,W),S.addMul(this.m_invMassB,V),M+=this.m_invIB*v.crossVec2Vec2(this.m_rB,V),this.m_bodyA.c_velocity.v=m,this.m_bodyA.c_velocity.w=x,this.m_bodyB.c_velocity.v=S,this.m_bodyB.c_velocity.w=M},c.prototype.solvePositionConstraints=function(h){var m=this.m_bodyA.c_position.c,x=this.m_bodyA.c_position.a,S=this.m_bodyB.c_position.c,M=this.m_bodyB.c_position.a,D=X.neo(x),R=X.neo(M),U=X.mulVec2(D,v.sub(this.m_localAnchorA,this.m_localCenterA)),O=X.mulVec2(R,v.sub(this.m_localAnchorB,this.m_localCenterB)),W=v.sub(v.add(m,this.m_rA),this.m_groundAnchorA),V=v.sub(v.add(S,this.m_rB),this.m_groundAnchorB),B=W.length(),F=V.length();B>10*He.linearSlop?W.mul(1/B):W.setZero(),F>10*He.linearSlop?V.mul(1/F):V.setZero();var j=v.crossVec2Vec2(U,W),ee=v.crossVec2Vec2(O,V),se=this.m_invMassA+this.m_invIA*j*j+this.m_ratio*this.m_ratio*(this.m_invMassB+this.m_invIB*ee*ee);se>0&&(se=1/se);var xe=this.m_constant-B-this.m_ratio*F,de=oe.abs(xe),Ie=-se*xe,Oe=v.mulNumVec2(-Ie,W),ze=v.mulNumVec2(-this.m_ratio*Ie,V);return m.addMul(this.m_invMassA,Oe),x+=this.m_invIA*v.crossVec2Vec2(U,Oe),S.addMul(this.m_invMassB,ze),M+=this.m_invIB*v.crossVec2Vec2(O,ze),this.m_bodyA.c_position.c=m,this.m_bodyA.c_position.a=x,this.m_bodyB.c_position.c=S,this.m_bodyB.c_position.a=M,de<He.linearSlop},c.TYPE="pulley-joint",c}(Ri),zm={maxLength:0},Sl=function(g){function c(h,m,x,S){var M=this;return M instanceof c?(h=ge(h,zm),m=(M=g.call(this,h,m,x)||this).m_bodyA,x=M.m_bodyB,M.m_type=c.TYPE,M.m_localAnchorA=S?m.getLocalPoint(S):h.localAnchorA||v.neo(-1,0),M.m_localAnchorB=S?x.getLocalPoint(S):h.localAnchorB||v.neo(1,0),M.m_maxLength=h.maxLength,M.m_mass=0,M.m_impulse=0,M.m_length=0,M.m_state=0,M):new c(h,m,x,S)}return Ln(c,g),c.prototype._serialize=function(){return{type:this.m_type,bodyA:this.m_bodyA,bodyB:this.m_bodyB,collideConnected:this.m_collideConnected,localAnchorA:this.m_localAnchorA,localAnchorB:this.m_localAnchorB,maxLength:this.m_maxLength}},c._deserialize=function(h,m,x){return(h=Q({},h)).bodyA=x(sn,h.bodyA,m),h.bodyB=x(sn,h.bodyB,m),new c(h)},c.prototype.getLocalAnchorA=function(){return this.m_localAnchorA},c.prototype.getLocalAnchorB=function(){return this.m_localAnchorB},c.prototype.setMaxLength=function(h){this.m_maxLength=h},c.prototype.getMaxLength=function(){return this.m_maxLength},c.prototype.getLimitState=function(){return this.m_state},c.prototype.getAnchorA=function(){return this.m_bodyA.getWorldPoint(this.m_localAnchorA)},c.prototype.getAnchorB=function(){return this.m_bodyB.getWorldPoint(this.m_localAnchorB)},c.prototype.getReactionForce=function(h){return v.mulNumVec2(this.m_impulse,this.m_u).mul(h)},c.prototype.getReactionTorque=function(h){return 0},c.prototype.initVelocityConstraints=function(h){this.m_localCenterA=this.m_bodyA.m_sweep.localCenter,this.m_localCenterB=this.m_bodyB.m_sweep.localCenter,this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var m=this.m_bodyA.c_position.c,S=this.m_bodyA.c_velocity.v,M=this.m_bodyA.c_velocity.w,D=this.m_bodyB.c_position.c,R=this.m_bodyB.c_position.a,U=this.m_bodyB.c_velocity.v,O=this.m_bodyB.c_velocity.w,W=X.neo(this.m_bodyA.c_position.a),V=X.neo(R);if(this.m_rA=X.mulSub(W,this.m_localAnchorA,this.m_localCenterA),this.m_rB=X.mulSub(V,this.m_localAnchorB,this.m_localCenterB),this.m_u=v.zero(),this.m_u.addCombine(1,D,1,this.m_rB),this.m_u.subCombine(1,m,1,this.m_rA),this.m_length=this.m_u.length(),this.m_state=this.m_length-this.m_maxLength>0?2:0,!(this.m_length>He.linearSlop))return this.m_u.setZero(),this.m_mass=0,void(this.m_impulse=0);this.m_u.mul(1/this.m_length);var F=v.crossVec2Vec2(this.m_rA,this.m_u),j=v.crossVec2Vec2(this.m_rB,this.m_u),ee=this.m_invMassA+this.m_invIA*F*F+this.m_invMassB+this.m_invIB*j*j;if(this.m_mass=0!=ee?1/ee:0,h.warmStarting){this.m_impulse*=h.dtRatio;var Z=v.mulNumVec2(this.m_impulse,this.m_u);S.subMul(this.m_invMassA,Z),M-=this.m_invIA*v.crossVec2Vec2(this.m_rA,Z),U.addMul(this.m_invMassB,Z),O+=this.m_invIB*v.crossVec2Vec2(this.m_rB,Z)}else this.m_impulse=0;this.m_bodyA.c_velocity.v.setVec2(S),this.m_bodyA.c_velocity.w=M,this.m_bodyB.c_velocity.v.setVec2(U),this.m_bodyB.c_velocity.w=O},c.prototype.solveVelocityConstraints=function(h){var m=this.m_bodyA.c_velocity.v,x=this.m_bodyA.c_velocity.w,S=this.m_bodyB.c_velocity.v,M=this.m_bodyB.c_velocity.w,D=v.addCrossNumVec2(m,x,this.m_rA),R=v.addCrossNumVec2(S,M,this.m_rB),U=this.m_length-this.m_maxLength,O=v.dot(this.m_u,v.sub(R,D));U<0&&(O+=h.inv_dt*U);var W=-this.m_mass*O,V=this.m_impulse;this.m_impulse=oe.min(0,this.m_impulse+W);var B=v.mulNumVec2(W=this.m_impulse-V,this.m_u);m.subMul(this.m_invMassA,B),x-=this.m_invIA*v.crossVec2Vec2(this.m_rA,B),S.addMul(this.m_invMassB,B),M+=this.m_invIB*v.crossVec2Vec2(this.m_rB,B),this.m_bodyA.c_velocity.v=m,this.m_bodyA.c_velocity.w=x,this.m_bodyB.c_velocity.v=S,this.m_bodyB.c_velocity.w=M},c.prototype.solvePositionConstraints=function(h){var m=this.m_bodyA.c_position.c,x=this.m_bodyA.c_position.a,S=this.m_bodyB.c_position.c,M=this.m_bodyB.c_position.a,D=X.neo(x),R=X.neo(M),U=X.mulSub(D,this.m_localAnchorA,this.m_localCenterA),O=X.mulSub(R,this.m_localAnchorB,this.m_localCenterB),W=v.zero();W.addCombine(1,S,1,O),W.subCombine(1,m,1,U);var V=W.normalize(),B=V-this.m_maxLength;B=oe.clamp(B,0,He.maxLinearCorrection);var j=v.mulNumVec2(-this.m_mass*B,W);return m.subMul(this.m_invMassA,j),x-=this.m_invIA*v.crossVec2Vec2(U,j),S.addMul(this.m_invMassB,j),M+=this.m_invIB*v.crossVec2Vec2(O,j),this.m_bodyA.c_position.c.setVec2(m),this.m_bodyA.c_position.a=x,this.m_bodyB.c_position.c.setVec2(S),this.m_bodyB.c_position.a=M,V-this.m_maxLength<He.linearSlop},c.TYPE="rope-joint",c}(Ri),Sd={frequencyHz:0,dampingRatio:0},bu=function(g){function c(h,m,x,S){var M=this;return M instanceof c?(h=ge(h,Sd),m=(M=g.call(this,h,m,x)||this).m_bodyA,x=M.m_bodyB,M.m_type=c.TYPE,M.m_localAnchorA=v.clone(S?m.getLocalPoint(S):h.localAnchorA||v.zero()),M.m_localAnchorB=v.clone(S?x.getLocalPoint(S):h.localAnchorB||v.zero()),M.m_referenceAngle=oe.isFinite(h.referenceAngle)?h.referenceAngle:x.getAngle()-m.getAngle(),M.m_frequencyHz=h.frequencyHz,M.m_dampingRatio=h.dampingRatio,M.m_impulse=new qt,M.m_bias=0,M.m_gamma=0,M.m_mass=new Or,M):new c(h,m,x,S)}return Ln(c,g),c.prototype._serialize=function(){return{type:this.m_type,bodyA:this.m_bodyA,bodyB:this.m_bodyB,collideConnected:this.m_collideConnected,frequencyHz:this.m_frequencyHz,dampingRatio:this.m_dampingRatio,localAnchorA:this.m_localAnchorA,localAnchorB:this.m_localAnchorB,referenceAngle:this.m_referenceAngle}},c._deserialize=function(h,m,x){return(h=Q({},h)).bodyA=x(sn,h.bodyA,m),h.bodyB=x(sn,h.bodyB,m),new c(h)},c.prototype._setAnchors=function(h){h.anchorA?this.m_localAnchorA.setVec2(this.m_bodyA.getLocalPoint(h.anchorA)):h.localAnchorA&&this.m_localAnchorA.setVec2(h.localAnchorA),h.anchorB?this.m_localAnchorB.setVec2(this.m_bodyB.getLocalPoint(h.anchorB)):h.localAnchorB&&this.m_localAnchorB.setVec2(h.localAnchorB)},c.prototype.getLocalAnchorA=function(){return this.m_localAnchorA},c.prototype.getLocalAnchorB=function(){return this.m_localAnchorB},c.prototype.getReferenceAngle=function(){return this.m_referenceAngle},c.prototype.setFrequency=function(h){this.m_frequencyHz=h},c.prototype.getFrequency=function(){return this.m_frequencyHz},c.prototype.setDampingRatio=function(h){this.m_dampingRatio=h},c.prototype.getDampingRatio=function(){return this.m_dampingRatio},c.prototype.getAnchorA=function(){return this.m_bodyA.getWorldPoint(this.m_localAnchorA)},c.prototype.getAnchorB=function(){return this.m_bodyB.getWorldPoint(this.m_localAnchorB)},c.prototype.getReactionForce=function(h){return v.neo(this.m_impulse.x,this.m_impulse.y).mul(h)},c.prototype.getReactionTorque=function(h){return h*this.m_impulse.z},c.prototype.initVelocityConstraints=function(h){this.m_localCenterA=this.m_bodyA.m_sweep.localCenter,this.m_localCenterB=this.m_bodyB.m_sweep.localCenter,this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var m=this.m_bodyA.c_position.a,x=this.m_bodyA.c_velocity.v,S=this.m_bodyA.c_velocity.w,M=this.m_bodyB.c_position.a,D=this.m_bodyB.c_velocity.v,R=this.m_bodyB.c_velocity.w,U=X.neo(m),O=X.neo(M);this.m_rA=X.mulVec2(U,v.sub(this.m_localAnchorA,this.m_localCenterA)),this.m_rB=X.mulVec2(O,v.sub(this.m_localAnchorB,this.m_localCenterB));var W=this.m_invMassA,V=this.m_invMassB,B=this.m_invIA,F=this.m_invIB,j=new Or;if(j.ex.x=W+V+this.m_rA.y*this.m_rA.y*B+this.m_rB.y*this.m_rB.y*F,j.ey.x=-this.m_rA.y*this.m_rA.x*B-this.m_rB.y*this.m_rB.x*F,j.ez.x=-this.m_rA.y*B-this.m_rB.y*F,j.ex.y=j.ey.x,j.ey.y=W+V+this.m_rA.x*this.m_rA.x*B+this.m_rB.x*this.m_rB.x*F,j.ez.y=this.m_rA.x*B+this.m_rB.x*F,j.ex.z=j.ez.x,j.ey.z=j.ez.y,j.ez.z=B+F,this.m_frequencyHz>0){j.getInverse22(this.m_mass);var ee=B+F,Z=ee>0?1/ee:0,re=M-m-this.m_referenceAngle,se=2*oe.PI*this.m_frequencyHz,de=Z*se*se,Ie=h.dt;this.m_gamma=Ie*(2*Z*this.m_dampingRatio*se+Ie*de),this.m_gamma=0!=this.m_gamma?1/this.m_gamma:0,this.m_bias=re*Ie*de*this.m_gamma,this.m_mass.ez.z=0!=(ee+=this.m_gamma)?1/ee:0}else 0==j.ez.z?(j.getInverse22(this.m_mass),this.m_gamma=0,this.m_bias=0):(j.getSymInverse33(this.m_mass),this.m_gamma=0,this.m_bias=0);if(h.warmStarting){this.m_impulse.mul(h.dtRatio);var Oe=v.neo(this.m_impulse.x,this.m_impulse.y);x.subMul(W,Oe),S-=B*(v.crossVec2Vec2(this.m_rA,Oe)+this.m_impulse.z),D.addMul(V,Oe),R+=F*(v.crossVec2Vec2(this.m_rB,Oe)+this.m_impulse.z)}else this.m_impulse.setZero();this.m_bodyA.c_velocity.v=x,this.m_bodyA.c_velocity.w=S,this.m_bodyB.c_velocity.v=D,this.m_bodyB.c_velocity.w=R},c.prototype.solveVelocityConstraints=function(h){var m=this.m_bodyA.c_velocity.v,x=this.m_bodyA.c_velocity.w,S=this.m_bodyB.c_velocity.v,M=this.m_bodyB.c_velocity.w,D=this.m_invMassA,R=this.m_invMassB,U=this.m_invIA,O=this.m_invIB;if(this.m_frequencyHz>0){var V=-this.m_mass.ez.z*(M-x+this.m_bias+this.m_gamma*this.m_impulse.z);this.m_impulse.z+=V,x-=U*V,M+=O*V,(B=v.zero()).addCombine(1,S,1,v.crossNumVec2(M,this.m_rB)),B.subCombine(1,m,1,v.crossNumVec2(x,this.m_rA));var F=v.neg(Or.mulVec2(this.m_mass,B));this.m_impulse.x+=F.x,this.m_impulse.y+=F.y;var j=v.clone(F);m.subMul(D,j),x-=U*v.crossVec2Vec2(this.m_rA,j),S.addMul(R,j),M+=O*v.crossVec2Vec2(this.m_rB,j)}else{var B;(B=v.zero()).addCombine(1,S,1,v.crossNumVec2(M,this.m_rB)),B.subCombine(1,m,1,v.crossNumVec2(x,this.m_rA));var ee=new qt(B.x,B.y,M-x),Z=qt.neg(Or.mulVec3(this.m_mass,ee));this.m_impulse.add(Z),j=v.neo(Z.x,Z.y),m.subMul(D,j),x-=U*(v.crossVec2Vec2(this.m_rA,j)+Z.z),S.addMul(R,j),M+=O*(v.crossVec2Vec2(this.m_rB,j)+Z.z)}this.m_bodyA.c_velocity.v=m,this.m_bodyA.c_velocity.w=x,this.m_bodyB.c_velocity.v=S,this.m_bodyB.c_velocity.w=M},c.prototype.solvePositionConstraints=function(h){var j,ee,m=this.m_bodyA.c_position.c,x=this.m_bodyA.c_position.a,S=this.m_bodyB.c_position.c,M=this.m_bodyB.c_position.a,D=X.neo(x),R=X.neo(M),U=this.m_invMassA,O=this.m_invMassB,W=this.m_invIA,V=this.m_invIB,B=X.mulVec2(D,v.sub(this.m_localAnchorA,this.m_localCenterA)),F=X.mulVec2(R,v.sub(this.m_localAnchorB,this.m_localCenterB)),Z=new Or;if(Z.ex.x=U+O+B.y*B.y*W+F.y*F.y*V,Z.ey.x=-B.y*B.x*W-F.y*F.x*V,Z.ez.x=-B.y*W-F.y*V,Z.ex.y=Z.ey.x,Z.ey.y=U+O+B.x*B.x*W+F.x*F.x*V,Z.ez.y=B.x*W+F.x*V,Z.ex.z=Z.ez.x,Z.ey.z=Z.ez.y,Z.ez.z=W+V,this.m_frequencyHz>0){(re=v.zero()).addCombine(1,S,1,F),re.subCombine(1,m,1,B),j=re.length(),ee=0;var se=v.neg(Z.solve22(re));m.subMul(U,se),x-=W*v.crossVec2Vec2(B,se),S.addMul(O,se),M+=V*v.crossVec2Vec2(F,se)}else{var re;(re=v.zero()).addCombine(1,S,1,F),re.subCombine(1,m,1,B);var xe=M-x-this.m_referenceAngle;j=re.length(),ee=oe.abs(xe);var de=new qt(re.x,re.y,xe),Ie=new qt;if(Z.ez.z>0)Ie=qt.neg(Z.solve33(de));else{var Oe=v.neg(Z.solve22(re));Ie.set(Oe.x,Oe.y,0)}se=v.neo(Ie.x,Ie.y),m.subMul(U,se),x-=W*(v.crossVec2Vec2(B,se)+Ie.z),S.addMul(O,se),M+=V*(v.crossVec2Vec2(F,se)+Ie.z)}return this.m_bodyA.c_position.c=m,this.m_bodyA.c_position.a=x,this.m_bodyB.c_position.c=S,this.m_bodyB.c_position.a=M,j<=He.linearSlop&&ee<=He.angularSlop},c.TYPE="weld-joint",c}(Ri),Hm={enableMotor:!1,maxMotorTorque:0,motorSpeed:0,frequencyHz:2,dampingRatio:.7},Au=function(g){function c(h,m,x,S,M){var D=this;return D instanceof c?(h=ge(h,Hm),(D=g.call(this,h,m,x)||this).m_ax=v.zero(),D.m_ay=v.zero(),m=D.m_bodyA,x=D.m_bodyB,D.m_type=c.TYPE,D.m_localAnchorA=v.clone(S?m.getLocalPoint(S):h.localAnchorA||v.zero()),D.m_localAnchorB=v.clone(S?x.getLocalPoint(S):h.localAnchorB||v.zero()),D.m_localXAxisA=v.clone(M?m.getLocalVector(M):h.localAxisA||h.localAxis||v.neo(1,0)),D.m_localYAxisA=v.crossNumVec2(1,D.m_localXAxisA),D.m_mass=0,D.m_impulse=0,D.m_motorMass=0,D.m_motorImpulse=0,D.m_springMass=0,D.m_springImpulse=0,D.m_maxMotorTorque=h.maxMotorTorque,D.m_motorSpeed=h.motorSpeed,D.m_enableMotor=h.enableMotor,D.m_frequencyHz=h.frequencyHz,D.m_dampingRatio=h.dampingRatio,D.m_bias=0,D.m_gamma=0,D):new c(h,m,x,S,M)}return Ln(c,g),c.prototype._serialize=function(){return{type:this.m_type,bodyA:this.m_bodyA,bodyB:this.m_bodyB,collideConnected:this.m_collideConnected,enableMotor:this.m_enableMotor,maxMotorTorque:this.m_maxMotorTorque,motorSpeed:this.m_motorSpeed,frequencyHz:this.m_frequencyHz,dampingRatio:this.m_dampingRatio,localAnchorA:this.m_localAnchorA,localAnchorB:this.m_localAnchorB,localAxisA:this.m_localXAxisA}},c._deserialize=function(h,m,x){return(h=Q({},h)).bodyA=x(sn,h.bodyA,m),h.bodyB=x(sn,h.bodyB,m),new c(h)},c.prototype._setAnchors=function(h){h.anchorA?this.m_localAnchorA.setVec2(this.m_bodyA.getLocalPoint(h.anchorA)):h.localAnchorA&&this.m_localAnchorA.setVec2(h.localAnchorA),h.anchorB?this.m_localAnchorB.setVec2(this.m_bodyB.getLocalPoint(h.anchorB)):h.localAnchorB&&this.m_localAnchorB.setVec2(h.localAnchorB),h.localAxisA&&(this.m_localXAxisA.setVec2(h.localAxisA),this.m_localYAxisA.setVec2(v.crossNumVec2(1,h.localAxisA)))},c.prototype.getLocalAnchorA=function(){return this.m_localAnchorA},c.prototype.getLocalAnchorB=function(){return this.m_localAnchorB},c.prototype.getLocalAxisA=function(){return this.m_localXAxisA},c.prototype.getJointTranslation=function(){var h=this.m_bodyA,m=this.m_bodyB,x=h.getWorldPoint(this.m_localAnchorA),S=m.getWorldPoint(this.m_localAnchorB),M=v.sub(S,x),D=h.getWorldVector(this.m_localXAxisA);return v.dot(M,D)},c.prototype.getJointSpeed=function(){return this.m_bodyB.m_angularVelocity-this.m_bodyA.m_angularVelocity},c.prototype.isMotorEnabled=function(){return this.m_enableMotor},c.prototype.enableMotor=function(h){this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_enableMotor=h},c.prototype.setMotorSpeed=function(h){this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_motorSpeed=h},c.prototype.getMotorSpeed=function(){return this.m_motorSpeed},c.prototype.setMaxMotorTorque=function(h){this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_maxMotorTorque=h},c.prototype.getMaxMotorTorque=function(){return this.m_maxMotorTorque},c.prototype.getMotorTorque=function(h){return h*this.m_motorImpulse},c.prototype.setSpringFrequencyHz=function(h){this.m_frequencyHz=h},c.prototype.getSpringFrequencyHz=function(){return this.m_frequencyHz},c.prototype.setSpringDampingRatio=function(h){this.m_dampingRatio=h},c.prototype.getSpringDampingRatio=function(){return this.m_dampingRatio},c.prototype.getAnchorA=function(){return this.m_bodyA.getWorldPoint(this.m_localAnchorA)},c.prototype.getAnchorB=function(){return this.m_bodyB.getWorldPoint(this.m_localAnchorB)},c.prototype.getReactionForce=function(h){return v.combine(this.m_impulse,this.m_ay,this.m_springImpulse,this.m_ax).mul(h)},c.prototype.getReactionTorque=function(h){return h*this.m_motorImpulse},c.prototype.initVelocityConstraints=function(h){this.m_localCenterA=this.m_bodyA.m_sweep.localCenter,this.m_localCenterB=this.m_bodyB.m_sweep.localCenter,this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var m=this.m_invMassA,x=this.m_invMassB,S=this.m_invIA,M=this.m_invIB,D=this.m_bodyA.c_position.c,U=this.m_bodyA.c_velocity.v,O=this.m_bodyA.c_velocity.w,W=this.m_bodyB.c_position.c,V=this.m_bodyB.c_position.a,B=this.m_bodyB.c_velocity.v,F=this.m_bodyB.c_velocity.w,j=X.neo(this.m_bodyA.c_position.a),ee=X.neo(V),Z=X.mulVec2(j,v.sub(this.m_localAnchorA,this.m_localCenterA)),re=X.mulVec2(ee,v.sub(this.m_localAnchorB,this.m_localCenterB)),se=v.zero();if(se.addCombine(1,W,1,re),se.subCombine(1,D,1,Z),this.m_ay=X.mulVec2(j,this.m_localYAxisA),this.m_sAy=v.crossVec2Vec2(v.add(se,Z),this.m_ay),this.m_sBy=v.crossVec2Vec2(re,this.m_ay),this.m_mass=m+x+S*this.m_sAy*this.m_sAy+M*this.m_sBy*this.m_sBy,this.m_mass>0&&(this.m_mass=1/this.m_mass),this.m_springMass=0,this.m_bias=0,this.m_gamma=0,this.m_frequencyHz>0){this.m_ax=X.mulVec2(j,this.m_localXAxisA),this.m_sAx=v.crossVec2Vec2(v.add(se,Z),this.m_ax),this.m_sBx=v.crossVec2Vec2(re,this.m_ax);var xe=m+x+S*this.m_sAx*this.m_sAx+M*this.m_sBx*this.m_sBx;if(xe>0){this.m_springMass=1/xe;var de=v.dot(se,this.m_ax),Ie=2*oe.PI*this.m_frequencyHz,ze=this.m_springMass*Ie*Ie,nt=h.dt;this.m_gamma=nt*(2*this.m_springMass*this.m_dampingRatio*Ie+nt*ze),this.m_gamma>0&&(this.m_gamma=1/this.m_gamma),this.m_bias=de*nt*ze*this.m_gamma,this.m_springMass=xe+this.m_gamma,this.m_springMass>0&&(this.m_springMass=1/this.m_springMass)}}else this.m_springImpulse=0;if(this.m_enableMotor?(this.m_motorMass=S+M,this.m_motorMass>0&&(this.m_motorMass=1/this.m_motorMass)):(this.m_motorMass=0,this.m_motorImpulse=0),h.warmStarting){this.m_impulse*=h.dtRatio,this.m_springImpulse*=h.dtRatio,this.m_motorImpulse*=h.dtRatio;var pt=v.combine(this.m_impulse,this.m_ay,this.m_springImpulse,this.m_ax),$e=this.m_impulse*this.m_sAy+this.m_springImpulse*this.m_sAx+this.m_motorImpulse,Ue=this.m_impulse*this.m_sBy+this.m_springImpulse*this.m_sBx+this.m_motorImpulse;U.subMul(this.m_invMassA,pt),O-=this.m_invIA*$e,B.addMul(this.m_invMassB,pt),F+=this.m_invIB*Ue}else this.m_impulse=0,this.m_springImpulse=0,this.m_motorImpulse=0;this.m_bodyA.c_velocity.v.setVec2(U),this.m_bodyA.c_velocity.w=O,this.m_bodyB.c_velocity.v.setVec2(B),this.m_bodyB.c_velocity.w=F},c.prototype.solveVelocityConstraints=function(h){var m=this.m_invMassA,x=this.m_invMassB,S=this.m_invIA,M=this.m_invIB,D=this.m_bodyA.c_velocity.v,R=this.m_bodyA.c_velocity.w,U=this.m_bodyB.c_velocity.v,O=this.m_bodyB.c_velocity.w,W=v.dot(this.m_ax,U)-v.dot(this.m_ax,D)+this.m_sBx*O-this.m_sAx*R;this.m_springImpulse+=V=-this.m_springMass*(W+this.m_bias+this.m_gamma*this.m_springImpulse);var B=v.mulNumVec2(V,this.m_ax),F=V*this.m_sAx,j=V*this.m_sBx;D.subMul(m,B),R-=S*F,U.addMul(x,B);var V,ee=this.m_motorImpulse,Z=h.dt*this.m_maxMotorTorque;this.m_motorImpulse=oe.clamp(this.m_motorImpulse+(V=-this.m_motorMass*(W=(O+=M*j)-R-this.m_motorSpeed)),-Z,Z),R-=S*(V=this.m_motorImpulse-ee),O+=M*V,W=v.dot(this.m_ay,U)-v.dot(this.m_ay,D)+this.m_sBy*O-this.m_sAy*R,this.m_impulse+=V=-this.m_mass*W,B=v.mulNumVec2(V,this.m_ay),F=V*this.m_sAy,j=V*this.m_sBy,D.subMul(m,B),R-=S*F,U.addMul(x,B),O+=M*j,this.m_bodyA.c_velocity.v.setVec2(D),this.m_bodyA.c_velocity.w=R,this.m_bodyB.c_velocity.v.setVec2(U),this.m_bodyB.c_velocity.w=O},c.prototype.solvePositionConstraints=function(h){var m=this.m_bodyA.c_position.c,x=this.m_bodyA.c_position.a,S=this.m_bodyB.c_position.c,M=this.m_bodyB.c_position.a,D=X.neo(x),R=X.neo(M),U=X.mulVec2(D,v.sub(this.m_localAnchorA,this.m_localCenterA)),O=X.mulVec2(R,v.sub(this.m_localAnchorB,this.m_localCenterB)),W=v.zero();W.addCombine(1,S,1,O),W.subCombine(1,m,1,U);var Z,V=X.mulVec2(D,this.m_localYAxisA),B=v.crossVec2Vec2(v.add(W,U),V),F=v.crossVec2Vec2(O,V),j=v.dot(W,V),ee=this.m_invMassA+this.m_invMassB+this.m_invIA*this.m_sAy*this.m_sAy+this.m_invIB*this.m_sBy*this.m_sBy,re=v.mulNumVec2(Z=0!=ee?-j/ee:0,V),se=Z*B,xe=Z*F;return m.subMul(this.m_invMassA,re),x-=this.m_invIA*se,S.addMul(this.m_invMassB,re),M+=this.m_invIB*xe,this.m_bodyA.c_position.c.setVec2(m),this.m_bodyA.c_position.a=x,this.m_bodyB.c_position.c.setVec2(S),this.m_bodyB.c_position.a=M,oe.abs(j)<=He.linearSlop},c.TYPE="wheel-joint",c}(Ri),Gm=0;function va(g){var c,h=(g=g||{}).rootClass||gu,m=g.preSerialize||function(O){return O},x=g.postSerialize||function(O,W){return O},S=g.preDeserialize||function(O){return O},M=g.postDeserialize||function(O,W){return O},D={World:gu,Body:sn,Joint:Ri,Fixture:xr,Shape:ai},R=Q({Vec2:v,Vec3:qt},D),U=((c={})[sn.STATIC]=sn,c[sn.DYNAMIC]=sn,c[sn.KINEMATIC]=sn,c[pa.TYPE]=pa,c[yl.TYPE]=yl,c[es.TYPE]=es,c[ts.TYPE]=ts,c[ns.TYPE]=ns,c[xl.TYPE]=xl,c[vu.TYPE]=vu,c[wl.TYPE]=wl,c[Ml.TYPE]=Ml,c[xu.TYPE]=xu,c[Vr.TYPE]=Vr,c[ga.TYPE]=ga,c[is.TYPE]=is,c[Sl.TYPE]=Sl,c[bu.TYPE]=bu,c[Au.TYPE]=Au,c);this.toJson=function(O){var W=[],V=[O],B={};function F(se,xe){return se.__sid=se.__sid||++Gm,B[se.__sid]||(V.push(se),B[se.__sid]={refIndex:W.length+V.length,refType:xe}),B[se.__sid]}function ee(se,xe){if("object"!=typeof se||null===se)return se;if("function"==typeof se._serialize){if(se!==xe)for(var de in D)if(se instanceof D[de])return F(se,de);se=function j(se){var xe=(se=m(se))._serialize();return x(xe,se)}(se)}if(Array.isArray(se)){for(var Ie=[],Oe=0;Oe<se.length;Oe++)Ie[Oe]=ee(se[Oe]);se=Ie}else{for(var Oe in Ie={},se)se.hasOwnProperty(Oe)&&(Ie[Oe]=ee(se[Oe]));se=Ie}return se}for(;V.length;){var Z=V.shift(),re=ee(Z,Z);W.push(re)}return W},this.fromJson=function(O){var W={};function B(ee,Z,re){var se=function V(ee,Z){return(!Z||!Z._deserialize)&&(Z=U[ee.type]),Z&&Z._deserialize}(Z,ee);if(se){var xe=se(Z=S(Z),re,F);return M(xe,Z)}}function F(ee,Z,re){if(!Z.refIndex)return ee&&ee._deserialize&&B(ee,Z,re);ee=R[Z.refType]||ee;var se=Z.refIndex;if(!W[se]){var de=B(ee,O[se],re);W[se]=de}return W[se]}return h._deserialize(O[0],null,F)}}var Ed=new va;function wu(g,c,h,m,x){g.pointCount=0;var S=ne.mulVec2(h,c.m_p),M=ne.mulVec2(x,m.m_p),D=v.distanceSquared(M,S),O=c.m_radius+m.m_radius;D>O*O||(g.type=en.e_circles,g.localPoint.setVec2(c.m_p),g.localNormal.setZero(),g.pointCount=1,g.points[0].localPoint.setVec2(m.m_p),g.points[0].id.cf.indexA=0,g.points[0].id.cf.typeA=on.e_vertex,g.points[0].id.cf.indexB=0,g.points[0].id.cf.typeB=on.e_vertex)}function El(g,c,h,m,x){g.pointCount=0;var S=ne.mulTVec2(h,ne.mulVec2(x,m.m_p)),M=c.m_vertex1,D=c.m_vertex2,R=v.sub(D,M),U=v.dot(R,v.sub(D,S)),O=v.dot(R,v.sub(S,M)),W=c.m_radius+m.m_radius;if(O<=0){var V=v.clone(M),B=v.sub(S,V);if(v.dot(B,B)>W*W)return;if(c.m_hasVertex0){var ee=M,Z=v.sub(ee,c.m_vertex0);if(v.dot(Z,v.sub(ee,S))>0)return}return g.type=en.e_circles,g.localNormal.setZero(),g.localPoint.setVec2(V),g.pointCount=1,g.points[0].localPoint.setVec2(m.m_p),g.points[0].id.cf.indexA=0,g.points[0].id.cf.typeA=on.e_vertex,g.points[0].id.cf.indexB=0,void(g.points[0].id.cf.typeB=on.e_vertex)}if(U<=0){var se=v.clone(D),xe=v.sub(S,se);if(v.dot(xe,xe)>W*W)return;if(c.m_hasVertex3){var Oe=D,ze=v.sub(c.m_vertex3,Oe);if(v.dot(ze,v.sub(S,Oe))>0)return}return g.type=en.e_circles,g.localNormal.setZero(),g.localPoint.setVec2(se),g.pointCount=1,g.points[0].localPoint.setVec2(m.m_p),g.points[0].id.cf.indexA=1,g.points[0].id.cf.typeA=on.e_vertex,g.points[0].id.cf.indexB=0,void(g.points[0].id.cf.typeB=on.e_vertex)}var pt=v.dot(R,R),$e=v.combine(U/pt,M,O/pt,D),Ue=v.sub(S,$e);if(!(v.dot(Ue,Ue)>W*W)){var Tt=v.neo(-R.y,R.x);v.dot(Tt,v.sub(S,M))<0&&Tt.setNum(-Tt.x,-Tt.y),Tt.normalize(),g.type=en.e_faceA,g.localNormal=Tt,g.localPoint.setVec2(M),g.pointCount=1,g.points[0].localPoint.setVec2(m.m_p),g.points[0].id.cf.indexA=0,g.points[0].id.cf.typeA=on.e_face,g.points[0].id.cf.indexB=0,g.points[0].id.cf.typeB=on.e_vertex}}function Td(g,c,h,m,x){for(var S=g.m_count,M=h.m_count,D=g.m_normals,R=g.m_vertices,U=h.m_vertices,O=ne.mulTXf(m,c),W=0,V=-1/0,B=0;B<S;++B){for(var F=X.mulVec2(O.q,D[B]),j=ne.mulVec2(O,R[B]),ee=1/0,Z=0;Z<M;++Z){var re=v.dot(F,U[Z])-v.dot(F,j);re<ee&&(ee=re)}ee>V&&(V=ee,W=B)}x.maxSeparation=V,x.bestIndex=W}va.toJson=Ed.toJson,va.fromJson=Ed.fromJson,Fr.addType(ns.TYPE,ns.TYPE,function Wm(g,c,h,m,x,S,M){wu(g,h.getShape(),c,S.getShape(),x)}),Fr.addType(es.TYPE,ns.TYPE,function qm(g,c,h,m,x,S,M){El(g,h.getShape(),c,S.getShape(),x)}),Fr.addType(pa.TYPE,ns.TYPE,function jm(g,c,h,m,x,S,M){var D=h.getShape(),R=new es;D.getChildEdge(R,m),El(g,R,c,S.getShape(),x)}),Fr.addType(ts.TYPE,ts.TYPE,function Mu(g,c,h,m,x,S,M){Sn(g,h.getShape(),c,S.getShape(),x)});var Oo={maxSeparation:0,bestIndex:0};function Sn(g,c,h,m,x){g.pointCount=0;var S=c.m_radius+m.m_radius;Td(c,h,m,x,Oo);var M=Oo.bestIndex,D=Oo.maxSeparation;if(!(D>S)){Td(m,x,c,h,Oo);var U=Oo.maxSeparation;if(!(U>S)){var O,W,V,B,F,j;U>D+.1*He.linearSlop?(O=m,W=c,V=x,B=h,F=Oo.bestIndex,g.type=en.e_faceB,j=1):(O=c,W=m,V=h,B=x,F=M,g.type=en.e_faceA,j=0);var Z=[new Ji,new Ji];!function $m(g,c,h,m,x,S){for(var D=x.m_count,R=x.m_vertices,U=x.m_normals,O=X.mulTVec2(S.q,X.mulVec2(h.q,c.m_normals[m])),W=0,V=1/0,B=0;B<D;++B){var F=v.dot(O,U[B]);F<V&&(V=F,W=B)}var j=W,ee=j+1<D?j+1:0;g[0].v=ne.mulVec2(S,R[j]),g[0].id.cf.indexA=m,g[0].id.cf.indexB=j,g[0].id.cf.typeA=on.e_face,g[0].id.cf.typeB=on.e_vertex,g[1].v=ne.mulVec2(S,R[ee]),g[1].id.cf.indexA=m,g[1].id.cf.indexB=ee,g[1].id.cf.typeA=on.e_face,g[1].id.cf.typeB=on.e_vertex}(Z,O,V,F,W,B);var se=O.m_vertices,xe=F,de=F+1<O.m_count?F+1:0,Ie=se[xe],Oe=se[de],ze=v.sub(Oe,Ie);ze.normalize();var nt=v.crossVec2Num(ze,1),pt=v.combine(.5,Ie,.5,Oe),$e=X.mulVec2(V.q,ze),Ue=v.crossVec2Num($e,1);Ie=ne.mulVec2(V,Ie),Oe=ne.mulVec2(V,Oe);var _n,Rt=v.dot(Ue,Ie),Tt=-v.dot($e,Ie)+S,Gt=v.dot($e,Oe)+S,En=[new Ji,new Ji],rt=[new Ji,new Ji];if(!((_n=br(En,Z,v.neg($e),Tt,xe))<2||(_n=br(rt,En,$e,Gt,de),_n<2))){g.localNormal=nt,g.localPoint=pt;for(var bt=0,dt=0;dt<rt.length;++dt)if(v.dot(Ue,rt[dt].v)-Rt<=S){var At=g.points[bt];if(At.localPoint.setVec2(ne.mulTVec2(B,rt[dt].v)),At.id=rt[dt].id,j){var zt=At.id.cf,lr=zt.indexA,Pi=zt.typeA,cr=zt.typeB;zt.indexA=zt.indexB,zt.indexB=lr,zt.typeA=cr,zt.typeB=Pi}++bt}g.pointCount=bt}}}}function Kn(g,c,h,m,x){g.pointCount=0;for(var S=ne.mulVec2(x,m.m_p),M=ne.mulTVec2(h,S),D=0,R=-1/0,U=c.m_radius+m.m_radius,O=c.m_count,W=c.m_vertices,V=c.m_normals,B=0;B<O;++B){var F=v.dot(V[B],v.sub(M,W[B]));if(F>U)return;F>R&&(R=F,D=B)}var j=D,Z=W[j],re=W[j+1<O?j+1:0];if(R<oe.EPSILON)return g.pointCount=1,g.type=en.e_faceA,g.localNormal.setVec2(V[D]),g.localPoint.setCombine(.5,Z,.5,re),g.points[0].localPoint=m.m_p,g.points[0].id.cf.indexA=0,g.points[0].id.cf.typeA=on.e_vertex,g.points[0].id.cf.indexB=0,void(g.points[0].id.cf.typeB=on.e_vertex);var se=v.dot(v.sub(M,Z),v.sub(re,Z)),xe=v.dot(v.sub(M,re),v.sub(Z,re));if(se<=0){if(v.distanceSquared(M,Z)>U*U)return;g.pointCount=1,g.type=en.e_faceA,g.localNormal.setCombine(1,M,-1,Z),g.localNormal.normalize(),g.localPoint=Z,g.points[0].localPoint.setVec2(m.m_p),g.points[0].id.cf.indexA=0,g.points[0].id.cf.typeA=on.e_vertex,g.points[0].id.cf.indexB=0,g.points[0].id.cf.typeB=on.e_vertex}else if(xe<=0){if(v.distanceSquared(M,re)>U*U)return;g.pointCount=1,g.type=en.e_faceA,g.localNormal.setCombine(1,M,-1,re),g.localNormal.normalize(),g.localPoint.setVec2(re),g.points[0].localPoint.setVec2(m.m_p),g.points[0].id.cf.indexA=0,g.points[0].id.cf.typeA=on.e_vertex,g.points[0].id.cf.indexB=0,g.points[0].id.cf.typeB=on.e_vertex}else{var de=v.mid(Z,re);if(v.dot(M,V[j])-v.dot(de,V[j])>U)return;g.pointCount=1,g.type=en.e_faceA,g.localNormal.setVec2(V[j]),g.localPoint.setVec2(de),g.points[0].localPoint.setVec2(m.m_p),g.points[0].id.cf.indexA=0,g.points[0].id.cf.typeA=on.e_vertex,g.points[0].id.cf.indexB=0,g.points[0].id.cf.typeB=on.e_vertex}}Fr.addType(ts.TYPE,ns.TYPE,function Tl(g,c,h,m,x,S,M){Kn(g,h.getShape(),c,S.getShape(),x)}),Fr.addType(es.TYPE,ts.TYPE,function Su(g,c,h,m,x,S,M){xn(g,h.getShape(),c,S.getShape(),x)}),Fr.addType(pa.TYPE,ts.TYPE,function Xm(g,c,h,m,x,S,M){var D=h.getShape(),R=new es;D.getChildEdge(R,m),xn(g,R,c,S.getShape(),x)});var jn=(()=>((jn=jn||{})[jn.e_unknown=-1]="e_unknown",jn[jn.e_edgeA=1]="e_edgeA",jn[jn.e_edgeB=2]="e_edgeB",jn))(),Cl=function g(){},Eu=function g(){this.vertices=[],this.normals=[],this.count=0},lx=function g(){this.normal=v.zero(),this.sideNormal1=v.zero(),this.sideNormal2=v.zero()},wr=new Cl,Xe=new Cl,zn=new Eu,Ge=new lx;function xn(g,c,h,m,x){var S=ne.mulTXf(h,x),M=ne.mulVec2(S,m.m_centroid),D=c.m_vertex0,R=c.m_vertex1,U=c.m_vertex2,O=c.m_vertex3,W=c.m_hasVertex0,V=c.m_hasVertex3,B=v.sub(U,R);B.normalize();var xe,de,F=v.neo(B.y,-B.x),j=v.dot(F,v.sub(M,R)),ee=0,Z=0,re=!1,se=!1;if(W){var Ie=v.sub(R,D);Ie.normalize(),xe=v.neo(Ie.y,-Ie.x),re=v.crossVec2Vec2(Ie,B)>=0,ee=v.dot(xe,M)-v.dot(xe,D)}if(V){var Oe=v.sub(O,U);Oe.normalize(),de=v.neo(Oe.y,-Oe.x),se=v.crossVec2Vec2(B,Oe)>0,Z=v.dot(de,M)-v.dot(de,U)}var ze,nt=v.zero(),pt=v.zero(),$e=v.zero();W&&V?re&&se?(ze=ee>=0||j>=0||Z>=0)?(nt.setVec2(F),pt.setVec2(xe),$e.setVec2(de)):(nt.setMul(-1,F),pt.setMul(-1,F),$e.setMul(-1,F)):re?(ze=ee>=0||j>=0&&Z>=0)?(nt.setVec2(F),pt.setVec2(xe),$e.setVec2(F)):(nt.setMul(-1,F),pt.setMul(-1,de),$e.setMul(-1,F)):se?(ze=Z>=0||ee>=0&&j>=0)?(nt.setVec2(F),pt.setVec2(F),$e.setVec2(de)):(nt.setMul(-1,F),pt.setMul(-1,F),$e.setMul(-1,xe)):(ze=ee>=0&&j>=0&&Z>=0)?(nt.setVec2(F),pt.setVec2(F),$e.setVec2(F)):(nt.setMul(-1,F),pt.setMul(-1,de),$e.setMul(-1,xe)):W?re?(ze=ee>=0||j>=0)?(nt.setVec2(F),pt.setVec2(xe),$e.setMul(-1,F)):(nt.setMul(-1,F),pt.setVec2(F),$e.setMul(-1,F)):(ze=ee>=0&&j>=0)?(nt.setVec2(F),pt.setVec2(F),$e.setMul(-1,F)):(nt.setMul(-1,F),pt.setVec2(F),$e.setMul(-1,xe)):V?se?(ze=j>=0||Z>=0)?(nt.setVec2(F),pt.setMul(-1,F),$e.setVec2(de)):(nt.setMul(-1,F),pt.setMul(-1,F),$e.setVec2(F)):(ze=j>=0&&Z>=0)?(nt.setVec2(F),pt.setMul(-1,F),$e.setVec2(F)):(nt.setMul(-1,F),pt.setMul(-1,de),$e.setVec2(F)):(ze=j>=0)?(nt.setVec2(F),pt.setMul(-1,F),$e.setMul(-1,F)):(nt.setMul(-1,F),pt.setVec2(F),$e.setVec2(F)),zn.count=m.m_count;for(var Ue=0;Ue<m.m_count;++Ue)zn.vertices[Ue]=ne.mulVec2(S,m.m_vertices[Ue]),zn.normals[Ue]=X.mulVec2(S.q,m.m_normals[Ue]);var Rt=2*He.polygonRadius;for(g.pointCount=0,wr.type=jn.e_edgeA,wr.index=ze?0:1,wr.separation=1/0,Ue=0;Ue<zn.count;++Ue)(Tt=v.dot(nt,v.sub(zn.vertices[Ue],R)))<wr.separation&&(wr.separation=Tt);if(wr.type!=jn.e_unknown&&!(wr.separation>Rt)){Xe.type=jn.e_unknown,Xe.index=-1,Xe.separation=-1/0;var Gt=v.neo(-nt.y,nt.x);for(Ue=0;Ue<zn.count;++Ue){var Tt,En=v.neg(zn.normals[Ue]),rt=v.dot(En,v.sub(zn.vertices[Ue],R)),_n=v.dot(En,v.sub(zn.vertices[Ue],U));if((Tt=oe.min(rt,_n))>Rt){Xe.type=jn.e_edgeB,Xe.index=Ue,Xe.separation=Tt;break}if(v.dot(En,Gt)>=0){if(v.dot(v.sub(En,$e),nt)<-He.angularSlop)continue}else if(v.dot(v.sub(En,pt),nt)<-He.angularSlop)continue;Tt>Xe.separation&&(Xe.type=jn.e_edgeB,Xe.index=Ue,Xe.separation=Tt)}if(!(Xe.type!=jn.e_unknown&&Xe.separation>Rt)){var Ut;Ut=Xe.type==jn.e_unknown?wr:Xe.separation>.98*wr.separation+.001?Xe:wr;var At=[new Ji,new Ji];if(Ut.type==jn.e_edgeA){g.type=en.e_faceA;var zt=0,lr=v.dot(nt,zn.normals[0]);for(Ue=1;Ue<zn.count;++Ue){var kr=v.dot(nt,zn.normals[Ue]);kr<lr&&(lr=kr,zt=Ue)}var Pi=zt,cr=Pi+1<zn.count?Pi+1:0;At[0].v=zn.vertices[Pi],At[0].id.cf.indexA=0,At[0].id.cf.indexB=Pi,At[0].id.cf.typeA=on.e_face,At[0].id.cf.typeB=on.e_vertex,At[1].v=zn.vertices[cr],At[1].id.cf.indexA=0,At[1].id.cf.indexB=cr,At[1].id.cf.typeA=on.e_face,At[1].id.cf.typeB=on.e_vertex,ze?(Ge.i1=0,Ge.i2=1,Ge.v1=R,Ge.v2=U,Ge.normal.setVec2(F)):(Ge.i1=1,Ge.i2=0,Ge.v1=U,Ge.v2=R,Ge.normal.setMul(-1,F))}else g.type=en.e_faceB,At[0].v=R,At[0].id.cf.indexA=0,At[0].id.cf.indexB=Ut.index,At[0].id.cf.typeA=on.e_vertex,At[0].id.cf.typeB=on.e_face,At[1].v=U,At[1].id.cf.indexA=0,At[1].id.cf.indexB=Ut.index,At[1].id.cf.typeA=on.e_vertex,At[1].id.cf.typeB=on.e_face,Ge.i1=Ut.index,Ge.i2=Ge.i1+1<zn.count?Ge.i1+1:0,Ge.v1=zn.vertices[Ge.i1],Ge.v2=zn.vertices[Ge.i2],Ge.normal.setVec2(zn.normals[Ge.i1]);Ge.sideNormal1.setNum(Ge.normal.y,-Ge.normal.x),Ge.sideNormal2.setMul(-1,Ge.sideNormal1),Ge.sideOffset1=v.dot(Ge.sideNormal1,Ge.v1),Ge.sideOffset2=v.dot(Ge.sideNormal2,Ge.v2);var ss,Es=[new Ji,new Ji],Li=[new Ji,new Ji];if(!((ss=br(Es,At,Ge.sideNormal1,Ge.sideOffset1,Ge.i1))<He.maxManifoldPoints||(ss=br(Li,Es,Ge.sideNormal2,Ge.sideOffset2,Ge.i2),ss<He.maxManifoldPoints))){Ut.type==jn.e_edgeA?(g.localNormal=v.clone(Ge.normal),g.localPoint=v.clone(Ge.v1)):(g.localNormal=v.clone(m.m_normals[Ge.i1]),g.localPoint=v.clone(m.m_vertices[Ge.i1]));var Vo=0;for(Ue=0;Ue<He.maxManifoldPoints;++Ue)if(v.dot(Ge.normal,v.sub(Li[Ue].v,Ge.v1))<=Rt){var Ur=g.points[Vo];Ut.type==jn.e_edgeA?(Ur.localPoint=ne.mulTVec2(S,Li[Ue].v),Ur.id=Li[Ue].id):(Ur.localPoint=Li[Ue].v,Ur.id.cf.typeA=Li[Ue].id.cf.typeB,Ur.id.cf.typeB=Li[Ue].id.cf.typeA,Ur.id.cf.indexA=Li[Ue].id.cf.indexB,Ur.id.cf.indexB=Li[Ue].id.cf.indexA),++Vo}g.pointCount=Vo}}}}var rs={};rs.CollidePolygons=Sn,rs.Settings=He,rs.Sweep=mt,rs.Manifold=gl,rs.Distance=Ar,rs.TimeOfImpact=No,rs.DynamicTree=Y,rs.stats=Bn,xd.TimeStep=_u,Ar.testOverlap=Dm,Ar.Input=du,Ar.Output=fa,Ar.Proxy=Ks,Ar.Cache=fu,No.Input=vd,No.Output=Qr,Pt.AABB=Ke,Pt.Body=sn,Pt.Box=yl,Pt.Chain=pa,Pt.Circle=ns,Pt.CollideCircles=wu,Pt.CollideEdgeCircle=El,Pt.CollideEdgePolygon=xn,Pt.CollidePolygonCircle=Kn,Pt.CollidePolygons=Sn,Pt.Contact=Fr,Pt.Distance=Ar,Pt.DistanceJoint=xl,Pt.DynamicTree=Y,Pt.Edge=es,Pt.Fixture=xr,Pt.FrictionJoint=vu,Pt.GearJoint=wl,Pt.Joint=Ri,Pt.Manifold=gl,Pt.Mat22=bi,Pt.Mat33=Or,Pt.Math=oe,Pt.MotorJoint=Ml,Pt.MouseJoint=xu,Pt.Polygon=ts,Pt.PrismaticJoint=Vr,Pt.PulleyJoint=ga,Pt.RevoluteJoint=is,Pt.RopeJoint=Sl,Pt.Rot=X,Pt.Serializer=va,Pt.Settings=He,Pt.Shape=ai,Pt.Sweep=mt,Pt.TimeOfImpact=No,Pt.Transform=ne,Pt.Vec2=v,Pt.Vec3=qt,Pt.WeldJoint=bu,Pt.WheelJoint=Au,Pt.World=gu,Pt.internal=rs,Object.defineProperty(Pt,"__esModule",{value:!0})}(Po)}},_l=>{_l(_l.s=111)}]);